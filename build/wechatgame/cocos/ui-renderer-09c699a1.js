System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./scene-asset-10397f71.js","./math-base-02e87bf8.js","./index-f2c2eec3.js","./pipeline-state-manager-f4a950fe.js","./deprecated-dacf9914.js"],(function(t){"use strict";var e,i,n,r,s,a,o,h,f,u,c,l,_,d,y,D,g,p,v,E,m,A,S,R,b,I,x,C,T,B,w,O,k,P,M,N,L,F,H,V,z,U,G,W,j,X,Y,K,q,Z,J,Q,$,tt,et,it,nt,rt,st,at,ot,ht,ft;return{setters:[function(t){e=t.l,i=t.Q,n=t.x,r=t.d,s=t.A,a=t.F,o=t.f,h=t.g,f=t.y,u=t.i,c=t.G,l=t.H,_=t.I,d=t.m},function(t){y=t.at,D=t.aS,g=t.c,p=t.aT,v=t.ac,E=t.e,m=t.g,A=t.av,S=t.P,R=t.o,b=t.ba,I=t.p,x=t.bm,C=t.R,T=t.q},function(t){B=t.a$,w=t.ce,O=t.bS,k=t.au,P=t.aZ,M=t.bT,N=t.bX,L=t.bU,F=t.b5,H=t.bP,V=t.aI,z=t.b1,U=t.b0,G=t.ad,W=t.aM,j=t.aL,X=t.b_,Y=t.bW,K=t.cf,q=t.b2,Z=t.cg},function(t){J=t.C,Q=t.V,$=t.a,tt=t.e,et=t.R,it=t.h,nt=t.E,rt=t.S},function(){},function(t){st=t.a},function(t){at=t.k,ot=t.j,ht=t.I,ft=t.J}],execute:function(){t({I:void 0,c:void 0,e:void 0,g:gt,h:pt,m:void 0});var ut,ct=t("k",[new y(D.ATTR_POSITION,g.RGB32F)]),lt=t("f",[new y(D.ATTR_POSITION,g.RGB32F),new y(D.ATTR_COLOR,g.RGBA32F)]),_t=t("i",[new y(D.ATTR_POSITION,g.RGB32F),new y(D.ATTR_TEX_COORD,g.RG32F),new y(D.ATTR_COLOR,g.RGBA32F)]),dt=t("o",[new y(D.ATTR_POSITION,g.RGB32F),new y(D.ATTR_TEX_COORD,g.RG32F),new y(D.ATTR_COLOR,g.RGBA8,!0)]),yt=[new y(D.ATTR_POSITION,g.RGB32F),new y(D.ATTR_TEX_COORD,g.RG32F),new y(D.ATTR_COLOR,g.RGBA32F),new y(D.ATTR_COLOR2,g.RGBA32F)],Dt=t("n",[new y(D.ATTR_POSITION,g.RGB32F),new y(D.ATTR_TEX_COORD,g.RG32F),new y(D.ATTR_COLOR,g.RGBA8,!0),new y(D.ATTR_COLOR2,g.RGBA8,!0)]);function gt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=p[n.format].count}return e}function pt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=p[n.format].size}return e}e.internal.vfmtPosUvColor=_t,e.internal.vfmtPosUvTwoColor=yt,e.internal.vfmtPosUvColor4B=dt,e.internal.vfmtPosUvTwoColor4B=Dt,t("v",Object.freeze({__proto__:null,vfmt:ct,vfmtPosColor:lt,vfmtPosUvColor:_t,vfmtPosUvColor4B:dt,vfmtPosUvTwoColor:yt,vfmtPosUvTwoColor4B:Dt,getComponentPerVertex:gt,getAttributeStride:pt})),function(t){t[t.byteOffset=0]="byteOffset",t[t.vertexOffset=1]="vertexOffset",t[t.indexOffset=2]="indexOffset",t[t.dirty=3]="dirty",t[t.count=4]="count"}(ut||(ut={}));var vt,Et,mt,At,St,Rt,bt=t("M",function(){var t=e.prototype;function e(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0,this.initSharedBuffer(),this.syncSharedBufferToNative()}return t.initSharedBuffer=function(){},t.syncSharedBufferToNative=function(){},t.initialize=function(t,e,r,s){this._initVDataCount=r,this._initIDataCount=s,this._attributes=e,this.floatsPerVertex=pt(e)>>2,i(this._initVDataCount/this._floatsPerVertex<65536,n(9005)),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},t.reset=function(){this._nextFreeIAHandle=0,this.dirty=!1},t.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t];e.vertexBuffers[0]&&e.vertexBuffers[0].destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.ia.destroy()}this._iaPool.length=0},t.setDirty=function(){this.dirty=!0},t.request=function(){return r(9002),!1},t.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},t.recycleIA=function(t){for(var e=this._iaPool,i=0;i<this._nextFreeIAHandle;++i)if(t===e[i].ia){var n=e[i];return e[i]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=n)}},t.checkCapacity=function(t,e){var i=(this.vertexOffset+t)*this._floatsPerVertex,n=this.indexOffset+e;return!(i>this._initVDataCount||n>this._initIDataCount)},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){for(var t=st.__isWebIOS14OrIPadOS14Env?this._nextFreeIAHandle:1,e=this.byteOffset,i=this.indexOffset,n=0;n<t;++n){var r=this._iaPool[n],s=new Float32Array(this.vData.buffer,0,e>>2),a=new Uint16Array(this.iData.buffer,0,i),o=r.vertexBuffers[0];e>o.size&&o.resize(e),o.update(s),2*i>r.indexBuffer.size&&r.indexBuffer.resize(2*i),r.indexBuffer.update(a)}this.dirty=!1}},t.createNewIA=function(t){var e,i,n;if(st.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,s=Uint16Array.BYTES_PER_ELEMENT,a=t.createBuffer(new v(E.VERTEX|E.TRANSFER_DST,m.HOST|m.DEVICE,r,r));n=t.createBuffer(new v(E.INDEX|E.TRANSFER_DST,m.HOST|m.DEVICE,s,s)),i=[a],this._iaInfo=new A(this._attributes,i,n),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),i=this._iaInfo.vertexBuffers,n=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:i,indexBuffer:n}},s(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(t){this._byteOffset=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(t){this._indexOffset=t}},{key:"dirty",get:function(){return this._dirty},set:function(t){this._dirty=t}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(t){this._floatsPerVertex=t}},{key:"vData",get:function(){return this._vData},set:function(t){this._vData=t}},{key:"iData",get:function(){return this._iData},set:function(t){this._iData=t}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),e}()),It=function(){function t(t,e){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=pt(e)>>2,this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},s(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}(),xt=new S((function(){return{offset:0,length:0}}),32),Ct=function(){function t(t,e,n,r,s,a){this._ib=void 0,this.vertexAccessor=t,this.bufferId=e,this.meshBuffer=n,this.vertexOffset=r,this.vb=s,this.indexCount=a,this._ib=new Uint16Array(a),i(n===t.getMeshBuffer(e))}return t.prototype.setIndexBuffer=function(){},s(t,[{key:"ib",get:function(){return this._ib}}]),t}(),Tt=t("j",function(t){function e(i,n,r,s){var a;return(a=t.call(this,i,n)||this)._freeLists=[],a._vCount=0,a._iCount=0,a._id=0,a._vCount=r||Math.floor(1024*f.BATCHER2D_MEM_INCREMENT/a._vertexFormatBytes),a._iCount=s||a._vCount*e.IB_SCALE,a._id=e.generateID(),a._allocateBuffer(),a}a(e,t);var i=e.prototype;return i.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var i=this._freeLists[e],n=0;n<i.length;++n)xt.free(i[n])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},i.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},i.getVertexBuffer=function(t){return this._buffers[t].vData},i.getIndexBuffer=function(t){return this._buffers[t].iData},i.getMeshBuffer=function(t){return this._buffers[t]},i.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],i=this._buffers[t];(!e||e.length<i.vData.byteLength)&&i.uploadBuffers()}},i.appendIndices=function(t,e){var i=this._buffers[t];e.length&&(i.iData.set(e,i.indexOffset),i.indexOffset+=e.length)},i.allocateChunk=function(t,e){for(var i,n=t*this.vertexFormatBytes,r=null,s=0,a=-1,h=null,f=0;f<this._buffers.length;++f){r=this._buffers[f],i=this._freeLists[f];for(var u=0;u<i.length;++u)if(i[u].length>=n){h=i[u],s=f,a=u;break}if(h)break}if(h||(s=this._allocateBuffer(),(r=this._buffers[s])&&r.checkCapacity(t,e)&&(a=0,h=this._freeLists[s][a])),h){var c=h.offset/this.vertexFormatBytes,l=new Float32Array(r.vData.buffer,h.offset,n>>2).fill(0);return this._allocateChunkFromEntry(s,a,h,n),new Ct(this,s,r,c,l,e)}return o(9004,n),null},i.recycleChunk=function(t){var e=this._freeLists[t.bufferId],i=this._buffers[t.bufferId],n=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var s=!1,a=0,o=null,h=e[a];h&&h.offset<n;)o=h,h=e[++a];if(o&&0==n-(o.offset+o.length)&&(o.length+=r,n=o.offset,r=o.length,h&&h.offset-(n+r)==0&&(o.length+=h.length,e.splice(a,1),xt.free(h),h=null),s=!0),!s&&h){if(0==h.offset-(n+r))h.offset=n,h.length+=r;else{var f=xt.alloc();f.offset=n,f.length=r,e.splice(a,0,f)}s=!0}if(s)n+r===i.byteOffset&&(i.byteOffset=n);else{var u=xt.alloc();u.offset=n,u.length=r,e.push(u)}}},i._allocateChunkFromEntry=function(t,e,i,n){var r=i.length-n,s=i.offset+n,a=this._buffers[t];a.byteOffset<s&&(a.byteOffset=s),h(r>=0,9004,t,i.offset,i.length),0===r?(this._freeLists[t].splice(e,1),xt.free(i)):(i.offset+=n,i.length=r)},i._allocateBuffer=function(){h(this._buffers.length===this._freeLists.length,9003);var t=new bt,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var i=xt.alloc();i.offset=0,i.length=t.vData.byteLength;var n=[i];return this._freeLists.push(n),at.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},e.generateID=function(){return e.ID_COUNT++},s(e,[{key:"id",get:function(){return this._id}}]),e}(It));Tt.IB_SCALE=4,Tt.ID_COUNT=0,function(t){t[t.DrawInfoType=0]="DrawInfoType",t[t.VertDirty=1]="VertDirty",t[t.IsMeshBuffer=2]="IsMeshBuffer",t[t.Stride=3]="Stride",t[t.Count=4]="Count"}(vt||(vt={})),function(t){t[t.BufferID=0]="BufferID",t[t.AccessorID=1]="AccessorID",t[t.Count=2]="Count"}(Et||(Et={})),function(t){t[t.VertexOffset=0]="VertexOffset",t[t.IndexOffset=1]="IndexOffset",t[t.VBCount=2]="VBCount",t[t.IBCount=3]="IBCount",t[t.DataHash=4]="DataHash",t[t.Count=5]="Count"}(mt||(mt={})),function(t){t[t.COMP=0]="COMP",t[t.MODEL=1]="MODEL",t[t.MIDDLEWARE=2]="MIDDLEWARE",t[t.SUB_NODE=3]="SUB_NODE"}(At||(At=t("m",{}))),t("l",function(){function t(t){this._accId=-1,this._bufferId=-1,this._vertexOffset=0,this._indexOffset=0,this._vb=null,this._ib=null,this._vData=null,this._iData=null,this._vertDirty=!1,this._vbCount=0,this._ibCount=0,this._dataHash=0,this._isMeshBuffer=!1,this._material=null,this._texture=null,this._sampler=null,this._stride=0,this._useLocal=!1,this._model=null,this._drawInfoType=At.COMP,this._subNode=null,this._uint8SharedBuffer=void 0,this._uint16SharedBuffer=void 0,this._uint32SharedBuffer=void 0,this.init(t);var e=this._nativeObj.getAttrSharedBufferForJS(),i=0;this._uint8SharedBuffer=new Uint8Array(e,i,vt.Count),i+=vt.Count*Uint8Array.BYTES_PER_ELEMENT,this._uint16SharedBuffer=new Uint16Array(e,i,Et.Count),i+=Et.Count*Uint16Array.BYTES_PER_ELEMENT,this._uint32SharedBuffer=new Uint32Array(e,i,mt.Count)}var e=t.prototype;return e.init=function(){},e.clear=function(){this._bufferId=0,this._vertexOffset=0,this._indexOffset=0,this._vertDirty=!1},e.setAccId=function(t){this._accId=t},e.setBufferId=function(t){this._bufferId=t},e.setAccAndBuffer=function(t,e){this._bufferId=e,this._accId=t},e.setVertexOffset=function(t){this._vertexOffset=t},e.setIndexOffset=function(t){this._indexOffset=t},e.setVB=function(){},e.setIB=function(){},e.setVData=function(){},e.setIData=function(){},e.setVBCount=function(t){this._vbCount=t},e.setIBCount=function(){},e.setVertDirty=function(t){this._vertDirty=t},e.setDataHash=function(t){this._dataHash=t},e.setIsMeshBuffer=function(t){this._isMeshBuffer=t},e.setMaterial=function(t){this._material=t},e.setTexture=function(t){this._texture=t},e.setSampler=function(t){this._sampler=t},e.setModel=function(){},e.setDrawInfoType=function(t){this._drawInfoType=t},e.setSubNode=function(t){this._subNode=t},e.setStride=function(t){this._stride=t},e.initRender2dBuffer=function(){},e.fillRender2dBuffer=function(){},s(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"render2dBuffer",get:function(){return this._render2dBuffer}}]),t}()),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(St||(St=t("c",{}))),function(t){t[t.stencilTest=0]="stencilTest",t[t.func=1]="func",t[t.stencilMask=2]="stencilMask",t[t.writeMask=3]="writeMask",t[t.failOp=4]="failOp",t[t.zFailOp=5]="zFailOp",t[t.passOp=6]="passOp",t[t.ref=7]="ref",t[t.count=8]="count"}(Rt||(Rt={}));var Bt,wt,Ot,kt,Pt,Mt=t("S",function(){function t(){this._maskStack=[],this._stencilPattern={stencilTest:!0,func:R.ALWAYS,stencilMask:65535,writeMask:65535,failOp:I.KEEP,zFailOp:I.KEEP,passOp:I.KEEP,ref:1},this._stage=St.DISABLED,this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){return t.stencilStage!==St.ENTER_LEVEL?St.CLEAR_INVERTED:St.CLEAR},e.enableMask=function(){this.stage=St.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=St.DISABLED:this.stage=St.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.getMaskStackSize=function(){return this._maskStack.length},e.reset=function(){this._maskStack.length=0,this.stage=St.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,n=!1,r=!1,s=R.LESS,a=this.stencilStateMap;if(e&&e.passes[0]){var o=e.passes[0].depthStencilState,h=0,f=0;o.depthTest&&(h=1),o.depthWrite&&(f=1),i=h|f<<1|o.depthFunc<<2|t<<6|this._maskStack.length<<9,n=o.depthTest,r=o.depthWrite,s=o.depthFunc,a=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(a&&a.has(i))return a.get(i);this.setStateFromStage(t);var u=new b(n,r,s,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return a.set(i,u),u},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===St.DISABLED?(e.stencilTest=!1,e.func=R.ALWAYS,e.failOp=I.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===St.ENABLED?(e.func=R.EQUAL,e.failOp=I.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===St.CLEAR?(e.func=R.NEVER,e.failOp=I.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===St.CLEAR_INVERTED||t===St.ENTER_LEVEL?(e.func=R.NEVER,e.failOp=I.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===St.ENTER_LEVEL_INVERTED&&(e.func=R.NEVER,e.failOp=I.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},s(t,[{key:"stage",get:function(){return this._stage},set:function(t){this._stage=t}},{key:"pattern",get:function(){return this._stencilPattern}}]),t}());Mt.sharedManager=null,Mt.sharedManager=new Mt,function(t){t[t.STATIC=0]="STATIC",t[t.DYNAMIC=1]="DYNAMIC",t[t.CROSSED=2]="CROSSED"}(Bt||(Bt=t("e",{}))),function(t){t[t.localOpacity=0]="localOpacity",t[t.count=1]="count"}(wt||(wt={})),function(t){t[t.colorR=0]="colorR",t[t.colorG=1]="colorG",t[t.colorB=2]="colorB",t[t.colorA=3]="colorA",t[t.maskMode=4]="maskMode",t[t.count=5]="count"}(Ot||(Ot={})),function(t){t[t.colorDirty=0]="colorDirty",t[t.enabled=1]="enabled",t[t.useLocal=2]="useLocal",t[t.count=3]="count"}(kt||(kt={})),function(t){t[t.NONE=0]="NONE",t[t.MASK=1]="MASK",t[t.MASK_INVERTED=2]="MASK_INVERTED",t[t.MASK_NODE=3]="MASK_NODE",t[t.MASK_NODE_INVERTED=4]="MASK_NODE_INVERTED"}(Pt||(Pt={}));var Nt,Lt,Ft,Ht,Vt,zt,Ut,Gt,Wt,jt,Xt,Yt,Kt,qt,Zt,Jt,Qt,$t,te,ee,ie,ne,re,se,ae,oe,he,fe,ue,ce,le,_e,de,ye,De=t("d",function(){function t(){this._renderEntityType=Bt.STATIC,this._dynamicDrawInfoArr=[],this._node=null,this._renderTransform=null,this._stencilStage=St.DISABLED,this._useLocal=!1,this._maskMode=Pt.NONE,this._color=J.WHITE,this._localOpacity=255,this._colorDirty=!0,this._enabled=!1}var e=t.prototype;return e.addDynamicRenderDrawInfo=function(){},e.removeDynamicRenderDrawInfo=function(){},e.clearDynamicRenderDrawInfos=function(){},e.clearStaticRenderDrawInfos=function(){},e.setDynamicRenderDrawInfo=function(){},e.setMaskMode=function(t){this._maskMode=t},e.getStaticRenderDrawInfo=function(){return null},e.setNode=function(t){this._node=t},e.setRenderTransform=function(t){this._renderTransform=t},e.setStencilStage=function(t){this._stencilStage=t},e.setUseLocal=function(t){this._useLocal=t},e.initSharedBuffer=function(){},s(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"renderDrawInfoArr",get:function(){return this._dynamicDrawInfoArr}},{key:"renderEntityType",get:function(){return this._renderEntityType}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t}},{key:"colorDirty",get:function(){return this._colorDirty},set:function(t){this._colorDirty=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}()),ge=pt(_t)>>2,pe=new S((function(){return{x:0,y:0,z:0,u:0,v:0,color:J.WHITE.clone()}}),128),ve=t("B",function(){function t(t){void 0===t&&(t=_t),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=_t,this._drawInfoType=At.COMP,this._multiOwner=!1,this._batcher=null,this._floatStride=t===_t?ge:pt(t)>>2,this._vertexFormat=t}var e=t.prototype;return e.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},e.initRenderDrawInfo=function(t,e){void 0===e&&(e=At.COMP)},e.removeRenderDrawInfo=function(){},e.setRenderDrawInfoAttributes=function(){},s(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(t){this._drawInfoType=t,this._renderDrawInfo&&this._renderDrawInfo.setDrawInfoType(t)}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(t){this._material=t,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(t)}},{key:"dataHash",get:function(){return this._dataHash},set:function(t){this._dataHash=t,this._renderDrawInfo&&this._renderDrawInfo.setDataHash(t)}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(t){this._multiOwner=t}},{key:"batcher",get:function(){return this._batcher||(this._batcher=at.root.batcher2D),this._batcher}}]),t}()),Ee=t("R",function(t){function e(e,i){var n;return void 0===e&&(e=_t),(n=t.call(this,e)||this)._vertDirty=!0,n._textureHash=0,n.indices=null,n.layer=0,n.nodeDirty=!0,n.passDirty=!0,n.textureDirty=!0,n.hashDirty=!0,n._data=[],n._pivotX=0,n._pivotY=0,n._width=0,n._height=0,n._frame=null,n._accessor=null,n.vertexRow=1,n.vertexCol=1,i||(i=n.batcher.switchBufferAccessor(n._vertexFormat)),n._accessor=i,n}a(e,t),e.add=function(t,i){void 0===t&&(t=_t);var n=new e(t,i);return i||(i=at.root.batcher2D.switchBufferAccessor(n._vertexFormat)),n._accessor=i,n},e.remove=function(t){t.clear(),t._accessor=null};var i=e.prototype;return i.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},i.setRenderDrawInfoAttributes=function(){},i.fillDrawInfoAttributes=function(){},i.syncRender2dBuffer=function(){},i.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var i=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),i&&(this.chunk.vb.set(i.vb),this._accessor.recycleChunk(i)),this.updateHash()}},i.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},i.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},i.updatePass=function(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},i.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},i.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=x(t,666),this.hashDirty=!1},i.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(this.material)),this.nodeDirty){var i=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==i&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&(this._renderDrawInfo.setTexture(this.frame?this.frame.getGFXTexture():null),this._renderDrawInfo.setSampler(this.frame?this.frame.getGFXSampler():null))),this.hashDirty&&(this.updateHash(),this._renderDrawInfo&&this._renderDrawInfo.setDataHash(this.dataHash))},i.updateSizeNPivot=function(t,e,i,n){t===this._width&&e===this._height&&i===this._pivotX&&n===this._pivotY||(this._width=t,this._height=e,this._pivotX=i,this._pivotY=n,this.vertDirty=!0)},i.clear=function(){this.resize(0,0),this._data.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},e.createStaticVBAccessor=function(t,e,i){var n=at.root.device;return new Tt(n,t,e,i)},s(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var i=e.length,n=0;for(n=t;n<i;n++)pe.free(e[n]);for(n=i;n<t;n++)e[n]=pe.alloc();e.length=t}this.syncRender2dBuffer()}},{key:"data",get:function(){return this._data}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(t){this._vertDirty=t,this._renderDrawInfo&&t&&this._renderDrawInfo.setVertDirty(t)}},{key:"textureHash",get:function(){return this._textureHash},set:function(t){this._textureHash=t}},{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t,this._renderDrawInfo&&(this._frame?(this._renderDrawInfo.setTexture(this._frame.getGFXTexture()),this._renderDrawInfo.setSampler(this._frame.getGFXSampler())):(this._renderDrawInfo.setTexture(null),this._renderDrawInfo.setSampler(null)))}},{key:"accessor",get:function(){return this._accessor}}]),e}(ve)),me=t("b",function(t){function e(e){var i;return void 0===e&&(e=_t),(i=t.call(this,e)||this)._isMeshBuffer=!0,i.vData=void 0,i.iData=void 0,i.vertexStart=0,i.vertexRange=0,i.indexStart=0,i.indexRange=0,i.lastFilledIndex=0,i.lastFilledVertex=0,i.frame=void 0,i._byteLength=0,i._vertexBuffers=[],i._indexBuffer=null,i._iaPool=null,i._iaInfo=null,i.vData=new Float32Array(256*i.stride),i.iData=new Uint16Array(1536),i}a(e,t),e.add=function(t){void 0===t&&(t=_t);var i=new e;return i._floatStride=t===_t?ge:pt(t)>>2,i._vertexFormat=t,i},e.remove=function(t){t.clear()};var n=e.prototype;return n.request=function(t,e){var i=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=i,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var i=this._byteLength+t*this.stride,n=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,s=this.iData.length,a=this.vData.length,o=this.iData.length;if(i>r||n>s){for(;r<i||s<n;)r=4*(a*=2),s=o*=2;this._reallocBuffer(a,o)}return!0},n.resize=function(t,e){var n=t*this.stride;i(t>=0&&e>=0&&n<=this.vData.byteLength&&e<=this.iData.length),this._vc=t,this._ic=e,this._byteLength=n,this.updateRange(0,t,0,e)},n.updateRange=function(t,e,n,r){i(e>=0&&r>=0&&e<=this._vc&&r<=this._ic),this.vertexStart=t,this.indexStart=n,this.vertexRange=e,this.indexRange=r},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),i=new Uint16Array(this.iData.buffer,0,t),n=this._vertexBuffers[0];this._byteLength>n.size&&n.resize(this._byteLength),n.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(i)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var i=this.stride,n=this._vertexBuffers;n.length||n.push(t.createBuffer(new v(E.VERTEX|E.TRANSFER_DST,m.DEVICE,i,i)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new v(E.INDEX|E.TRANSFER_DST,m.DEVICE,r,r))),this._iaInfo=new A(this._vertexFormat,n,this._indexBuffer),this._iaPool=new C((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),i&&this.vData.set(i,0);var n=this.iData;this.iData=new Uint16Array(e),n&&this.iData.set(n,0)},n.setRenderDrawInfoAttributes=function(){},n.particleInitRenderDrawInfo=function(){},s(e,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),e}(ve)),Ae=(new C((function(){return new me}),32),new Q),Se=new Q,Re=new $,be=new tt,Ie=new tt,xe=new tt,Ce=new tt(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Te=new et,Be=t("a",(Nt=B("cc.UITransform"),Lt=M(),Ft=N(110),Ht=L(),Vt=F(),zt=H(),Ut=F(),Gt=H(),Nt(Wt=Lt(Wt=Ft(Wt=Ht(Wt=w(Wt=O((qt=Kt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._priority=0,l(e,"_contentSize",Xt,_(e)),l(e,"_anchorPoint",Yt,_(e)),e}a(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},i.onEnable=function(){this.node.on(k.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},i.onDisable=function(){this.node.off(k.PARENT_CHANGED,this._parentChanged,this)},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i=this._contentSize;if(void 0===e){if(it((t=t).width,i.width,nt)&&it(t.height,i.height,nt))return;i.width=t.width,i.height=t.height}else{if(it(t=t,i.width,nt)&&it(e,i.height,nt))return;i.width=t,i.height=e}this.node.emit(k.SIZE_CHANGED),this._markRenderDataDirty()},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(k.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},i.isHit=function(t){for(var e=this._contentSize.width,i=this._contentSize.height,n=Ae,r=Se,s=this._getRenderScene().cameras,a=0;a<s.length;a++){var o=s[a];if(o.visibility&this.node.layer){o.node.getWorldRT(be);var h=be.m12,f=be.m13,u=ht.center;if(be.m12=u.x-(be.m00*h+be.m04*f),be.m13=u.y-(be.m01*h+be.m05*f),tt.invert(be,be),Q.transformMat4(n,t,be),this.node.getWorldMatrix(xe),tt.invert(be,xe),!tt.strictEquals(be,Ce)){Q.transformMat4(r,n,be),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*i;var c=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=i&&(c=this._maskTest(n)),c)return!0}}}return!1},i.hitTest=function(t){for(var e=this._contentSize.width,i=this._contentSize.height,n=Re,r=Ae,s=Se,a=this._getRenderScene().cameras,o=0;o<a.length;o++){var h=a[o];if(h.visibility&this.node.layer&&(!h.window||h.window.swapchain)&&($.set(n,t.x,t.y,0),h.screenToWorld(n,n),Q.set(r,n.x,n.y),this.node.getWorldMatrix(xe),tt.invert(be,xe),!tt.strictEquals(be,Ce))){Q.transformMat4(s,r,be),s.x+=this._anchorPoint.x*e,s.y+=this._anchorPoint.y*i;var f=!1;if(s.x>=0&&s.y>=0&&s.x<=e&&s.y<=i&&(f=this._maskTest(r)),f)return!0}}return!1},i._maskTest=function(t){var e,i,n=null===(e=this.node)||void 0===e||null===(i=e.eventProcessor)||void 0===i?void 0:i.maskList;if(n)for(var r=this.node,s=n.length,a=0,o=0;r&&o<s;++a,r=r.parent){var h=n[o];if(a===h.index){if(r!==h.comp.node){n.length=o;break}var f=h.comp;if(f&&f._enabled&&!f.isHit(t))return!1;o++}else if(a>h.index){n.length=o;break}}return!0},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(xe),tt.invert(be,xe),e||(e=new $),$.transformMat4(e,t,be)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(xe),e||(e=new $),$.transformMat4(e,t,xe)},i.getBoundingBox=function(){tt.fromRTS(Ie,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,i=new et(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(Ie),i},i.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(xe),this.getBoundingBoxTo(xe)):this.getBoundingBox()},i.getBoundingBoxTo=function(t){tt.fromRTS(Ie,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var i=this._contentSize.width,n=this._contentSize.height,r=new et(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n);if(tt.multiply(xe,t,Ie),r.transformMat4(xe),!this.node.children)return r;for(var s,a=this.node.children,o=u(a);!(s=o()).done;){var h=s.value;if(h&&h.active){var f=h.getComponent(e);if(f){var c=f.getBoundingBoxTo(t);c&&et.union(r,r,c)}}}return r},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;Te.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),Te.transformMat4(this.node.worldMatrix);var n=Te.x+.5*Te.width,r=Te.y+.5*Te.height,s=this.node.worldPosition.z,a=Te.width/2,o=Te.height/2;return null!=t?(P.set(t,n,r,s,a,o,.001),t):new P(n,r,s,a,o,.001)},i._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},i._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&t.markForUpdateRenderData()},e.insertChangeMap=function(t){var i=t.uuid;e.priorityChangeNodeMap.has(i)||e.priorityChangeNodeMap.set(i,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var i=t._uiProps.uiTransformComp,n=e._uiProps.uiTransformComp,r=(i?i._priority:0)-(n?n._priority:0);return 0===r?t.getSiblingIndex()-e.getSiblingIndex():r}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},s(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(k.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(k.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(k.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(k.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(k.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(k.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?r(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=at.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=at.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(V),Kt.EventType=k,Kt.priorityChangeNodeMap=new Map,c((jt=qt).prototype,"contentSize",[Vt,zt],Object.getOwnPropertyDescriptor(jt.prototype,"contentSize"),jt.prototype),c(jt.prototype,"anchorPoint",[Ut,Gt],Object.getOwnPropertyDescriptor(jt.prototype,"anchorPoint"),jt.prototype),Xt=c(jt.prototype,"_contentSize",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rt(100,100)}}),Yt=c(jt.prototype,"_anchorPoint",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(.5,.5)}}),Wt=jt))||Wt)||Wt)||Wt)||Wt)||Wt)||Wt));at.on(ot.EVENT_AFTER_UPDATE,Be._sortSiblings),at.on(ot.EVENT_BEFORE_SCENE_LAUNCH,Be._cleanChangeMap),d(T),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(ye||(ye=t("I",{})));var we=t("U",(Zt=B("cc.UIRenderer"),Jt=K(Be),Qt=q(),$t=U(G),te=F(),ee=H(),ie=Z(),ne=F(),re=H(),se=U(G),Zt(ae=Jt(ae=O((de=_e=function(t){function e(){var e;return(e=t.call(this)||this)._renderData=null,l(e,"_materials",he,_(e)),l(e,"_customMaterial",fe,_(e)),l(e,"_srcBlendFactor",ue,_(e)),l(e,"_dstBlendFactor",ce,_(e)),l(e,"_color",le,_(e)),e._stencilStage=St.DISABLED,e._assembler=null,e._postAssembler=null,e._renderDataFlag=!0,e._renderFlag=!0,e._renderEntity=void 0,e._instanceMaterialType=-1,e._srcBlendFactorCache=T.SRC_ALPHA,e._dstBlendFactorCache=T.ONE_MINUS_SRC_ALPHA,e._dirtyVersion=-1,e._internalId=-1,e._useVertexOpacity=!1,e._lastParent=null,e._renderEntity=e.createRenderEntity(),e}a(e,t);var i=e.prototype;return i.onLoad=function(){this._renderEntity.setNode(this.node)},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(k.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(k.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(k.PARENT_CHANGED,this._colorDirty,this),this.updateMaterial(),this._colorDirty(),ft.addRenderer(this),this.markForUpdateRenderData()},i.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},i.onDisable=function(){this.node.off(k.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(k.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(k.PARENT_CHANGED,this._colorDirty,this),ft.removeRenderer(this),this._renderFlag=!1,this._renderEntity.enabled=!1},i.onDestroy=function(){if(this._renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var e=this._materialInstances[t];e&&e.destroy()}},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),t){var e=this.renderData;e&&(e.vertDirty=!0),ft.markDirtyRenderer(this)}},i.requestRenderData=function(t){void 0===t&&(t=At.COMP);var e=Ee.add();return e.initRenderDrawInfo(this,t),this._renderData=e,e},i.destroyRenderData=function(){this.renderData&&(this.renderData.removeRenderDrawInfo(this),Ee.remove(this.renderData),this._renderData=null)},i.updateRenderer=function(){this._assembler&&this._assembler.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},i.fillBuffers=function(t){this._renderFlag&&this._render(t)},i.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._canRender=function(){return null!==this.getMaterial(0)&&this._enabled&&this._color.a>0},i._postCanRender=function(){},i.updateMaterial=function(){if(this._customMaterial)this.setMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this.stencilStage!==St.ENTER_LEVEL&&this.stencilStage!==St.ENTER_LEVEL_INVERTED||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},i._updateColor=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0),this.setEntityColor(this._color),this.setEntityOpacity(this.node._uiProps.localOpacity),this._assembler&&(this._assembler.updateColor(this),this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag))},e.setEntityColorDirtyRecursively=function(t,i){var n=t._uiProps.uiComp;n&&n.color&&(n._renderEntity.colorDirty=i);for(var r=0;r<t.children.length;r++)e.setEntityColorDirtyRecursively(t.children[r],i)},i.setEntityColorDirty=function(){},i.setEntityColor=function(){},i.setEntityOpacity=function(){},i.setEntityEnabled=function(){},i._updateBlendFunc=function(){var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(t=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,t.blendDstAlpha=T.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;var e=this.getMaterialInstance(0).passes[0];e.blendState.setTarget(0,t),e._updatePassHash(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},i._nodeStateChange=function(){this.renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0)},i._onMaterialModified=function(e,i){this.renderData&&(this.markForUpdateRenderData(),this.renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,i)},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case ye.ADD_COLOR:t=W.get("ui-base-material");break;case ye.GRAYSCALE:t=W.get("ui-sprite-gray-material");break;case ye.USE_ALPHA_SEPARATED:t=W.get("ui-sprite-alpha-sep-material");break;case ye.USE_ALPHA_SEPARATED_AND_GRAY:t=W.get("ui-sprite-gray-alpha-sep-material");break;default:t=W.get("ui-sprite-material")}return t},i.setNodeDirty=function(){this.renderData&&(this.renderData.nodeDirty=!0)},i.setTextureDirty=function(){this.renderData&&(this.renderData.textureDirty=!0)},i.createRenderEntity=function(){return new De(Bt.STATIC)},s(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(t){this._stencilStage=t,this._renderEntity.setStencilStage(t)}},{key:"batcher",get:function(){return at.root.batcher2D}},{key:"renderEntity",get:function(){return this._renderEntity}}]),e}(j),_e.BlendState=T,_e.Assembler=null,_e.PostAssembler=null,c((oe=de).prototype,"sharedMaterials",[X,Qt],Object.getOwnPropertyDescriptor(oe.prototype,"sharedMaterials"),oe.prototype),c(oe.prototype,"customMaterial",[$t,te,ee,ie,Y],Object.getOwnPropertyDescriptor(oe.prototype,"customMaterial"),oe.prototype),c(oe.prototype,"color",[ne,re],Object.getOwnPropertyDescriptor(oe.prototype,"color"),oe.prototype),he=c(oe.prototype,"_materials",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fe=c(oe.prototype,"_customMaterial",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=c(oe.prototype,"_srcBlendFactor",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.SRC_ALPHA}}),ce=c(oe.prototype,"_dstBlendFactor",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.ONE_MINUS_SRC_ALPHA}}),le=c(oe.prototype,"_color",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return J.WHITE.clone()}}),ae=oe))||ae)||ae)||ae));e.internal.UIRenderer=we}}}));
