System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./math-base-02e87bf8.js","./pipeline-state-manager-f4a950fe.js","./touch-37ec7c16.js"],(function(t,e){"use strict";var n,i,r,s,o,a,u,h,c,l,f,p,_,d,v,g,m,y,b,E,T,w,A,I,C,O,S,R,x,N,M,P,D,L,k,F,B,U,z,H,V,G,j,W,K,Y,q,X,Q,$,Z,J,tt,et,nt,it,rt,st,ot,at,ut,ht,ct,lt,ft,pt,_t,dt,vt,gt,mt,yt,bt,Et,Tt,wt,At,It,Ct,Ot,St,Rt,xt,Nt,Mt,Pt,Dt,Lt,kt,Ft,Bt,Ut,zt,Ht,Vt,Gt,jt,Wt,Kt,Yt,qt,Xt,Qt,$t,Zt,Jt,te,ee,ne,ie,re,se,oe,ae,ue,he,ce,le,fe,pe,_e,de,ve,ge,me,ye,be,Ee,Te,we,Ae,Ie,Ce,Oe,Se,Re,xe,Ne,Me,Pe,De,Le,ke,Fe,Be,Ue,ze,He,Ve,Ge,je,We,Ke,Ye,qe,Xe,Qe,$e,Ze,Je,tn,en,nn,rn,sn,on,an,un,hn,cn,ln,fn,pn,_n,dn,vn,gn,mn,yn;return{setters:[function(t){n=t.A,i=t.l,r=t.m,s=t.Q,o=t.C,a=t.M,u=t.R,h=t.U,c=t.q,l=t.r,f=t.s,p=t.p,_=t.d,d=t.X,v=t.i,g=t.e,m=t.F,y=t.t,b=t.x,E=t.G,T=t.H,w=t.I,A=t.g,I=t.O,C=t.Y,O=t.L,S=t.Z,R=t.$,x=t.a0,N=t.a1,M=t.a2,P=t.a3,D=t.a4,L=t.a5,k=t.a6,F=t.a7,B=t.a8,U=t.a9,z=t.f,H=t.aa,V=t.V,G=t.ab,j=t.y,W=t.ac,K=t.N,Y=t.ad,q=t.J,X=t.ae,Q=t.z,$=t.S,Z=t.af,J=t.E,tt=t.K,et=t.ag,nt=t.ah,it=t.a,rt=t.ai,st=t.aj,ot=t.P,at=t.ak,ut=t.al},function(t){ht=t.bt,ct=t.bu,lt=t.y,ft=t.br,pt=t.bn,_t=t.bx,dt=t.by,vt=t.bp,gt=t.U,mt=t.b,yt=t.a8,bt=t.c,Et=t.n,Tt=t.m,wt=t.k,At=t.aj,It=t.bm,Ct=t.j,Ot=t.i,St=t.a6,Rt=t.A,xt=t.ah,Nt=t.h,Mt=t.ai,Pt=t.bo,Dt=t.T,Lt=t.aG,kt=t.au,Ft=t.a$,Bt=t.aF,Ut=t.J,zt=t.al,Ht=t.ak,Vt=t.am,Gt=t.an,jt=t.ao,Wt=t.aq,Kt=t.ap,Yt=t.ar,qt=t.at,Xt=t.as,Qt=t.t,$t=t.aI,Zt=t.aU,Jt=t.aV,te=t.ac,ee=t.e,ne=t.g,ie=t.av,re=t.bh,se=t.F,oe=t.ad,ae=t.aH,ue=t.bc,he=t.ba,ce=t.b9,le=t.H,fe=t.a7,pe=t.a0,_e=t.bj,de=t.aw,ve=t.ax,ge=t.aA,me=t.aB,ye=t.v,be=t.bz,Ee=t.bq,Te=t.bA,we=t.bB,Ae=t.d,Ie=t.aT,Ce=t.aS},function(t){Oe=t.a,Se=t.e,Re=t.M,xe=t.E,Ne=t.L,Me=t.N,Pe=t.c,De=t.F,Le=t.Q,ke=t.h,Fe=t.V,Be=t.C,Ue=t.S,ze=t.R,He=t.B,Ve=t.z,Ge=t.l,je=t.i,We=t.U,Ke=t.t,Ye=t.P,qe=t.O},function(t){Xe=t.a,Qe=t.C,$e=t.d,Ze=t.S,Je=t.B,tn=t.l,en=t.h,nn=t.E,rn=t.e,sn=t.F,on=t.P,an=t.G,un=t.H,hn=t.c,cn=t.z},function(t){ln=t.d,fn=t.I,pn=t.a,_n=t.K,dn=t.b,vn=t.c,gn=t.T,mn=t.S,yn=t.E}],execute:function(){t({C:void 0,I:op,J:ap,K:up,L:void 0,N:vp,T:void 0,W:Aa,Y:function(t){return t[ns]},Z:Ha,_:xn,a:Rn,aO:void 0,aP:void 0,aQ:void 0,aS:void 0,aq:xE,as:void 0,at:void 0,au:void 0,b:Cn,b0:Rs,b6:function(t){for(var e=t.length-1;e>=0;--e){var n=t[e];if(n.window.swapchain)return void(Xp=n)}Xp=null},b8:function(t,e,n,i,r){if(i&&i.enabled&&r===Xp){var s=i.subModels[0],o=s.inputAssembler,a=s.passes,u=s.shaders,h=s.descriptorSet;kp.width=Fp.width=r.window.width,kp.height=Fp.height=r.window.height;var c=on.getOrCreatePipelineState(t,a[0],u[0],e,o);n.setViewport(kp),n.setScissor(Fp),n.bindPipelineState(c),n.bindDescriptorSet(Ze.MATERIAL,a[0].descriptorSet),n.bindDescriptorSet(Ze.LOCAL,h),n.bindInputAssembler(o),n.draw(o)}},b9:Bp,bC:void 0,bD:io,bF:Ll,bH:function(t){Ol=t},bJ:Js,bL:function(t,e,n,i,r,s){void 0===e&&(e=bt.R32F),void 0===n&&(n=0),void 0===i&&(i=t.byteLength-n),void 0===r&&(r=0),void 0===s&&(s=[]);var o=Ie[e];r||(r=o.size);for(var a="get"+Lw(o),u=o.size/o.count,h=Math.floor(i/r),c=Xe.isLittleEndian,l=0;l<h;++l)for(var f=n+r*l,p=0;p<o.count;++p){var _=f+u*p;s[o.count*l+p]=t[a](_,c)}return s},bM:function(t,e,n,i,r){void 0===n&&(n=bt.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var s=Ie[n];r||(r=s.size);for(var o="set"+Lw(s),a=s.size/s.count,u=Math.floor(e.length/s.count),h=Xe.isLittleEndian,c=0;c<u;++c)for(var l=i+r*c,f=0;f<s.count;++f){var p=l+a*f;t[o](p,e[s.count*c+f],h)}},bN:kw,bR:Jr,bV:rs,bY:void 0,bZ:void 0,bb:eu,bm:void 0,bo:void 0,c:Sn,c3:vh,c4:Dh,c5:void 0,c7:void 0,c9:Lr,ca:function(t){return"function"==typeof t.lerp},cb:void 0,ci:void 0,cj:void 0,ck:void 0,co:function(){var t=new Zu;return t.assignSorted([[0,{interpolationMode:kr.CUBIC,value:1}],[1,{interpolationMode:kr.CUBIC,value:1}]]),t},d:On,e:An,f:void 0,g:Mn,h:void 0,i:void 0,j:wn,k:void 0,l:void 0,m:In,s:Nn});var bn=/(\.[^\.\/\?\\]*)(\?.*)?$/,En=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Tn=/[^\.\/]+\/\.\.\//;function wn(){for(var t="",e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r];t=(t+(""===t?"":"/")+o).replace(/(\/|\\\\)$/,"")}return t}function An(t){var e=bn.exec(t);return e?e[1]:""}function In(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function Cn(t,e){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return t;var r=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function On(t){var e=En.exec(t);return e?e[2]:""}function Sn(t,e){e=e||"";var n=t.indexOf("?"),i="";return n>0&&(i=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+e+i:t.substring(0,n)+e+i}function Rn(t,e,n){if(0===e.indexOf("."))return Sn(t,e);var i=t.indexOf("?"),r="",s=n?An(t):"";return i>0&&(r=t.substring(i),t=t.substring(0,i)),i=(i=t.lastIndexOf("/"))<=0?0:i+1,t.substring(0,i)+e+s+r}function xn(t){var e=t=String(t);do{e=t,t=t.replace(Tn,"")}while(e.length!==t.length);return t}function Nn(t){return t.replace(/[\/\\]$/,"")}function Mn(){return ht.os===ct.WINDOWS?"\\":"/"}t("U",Object.freeze({__proto__:null,join:wn,extname:An,mainFileName:In,basename:Cn,dirname:On,changeExtname:Sn,changeBasename:Rn,_normalize:xn,stripSep:Nn,getSeperator:Mn}));var Pn=new Oe,Dn=new Oe,Ln=new Oe,kn=new Oe,Fn=new Oe,Bn=new Oe,Un=new Array(3),zn=new Array(3);function Hn(t,e){return Oe.dot(e.n,t)-e.d}function Vn(t,e,n){return Oe.copy(t,e),Oe.subtract(Fn,n.center,n.halfExtents),Oe.add(Bn,n.center,n.halfExtents),t.x=t.x<Fn.x?Fn.x:t.x,t.y=t.y<Fn.y?Fn.y:t.y,t.z=t.z<Fn.z?Fn.z:t.z,t.x=t.x>Bn.x?Bn.x:t.x,t.y=t.y>Bn.y?Bn.y:t.y,t.z=t.z>Bn.z?Bn.z:t.z,t}function Gn(t,e,n){Oe.set(Pn,n.orientation.m00,n.orientation.m01,n.orientation.m02),Oe.set(Dn,n.orientation.m03,n.orientation.m04,n.orientation.m05),Oe.set(Ln,n.orientation.m06,n.orientation.m07,n.orientation.m08),Un[0]=Pn,Un[1]=Dn,Un[2]=Ln,zn[0]=n.halfExtents.x,zn[1]=n.halfExtents.y,zn[2]=n.halfExtents.z,Oe.subtract(kn,e,n.center),Oe.set(t,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Oe.dot(kn,Un[i]);r>zn[i]&&(r=zn[i]),r<-zn[i]&&(r=-zn[i]),t.x+=r*Un[i].x,t.y+=r*Un[i].y,t.z+=r*Un[i].z}return t}t("bc",Object.freeze({__proto__:null,point_plane:Hn,pt_point_plane:function(t,e,n){var i=Hn(e,n);return Oe.subtract(t,e,Oe.multiplyScalar(t,n.n,i))},pt_point_aabb:Vn,pt_point_obb:Gn,pt_point_line:function(t,e,n,i){Oe.subtract(Pn,n,i);var r=Pn,s=Oe.lengthSqr(r);if(0==s)Oe.copy(t,n);else{Oe.subtract(Pn,e,n);var o=Oe.dot(Pn,r)/s;o<0?Oe.copy(t,n):o>1?Oe.copy(t,i):Oe.scaleAndAdd(t,n,r,o)}}}));var jn=t("bd",{SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512,SHAPE_SPLINE:1024}),Wn=t("be",function(){function t(t,e,n,i,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=jn.SHAPE_LINE,this.s=new Oe(t,e,n),this.e=new Oe(i,r,s)}return t.create=function(e,n,i,r,s,o){return new t(e,n,i,r,s,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return Oe.copy(t.s,e.s),Oe.copy(t.e,e.e),t},t.fromPoints=function(t,e,n){return Oe.copy(t.s,e),Oe.copy(t.e,n),t},t.set=function(t,e,n,i,r,s,o){return t.s.x=e,t.s.y=n,t.s.z=i,t.e.x=r,t.e.y=s,t.e.z=o,t},t.len=function(t){return Oe.distance(t.s,t.e)},t.prototype.length=function(){return Oe.distance(this.s,this.e)},n(t,[{key:"type",get:function(){return this._type}}]),t}()),Kn=t("bg",function(){function t(t,e,n,i,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=jn.SHAPE_RAY,this.o=new Oe(t,e,n),this.d=new Oe(i,r,s)}return t.create=function(e,n,i,r,s,o){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=1),new t(e,n,i,r,s,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return Oe.copy(t.o,e.o),Oe.copy(t.d,e.d),t},t.fromPoints=function(t,e,n){return Oe.copy(t.o,e),Oe.normalize(t.d,Oe.subtract(t.d,n,e)),t},t.set=function(t,e,n,i,r,s,o){return t.o.x=e,t.o.y=n,t.o.z=i,t.d.x=r,t.d.y=s,t.d.z=o,t},t.prototype.computeHit=function(t,e){Oe.normalize(t,this.d),Oe.scaleAndAdd(t,this.o,t,e)},n(t,[{key:"type",get:function(){return this._type}}]),t}()),Yn=new Oe,qn=new Oe,Xn=new Oe,Qn=new Oe;function $n(t){return Math.max(Math.max(t.x,t.y),t.z)}var Zn,Jn=t("b3",function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Oe(0,0,0),this._radius=0,this._type=void 0,this._type=jn.SHAPE_SPHERE,this._center=new Oe(t,e,n),this._radius=i}t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return Oe.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,n){return Oe.multiplyScalar(t.center,Oe.add(Yn,e,n),.5),t.radius=.5*Oe.subtract(Yn,n,e).length(),t},t.set=function(t,e,n,i,r){return t.center.x=e,t.center.y=n,t.center.z=i,t.radius=r,t};var e=t.prototype;return e.destroy=function(){},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){Oe.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Oe.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,n,i,r){Oe.transformMat4(r.center,this.center,t),r.radius=this.radius*$n(i)},e.translateAndRotate=function(t,e,n){Oe.transformMat4(n.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*$n(t)},e.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),Oe.subtract(qn,t,this.center);var e=qn.length();if(e>this.radius){var n=.5*(e-this.radius);this.radius+=n,Oe.multiplyScalar(qn,qn,n/e),Oe.add(this.center,this.center,qn)}},e.mergePoints=function(t){var e=t.length;if(!(e<1)){this.radius=-1;for(var n=0;n<e;n++)this.mergePoint(t[n])}},e.mergeAABB=function(t){t.getBoundary(Xn,Qn),this.mergePoint(Xn),this.mergePoint(Qn)},n(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t}},{key:"type",get:function(){return this._type}}]),t}()),ti=t("bh",function(){function t(t,e,n,i,r,s,o,a,u){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=1),void 0===u&&(u=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=jn.SHAPE_TRIANGLE,this.a=new Oe(t,e,n),this.b=new Oe(i,r,s),this.c=new Oe(o,a,u)}return t.create=function(e,n,i,r,s,o,a,u,h){return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=0),void 0===h&&(h=1),new t(e,n,i,r,s,o,a,u,h)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return Oe.copy(t.a,e.a),Oe.copy(t.b,e.b),Oe.copy(t.c,e.c),t},t.fromPoints=function(t,e,n,i){return Oe.copy(t.a,e),Oe.copy(t.b,n),Oe.copy(t.c,i),t},t.set=function(t,e,n,i,r,s,o,a,u,h){return t.a.x=e,t.a.y=n,t.a.z=i,t.b.x=r,t.b.y=s,t.b.z=o,t.c.x=a,t.c.y=u,t.c.z=h,t},n(t,[{key:"type",get:function(){return this._type}}]),t}());!function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(Zn||(Zn=t("bo",{})));var ei,ni,ii,ri,si,oi,ai=(ei=new Oe(0,0,0),function(t,e){var n=Oe.dot(t.d,e.n);if(Math.abs(n)<Number.EPSILON)return 0;Oe.multiplyScalar(ei,e.n,e.d);var i=Oe.dot(Oe.subtract(ei,ei,t.o),e.n)/n;return i<0?0:i}),ui=(ni=new Oe(0,0,0),ii=new Oe(0,0,0),ri=new Oe(0,0,0),si=new Oe(0,0,0),oi=new Oe(0,0,0),function(t,e,n){Oe.subtract(ni,e.b,e.a),Oe.subtract(ii,e.c,e.a),Oe.cross(ri,t.d,ii);var i=Oe.dot(ni,ri);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Oe.subtract(si,t.o,e.a);var s=Oe.dot(si,ri)*r;if(s<0||s>1)return 0;Oe.cross(oi,si,ni);var o=Oe.dot(t.d,oi)*r;if(o<0||s+o>1)return 0;var a=Oe.dot(ii,oi)*r;return a<0?0:a}),hi=function(){var t=new Oe(0,0,0);return function(e,n){var i=n.radius,r=n.center,s=e.o,o=e.d,a=i*i;Oe.subtract(t,r,s);var u=t.lengthSqr(),h=Oe.dot(t,o),c=a-(u-h*h);if(c<0)return 0;var l=Math.sqrt(c),f=u<a?h+l:h-l;return f<0?0:f}}(),ci=function(){var t=new Oe,e=new Oe;return function(n,i){return Oe.subtract(t,i.center,i.halfExtents),Oe.add(e,i.center,i.halfExtents),li(n,t,e)}}();function li(t,e,n){var i=t.o,r=t.d,s=1/r.x,o=1/r.y,a=1/r.z,u=(e.x-i.x)*s,h=(n.x-i.x)*s,c=(e.y-i.y)*o,l=(n.y-i.y)*o,f=(e.z-i.z)*a,p=(n.z-i.z)*a,_=Math.max(Math.max(Math.min(u,h),Math.min(c,l)),Math.min(f,p)),d=Math.min(Math.min(Math.max(u,h),Math.max(c,l)),Math.max(f,p));return d<0||_>d?0:_>0?_:d}var fi,pi,_i,di,vi,gi,mi,yi,bi,Ei,Ti,wi,Ai=function(){var t=new Oe,e=new Oe,n=new Oe,i=new Oe,r=new Oe,s=new Oe,o=new Oe,a=new Array(3),u=new Array(3),h=new Array(3),c=new Array(6);return function(l,f){a[0]=f.halfExtents.x,a[1]=f.halfExtents.y,a[2]=f.halfExtents.z,t=f.center,e=l.o,n=l.d,Oe.set(i,f.orientation.m00,f.orientation.m01,f.orientation.m02),Oe.set(r,f.orientation.m03,f.orientation.m04,f.orientation.m05),Oe.set(s,f.orientation.m06,f.orientation.m07,f.orientation.m08),Oe.subtract(o,t,e),u[0]=Oe.dot(i,n),u[1]=Oe.dot(r,n),u[2]=Oe.dot(s,n),h[0]=Oe.dot(i,o),h[1]=Oe.dot(r,o),h[2]=Oe.dot(s,o);for(var p=0;p<3;++p){if(0===u[p]){if(-h[p]-a[p]>0||-h[p]+a[p]<0)return 0;u[p]=1e-7}c[2*p+0]=(h[p]+a[p])/u[p],c[2*p+1]=(h[p]-a[p])/u[p]}var _=Math.max(Math.max(Math.min(c[0],c[1]),Math.min(c[2],c[3])),Math.min(c[4],c[5])),d=Math.min(Math.min(Math.max(c[0],c[1]),Math.max(c[2],c[3])),Math.max(c[4],c[5]));return d<0||_>d?0:_>0?_:d}}(),Ii=(fi=new Oe,pi=new Oe,_i=new Oe,di=new Oe,vi=new Oe,gi=new Oe,mi=new Oe,yi=new Jn,function(t,e){var n=e.radius*e.radius,i=Oe.normalize(fi,t.d),r=e.ellipseCenter0,s=e.ellipseCenter1,o=Oe.subtract(pi,s,r);if(o.equals(Oe.ZERO))return yi.radius=e.radius,yi.center.set(e.ellipseCenter0),hr.raySphere(t,yi);var a=t.o,u=Oe.subtract(_i,a,r),h=Oe.cross(di,i,o),c=h.lengthSqr();if(0===c){yi.radius=e.radius;var l=Oe.subtract(vi,s,a);return u.lengthSqr()<l.lengthSqr()?yi.center.set(e.ellipseCenter0):yi.center.set(e.ellipseCenter1),hr.raySphere(t,yi)}var f=Oe.cross(vi,u,o),p=o.lengthSqr(),_=2*Oe.dot(h,f),d=_*_-4*c*(f.lengthSqr()-n*p);if(d<0)return 0;var v=(-_-Math.sqrt(d))/(2*c);if(v<0){yi.radius=e.radius;var g=Oe.subtract(gi,s,a);return u.lengthSqr()<g.lengthSqr()?yi.center.set(e.ellipseCenter0):yi.center.set(e.ellipseCenter1),hr.raySphere(t,yi)}var m=Oe.scaleAndAdd(gi,t.o,i,v),y=Oe.subtract(mi,m,r),b=Oe.dot(y,o)/p;return b>=0&&b<=1?v:b<0?(yi.radius=e.radius,yi.center.set(e.ellipseCenter0),hr.raySphere(t,yi)):b>1?(yi.radius=e.radius,yi.center.set(e.ellipseCenter1),hr.raySphere(t,yi)):0}),Ci=(bi=ti.create(),Ei={distance:1/0,doubleSided:!1,mode:Zn.ANY},Ti=0,wi=function(t,e,n,i,r,s){t===Zn.CLOSEST?(Ti>e||0===Ti)&&(Ti=e,s&&(0===s.length?s.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(s[0].distance=e,s[0].vertexIndex0=n/3,s[0].vertexIndex1=i/3,s[0].vertexIndex2=r/3))):(Ti=e,s&&s.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(t,e,n){if(Ti=0,0===e.geometricInfo.positions.length)return Ti;var i=void 0===n?Ei:n;if(li(t,e.geometricInfo.boundingBox.min,e.geometricInfo.boundingBox.max)){var r=e.primitiveMode,s=e.geometricInfo;!function(t,e,n,i,r){if(n===lt.TRIANGLE_LIST)for(var s=e.length,o=0;o<s;o+=3){var a=3*e[o],u=3*e[o+1],h=3*e[o+2];Oe.set(bi.a,t[a],t[a+1],t[a+2]),Oe.set(bi.b,t[u],t[u+1],t[u+2]),Oe.set(bi.c,t[h],t[h+1],t[h+2]);var c=hr.rayTriangle(i,bi,r.doubleSided);if(!(0===c||c>r.distance)&&(wi(r.mode,c,a,u,h,r.result),r.mode===Zn.ANY))return c}else if(n===lt.TRIANGLE_STRIP)for(var l=e.length-2,f=0,p=0;p<l;p+=1){var _=3*e[p-f],d=3*e[p+f+1],v=3*e[p+2];Oe.set(bi.a,t[_],t[_+1],t[_+2]),Oe.set(bi.b,t[d],t[d+1],t[d+2]),Oe.set(bi.c,t[v],t[v+1],t[v+2]),f=~f;var g=hr.rayTriangle(i,bi,r.doubleSided);if(!(0===g||g>r.distance)&&(wi(r.mode,g,_,d,v,r.result),r.mode===Zn.ANY))return g}else if(n===lt.TRIANGLE_FAN){var m=e.length-1,y=3*e[0];Oe.set(bi.a,t[y],t[y+1],t[y+2]);for(var b=1;b<m;b+=1){var E=3*e[b],T=3*e[b+1];Oe.set(bi.b,t[E],t[E+1],t[E+2]),Oe.set(bi.c,t[T],t[T+1],t[T+2]);var w=hr.rayTriangle(i,bi,r.doubleSided);if(!(0===w||w>r.distance)&&(wi(r.mode,w,y,E,T,r.result),r.mode===Zn.ANY))return w}}}(s.positions,s.indices,r,t,i)}return Ti}),Oi=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:Zn.ANY};return function(n,i,r){t=0;var s=void 0===r?e:r,o=i.renderingSubMeshes.length,a=i.struct.minPosition,u=i.struct.maxPosition;if(a&&u&&!li(n,a,u))return t;for(var h=0;h<o;h++){var c=i.renderingSubMeshes[h],l=Ci(n,c,s);if(l)if(s.mode===Zn.CLOSEST)(0===t||t>l)&&(t=l,s.subIndices&&(s.subIndices[0]=h));else if(t=l,s.subIndices&&s.subIndices.push(h),s.mode===Zn.ANY)return l}return t&&s.mode===Zn.CLOSEST&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),Si=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:Zn.ANY},n=new Kn,i=new Se;return function(r,s,o){t=0;var a=void 0===o?e:o,u=s.worldBounds;if(u&&!ci(r,u))return t;Kn.copy(n,r),s.node&&(Se.invert(i,s.node.getWorldMatrix(i)),Oe.transformMat4(n.o,r.o,i),Oe.transformMat4Normal(n.d,r.d,i));for(var h=s.subModels,c=0;c<h.length;c++){var l=h[c].subMesh,f=Ci(n,l,a);if(f)if(a.mode===Zn.CLOSEST)(0===t||t>f)&&(t=f,a.subIndices&&(a.subIndices[0]=c));else if(t=f,a.subIndices&&a.subIndices.push(c),a.mode===Zn.ANY)return f}return t&&a.mode===Zn.CLOSEST&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}(),Ri=function(){var t=new Oe(0,0,0);return function(e,n){Oe.subtract(t,e.e,e.s);var i=(n.d-Oe.dot(e.s,n.n))/Oe.dot(t,n.n);return i<0||i>1?0:i}}(),xi=function(){var t=new Oe(0,0,0),e=new Oe(0,0,0),n=new Oe(0,0,0),i=new Oe(0,0,0),r=new Oe(0,0,0),s=new Oe(0,0,0);return function(o,a,u){Oe.subtract(t,a.b,a.a),Oe.subtract(e,a.c,a.a),Oe.subtract(n,o.s,o.e),Oe.cross(r,t,e);var h=Oe.dot(n,r);if(h<=0)return 0;Oe.subtract(i,o.s,a.a);var c=Oe.dot(i,r);if(c<0||c>h)return 0;Oe.cross(s,n,i);var l=Oe.dot(e,s);if(l<0||l>h)return 0;var f=-Oe.dot(t,s);if(f<0||l+f>h)return 0;if(u){var p=1/h,_=1-(l*=p)-(f*=p);Oe.set(u,a.a.x*_+a.b.x*l+a.c.x*f,a.a.y*_+a.b.y*l+a.c.y*f,a.a.z*_+a.b.z*l+a.c.z*f)}return 1}}(),Ni=new Kn;function Mi(t,e){Ni.o.set(t.s),Oe.subtract(Ni.d,t.e,t.s),Ni.d.normalize();var n=ci(Ni,e);return n<=t.length()?n:0}function Pi(t,e){Ni.o.set(t.s),Oe.subtract(Ni.d,t.e,t.s),Ni.d.normalize();var n=Ai(Ni,e);return n<=t.length()?n:0}function Di(t,e){Ni.o.set(t.s),Oe.subtract(Ni.d,t.e,t.s),Ni.d.normalize();var n=hi(Ni,e);return n<=t.length()?n:0}var Li,ki,Fi,Bi,Ui=(Li=new Oe,ki=new Oe,Fi=new Oe,Bi=new Oe,function(t,e){return Oe.subtract(Li,t.center,t.halfExtents),Oe.add(ki,t.center,t.halfExtents),Oe.subtract(Fi,e.center,e.halfExtents),Oe.add(Bi,e.center,e.halfExtents),Li.x<=Bi.x&&ki.x>=Fi.x&&Li.y<=Bi.y&&ki.y>=Fi.y&&Li.z<=Bi.z&&ki.z>=Fi.z});function zi(t,e,n,i,r,s){Oe.set(s[0],t.x+n.x*e.x+i.x*e.y+r.x*e.z,t.y+n.y*e.x+i.y*e.y+r.y*e.z,t.z+n.z*e.x+i.z*e.y+r.z*e.z),Oe.set(s[1],t.x-n.x*e.x+i.x*e.y+r.x*e.z,t.y-n.y*e.x+i.y*e.y+r.y*e.z,t.z-n.z*e.x+i.z*e.y+r.z*e.z),Oe.set(s[2],t.x+n.x*e.x-i.x*e.y+r.x*e.z,t.y+n.y*e.x-i.y*e.y+r.y*e.z,t.z+n.z*e.x-i.z*e.y+r.z*e.z),Oe.set(s[3],t.x+n.x*e.x+i.x*e.y-r.x*e.z,t.y+n.y*e.x+i.y*e.y-r.y*e.z,t.z+n.z*e.x+i.z*e.y-r.z*e.z),Oe.set(s[4],t.x-n.x*e.x-i.x*e.y-r.x*e.z,t.y-n.y*e.x-i.y*e.y-r.y*e.z,t.z-n.z*e.x-i.z*e.y-r.z*e.z),Oe.set(s[5],t.x+n.x*e.x-i.x*e.y-r.x*e.z,t.y+n.y*e.x-i.y*e.y-r.y*e.z,t.z+n.z*e.x-i.z*e.y-r.z*e.z),Oe.set(s[6],t.x-n.x*e.x+i.x*e.y-r.x*e.z,t.y-n.y*e.x+i.y*e.y-r.y*e.z,t.z-n.z*e.x+i.z*e.y-r.z*e.z),Oe.set(s[7],t.x-n.x*e.x-i.x*e.y+r.x*e.z,t.y-n.y*e.x-i.y*e.y+r.y*e.z,t.z-n.z*e.x-i.z*e.y+r.z*e.z)}function Hi(t,e){for(var n=Oe.dot(e,t[0]),i=n,r=1;r<8;++r){var s=Oe.dot(e,t[r]);n=s<n?s:n,i=s>i?s:i}return[n,i]}var Vi,Gi,ji,Wi=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Oe(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Oe(0,0,0),i[r]=new Oe(0,0,0);var s=new Oe,o=new Oe;return function(e,r){Oe.set(t[0],1,0,0),Oe.set(t[1],0,1,0),Oe.set(t[2],0,0,1),Oe.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Oe.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Oe.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var a=0;a<3;++a)Oe.cross(t[6+3*a],t[a],t[3]),Oe.cross(t[7+3*a],t[a],t[4]),Oe.cross(t[7+3*a],t[a],t[5]);Oe.subtract(s,e.center,e.halfExtents),Oe.add(o,e.center,e.halfExtents),function(t,e,n){Oe.set(n[0],t.x,e.y,e.z),Oe.set(n[1],t.x,e.y,t.z),Oe.set(n[2],t.x,t.y,e.z),Oe.set(n[3],t.x,t.y,t.z),Oe.set(n[4],e.x,e.y,e.z),Oe.set(n[5],e.x,e.y,t.z),Oe.set(n[6],e.x,t.y,e.z),Oe.set(n[7],e.x,t.y,t.z)}(s,o,n),zi(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var u=0;u<15;++u){var h=Hi(n,t[u]),c=Hi(i,t[u]);if(c[0]>h[1]||h[0]>c[1])return 0}return 1}}(),Ki=function(t,e){var n=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),i=Oe.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1},Yi=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===Ki(t,e.planes[n]))return 0;return 1},qi=function(){for(var t=new Array(8),e=0,n=0,i=0;i<t.length;i++)t[i]=new Oe(0,0,0);return function(i,r){for(var s=0,o=!1,a=0;a<r.planes.length;a++){if(-1===(s=Ki(i,r.planes[a])))return 0;1===s&&(o=!0)}if(!o)return 1;for(var u=0;u<r.vertices.length;u++)Oe.subtract(t[u],r.vertices[u],i.center);e=0,n=0;for(var h=0;h<r.vertices.length;h++)t[h].x>i.halfExtents.x?e++:t[h].x<-i.halfExtents.x&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var c=0;c<r.vertices.length;c++)t[c].y>i.halfExtents.y?e++:t[c].y<-i.halfExtents.y&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var l=0;l<r.vertices.length;l++)t[l].z>i.halfExtents.z?e++:t[l].z<-i.halfExtents.z&&n++;return e===r.vertices.length||n===r.vertices.length?0:1}}(),Xi=(Vi=new Oe(0,0,0),Gi=new Re,function(t,e){return Oe.subtract(Vi,e,t.center),Oe.transformMat3(Vi,Vi,Re.transpose(Gi,t.orientation)),n=Vi,i=t.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),Qi=(ji=function(t,e,n,i){return Math.abs(t.x*e+t.y*n+t.z*i)},function(t,e){var n=t.halfExtents.x*ji(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*ji(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*ji(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),i=Oe.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1}),$i=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===Qi(t,e.planes[n]))return 0;return 1},Zi=function(){for(var t=new Array(8),e=0,n=0,i=0,r=0;r<t.length;r++)t[r]=new Oe(0,0,0);var s=function(t,e,n,i){return t.x*e+t.y*n+t.z*i};return function(r,o){for(var a=0,u=!1,h=0;h<o.planes.length;h++){if(-1===(a=Qi(r,o.planes[h])))return 0;1===a&&(u=!0)}if(!u)return 1;for(var c=0;c<o.vertices.length;c++)Oe.subtract(t[c],o.vertices[c],r.center);n=0,i=0;for(var l=0;l<o.vertices.length;l++)(e=s(t[l],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:e<-r.halfExtents.x&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var f=0;f<o.vertices.length;f++)(e=s(t[f],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:e<-r.halfExtents.y&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var p=0;p<o.vertices.length;p++)(e=s(t[p],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:e<-r.halfExtents.z&&i++;return n===o.vertices.length||i===o.vertices.length?0:1}}(),Ji=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Oe(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Oe(0,0,0),i[r]=new Oe(0,0,0);return function(e,r){Oe.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),Oe.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),Oe.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),Oe.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Oe.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Oe.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Oe.cross(t[6+3*s],t[s],t[3]),Oe.cross(t[7+3*s],t[s],t[4]),Oe.cross(t[8+3*s],t[s],t[5]);zi(e.center,e.halfExtents,t[0],t[1],t[2],n),zi(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var o=0;o<15;++o){var a=Hi(n,t[o]),u=Hi(i,t[o]);if(u[0]>a[1]||a[0]>u[1])return 0}return 1}}(),tr=function(){for(var t=new Jn,e=new Oe,n=new Oe,i=new Oe,r=new Array(8),s=0;s<8;s++)r[s]=new Oe;for(var o=new Array(8),a=0;a<8;a++)o[a]=new Oe;return function(s,a){if(0===Oe.squaredDistance(a.ellipseCenter0,a.ellipseCenter1))return t.radius=a.radius,t.center.set(a.ellipseCenter0),hr.sphereOBB(t,s);e.x=s.orientation.m00,e.y=s.orientation.m01,e.z=s.orientation.m02,n.x=s.orientation.m03,n.y=s.orientation.m04,n.z=s.orientation.m05,i.x=s.orientation.m06,i.y=s.orientation.m07,i.z=s.orientation.m08,zi(s.center,s.halfExtents,e,n,i,r);var u=o,h=Oe.copy(u[0],e),c=Oe.copy(u[1],n),l=Oe.copy(u[2],i);Oe.subtract(u[3],a.center,s.center).normalize();var f=Oe.subtract(u[4],a.ellipseCenter0,a.ellipseCenter1);f.normalize(),Oe.cross(u[5],h,f),Oe.cross(u[6],c,f),Oe.cross(u[7],l,f);for(var p=0;p<8;++p){var _=Hi(r,u[p]),d=Oe.dot(u[p],a.ellipseCenter0),v=Oe.dot(u[p],a.ellipseCenter1),g=Math.max(d,v),m=Math.min(d,v)-a.radius,y=g+a.radius;if(m>_[1]||_[0]>y)return 0}return 1}}(),er=function(t,e){var n=Oe.dot(e.n,t.center),i=t.radius*e.n.length();return n+i<e.d?-1:n-i>e.d?0:1},nr=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===er(t,e.planes[n]))return 0;return 1},ir=function(){var t=new Oe(0,0,0),e=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var s=i.planes[r],o=n.radius,a=n.center,u=s.n,h=s.d,c=Oe.dot(u,a);if(c+o<h)return 0;if(!(c-o>h)){Oe.add(t,a,Oe.multiplyScalar(t,u,o));for(var l=0;l<6;l++)if(l!==r&&l!==r+e[r]){var f=i.planes[l];if(Oe.dot(f.n,t)<f.d)return 0}}}return 1}}(),rr=function(t,e){var n=t.radius+e.radius;return Oe.squaredDistance(t.center,e.center)<n*n},sr=function(){var t=new Oe;return function(e,n){return Vn(t,e.center,n),Oe.squaredDistance(e.center,t)<e.radius*e.radius}}(),or=function(){var t=new Oe;return function(e,n){return Gn(t,e.center,n),Oe.squaredDistance(e.center,t)<e.radius*e.radius}}(),ar=function(){var t=new Oe,e=new Oe;return function(n,i){var r=n.radius+i.radius,s=r*r,o=Oe.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===o)return Oe.squaredDistance(n.center,i.center)<s;Oe.subtract(t,n.center,i.ellipseCenter0),Oe.subtract(e,i.ellipseCenter1,i.ellipseCenter0);var a=Oe.dot(t,e)/o;return a<0?Oe.squaredDistance(n.center,i.ellipseCenter0)<s:a>1?Oe.squaredDistance(n.center,i.ellipseCenter1)<s:(Oe.scaleAndAdd(t,i.ellipseCenter0,e,a),Oe.squaredDistance(n.center,t)<s)}}(),ur=function(){var t=new Oe,e=new Oe,n=new Oe,i=new Oe,r=new Oe,s=new Oe;return function(o,a){var u,h,c=Oe.subtract(t,o.ellipseCenter1,o.ellipseCenter0),l=Oe.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=Oe.subtract(n,o.ellipseCenter0,a.ellipseCenter0),p=Oe.dot(c,c),_=Oe.dot(c,l),d=Oe.dot(l,l),v=Oe.dot(c,f),g=Oe.dot(l,f),m=p*d-_*_,y=m,b=m;m<xe?(u=0,y=1,h=g,b=d):(h=p*g-_*v,(u=_*g-d*v)<0?(u=0,h=g,b=d):u>y&&(u=y,h=g+_,b=d)),h<0?(h=0,-v<0?u=0:-v>p?u=y:(u=-v,y=p)):h>b&&(h=b,-v+_<0?u=0:-v+_>p?u=y:(u=-v+_,y=p));var E=Math.abs(u)<xe?0:u/y,T=Math.abs(h)<xe?0:h/b,w=i;w.set(f),w.add(Oe.multiplyScalar(r,c,E)),w.subtract(Oe.multiplyScalar(s,l,T));var A=o.radius+a.radius;return w.lengthSqr()<A*A}}(),hr=t("b4",{raySphere:hi,rayAABB:ci,rayOBB:Ai,rayPlane:ai,rayTriangle:ui,rayCapsule:Ii,raySubMesh:Ci,rayMesh:Oi,rayModel:Si,lineSphere:Di,lineAABB:Mi,lineOBB:Pi,linePlane:Ri,lineTriangle:xi,sphereWithSphere:rr,sphereAABB:sr,sphereOBB:or,spherePlane:er,sphereFrustum:nr,sphereFrustumAccurate:ir,sphereCapsule:ar,aabbWithAABB:Ui,aabbWithOBB:Wi,aabbPlane:Ki,aabbFrustum:Yi,aabbFrustumAccurate:qi,obbWithOBB:Ji,obbPlane:Qi,obbFrustum:$i,obbFrustumAccurate:Zi,obbPoint:Xi,obbCapsule:tr,aabbFrustumCompletelyInside:function(t,e){for(var n=0;n<e.planes.length;n++)if(0!==Ki(t,e.planes[n]))return 0;return 1},capsuleWithCapsule:ur,resolve:function(t,e,n){void 0===n&&(n=null);var i=t._type,r=e._type,s=this[i|r];return i<r?s(t,e,n):s(e,t,n)}});hr[jn.SHAPE_RAY|jn.SHAPE_SPHERE]=hi,hr[jn.SHAPE_RAY|jn.SHAPE_AABB]=ci,hr[jn.SHAPE_RAY|jn.SHAPE_OBB]=Ai,hr[jn.SHAPE_RAY|jn.SHAPE_PLANE]=ai,hr[jn.SHAPE_RAY|jn.SHAPE_TRIANGLE]=ui,hr[jn.SHAPE_RAY|jn.SHAPE_CAPSULE]=Ii,hr[jn.SHAPE_LINE|jn.SHAPE_SPHERE]=Di,hr[jn.SHAPE_LINE|jn.SHAPE_AABB]=Mi,hr[jn.SHAPE_LINE|jn.SHAPE_OBB]=Pi,hr[jn.SHAPE_LINE|jn.SHAPE_PLANE]=Ri,hr[jn.SHAPE_LINE|jn.SHAPE_TRIANGLE]=xi,hr[jn.SHAPE_SPHERE]=rr,hr[jn.SHAPE_SPHERE|jn.SHAPE_AABB]=sr,hr[jn.SHAPE_SPHERE|jn.SHAPE_OBB]=or,hr[jn.SHAPE_SPHERE|jn.SHAPE_PLANE]=er,hr[jn.SHAPE_SPHERE|jn.SHAPE_FRUSTUM]=nr,hr[jn.SHAPE_SPHERE|jn.SHAPE_FRUSTUM_ACCURATE]=ir,hr[jn.SHAPE_SPHERE|jn.SHAPE_CAPSULE]=ar,hr[jn.SHAPE_AABB]=Ui,hr[jn.SHAPE_AABB|jn.SHAPE_OBB]=Wi,hr[jn.SHAPE_AABB|jn.SHAPE_PLANE]=Ki,hr[jn.SHAPE_AABB|jn.SHAPE_FRUSTUM]=Yi,hr[jn.SHAPE_AABB|jn.SHAPE_FRUSTUM_ACCURATE]=qi,hr[jn.SHAPE_OBB]=Ji,hr[jn.SHAPE_OBB|jn.SHAPE_PLANE]=Qi,hr[jn.SHAPE_OBB|jn.SHAPE_FRUSTUM]=$i,hr[jn.SHAPE_OBB|jn.SHAPE_FRUSTUM_ACCURATE]=Zi,hr[jn.SHAPE_OBB|jn.SHAPE_CAPSULE]=tr,hr[jn.SHAPE_CAPSULE]=ur,Ne(Wn.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),Me(hr,"intersect",[{name:"line_quad"}]);var cr=new Oe(0,0,0),lr=new Oe(0,0,0),fr=i.mat4(),pr=i.v4(),_r=t("bf",function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=jn.SHAPE_PLANE,this.n=new Oe(t,e,n),this.d=i}return t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return Oe.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,n,i){return Oe.subtract(cr,n,e),Oe.subtract(lr,i,e),Oe.normalize(t.n,Oe.cross(t.n,cr,lr)),t.d=Oe.dot(t.n,e),t},t.set=function(t,e,n,i,r){return t.n.x=e,t.n.y=n,t.n.z=i,t.d=r,t},t.fromNormalAndPoint=function(t,e,n){return Oe.copy(t.n,e),t.d=Oe.dot(e,n),t},t.normalize=function(t,e){var n=e.n.length();return Oe.normalize(t.n,e.n),n>0&&(t.d=e.d/n),t},t.prototype.transform=function(t){Se.invert(fr,t),Se.transpose(fr,fr),Pe.set(pr,this.n.x,this.n.y,this.n.z,this.d),Pe.transformMat4(pr,pr,fr),Oe.set(this.n,pr.x,pr.y,pr.z),this.d=pr.w},n(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}()),dr=new Oe,vr=new Oe,gr=new Oe,mr=new Oe,yr=new Re,br=function(t,e,n){yr.m00=Math.abs(n.m00),yr.m01=Math.abs(n.m01),yr.m02=Math.abs(n.m02),yr.m03=Math.abs(n.m04),yr.m04=Math.abs(n.m05),yr.m05=Math.abs(n.m06),yr.m06=Math.abs(n.m08),yr.m07=Math.abs(n.m09),yr.m08=Math.abs(n.m10),Oe.transformMat3(t,e,yr)},Er=t("aZ",function(){function t(t,e,n,i,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===s&&(s=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=jn.SHAPE_AABB,this.center=new Oe(t,e,n),this.halfExtents=new Oe(i,r,s)}t.create=function(e,n,i,r,s,o){return new t(e,n,i,r,s,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return Oe.copy(t.center,e.center),Oe.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,n){return Oe.add(dr,n,e),Oe.subtract(vr,n,e),Oe.multiplyScalar(t.center,dr,.5),Oe.multiplyScalar(t.halfExtents,vr,.5),t},t.set=function(t,e,n,i,r,s,o){return t.center.set(e,n,i),t.halfExtents.set(r,s,o),t},t.merge=function(e,n,i){return Oe.subtract(dr,n.center,n.halfExtents),Oe.subtract(vr,i.center,i.halfExtents),Oe.add(gr,n.center,n.halfExtents),Oe.add(mr,i.center,i.halfExtents),Oe.max(mr,gr,mr),Oe.min(gr,dr,vr),t.fromPoints(e,gr,mr)},t.toBoundingSphere=function(t,e){return t.center.set(e.center),t.radius=e.halfExtents.length(),t},t.transform=function(t,e,n){return Oe.transformMat4(t.center,e.center,n),br(t.halfExtents,e.halfExtents,n),t};var e=t.prototype;return e.getBoundary=function(t,e){Oe.subtract(t,this.center,this.halfExtents),Oe.add(e,this.center,this.halfExtents)},e.transform=function(t,e,n,i,r){Oe.transformMat4(r.center,this.center,t),br(r.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.mergePoint=function(t){this.getBoundary(dr,vr),t.x<dr.x&&(dr.x=t.x),t.y<dr.y&&(dr.y=t.y),t.z<dr.z&&(dr.z=t.z),t.x>vr.x&&(vr.x=t.x),t.y>vr.y&&(vr.y=t.y),t.z>vr.z&&(vr.z=t.z),Oe.add(gr,dr,vr),this.center.set(Oe.multiplyScalar(gr,gr,.5)),this.halfExtents.set(vr.x-gr.x,vr.y-gr.y,vr.z-gr.z)},e.mergePoints=function(t){if(!(t.length<1))for(var e=0;e<t.length;e++)this.mergePoint(t[e])},e.mergeFrustum=function(t){return this.mergePoints(t.vertices)},n(t,[{key:"type",get:function(){return this._type}}]),t}()),Tr=new Oe,wr=new Oe,Ar=new Re,Ir=t("bi",function(){function t(t,e,n,i,r,s,o,a,u,h,c,l,f,p,_){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===s&&(s=1),void 0===o&&(o=1),void 0===a&&(a=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===c&&(c=1),void 0===l&&(l=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===_&&(_=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=jn.SHAPE_OBB,this.center=new Oe(t,e,n),this.halfExtents=new Oe(i,r,s),this.orientation=new Re(o,a,u,h,c,l,f,p,_)}t.create=function(e,n,i,r,s,o,a,u,h,c,l,f,p,_,d){return new t(e,n,i,r,s,o,a,u,h,c,l,f,p,_,d)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return Oe.copy(t.center,e.center),Oe.copy(t.halfExtents,e.halfExtents),Re.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,n){return Oe.multiplyScalar(t.center,Oe.add(Tr,e,n),.5),Oe.multiplyScalar(t.halfExtents,Oe.subtract(wr,n,e),.5),Re.identity(t.orientation),t},t.set=function(t,e,n,i,r,s,o,a,u,h,c,l,f,p,_,d){return Oe.set(t.center,e,n,i),Oe.set(t.halfExtents,r,s,o),Re.set(t.orientation,a,u,h,c,l,f,p,_,d),t};var e=t.prototype;return e.getBoundary=function(t,e){!function(t,e,n){Ar.m00=Math.abs(n.m00),Ar.m01=Math.abs(n.m01),Ar.m02=Math.abs(n.m02),Ar.m03=Math.abs(n.m03),Ar.m04=Math.abs(n.m04),Ar.m05=Math.abs(n.m05),Ar.m06=Math.abs(n.m06),Ar.m07=Math.abs(n.m07),Ar.m08=Math.abs(n.m08),Oe.transformMat3(t,e,Ar)}(Tr,this.halfExtents,this.orientation),Oe.subtract(t,this.center,Tr),Oe.add(e,this.center,Tr)},e.transform=function(t,e,n,i,r){Oe.transformMat4(r.center,this.center,t),Re.fromQuat(r.orientation,n),Oe.multiply(r.halfExtents,this.halfExtents,i)},e.translateAndRotate=function(t,e,n){Oe.transformMat4(n.center,this.center,t),Re.fromQuat(n.orientation,e)},e.setScale=function(t,e){Oe.multiply(e.halfExtents,this.halfExtents,t)},n(t,[{key:"type",get:function(){return this._type}}]),t}()),Cr=t("bj",function(){function t(t,e,n){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=jn.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=n,this.center=new Oe,this.rotation=new Le,this.ellipseCenter0=new Oe(0,e,0),this.ellipseCenter1=new Oe(0,-e,0),this.updateCache()}var e=t.prototype;return e.transform=function(t,e,n,i,r){var s=i,o=De(s);r.radius=this.radius*Math.abs(o);var a=(this.halfHeight+this.radius)*Math.abs(s.y)-r.radius;a<0&&(a=0),r.halfHeight=a,Oe.transformMat4(r.center,this.center,t),Le.multiply(r.rotation,this.rotation,n),r.updateCache()},e.updateCache=function(){this.updateLocalCenter(),Oe.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Oe.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},n(t,[{key:"type",get:function(){return this._type}}]),t}()),Or=new Array(8);Or[0]=new Oe(1,1,1),Or[1]=new Oe(-1,1,1),Or[2]=new Oe(-1,-1,1),Or[3]=new Oe(1,-1,1),Or[4]=new Oe(1,1,-1),Or[5]=new Oe(-1,1,-1),Or[6]=new Oe(-1,-1,-1),Or[7]=new Oe(1,-1,-1);var Sr,Rr,xr,Nr=new Oe,Mr=new Oe,Pr=new Oe,Dr=t("a_",function(){function t(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=jn.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=_r.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new Oe}t.createFromAABB=function(t,e){var n=new Oe,i=new Oe;return Oe.subtract(n,e.center,e.halfExtents),Oe.add(i,e.center,e.halfExtents),t.vertices[0].set(n.x,i.y,n.z),t.vertices[1].set(i.x,i.y,n.z),t.vertices[2].set(i.x,n.y,n.z),t.vertices[3].set(n.x,n.y,n.z),t.vertices[4].set(n.x,i.y,i.z),t.vertices[5].set(i.x,i.y,i.z),t.vertices[6].set(i.x,n.y,i.z),t.vertices[7].set(n.x,n.y,i.z),t._type!==jn.SHAPE_FRUSTUM_ACCURATE||t.updatePlanes(),t},t.split=function(t,e,n,i,r){var s=Math.tan(.5*e.fov),o=s*e.aspect;Nr.set(i*o,i*s,i),Mr.set(r*o,r*s,r);var a=t.vertices;return Pr.set(Nr.x,Nr.y,Nr.z),Oe.transformMat4(a[0],Pr,n),Pr.set(-Nr.x,Nr.y,Nr.z),Oe.transformMat4(a[1],Pr,n),Pr.set(-Nr.x,-Nr.y,Nr.z),Oe.transformMat4(a[2],Pr,n),Pr.set(Nr.x,-Nr.y,Nr.z),Oe.transformMat4(a[3],Pr,n),Pr.set(Mr.x,Mr.y,Mr.z),Oe.transformMat4(a[4],Pr,n),Pr.set(-Mr.x,Mr.y,Mr.z),Oe.transformMat4(a[5],Pr,n),Pr.set(-Mr.x,-Mr.y,Mr.z),Oe.transformMat4(a[6],Pr,n),Pr.set(Mr.x,-Mr.y,Mr.z),Oe.transformMat4(a[7],Pr,n),t.updatePlanes(),t},t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e.type;for(var n=0;n<6;++n)_r.copy(t.planes[n],e.planes[n]);for(var i=0;i<8;++i)Oe.copy(t.vertices[i],e.vertices[i]);return t};var e=t.prototype;return e.update=function(t,e){if(Oe.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),Oe.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),Oe.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),Oe.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),Oe.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),Oe.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===jn.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Oe.multiplyScalar(i.n,i.n,r),i.d*=r}for(var s=0;s<8;s++)Oe.transformMat4(this.vertices[s],Or[s],e)}},e.transform=function(t){if(this._type===jn.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)Oe.transformMat4(this.vertices[e],this.vertices[e],t);this.updatePlanes()}},e.zero=function(){for(var t=0;t<8;t++)this.vertices[t].set(0,0,0);this.updatePlanes()},e.updatePlanes=function(){_r.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),_r.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),_r.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),_r.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),_r.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),_r.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])},n(t,[{key:"accurate",set:function(t){this._type=t?jn.SHAPE_FRUSTUM_ACCURATE:jn.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),t}());function Lr(t,e,n){void 0===n&&(n=1e-6);for(var i=0,r=t.length-1,s=r>>>1;i<=r;s=i+r>>>1){var o=t[s];if(o>e+n)r=s-1;else{if(!(o<e-n))return s;i=s+1}}return~i}Dr.createOrtho=function(t,e,n,i,r,s){var o=e/2,a=n/2;Oe.set(Pr,o,a,-i),Oe.transformMat4(t.vertices[0],Pr,s),Oe.set(Pr,-o,a,-i),Oe.transformMat4(t.vertices[1],Pr,s),Oe.set(Pr,-o,-a,-i),Oe.transformMat4(t.vertices[2],Pr,s),Oe.set(Pr,o,-a,-i),Oe.transformMat4(t.vertices[3],Pr,s),Oe.set(Pr,o,a,-r),Oe.transformMat4(t.vertices[4],Pr,s),Oe.set(Pr,-o,a,-r),Oe.transformMat4(t.vertices[5],Pr,s),Oe.set(Pr,-o,-a,-r),Oe.transformMat4(t.vertices[6],Pr,s),Oe.set(Pr,o,-a,-r),Oe.transformMat4(t.vertices[7],Pr,s),_r.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),_r.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),_r.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),_r.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),_r.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),_r.fromPoints(t.planes[5],t.vertices[7],t.vertices[5],t.vertices[6])},function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(Sr||(Sr=t("c5",{}))),function(t){t[t.Default=Sr.Default]="Default",t[t.Normal=Sr.Normal]="Normal",t[t.Reverse=Sr.Reverse]="Reverse",t[t.Loop=Sr.Loop]="Loop",t[t.LoopReverse=Sr.Loop|Sr.Reverse]="LoopReverse",t[t.PingPong=Sr.PingPong]="PingPong",t[t.PingPongReverse=Sr.PingPong|Sr.Reverse]="PingPongReverse"}(Rr||(Rr=t("c7",{}))),r(Rr),t("c6",function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}()),xr=Symbol.iterator;var kr,Fr,Br,Ur=function(){function t(){this._times=[],this._values=[]}var e=t.prototype;return e[xr]=function(){var t=this,e=0;return{next:function(){if(e>=t._times.length)return{done:!0,value:void 0};var n=[t._times[e],t._values[e]];return++e,{done:!1,value:n}}}},e.keyframes=function(){return this},e.times=function(){return this._times},e.values=function(){return this._values},e.getKeyframeTime=function(t){return this._times[t]},e.getKeyframeValue=function(t){return this._values[t]},e.addKeyFrame=function(t,e){return this._insertNewKeyframe(t,e)},e.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},e.indexOfKeyframe=function(t){return Lr(this._times,t)},e.updateTime=function(t,e){var n=this._values[t];this.removeKeyframe(t),this._insertNewKeyframe(e,n)},e.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},e.clear=function(){this._times.length=0,this._values.length=0},e.searchKeyframe=function(t){return Lr(this._times,t)},e.setKeyframes=function(t,e){s(t.length===e.length),s(function(t){return t.every((function(t,e,n){return 0===e||t>n[e-1]||ke(t,n[e-1],1e-6)}))}(t)),this._times=t,this._values=e},e._insertNewKeyframe=function(t,e){var n=this._times,i=this._values,r=n.length,s=Lr(n,t);if(s>=0)return s;var o=~s;return 0===o?(n.unshift(t),i.unshift(e)):o===r?(n.push(t),i.push(e)):(n.splice(o-1,0,t),i.splice(o-1,0,e)),o},n(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}();function zr(t){return t>-1e-9&&t<1e-9}o.fastDefine("cc.KeyframeCurve",Ur,{_times:[],_values:[]}),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.CUBIC=2]="CUBIC"}(kr||(kr=t("aO",{}))),function(t){t[t.LINEAR=0]="LINEAR",t[t.CLAMP=1]="CLAMP",t[t.LOOP=2]="LOOP",t[t.PING_PONG=3]="PING_PONG"}(Fr||(Fr=t("aP",{}))),function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.BOTH=3]="BOTH"}(Br||(Br=t("aQ",{})));var Hr=function(){},Vr=function(){return Hr},Gr=jr((function(){}));function jr(t){return function(e){return"function"==typeof e?t(e):function(n){return t(n,e)}}}function Wr(t){return function(e){return function(n){!function(t,e,n){var i=Yr(t);if(i){var r=qr(i,"proto");qr(r,"editor")[e]=n}}(n,t,e)}}}var Kr="__ccclassCache__";function Yr(t){return qr(t,Kr)}function qr(t,e){return t[e]||(t[e]={})}var Xr=t("a$",jr((function(t,e){var n=a.getSuper(t);n===Object&&(n=null);var i={name:e,extends:n,ctor:t},r=t[Kr];if(r){var s=r.proto;s&&a.mixin(i,s),t[Kr]=void 0}return o(i)}))),Qr=t("cf",Wr("requireComponent")),$r=t("bX",Wr("executionOrder")),Zr=t("ce",Gr);function Jr(t,e,n){var i=null;function r(t,e,n){!function(t,e,n,i,r,s){var o,h=s&&(s.get||s.set);r&&(o=u(r,h));var c=a.mixin(e,o||r||{});h?(s.get&&(c.get=s.get),s.set&&(c.set=s.set)):es(t,c,n,i,s)}(function(t){return Yr(t.constructor)}(t),function(t,e){var n,i,r=qr(Yr(t.constructor),"proto"),s=qr(r,"properties");return null!==(i=s[n=e])&&void 0!==i?i:s[n]={}}(t,e),t.constructor,e,i,n)}return void 0===t?Jr({type:void 0}):void 0===e?(i=t,r):void r(t,e,n)}function ts(t,e,n){var i,r,s=Yr(t.constructor),o=qr(s,"proto"),a=qr(o,"properties"),u=null!==(r=a[i=e])&&void 0!==r?r:a[i]={};return u.__internalFlags|=h.STANDALONE,n&&(n.get||n.set)?(n.get&&(u.get=n.get),n.set&&(u.set=n.set)):es(s,u,t.constructor,e,n),u}function es(t,e,n,i,r){if(r)r.initializer&&(e.default=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var s=t.default||(t.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(n));s.hasOwnProperty(i)&&(e.default=s[i])}}var ns=Symbol("cc:SerializationMetadata"),is=t("b1",(function(t,e,n){os(ts(t,e,n))}));function rs(t){return function(e,n,i){var r=ts(e,n,i);r.formerlySerializedAs=t,os(r)}}var ss=t("cn",(function(t,e,n){var i=ts(t,e,n);i.editorOnly=!0,os(i)}));function os(t){t.__internalFlags|=h.IMPLICIT_SERIALIZABLE}var as=t("c8",Hr),us=t("bS",Gr),hs=t("bU",Vr),cs=t("cr",Gr),ls=Vr,fs=Vr,ps=t("bT",Vr),_s=t("b7",Hr),ds=t("b2",Vr),vs=t("cs",Hr),gs=t("cg",Vr),ms=t("bP",Vr),ys=t("bQ",Vr),bs=t("cl",Vr),Es=(t("cm",Vr),t("cq",Vr)),Ts=t("bO",Hr),ws=t("b5",Vr),As=(t("cp",Hr),t("cd",Hr),t("bW",Hr)),Is=Rs(p),Cs=t("c1",Rs(c)),Os=Rs(l),Ss=t("cc",Rs(f));function Rs(t){return Jr({type:t})}var xs=t("b_",(function(t,e,n){ts(t,e,n).override=!0})),Ns=t("b$",(function(){})),Ms=Object.freeze({__proto__:null,uniquelyReferenced:as,ccclass:Xr,property:Jr,requireComponent:Qr,executionOrder:$r,disallowMultiple:Zr,allowReplicated:function(t){o.Attr.setClassAttr(t,"replicated","visible",!0)},executeInEditMode:us,menu:hs,playOnFocus:cs,inspector:ls,icon:fs,help:ps,type:Rs,integer:Is,float:Cs,boolean:Os,string:Ss});t("V",Ms);var Ps=t("bI",function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=a.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=a.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},n(t,[{key:"count",get:function(){return this._count}}]),t}()),Ds=function(){function t(e,n){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var e=t.prototype;return e.insert=function(t,e){return e>this.pipes.length?(_(4921),this):(this.pipes.splice(e,0,t),this)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0===e.length)return null;t.isFinish=!1;for(var n=0,i=e.length;n<i;){var r=(0,e[n])(t);if(r)return t.isFinish=!0,r;++n!==i&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var n=this;(0,this.pipes[t])(e,(function(i){i?(e.isFinish=!0,e.dispatch("complete",i)):++t<n.pipes.length?(e.input=e.output,e.output=null,n._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",i,e.output))}))},t}();Ds._pipelineId=0,function(){function t(t){if(this._weakMap={},void 0===window.WeakRef)throw new Error("this platform does not support WeakRef!");if(t)for(var e in t)this._weakMap[e]=new WeakRef(t[e])}var e=t.prototype;e.add=function(t,e){return this._weakMap[t]=new WeakRef(e),e},e.has=function(t){return t in this._weakMap&&!!this._weakMap[t].deref()},e.get=function(t){return this._weakMap[t]&&this._weakMap[t].deref()},e.remove=function(t){var e=this._weakMap[t];return delete this._weakMap[t],e&&e.deref()},e.clear=function(){this._weakMap=a.createMap(!0)},e.forEach=function(t){for(var e in this._weakMap){var n=this.get(e);n&&t(n,e)}},e.find=function(t){for(var e in this._weakMap){var n=this.get(e);if(n&&t(n,e))return this._weakMap[e].deref()}return null},e.destroy=function(){this._weakMap={}},n(t,[{key:"count",get:function(){return Object.values(this._weakMap).filter((function(t){return t.deref()})).length}}])}();var Ls,ks=t("by",new Ps),Fs=new Ps,Bs=new Ps,Us=t("bK",new Ps),zs=new Ds("normal load",[]),Hs=new Ds("fetch",[]),Vs=new Ds("transform url",[]),Gs=new Map;!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}(Ls||(Ls={}));var js,Ws={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.INTERNAL="internal",t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(js||(js=t("bC",{})));var Ks=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var n;return 0!==t._deadPool.length?(n=t._deadPool.pop()).set(e):n=new t(e),n};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,n,i,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,n);break;case"progress":this.onProgress&&this.onProgress(e,n,i,r);break;case"error":this.onError&&this.onError(e,n,i,r);break;default:var s="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[s]&&this[s](e,n,i,r)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();Ks.MAX_DEAD_NUM=500,Ks._taskId=0,Ks._deadPool=[];var Ys="0123456789abcdef".split(""),qs=["","","",""],Xs=qs.concat(qs,"-",qs,"-",qs,"-",qs,"-",qs,qs,qs),Qs=Xs.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function $s(t){var e=t.split("@")[0];if(22!==e.length)return t;Xs[0]=t[0],Xs[1]=t[1];for(var n=2,i=2;n<22;n+=2){var r=d[t.charCodeAt(n)],s=d[t.charCodeAt(n+1)];Xs[Qs[i++]]=Ys[r>>2],Xs[Qs[i++]]=Ys[(3&r)<<2|s>>4],Xs[Qs[i++]]=Ys[15&s]}return t.replace(e,Xs.join(""))}var Zs=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Js(t){var e=Zs.exec(t);return e?e[1]:""}function to(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.nativeExt&&(e.ext=e.nativeExt);var n=Us.find((function(e){return!!e.getAssetInfo(t)}));return n&&(e.bundle=n.name),io(t,e)}function eo(t){return!!t&&(t instanceof i.SceneAsset||t instanceof i.Scene)}function no(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function io(t,e){var n=Ks.create({input:t,options:e}),i=[];try{for(var r,s=Vs.sync(n),o=v(s);!(r=o()).done;){var a=r.value,u=a.url;a.recycle(),i.push(u)}}catch(t){for(var h,c=v(n.output);!(h=c()).done;)h.value.recycle();g(t.message,t.stack)}return n.recycle(),i.length>1?i:i[0]}var ro,so,oo,ao,uo,ho,co,lo=Object.freeze({__proto__:null,getUuidFromURL:Js,getUrlWithUuid:to,isScene:eo,normalize:no,transform:io,decodeUuid:$s}),fo=t("a2",Xr("cc.Asset")((ao=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).loaded=!0,T(e,"_native",oo,w(e)),e._nativeUrl="",e._file=null,e._ref=0,Object.defineProperty(w(e),"_uuid",{value:"",writable:!0}),e}m(e,t),e.deserialize=function(t){return i.deserialize(t)};var r=e.prototype;return r.toString=function(){return this.nativeUrl},r.serialize=function(){},r._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},r.addRef=function(){return this._ref++,this},r.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&i.assetManager._releaseManager.tryRelease(this),this},r.onLoaded=function(){},r.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},r.validate=function(){return!0},r.destroy=function(){return y(b(12101,this._uuid)),t.prototype.destroy.call(this)},n(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=to(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=to(this._uuid,{__nativeName__:t,nativeExt:An(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(ft(pt)),oo=E((so=ao).prototype,"_native",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),E(so.prototype,"_nativeAsset",[Jr],Object.getOwnPropertyDescriptor(so.prototype,"_nativeAsset"),so.prototype),ro=so))||ro);fo.prototype.createNode=null,i.Asset=fo;var po=t("af",Xr("cc.Script")(uo=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(fo))||uo);i._Script=po;var _o=t("ag",Xr("cc.JavaScript")(ho=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(po))||ho);i._JavaScript=_o;var vo,go,mo,yo,bo,Eo,To,wo,Ao,Io,Co,Oo,So,Ro=t("ah",Xr("cc.TypeScript")(co=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(po))||co);i._TypeScript=Ro;var xo,No,Mo,Po,Do,Lo,ko,Fo,Bo,Uo,zo,Ho,Vo,Go,jo,Wo=t("aH",(vo=Xr("cc.ClickEvent"),go=ms(),mo=ms(),yo=ms(),bo=ms(),vo((So=function(){function t(){T(this,"target",wo,this),T(this,"component",Ao,this),T(this,"_componentId",Io,this),T(this,"handler",Co,this),T(this,"customEventData",Oo,this)}t.emitEvents=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var s=0,o=e.length;s<o;s++){var a=e[s];a instanceof t&&a.emit(i)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(i.isValid(e)){this._genCompIdIfNeeded();var n=i.js.getClassById(this._componentId),r=e.getComponent(n);if(i.isValid(r)){var s=r[this.handler];"function"==typeof s&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),s.apply(r,t))}}},e._compName2Id=function(t){var e=i.js.getClassByName(t);return i.js.getClassId(e)},e._compId2Name=function(t){var e=i.js.getClassById(t);return i.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},n(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),wo=E((To=So).prototype,"target",[is,go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ao=E(To.prototype,"component",[is,_s,mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Io=E(To.prototype,"_componentId",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Co=E(To.prototype,"handler",[is,_s,yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Oo=E(To.prototype,"customEventData",[is,_s,bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Eo=To))||Eo)),Ko=new O("Comp"),Yo=pt.Flags.IsOnLoadCalled,qo=t("aI",(xo=Xr("cc.Component"),No=gs(),Mo=Rs(po),Po=ms(),xo((zo=Uo=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"node",ko,w(e)),T(e,"_enabled",Fo,w(e)),T(e,"__prefab",Bo,w(e)),e._sceneGetter=null,e._id=Ko.getNewId(),e}m(e,t);var r=e.prototype;return r._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},r.addComponent=function(t){return this.node.addComponent(t)},r.getComponent=function(t){return this.node.getComponent(t)},r.getComponents=function(t){return this.node.getComponents(t)},r.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},r.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},r.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&i.director._compScheduler.disableComp(this),!0)},r._onPreDestroy=function(){this.unscheduleAllCallbacks(),i.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},r._instantiate=function(t){return t||(t=i.instantiate._clone(this,this)),t&&(t.node=null),t},r.schedule=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=i.macro.REPEAT_FOREVER),void 0===r&&(r=0),A(t,1619),A((e=e||0)>=0,1620),n=Number.isNaN(n)?i.macro.REPEAT_FOREVER:n,r=r||0;var s=i.director.getScheduler(),o=s.isTargetPaused(this);s.schedule(t,this,e,n,r,o)},r.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},r.unschedule=function(t){t&&i.director.getScheduler().unschedule(t,this)},r.unscheduleAllCallbacks=function(){i.director.getScheduler().unscheduleAllForTarget(this)},n(e,[{key:"name",get:function(){if(this._name)return this._name;var t=C(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=i.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&Yo}}]),e}(pt),Uo.EventHandler=Wo,Uo.system=null,E((Lo=zo).prototype,"__scriptAsset",[No,Mo,Po,As],Object.getOwnPropertyDescriptor(Lo.prototype,"__scriptAsset"),Lo.prototype),ko=E(Lo.prototype,"node",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fo=E(Lo.prototype,"_enabled",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Bo=E(Lo.prototype,"__prefab",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Do=Lo))||Do)),Xo=qo.prototype;Xo.update=null,Xo.lateUpdate=null,Xo.__preload=null,Xo.onLoad=null,Xo.start=null,Xo.onEnable=null,Xo.onDisable=null,Xo.onDestroy=null,Xo.onFocusInEditor=null,Xo.onLostFocusInEditor=null,Xo.resetInEditor=null,Xo._getLocalBounds=null,Xo.onRestore=null,qo._requireComponent=null,qo._executionOrder=0,I(qo,"_registerEditorProps",(function(t,e){var n=e.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i)})),i.Component=qo;var Qo=t("aG",Xr("cc.MissingScript")(Ho=ls()((jo=function(t){function e(){var e;return e=t.call(this)||this,T(e,"_$erialized",Go,w(e)),e}return m(e,t),e.safeFindClass=function(t){var e=S(t);if(e)return e;i.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){_(4600,this.node.name)},e}(qo),Go=E((Vo=jo).prototype,"_$erialized",[is,ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ho=Vo))||Ho)||Ho);i._MissingScript=Qo;try{var $o=Qo.__values__;0!==$o.length&&"_$erialized"===$o[$o.length-1]||(g("The '_$erialized' prop in MissingScript is missing. Please contact jare."),g("    Error props: ['"+$o+"']"))}catch(zn){g("Error when checking MissingScript 5, "+zn)}var Zo=t("a1",Symbol("[[Serialize]]")),Jo=t("a0",Symbol("[[Deserialize]]")),ta=function(){function t(t,e){this._document=void 0,this._chunks=void 0,this._document=t,this._chunks=e}return n(t,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t}();function ea(t){var e=t;return{chunks:e.chunks,document:e.document}}function na(t){if(t.length<16)throw new ia(b(13102));var e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new ia(b(13100));var n=e.getUint32(4,!0);if(1!==n)throw new ia(b(13101,n));if(e.getUint32(8,!0)!==e.byteLength)throw new ia(b(13102));var i=12,r=e.getUint32(i,!0);i+=4;var s=new Uint8Array(e.buffer,i+e.byteOffset,r);i+=r;var o,a=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(b(13104))}(s);try{o=JSON.parse(a)}catch(t){throw new ia(t)}for(var u=[];i<e.byteLength;){i%8!=0&&(i+=8-i%8);var h=e.getUint32(i,!0);i+=4,u.push(new Uint8Array(e.buffer,i+e.byteOffset,h)),i+=h}if(i!==e.byteLength)throw new ia(b(13102));return new ta(o,u)}var ia=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(R(Error));!function(){function t(){this._viewOrPaddings=[],this._length=0}var e=t.prototype;e.alignAs=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;return this._viewOrPaddings.push(n),this._length+=n,n}}return 0},e.append=function(t){var e=this._length;return this._viewOrPaddings.push(t),this._length+=t.byteLength,e},e.get=function(){var t=new Uint8Array(this._length),e=0;return this._viewOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e),e+=n.byteLength)})),t},n(t,[{key:"byteLength",get:function(){return this._length}}])}(),i.internal.parseCCONJson=ea,i.internal.decodeCCONBinary=na,i.internal.CCON=ta;var ra=k+"type",sa=k+"default",oa=k+"formerlySerializedAs",aa=function(t){function e(){return t.call(this,(function(t){t.clear()}),1)||this}return m(e,t),e.prototype.get=function(t,e,n,i,r){var s=this._get();return s?(s.reset(t,e,n,i,r),s):new ua(t,e,n,i,r)},e}(x),ua=function(){function t(t,e,n,i){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced}var e=t.prototype;return e.reset=function(t,e,n,i){this.result=t,this.customEnv=i,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced},e.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},e.deserialize=function(t){var e,n=!1;t instanceof ta?(n=!0,e=t.document,t.chunks.length>0&&(s(1===t.chunks.length),this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:n};var i=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(i,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},e._deserializeObject=function(t,e,n,i){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,n,i):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}},e._deserializeTypedArrayView=function(t){return globalThis[t.ctor].from(t.array)},e._deserializeTypedArrayViewRef=function(t){var e=t.offset,n=t.length,i=t.ctor;return new globalThis[i](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,n)},e._deserializeArray=function(t){for(var e,n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof(e=t[i])&&e?this._deserializeAndAssignField(n,e,""+i)&&(n[i]=null):n[i]=e;return n},e._deserializePlainObject=function(t){var e={};return this._fillPlainObject(e,t),e},e._deserializeTypeTaggedObject=function(t,e,n,i){var r=this,s=t.__type__,o=this._classFinder(s,t,n,i);if(!o)return this._classFinder===S&&this._reportMissingClass(s),null;var a=function(t){var n=new t;return e>=0&&(r.deserializedList[e]=n),n}(o);return this._deserializeInto(t,a,o),a},e._deserializeInto=function(t,e,n,r){void 0===r&&(r=!1),r||!e[Jo]?e._deserialize?e._deserialize(t.content,this):i.Class._isCCClass(n)?this._deserializeFireClass(e,t,n):this._deserializeFastDefinedObject(e,t,n):this._runCustomizedDeserialize(t,e,n)},e._runCustomizedDeserialize=function(t,e,n){var i=this,r={readProperty:function(e){var n=t[e];return"object"==typeof n&&n?i._deserializeObjectField(n):n},readThis:function(){i._deserializeInto(t,e,n,!0)},readSuper:function(){var r=L(n);r&&i._deserializeInto(t,e,r)}};e[Jo](r,this._context)},e._deserializeFireClass=function(t,e,n){var r;if(n.hasOwnProperty("__deserialize__"))r=n.__deserialize__;else{r=function(t,e){var n=M.test(P(e)),r=D(e,i._BaseNode)||D(e,i.Component),s=!1,a=[],u=a,h=[],c=h,l=[];return function(){var t=e.__values__;s="_$erialized"===t[t.length-1];for(var r=N(e),f=0;f<t.length;f++){var p=t[f],_=p;r[p+oa]&&(_=r[p+oa]);var d=o.getDefault(r[p+sa]),v=r[p+ra],g=!1;if(n&&(void 0!==d||v))if(void 0===d)g=v instanceof F||v===B||v===U;else{var m=typeof d;g="string"===m||"number"===m||"boolean"===m}n&&g?(_!==p&&u===a&&(u=a.slice()),a.push(p),u!==a&&u.push(_)):(_!==p&&c===h&&(c=h.slice()),h.push(p),c!==h&&c.push(_),l.push(d instanceof i.ValueType&&d.constructor))}}(),function(t,e,i){for(var o=0;o<a.length;++o){var f=i[u[o]];void 0!==f&&(e[a[o]]=f)}for(var p=0;p<h.length;++p){var _=h[p],d=i[c[p]];if(void 0!==d)if(n||"object"==typeof d){var v=l[p];v?n||d?t._deserializeFastDefinedObject(e[_],d,v):e[_]=null:d?t._deserializeAndAssignField(e,d,_):e[_]=null}else e[_]=d}r&&i._id&&(e._id=i._id),s&&(e._$erialized=JSON.parse(JSON.stringify(i)),t._fillPlainObject(e._$erialized,i))}}(0,n);try{if(n===Qo){var s=n.__values__;0!==s.length&&"_$erialized"===s[s.length-1]||(g("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),g("    Error props: ['"+s+"']. Please contact jare."));var a=r;r=function(t,e,n,i){a(t,e,n,i),e._$erialized||g("Unable to stash previously serialized data. "+JSON.stringify(n))}}}catch(t){g("Error when checking MissingScript 6, "+t)}I(n,"__deserialize__",r,!0)}r(this,t,e,n)},e._deserializeAndAssignField=function(t,e,n){var i=e.__id__;if("number"==typeof i){var r=this.deserializedList[i];if(r)t[n]=r;else{var s,o=this._serializedData[i];t[n]=this._deserializeObject(o,i,void 0,n),null===(s=this._onDereferenced)||void 0===s||s.call(this,this.deserializedList,i,t,n)}}else{var a=e.__uuid__;if(a){var u=e.__expectedType__;this.result.push(t,n,a,u)}else t[n]=this._deserializeObject(e,-1)}return!1},e._deserializeObjectField=function(t){var e=t.__id__;if("number"==typeof e){var n=this.deserializedList[e];if(n)return n;var i=this._serializedData[e];return this._deserializeObject(i,e,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)},e._fillPlainObject=function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"object"!=typeof i?"__type__"!==n&&(t[n]=i):i?this._deserializeAndAssignField(t,i,n)&&(t[n]=null):t[n]=null}},e._deserializeFastDefinedObject=function(t,e,n){if(n===i.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(n===i.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(n!==i.Color){if(n===i.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var r=N(n),s=n.__values__,a=0;a<s.length;a++){var u=s[a],h=e[u];void 0!==h||e.hasOwnProperty(u)||(h=o.getDefault(r[u+sa])),"object"!=typeof h?t[u]=h:h?this._deserializeAndAssignField(t,h,u):t[u]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var c=e.a;t.a=void 0===c?255:c}},t}();ua.pool=new aa;var ha=[Fe,Oe,Pe,Le,Be,Ue,ze,Se];function ca(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var la=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},ca,ca,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Se.fromArray(t,e,1)}],fa=t("X",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var e=t.prototype;return e.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},e.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},e.push=function(t,e,n,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(n),this.uuidTypeList.push(i||"")},t}());function pa(t,e){for(var n=t[4][e[0]],i=n[0],r=new(0,i[0]),s=i[1],o=i[2],a=n[n.length-1],u=1;u<a;++u)r[s[n[u]]]=e[u];for(;u<e.length;++u){var h=s[n[u]],c=i[n[u]+o];(0,ya[c])(t,r,h,e[u])}return r}function _a(t,e,n){var i=new e;return i._deserialize?i._deserialize(n,t[0]):z(5303,C(e)),i}function da(t,e,n,i){i>=0?e[n]=t[5][i]:t[7][3*~i]=e}function va(t){return function(e,n,i,r){n[i]=r;for(var s=0;s<r.length;++s)t(e,r,s,r[s])}}function ga(t,e,n,i){e[n]=null,t[8][i]=e}function ma(t,e,n,i){e[n]=pa(t,i)}fa.pool=new x((function(t){t.reset()}),5),fa.pool.get=function(){return this._get()||new fa};var ya=new Array(13);function ba(t,e,n){return t||n(e),Object}function Ea(t,e,n,i,r,s,o){var a,u,h,c=t(e);if(!c){if(r)return void(n[i]=(a=n,u=i,h=e,function(){var e=t(h)||ba(s,h,o);return a[u]=e,new e}));c=ba(s,e,o)}n[i]=c}function Ta(t,e,n,i){for(var r=n||S,s=t[3],o=0;o<s.length;++o){var a=s[o];"string"!=typeof a?Ea(r,a[0],a,0,e,n,i):Ea(r,a,s,o,e,n,i)}}function wa(t){var e=t[4];if(e)for(var n=t[3],i=0;i<e.length;++i){var r=e[i];r[0]=n[r[0]]}}function Aa(t,e,n){"string"==typeof t&&(t=JSON.parse(t));var r,s=!e;if(e=e||fa.pool.get(),function(t){if(Array.isArray(t)){var e=t[0];return"number"==typeof e||e instanceof Ia}return!1}(t)){e.init(t),n=n||{};var o,a=t[0],u=!1;if("object"==typeof a&&(u=a.preprocessed,a=a.version),a<1)throw new Error(b(5304,a));n._version=a,n.result=e,t[0]=n,u||(Ta(t,!1,n.classFinder,null!==(o=n.reportMissingClass)&&void 0!==o?o:Aa.reportMissingClass),wa(t)),i.game._isCloning=!0;var h=t[5],c=function(t){var e=t[5],n=t[6],i=0===n?0:n.length,r=e[e.length-1],s=e.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--s);for(var o=0;o<s;++o)e[o]=pa(t,e[o]);for(var a=t[3],u=0;u<i;++u,++o){var h=n[u],c=e[o];if(h>=0){var l=a[h];e[o]=_a(t,l,c)}else(0,ya[h=~h])(t,e,o,c)}return r}(t);i.game._isCloning=!1,t[7]&&function(t,e,n){for(var i=t.length-1,r=0,s=3*t[i];r<s;r+=3){var o=t[r],a=e[t[r+2]],u=t[r+1];u>=0?o[n[u]]=a:o[~u]=a}for(;r<i;r+=3){var h=e[t[r]],c=e[t[r+2]],l=t[r+1];l>=0?h[n[l]]=c:h[~l]=c}}(t[7],h,t[2]),function(t){for(var e=t[5],n=t[2],i=t[1],r=t[8],s=t[9],o=t[10],a=0;a<r.length;++a){var u=r[a];"number"==typeof u&&(r[a]=e[u]);var h=s[a];"number"==typeof h&&(h=h>=0?n[h]:~h,s[a]=h);var c=o[a];"number"==typeof c&&(o[a]=i[c])}}(t),r=h[c]}else r=function(t,e,n){var r,s=(n=n||{}).classFinder||S,o=n.createAssetRefs||Xe.platform===_t.EDITOR_CORE,a=n.customEnv,u=n.ignoreEditorOnly,h=null!==(r=n.reportMissingClass)&&void 0!==r?r:i.deserialize.reportMissingClass;e.init();var c=ua.pool.get(e,s,h,a,u);i.game._isCloning=!0;var l=c.deserialize(t);return i.game._isCloning=!1,ua.pool.put(c),o&&e.assignAssetsBy((function(t,e){return EditorExtends.serialize.asAsset(t,e.type)})),l}(t,e,n);return s&&fa.pool.put(e),r}ya[0]=function(t,e,n,i){e[n]=i},ya[1]=da,ya[2]=va(da),ya[3]=va(ga),ya[4]=ma,ya[5]=function(t,e,n,i){la[i[0]](e[n],i)},ya[6]=ga,ya[7]=function(t,e,n,i){e[n].set(i)},ya[8]=function(t,e,n,i){var r=new ha[i[0]];la[i[0]](r,i),e[n]=r},ya[9]=va(ma),ya[10]=function(t,e,n,i){var r=t[3][i[0]];e[n]=_a(t,r,i[1])},ya[11]=function(t,e,n,i){var r=i[0];e[n]=r;for(var s=1;s<i.length;s+=3){var o=i[s],a=i[s+1],u=i[s+2];(0,ya[a])(t,r,o,u)}},ya[12]=function(t,e,n,i){var r=i[0];e[n]=r;for(var s=0;s<r.length;++s){var o=r[s],a=i[s+1];0!==a&&(0,ya[a])(t,r,s,o)}},Aa.Details=fa,Aa.reportMissingClass=function(t){z(5302,t)};var Ia=function(t){this.preprocessed=!0,this.version=t};function Ca(t,e,n){return[1,0,0,[t],0,n?[e,-1]:[e],[0],0,[],[],[]]}i.deserialize=Aa;var Oa,Sa,Ra,xa,Na,Ma,Pa,Da,La,ka,Fa,Ba=pt.Flags.Destroyed,Ua=pt.Flags.PersistentMask,za=[];function Ha(t){var e;if(dt(t)){if(t._instantiate)return i.game._isCloning=!0,e=t._instantiate(null,!0),i.game._isCloning=!1,e;if(t instanceof i.Asset)throw new TypeError(b(6903))}return i.game._isCloning=!0,e=Va(t),i.game._isCloning=!1,e}function Va(t,e){var n;Ga(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var i=0,r=za.length;i<r;++i)za[i]._iN$t=null;return za.length=0,n}function Ga(t,e,n){a.value(t,"_iN$t",e,!0),za.push(t);var i=t.constructor;if(H(i))!function(t,e,n,i){for(var r=t.__values__,s=0;s<r.length;s++){var o=r[s],a=e[o];if("object"==typeof a&&a){var u=n[o];u instanceof V&&u.constructor===a.constructor?u.set(a):n[o]=a._iN$t||ja(a,i)}else n[o]=a}}(i,t,e,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r||"__prefab"===r)){var s=t[r];if("object"==typeof s&&s){if(s===e)continue;e[r]=s._iN$t||ja(s,n)}else e[r]=s}dt(t)&&(e._objFlags&=Ua)}function ja(t,e){if(t instanceof V)return t.clone();if(t instanceof i.Asset)return t;var n;if(ArrayBuffer.isView(t)){var r=t.length;n=new t.constructor(r),t._iN$t=n,za.push(t);for(var s=0;s<r;++s)n[s]=t[s];return n}if(Array.isArray(t)){var o=t.length;n=new Array(o),t._iN$t=n,za.push(t);for(var a=0;a<o;++a){var u=t[a];n[a]="object"==typeof u&&u?u._iN$t||ja(u,e):u}return n}if(t._objFlags&Ba)return null;var h=t.constructor;if(H(h)){if(e)if(e instanceof i.Component){if(t instanceof i._BaseNode||t instanceof i.Component)return t}else if(e instanceof i._BaseNode)if(t instanceof i._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof i.Component&&t.node&&!t.node.isChildOf(e))return t;n=new h}else if(h===Object)n={};else{if(h)return t;n=Object.create(null)}return Ga(t,n,e),n}function Wa(t,e){return(e<<3)+t}function Ka(t){return qa[t]}function Ya(t){switch(t){case ka.Uint8:return Uint8Array;case ka.Uint16:return Uint16Array;case ka.Uint32:return Uint32Array;case ka.Int8:return Int8Array;case ka.Int16:return Int16Array;case ka.Int32:return Int32Array;case ka.Float32:return Float32Array;case ka.Float64:return Float64Array}}Ha._clone=Va,i.instantiate=Ha,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(ka||(ka={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(Fa||(Fa={})),t("$",Xr("cc.CompactValueTypeArray")((Da=Pa=function(){function t(){T(this,"_byteOffset",Ra,this),T(this,"_unitCount",xa,this),T(this,"_unitElement",Na,this),T(this,"_length",Ma,this)}return t.lengthFor=function(t,e,n){return Ka(e).requiredUnits*t.length*Ya(n).BYTES_PER_ELEMENT},t.compress=function(e,n,i,r,s,o){for(var a=Ka(n),u=Ya(i),h=a.requiredUnits*e.length,c=new u(r,s,h),l=0;l<e.length;++l)a.compress(c,l,e[l]);var f=new t;return f._unitElement=Wa(i,n),f._byteOffset=o,f._unitCount=h,f._length=e.length,f},t.prototype.decompress=function(t){for(var e,n={storageUnit:7&(e=this._unitElement),elementType:e>>3},i=n.storageUnit,r=Ka(n.elementType),s=new(Ya(i))(t,this._byteOffset,this._unitCount),o=new Array(this._length),a=0;a<this._length;++a)o[a]=r.decompress(s,a);return o},t}(),Pa.StorageUnit=ka,Pa.ElementType=Fa,Ra=E((Sa=Da).prototype,"_byteOffset",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xa=E(Sa.prototype,"_unitCount",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Na=E(Sa.prototype,"_unitElement",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wa(ka.Uint8,Fa.Scalar)}}),Ma=E(Sa.prototype,"_length",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Oa=Sa))||Oa);var qa=((La={})[Fa.Scalar]={requiredUnits:1,compress:function(t,e,n){t[e]=n},decompress:function(t,e){return t[e]}},La[Fa.Vec2]={requiredUnits:2,compress:function(t,e,n){t[2*e]=n.x,t[2*e+1]=n.y},decompress:function(t,e){return new Oe(t[2*e],t[2*e+1])}},La[Fa.Vec3]={requiredUnits:3,compress:function(t,e,n){t[3*e]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z},decompress:function(t,e){return new Oe(t[3*e],t[3*e+1],t[3*e+2])}},La[Fa.Vec4]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new Pe(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},La[Fa.Quat]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new Le(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},La[Fa.Mat4]={requiredUnits:16,compress:function(t,e,n){Se.toArray(t,n,16*e)},decompress:function(t,e){return Se.fromArray(new Se,t,16*e)}},La);function Xa(){return 0}function Qa(t){return t}function $a(t){return t*t}function Za(t){return t*(2-t)}function Ja(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function tu(t){return t*t*t}function eu(t){return--t*t*t+1}function nu(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function iu(t){return t*t*t*t}function ru(t){return 1- --t*t*t*t}function su(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function ou(t){return t*t*t*t*t}function au(t){return--t*t*t*t*t+1}function uu(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function hu(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function cu(t){return Math.sin(t*Math.PI/2)}function lu(t){return.5*(1-Math.cos(Math.PI*t))}function fu(t){return 0===t?0:Math.pow(1024,t-1)}function pu(t){return 1===t?1:1-Math.pow(2,-10*t)}function _u(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function du(t){return 1-Math.sqrt(1-t*t)}function vu(t){return Math.sqrt(1- --t*t)}function gu(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function mu(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function yu(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function bu(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}function Eu(t){if(1===t)return 1;var e=1.70158;return t*t*((e+1)*t-e)}function Tu(t){if(0===t)return 0;var e=1.70158;return--t*t*((e+1)*t+e)+1}function wu(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}function Au(t){return 1-Iu(1-t)}function Iu(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Cu(t){return t<.5?.5*Au(2*t):.5*Iu(2*t-1)+.5}function Ou(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function Su(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}i._decorator=Ms;var Ru,xu,Nu=Hu($a,Za),Mu=Hu(tu,eu),Pu=Hu(iu,ru),Du=Hu(ou,au),Lu=Hu(hu,cu),ku=Hu(fu,pu),Fu=Hu(du,vu),Bu=Hu(mu,yu),Uu=Hu(Eu,Tu),zu=Hu(Au,Iu);function Hu(t,e){return function(n){return n<.5?e(2*n)/2:t(2*n-1)/2+.5}}t("c2",Object.freeze({__proto__:null,constant:Xa,linear:Qa,quadIn:$a,quadOut:Za,quadInOut:Ja,cubicIn:tu,cubicOut:eu,cubicInOut:nu,quartIn:iu,quartOut:ru,quartInOut:su,quintIn:ou,quintOut:au,quintInOut:uu,sineIn:hu,sineOut:cu,sineInOut:lu,expoIn:fu,expoOut:pu,expoInOut:_u,circIn:du,circOut:vu,circInOut:gu,elasticIn:mu,elasticOut:yu,elasticInOut:bu,backIn:Eu,backOut:Tu,backInOut:wu,bounceIn:Au,bounceOut:Iu,bounceInOut:Cu,smooth:Ou,fade:Su,quadOutIn:Nu,cubicOutIn:Mu,quartOutIn:Pu,quintOutIn:Du,sineOutIn:Lu,expoOutIn:ku,circOutIn:Fu,elasticOutIn:Bu,backOutIn:Uu,bounceOutIn:zu})),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.QUAD_IN=2]="QUAD_IN",t[t.QUAD_OUT=3]="QUAD_OUT",t[t.QUAD_IN_OUT=4]="QUAD_IN_OUT",t[t.QUAD_OUT_IN=5]="QUAD_OUT_IN",t[t.CUBIC_IN=6]="CUBIC_IN",t[t.CUBIC_OUT=7]="CUBIC_OUT",t[t.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",t[t.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",t[t.QUART_IN=10]="QUART_IN",t[t.QUART_OUT=11]="QUART_OUT",t[t.QUART_IN_OUT=12]="QUART_IN_OUT",t[t.QUART_OUT_IN=13]="QUART_OUT_IN",t[t.QUINT_IN=14]="QUINT_IN",t[t.QUINT_OUT=15]="QUINT_OUT",t[t.QUINT_IN_OUT=16]="QUINT_IN_OUT",t[t.QUINT_OUT_IN=17]="QUINT_OUT_IN",t[t.SINE_IN=18]="SINE_IN",t[t.SINE_OUT=19]="SINE_OUT",t[t.SINE_IN_OUT=20]="SINE_IN_OUT",t[t.SINE_OUT_IN=21]="SINE_OUT_IN",t[t.EXPO_IN=22]="EXPO_IN",t[t.EXPO_OUT=23]="EXPO_OUT",t[t.EXPO_IN_OUT=24]="EXPO_IN_OUT",t[t.EXPO_OUT_IN=25]="EXPO_OUT_IN",t[t.CIRC_IN=26]="CIRC_IN",t[t.CIRC_OUT=27]="CIRC_OUT",t[t.CIRC_IN_OUT=28]="CIRC_IN_OUT",t[t.CIRC_OUT_IN=29]="CIRC_OUT_IN",t[t.ELASTIC_IN=30]="ELASTIC_IN",t[t.ELASTIC_OUT=31]="ELASTIC_OUT",t[t.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",t[t.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",t[t.BACK_IN=34]="BACK_IN",t[t.BACK_OUT=35]="BACK_OUT",t[t.BACK_IN_OUT=36]="BACK_IN_OUT",t[t.BACK_OUT_IN=37]="BACK_OUT_IN",t[t.BOUNCE_IN=38]="BOUNCE_IN",t[t.BOUNCE_OUT=39]="BOUNCE_OUT",t[t.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",t[t.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",t[t.SMOOTH=42]="SMOOTH",t[t.FADE=43]="FADE"}(xu||(xu=t("cb",{})));var Vu,Gu=((Ru={})[xu.CONSTANT]=Xa,Ru[xu.LINEAR]=Qa,Ru[xu.QUAD_IN]=$a,Ru[xu.QUAD_OUT]=Za,Ru[xu.QUAD_IN_OUT]=Ja,Ru[xu.QUAD_OUT_IN]=Nu,Ru[xu.CUBIC_IN]=tu,Ru[xu.CUBIC_OUT]=eu,Ru[xu.CUBIC_IN_OUT]=nu,Ru[xu.CUBIC_OUT_IN]=Mu,Ru[xu.QUART_IN]=iu,Ru[xu.QUART_OUT]=ru,Ru[xu.QUART_IN_OUT]=su,Ru[xu.QUART_OUT_IN]=Pu,Ru[xu.QUINT_IN]=ou,Ru[xu.QUINT_OUT]=au,Ru[xu.QUINT_IN_OUT]=uu,Ru[xu.QUINT_OUT_IN]=Du,Ru[xu.SINE_IN]=hu,Ru[xu.SINE_OUT]=cu,Ru[xu.SINE_IN_OUT]=lu,Ru[xu.SINE_OUT_IN]=Lu,Ru[xu.EXPO_IN]=fu,Ru[xu.EXPO_OUT]=pu,Ru[xu.EXPO_IN_OUT]=_u,Ru[xu.EXPO_OUT_IN]=ku,Ru[xu.CIRC_IN]=du,Ru[xu.CIRC_OUT]=vu,Ru[xu.CIRC_IN_OUT]=gu,Ru[xu.CIRC_OUT_IN]=Fu,Ru[xu.ELASTIC_IN]=mu,Ru[xu.ELASTIC_OUT]=yu,Ru[xu.ELASTIC_IN_OUT]=bu,Ru[xu.ELASTIC_OUT_IN]=Bu,Ru[xu.BACK_IN]=Eu,Ru[xu.BACK_OUT]=Tu,Ru[xu.BACK_IN_OUT]=wu,Ru[xu.BACK_OUT_IN]=Uu,Ru[xu.BOUNCE_IN]=Au,Ru[xu.BOUNCE_OUT]=Iu,Ru[xu.BOUNCE_IN_OUT]=Cu,Ru[xu.BOUNCE_OUT_IN]=zu,Ru[xu.SMOOTH]=Ou,Ru[xu.FADE]=Su,Ru);function ju(t){return Gu[t]}s(8===0+G(255)),s(16===8+G(65280));var Wu,Ku,Yu,qu=kr.LINEAR<<0|Br.NONE<<8|xu.LINEAR<<16,Xu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).value=0,e.rightTangent=0,e.rightTangentWeight=0,e.leftTangent=0,e.leftTangentWeight=0,e._flags=qu,e}return m(e,t),n(e,[{key:"interpolationMode",get:function(){return(255&this._flags)>>0},set:function(t){this._flags&=-256,this._flags|=t<<0}},{key:"tangentWeightMode",get:function(){return(65280&this._flags)>>8},set:function(t){this._flags&=-65281,this._flags|=t<<8}},{key:"easingMethod",get:function(){return(16711680&this._flags)>>16},set:function(t){this._flags&=-16711681,this._flags|=t<<16}}]),e}(Ns);function Qu(t){var e=new Xu;if("number"==typeof t)e.value=t;else{var n=t.interpolationMode,i=t.tangentWeightMode,r=t.value,s=t.rightTangent,o=t.rightTangentWeight,a=t.leftTangent,u=t.leftTangentWeight,h=t.easingMethod,c=t[vt];e.value=null!=r?r:e.value,e.rightTangent=null!=s?s:e.rightTangent,e.rightTangentWeight=null!=o?o:e.rightTangentWeight,e.leftTangent=null!=a?a:e.leftTangent,e.leftTangentWeight=null!=u?u:e.leftTangentWeight,e.interpolationMode=null!=n?n:e.interpolationMode,e.tangentWeightMode=null!=i?i:e.tangentWeightMode,e.easingMethod=null!=h?h:e.easingMethod,c&&(e[vt]=c)}return e}o.fastDefine("cc.RealKeyframeValue",Xu,((Vu={interpolationMode:kr.LINEAR,tangentWeightMode:Br.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:xu.LINEAR})[vt]=void 0,Vu)),o.Attr.setClassAttr(Xu,vt,"editorOnly",!0),(Wu=Xu,null!==(Yu=(Ku=Wu)[ns])&&void 0!==Yu?Yu:Ku[ns]={}).uniquelyReferenced=!0;var $u,Zu=t("aN",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).preExtrapolation=Fr.CLAMP,e.postExtrapolation=Fr.CLAMP,e}m(e,t);var n=e.prototype;return n.evaluate=function(t){var e=this._times,n=this._values,i=e.length;if(0===i)return 0;var r=e[0],s=e[i-1];if(t<r){var o=this.preExtrapolation,a=n[0];if(o===Fr.CLAMP||i<2)return a.value;switch(o){case Fr.LINEAR:return _h(r,n[0].value,e[1],n[1].value,t);case Fr.LOOP:t=fh(t,r,s);break;case Fr.PING_PONG:t=ph(t,r,s);break;default:return a.value}}else if(t>s){var u=this.postExtrapolation,h=n[i-1];if(u===Fr.CLAMP||i<2)return h.value;switch(u){case Fr.LINEAR:return _h(s,h.value,e[i-2],n[i-2].value,t);case Fr.LOOP:t=fh(t,r,s);break;case Fr.PING_PONG:t=ph(t,r,s);break;default:return h.value}}var c=Lr(e,t);if(c>=0)return n[c].value;var l=~c,f=l-1,p=e[f],_=n[f],d=e[l];return function(t,e,n,i,r){var s=n-t;switch(e.interpolationMode){default:case kr.CONSTANT:return e.value;case kr.LINEAR:var o=e.easingMethod===xu.LINEAR?r:ju(e.easingMethod)(r);return Ge(e.value,i.value,o);case kr.CUBIC:var a=1/3,u=e.rightTangent,h=e.rightTangentWeight,c=0!=(e.tangentWeightMode&Br.RIGHT),l=i.leftTangent,f=i.leftTangentWeight,p=0!=(i.tangentWeightMode&Br.LEFT);if(c||p){var _=0;if(c)_=h;else{var d=s,v=s*u;_=Math.sqrt(d*d+v*v)*a}var g=Math.atan(u),m=Math.cos(g)*_+t,y=Math.sin(g)*_+e.value,b=0;if(p)b=f;else{var E=s,T=s*l;b=Math.sqrt(E*E+T*T)*a}var w=Math.atan(l),A=(m-t)/s,I=(-Math.cos(w)*b+n-t)/s,C=y,O=-Math.sin(w)*b+i.value,S=[0,0,0],R=function(t,e,n,i,r){var s=n/i,o=e/i,a=s*s,u=1/3*(-1/3*a+o),h=.5*(2/27*s*a-1/3*s*o+t/i),c=u*u*u,l=h*h+c,f=0;if(zr(l)){if(zr(h))return r[0]=0,1;var p=Math.cbrt(-h);return r[0]=2*p,r[1]=-p,2}if(l<0){var _=1/3*Math.acos(-h/Math.sqrt(-c)),d=2*Math.sqrt(-u);r[0]=d*Math.cos(_),r[1]=-d*Math.cos(_+Math.PI/3),r[2]=-d*Math.cos(_-Math.PI/3),f=3}else{var v=Math.sqrt(l),g=Math.cbrt(v-h),m=-Math.cbrt(v+h);r[0]=g+m,f=1}for(var y=1/3*s,b=0;b<f;++b)r[b]-=y;return f}(0-r,3*A,3*I-6*A,3*(A-I)+1,S),x=function(t,e,n){var i=n;if(1===e)i=t[0];else{i=-1/0;for(var r=0;r<e;++r){var s=t[r];s>=0&&s<=1&&s>i&&(i=s)}i===-1/0&&(i=0)}return i}(S,R,r);return dh(e.value,C,O,i.value,x)}var N=e.value+a*u*s,M=i.value-a*l*s;return dh(e.value,N,M,i.value,r)}}(p,_,d,n[l],(t-p)/(d-p))},n.addKeyFrame=function(e,n){return t.prototype.addKeyFrame.call(this,e,Qu(n))},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return Qu(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return Qu(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var e=this._values[0].value;return this._values.every((function(n){return ke(n.value,e,t)}))},n[Zo]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=n.length,s=new DataView(new ArrayBuffer(0+Ju+Ju+th+eh*r+hh*r)),o=0;s.setUint8(o,this.preExtrapolation),o+=Ju,s.setUint8(o,this.postExtrapolation),o+=Ju,s.setUint32(o,r,!0),o+=th,n.forEach((function(t,e){return s.setFloat32(o+eh*e,t,!0)})),o+=eh*r;for(var a,u=v(i);!(a=u()).done;){var h=a.value;o=ch(s,h,o)}var c=new Uint8Array(s.buffer,0,o);t.writeProperty("bytes",c);var l=i.map((function(t){return t[vt]}));l.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",l)}else t.writeThis()},n[Jo]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;this.preExtrapolation=i.getUint8(r),r+=Ju,this.postExtrapolation=i.getUint8(r),r+=Ju;var o=i.getUint32(r,!0);r+=th;var a=Array.from({length:o},(function(t,e){return i.getFloat32(r+eh*e,!0)}));r+=eh*o;for(var u=new Array(o),h=0;h<o;++h){var c=Qu({});r=lh(i,c,r),u[h]=c}s(r===n.byteLength);var l=t.readProperty("keyframeValueEditorExtras");l&&(s(l.length===o),l.forEach((function(t,e){return u[e][vt]=t}))),this._times=a,this._values=u}else t.readThis()},e}(Ur));o.fastDefine("cc.RealCurve",Zu,{_times:[],_values:[],preExtrapolation:Fr.CLAMP,postExtrapolation:Fr.CLAMP}),function(t){t[t.VALUE=1]="VALUE",t[t.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",t[t.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",t[t.LEFT_TANGENT=8]="LEFT_TANGENT",t[t.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",t[t.RIGHT_TANGENT=32]="RIGHT_TANGENT",t[t.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}($u||($u={}));var Ju=1,th=4,eh=4,nh=Qu({}),ih=nh.interpolationMode,rh=nh.tangentWeightMode,sh=nh.leftTangent,oh=nh.leftTangentWeight,ah=nh.rightTangent,uh=nh.rightTangentWeight,hh=26;function ch(t,e,n){var i=0,r=n,s=r;r+=4;var o=e.value,a=e.interpolationMode,u=e.tangentWeightMode,h=e.rightTangent,c=e.rightTangentWeight,l=e.leftTangent,f=e.leftTangentWeight,p=e.easingMethod;return t.setFloat32(r,o,!0),r+=4,a!==ih&&(i|=$u.INTERPOLATION_MODE,t.setUint8(r,a),r+=1),u!==rh&&(i|=$u.TANGENT_WEIGHT_MODE,t.setUint8(r,u),r+=1),l!==sh&&(i|=$u.LEFT_TANGENT,t.setFloat32(r,l,!0),r+=4),f!==oh&&(i|=$u.LEFT_TANGENT_WEIGHT,t.setFloat32(r,f,!0),r+=4),h!==ah&&(i|=$u.RIGHT_TANGENT,t.setFloat32(r,h,!0),r+=4),c!==uh&&(i|=$u.RIGHT_TANGENT_WEIGHT,t.setFloat32(r,c,!0),r+=4),i|=p<<8,t.setUint32(s,i,!0),r}function lh(t,e,n){var i=n,r=t.getUint32(i,!0);i+=4,e.value=t.getFloat32(i,!0),i+=4,r&$u.INTERPOLATION_MODE&&(e.interpolationMode=t.getUint8(i),i+=1),r&$u.TANGENT_WEIGHT_MODE&&(e.tangentWeightMode=t.getUint8(i),i+=1),r&$u.LEFT_TANGENT&&(e.leftTangent=t.getFloat32(i,!0),i+=4),r&$u.LEFT_TANGENT_WEIGHT&&(e.leftTangentWeight=t.getFloat32(i,!0),i+=4),r&$u.RIGHT_TANGENT&&(e.rightTangent=t.getFloat32(i,!0),i+=4),r&$u.RIGHT_TANGENT_WEIGHT&&(e.rightTangentWeight=t.getFloat32(i,!0),i+=4);var s=(65280&r)>>8;return e.easingMethod=s,i}function fh(t,e,n){return e+Ve(t-e,n-e)}function ph(t,e,n){return e+He(t-e,n-e)}function _h(t,e,n,i,r){return e+(i-e)/(n-t)*(r-t)}function dh(t,e,n,i,r){var s=1-r;return s*s*s*t+3*s*s*r*e+3*s*r*r*n+r*r*r*i}function vh(t,e,n,i,r){var s=1-r;return s*(s*(t+(3*e-t)*r)+3*n*r*r)+i*r*r*r}i.bezier=vh;var gh,mh,yh,bh,Eh,Th,wh,Ah,Ih,Ch,Oh,Sh=Math.cos,Rh=Math.acos,xh=Math.max,Nh=2*Math.PI,Mh=Math.sqrt;function Ph(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function Dh(t,e){var n=function(t,e){var n,i,r,s,o=e-0,a=e-t[0],u=3*o,h=3*a,c=3*(e-t[2]),l=1/(-o+h-c+(e-1)),f=1/3,p=(u-6*a+c)*l,_=p*f,d=(-u+h)*l,v=(3*d-p*p)*f,g=v*f,m=(2*p*p*p-9*p*d+o*l*27)/27,y=m/2,b=y*y+g*g*g;if(b<0){var E=-v*f,T=Mh(E*E*E),w=-m/(2*T),A=Rh(w<-1?-1:w>1?1:w),I=2*Ph(T);return i=I*Sh(A*f)-_,r=I*Sh((A+Nh)*f)-_,s=I*Sh((A+2*Nh)*f)-_,i>=0&&i<=1?r>=0&&r<=1?s>=0&&s<=1?xh(i,r,s):xh(i,r):s>=0&&s<=1?xh(i,s):i:r>=0&&r<=1?s>=0&&s<=1?xh(r,s):r:s}if(0===b)return r=-(n=y<0?Ph(-y):-Ph(y))-_,(i=2*n-_)>=0&&i<=1?r>=0&&r<=1?xh(i,r):i:r;var C=Mh(b);return(n=Ph(-y+C))-Ph(y+C)-_}(t,e),i=t[1];return((1-n)*(i+(t[3]-i)*n)*3+n*n)*n}i.bezierByTime=Dh,function(t){t[t.SLERP=0]="SLERP",t[t.CONSTANT=1]="CONSTANT"}(Oh||(Oh=t("aS",{})));var Lh,kh=Xr("cc.QuatKeyframeValue")(gh=as((yh=E((mh=function(t){var e=void 0===t?{}:t,n=e.value,i=e.interpolationMode,r=e.easingMethod;T(this,"interpolationMode",yh,this),T(this,"value",bh,this),T(this,"easingMethod",Eh,this),this.value=n?Le.clone(n):this.value,this.interpolationMode=null!=i?i:this.interpolationMode,this.easingMethod=null!=r?r:this.easingMethod}).prototype,"interpolationMode",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oh.SLERP}}),bh=E(mh.prototype,"value",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Le.clone(Le.IDENTITY)}}),Eh=E(mh.prototype,"easingMethod",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xu.LINEAR}}),gh=mh))||gh)||gh;function Fh(t){return new kh(t)}t("aR",Xr("cc.QuatCurve")((Ch=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"preExtrapolation",Ah,w(e)),T(e,"postExtrapolation",Ih,w(e)),e}m(e,t);var n=e.prototype;return n.evaluate=function(t,e){var n;null!==(n=e)&&void 0!==n||(e=new Le);var i=this._times,r=this._values,s=this.postExtrapolation,o=this.preExtrapolation,a=i.length;if(0===a)return e;var u=i[0],h=i[a-1];if(t<u){var c=r[0];switch(o){case Fr.LOOP:t=u+Ve(t-u,h-u);break;case Fr.PING_PONG:t=u+He(t-u,h-u);break;case Fr.CLAMP:default:return Le.copy(e,c.value)}}else if(t>h){var l=r[a-1];switch(s){case Fr.LOOP:t=u+Ve(t-u,h-u);break;case Fr.PING_PONG:t=u+He(t-u,h-u);break;case Fr.CLAMP:default:return Le.copy(e,l.value)}}var f=Lr(i,t);if(f>=0)return Le.copy(e,r[f].value);var p=~f,_=p-1,d=i[_],v=r[_],g=i[p],m=r[p],y=(t-d)/(g-d);switch(v.interpolationMode){default:case Oh.CONSTANT:return Le.copy(e,v.value);case Oh.SLERP:var b=v.easingMethod,E=b===xu.LINEAR?y:Array.isArray(b)?Dh(b,y):ju(b)(y);return Le.slerp(e,v.value,m.value,E)}},n.addKeyFrame=function(e,n){var i=new kh(n);return t.prototype.addKeyFrame.call(this,e,i)},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return Fh(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return Fh(t[1])})))}},n[Zo]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=!0;i.forEach((function(t,e,n){var i=n[0];r&&t.interpolationMode!==i.interpolationMode&&(r=!1)}));var s=n.length,o=Gh*(r?1:s),a=i.reduce((function(t,e){var n=e.easingMethod;return t+(Array.isArray(n)?jh+4*Kh:jh)}),0),u=0,h=new DataView(new ArrayBuffer(u+=Uh+zh+Hh*s+4*Vh*s+a+o+0)),c=0,l=0;r&&(l|=Lh.INTERPOLATION_MODE),h.setUint32(c,l,!0),c+=Uh,h.setUint32(c,s,!0),c+=zh,n.forEach((function(t,e){return h.setFloat32(c+Hh*e,t,!0)})),c+=Hh*s,i.forEach((function(t,e){var n=t.value,i=n.x,r=n.y,s=n.z,o=n.w,a=c+4*Vh*e;h.setFloat32(a+0*Vh,i,!0),h.setFloat32(a+1*Vh,r,!0),h.setFloat32(a+2*Vh,s,!0),h.setFloat32(a+3*Vh,o,!0)})),c+=4*Vh*s,i.forEach((function(t){var e=t.easingMethod;Array.isArray(e)?(h.setUint8(c,Wh),++c,h.setFloat32(c+0*Kh,e[0],!0),h.setFloat32(c+1*Kh,e[1],!0),h.setFloat32(c+2*Kh,e[2],!0),h.setFloat32(c+3*Kh,e[3],!0),c+=4*Kh):(h.setUint8(c,e),++c)}));var f=c;c+=o;var p=f;i.forEach((function(t){var e=t.interpolationMode;h.setUint8(p,e),r||(p+=Gh)}));var _=new Uint8Array(h.buffer);t.writeProperty("bytes",_)}else t.writeThis()},n[Jo]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0,s=i.getUint32(r,!0);r+=Uh;var o=s&Lh.INTERPOLATION_MODE,a=i.getUint32(r,!0);r+=zh;var u=Array.from({length:a},(function(t,e){return i.getFloat32(r+Hh*e,!0)})),h=r+=Hh*a;r+=4*Vh*a;var c=Array.from({length:a},(function(t,e){var n=h+4*Vh*e,s=i.getFloat32(n+0*Vh,!0),o=i.getFloat32(n+1*Vh,!0),a=i.getFloat32(n+2*Vh,!0),u=i.getFloat32(n+3*Vh,!0),c=i.getUint8(r);++r;var l=Fh({value:{x:s,y:o,z:a,w:u}});return c!==Wh?l.easingMethod=c:(l.easingMethod=[i.getFloat32(r+0*Kh,!0),i.getFloat32(r+1*Kh,!0),i.getFloat32(r+2*Kh,!0),i.getFloat32(r+3*Kh,!0)],r+=4*Kh),l}));if(o){var l=i.getUint8(r);++r;for(var f=0;f<a;++f)c[f].interpolationMode=l}else{for(var p=0;p<a;++p){var _=i.getUint8(r+p);c[p].interpolationMode=_}r+=a}this._times=u,this._values=c}else t.readThis()},e}(Ur),Ah=E((wh=Ch).prototype,"preExtrapolation",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fr.CLAMP}}),Ih=E(wh.prototype,"postExtrapolation",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fr.CLAMP}}),Th=wh))||Th),function(t){t[t.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(Lh||(Lh={}));var Bh,Uh=1,zh=4,Hh=4,Vh=4,Gh=1,jh=1,Wh=255,Kh=4,Yh=(t("aT",Xr("cc.ObjectCurve")(Bh=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.evaluate=function(t){var e=this.searchKeyframe(t);if(e>=0)return this._values[e];var n=je(~e-1,0,this._values.length-1);return this._values[n]},e}(Ur))||Bh),t("bk",(function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0})));o.fastDefine("cc.Keyframe",Yh,{time:0,value:0,inTangent:0,outTangent:0});var qh,Xh=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,n=this.coefficient,e*(e*(e*n[0]+n[1])+n[2])+n[3];var e,n},t}(),Qh=t("bl",function(){function t(t){if(void 0===t&&(t=null),this.cachedKey=void 0,t instanceof Zu)this._curve=t;else{var e=new Zu;this._curve=e,e.preExtrapolation=Fr.LOOP,e.postExtrapolation=Fr.CLAMP,t?e.assignSorted(t.map((function(t){return[t.time,{interpolationMode:kr.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):e.assignSorted([[0,{interpolationMode:kr.CUBIC,value:1}],[1,{interpolationMode:kr.CUBIC,value:1}]])}this.cachedKey=new Xh}var e=t.prototype;return e.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:kr.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},e.evaluate_slow=function(t){return this._curve.evaluate(t)},e.evaluate=function(t){var e=this.cachedKey,n=this._curve,i=n.keyFramesCount-1,r=t,s=t<0?n.preExtrapolation:n.postExtrapolation,o=n.getKeyframeTime(0),a=n.getKeyframeTime(i);switch(s){case Fr.LOOP:r=Ve(t-o,a-o)+o;break;case Fr.PING_PONG:r=He(t-o,a-o)+o;break;case Fr.CLAMP:default:r=je(t,o,a)}if(r>=e.time&&r<e.endTime)return e.evaluate(r);var u=this.findIndex(e,r),h=Math.min(u+1,i);return this.calcOptimizedKey(e,u,h),e.evaluate(r)},e.calcOptimizedKey=function(t,e,n){var i=this._curve.getKeyframeTime(e),r=this._curve.getKeyframeTime(n),s=this._curve.getKeyframeValue(e),o=s.value,a=s.leftTangent,u=this._curve.getKeyframeValue(n),h=u.value,c=u.rightTangent;t.index=e,t.time=i,t.endTime=r;var l=r-i,f=h-o,p=1/(l*l),_=a*l,d=c*l;t.coefficient[0]=(_+d-f-f)*p/l,t.coefficient[1]=(f+f+f-_-_-d)*p,t.coefficient[2]=a,t.coefficient[3]=o},e.findIndex=function(t,e){var n=this._curve,i=n.keyFramesCount,r=t.index;if(-1!==r)if(e>n.getKeyframeTime(r))for(var s=0;s<3;s++){var o=r+s;if(o+1<i&&n.getKeyframeTime(o+1)>e)return o}else for(var a=0;a<3;a++){var u=r-a;if(u>=0&&n.getKeyframeTime(u-1)<=e)return u-1}for(var h,c=0,l=i;l-c>1;)h=Math.floor((c+l)/2),n.getKeyframeTime(h)>=e?l=h:c=h;return c},n(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var e=t[0],n=t[1],i=new Yh;return i.time=e,i.value=n.value,i.inTangent=n.leftTangent,i.outTangent=n.rightTangent,i}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:kr.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return Zh(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=$h(t)}},{key:"postWrapMode",get:function(){return Zh(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=$h(t)}}]),t}());function $h(t){switch(t){default:case Sr.Default:case Sr.Normal:case Sr.Clamp:return Fr.CLAMP;case Sr.PingPong:return Fr.PING_PONG;case Sr.Loop:return Fr.LOOP}}function Zh(t){switch(t){default:case Fr.LINEAR:case Fr.CLAMP:return Sr.Clamp;case Fr.PING_PONG:return Sr.PingPong;case Fr.LOOP:return Sr.Loop}}Qh.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],o.fastDefine("cc.AnimationCurve",Qh,{_curve:null}),function(t){t[t.LINEAR=0]="LINEAR",t[t.BEZIER=1]="BEZIER",t[t.CATMULL_ROM=2]="CATMULL_ROM"}(qh||(qh=t("bm",{})));var Jh,tc,ec,nc,ic,rc,sc,oc=4294967295,ac=new Oe,uc=new Oe,hc=new Oe,cc=new Oe;function lc(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}t("bn",function(){function t(t,e){void 0===t&&(t=qh.CATMULL_ROM),void 0===e&&(e=[]),this._type=void 0,this._mode=qh.CATMULL_ROM,this._knots=[],this._type=jn.SHAPE_SPLINE,this._mode=t;for(var n=0;n<e.length;n++)this._knots[n]=new Oe(e[n])}t.create=function(e,n){return void 0===n&&(n=[]),new t(e,n)},t.clone=function(e){return new t(e.mode,e.knots)},t.copy=function(t,e){t._mode=e.mode,t._knots.length=0;for(var n=e.knots,i=n.length,r=0;r<i;r++)t._knots[r]=new Oe(n[r]);return t};var e=t.prototype;return e.setModeAndKnots=function(t,e){this._mode=t,this._knots.length=0;for(var n=0;n<e.length;n++)this._knots[n]=new Oe(e[n])},e.clearKnots=function(){this._knots.length=0},e.getKnotCount=function(){return this._knots.length},e.addKnot=function(t){this._knots.push(new Oe(t))},e.insertKnot=function(t,e){var n=new Oe(e);t>=this._knots.length?this._knots.push(n):this._knots.splice(t,0,n)},e.removeKnot=function(t){s(t>=0&&t<this._knots.length),this._knots.splice(t,1)},e.setKnot=function(t,e){s(t>=0&&t<this._knots.length),this._knots[t].set(e)},e.getKnot=function(t){return s(t>=0&&t<this._knots.length),this._knots[t]},e.getPoint=function(e,n){void 0===n&&(n=oc),e=je(e,0,1);var i=this.getSegments();if(0==i)return new Oe(0,0,0);if(n==oc){var r=1/i;n=Math.floor(e/r),e=e%r/r}if(n>=i)return new Oe(this._knots[this._knots.length-1]);switch(this._mode){case qh.LINEAR:return t.calcLinear(this._knots[n],this._knots[n+1],e);case qh.BEZIER:return t.calcBezier(this._knots[4*n],this._knots[4*n+1],this._knots[4*n+2],this._knots[4*n+3],e);case qh.CATMULL_ROM:var s=n>0?this._knots[n-1]:this._knots[n],o=n+2<this._knots.length?this._knots[n+2]:this._knots[n+1];return t.calcCatmullRom(s,this._knots[n],this._knots[n+1],o,e);default:return new Oe(0,0,0)}},e.getPoints=function(t,e){if(void 0===e&&(e=oc),0==t)return[];if(1==t)return[this.getPoint(0,e)];for(var n=[],i=1/(t-1),r=0;r<t;r++){var s=r*i,o=this.getPoint(s,e);n.push(o)}return n},e.getSegments=function(){var t=this._knots.length;switch(this._mode){case qh.LINEAR:case qh.CATMULL_ROM:return t<2?(_(14300),0):t-1;case qh.BEZIER:return t<4||t%4!=0?(_(14301),0):t/4}},t.calcLinear=function(t,e,n){var i=new Oe;return Oe.multiplyScalar(ac,t,1-n),Oe.multiplyScalar(uc,e,n),Oe.add(i,ac,uc),i},t.calcBezier=function(t,e,n,i,r){var s=new Oe,o=1-r;return Oe.multiplyScalar(ac,t,o*o*o),Oe.multiplyScalar(uc,e,3*r*o*o),Oe.multiplyScalar(hc,n,3*r*r*o),Oe.multiplyScalar(cc,i,r*r*r),Oe.add(ac,ac,uc),Oe.add(hc,hc,cc),Oe.add(s,ac,hc),s},t.calcCatmullRom=function(t,e,n,i,r){var s=new Oe,o=r*r,a=o*r;return Oe.multiplyScalar(ac,t,-.5*a+o-.5*r),Oe.multiplyScalar(uc,e,1.5*a-2.5*o+1),Oe.multiplyScalar(hc,n,-1.5*a+2*o+.5*r),Oe.multiplyScalar(cc,i,.5*a-.5*o),Oe.add(ac,ac,uc),Oe.add(hc,hc,cc),Oe.add(s,ac,hc),s},n(t,[{key:"type",get:function(){return this._type}},{key:"mode",get:function(){return this._mode}},{key:"knots",get:function(){return this._knots}}]),t}()),Ne(hr,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]),t("bp",function(t){function e(){var e;return e=t.call(this)||this,lc("line","Line"),e}return m(e,t),e}(Wn)),t("bq",function(t){function e(){var e;return e=t.call(this)||this,lc("plane","Plane"),e}return m(e,t),e}(_r)),t("br",function(t){function e(){var e;return e=t.call(this)||this,lc("ray","Ray"),e}return m(e,t),e}(Kn)),t("bs",function(t){function e(){var e;return e=t.call(this)||this,lc("triangle","Triangle"),e}return m(e,t),e}(ti)),t("bt",function(t){function e(){var e;return e=t.call(this)||this,lc("sphere","Sphere"),e}return m(e,t),e}(Jn)),t("bu",function(t){function e(){var e;return e=t.call(this)||this,lc("aabb","AABB"),e}return m(e,t),e}(Er)),t("bv",function(t){function e(){var e;return e=t.call(this)||this,lc("obb","OBB"),e}return m(e,t),e}(Ir)),t("bw",function(t){function e(){var e;return e=t.call(this)||this,lc("capsule","Capsule"),e}return m(e,t),e}(Cr)),t("bx",function(t){function e(){var e;return e=t.call(this)||this,lc("frustum","Frustum"),e}return m(e,t),e}(Dr)),function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(Jh||(Jh=t("C",{}))),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(tc||(tc=t("f",{}))),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(ec||(ec=t("h",{}))),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(nc||(nc=t("i",{}))),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(ic||(ic=t("k",{}))),function(t){t[t.DEFAULT=-1]="DEFAULT",t[t.LEFT_EYE=0]="LEFT_EYE",t[t.RIGHT_EYE=1]="RIGHT_EYE",t[t.MAIN=2]="MAIN"}(rc||(rc=t("l",{}))),function(t){t[t.NO_TRACKING=0]="NO_TRACKING",t[t.POSITION_AND_ROTATION=1]="POSITION_AND_ROTATION",t[t.POSITION=2]="POSITION",t[t.ROTATION=3]="ROTATION"}(sc||(sc=t("T",{})));var fc,pc,_c,dc,vc,gc,mc,yc=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],bc=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],Ec=[100,200,400,800],Tc=new Oe,wc=new Oe,Ac=new Se,Ic=t("S",gt.STENCIL<<1),Cc=[],Oc=(t("n",function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=Jh.VERTICAL,this._fov=Ke(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new yt(.2,.2,.2,1),this._viewport=new ze(0,0,1,1),this._orientedViewport=new ze(0,0,1,1),this._curTransform=mt.IDENTITY,this._isProjDirty=!0,this._matView=new Se,this._matProj=new Se,this._matProjInv=new Se,this._matViewProj=new Se,this._matViewProjInv=new Se,this._frustum=new Dr,this._forward=new Oe,this._position=new Oe,this._priority=0,this._aperture=ec.F16_0,this._apertureValue=void 0,this._shutter=ic.D125,this._shutterValue=0,this._iso=nc.ISO100,this._isoValue=0,this._window=null,this._width=1,this._height=1,this._clearFlag=gt.NONE,this._clearDepth=1,this._visibility=Qe,this._exposure=0,this._clearStencil=0,this._geometryRenderer=null,this._cameraType=rc.DEFAULT,this._trackingType=sc.NO_TRACKING,this._device=t,this._apertureValue=yc[this._aperture],this._shutterValue=bc[this._shutter],this._isoValue=Ec[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!Cc.length){var e=t.capabilities.clipSpaceSignY;Cc[mt.IDENTITY]=new Se(1,0,0,0,0,e),Cc[mt.ROTATE_90]=new Se(0,1,0,0,-e,0),Cc[mt.ROTATE_180]=new Se(-1,0,0,0,0,-e),Cc[mt.ROTATE_270]=new Se(0,-1,0,0,e,0)}}var e=t.prototype;return e._updateAspect=function(t){if(void 0===t&&(t=!0),this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),t){var e=this.window.swapchain;(e&&e.surfaceTransform||mt.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0},e.initialize=function(t){void 0!==t.trackingType&&(this._trackingType=t.trackingType),void 0!==t.cameraType&&(this._cameraType=t.cameraType),this.node=t.node,this._width=1,this._height=1,this.clearFlag=gt.NONE,this.clearDepth=1,this.visibility=Qe,this._name=t.name,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(t.window)},e.destroy=function(){var t;this._node=null,this.detachFromScene(),this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,null===(t=this._geometryRenderer)||void 0===t||t.destroy()},e.attachToScene=function(t){this._enabled=!0,this._scene=t},e.detachFromScene=function(){this._enabled=!1,this._scene=null},e.resize=function(t,e){this._window&&(this._width=t,this._width=t,this._height=e,this._aspect=t*this._viewport.width/(e*this._viewport.height),this._isProjDirty=!0)},e.setFixedSize=function(t,e){this._width=t,this._height=e,this._updateAspect(),this.isWindowSize=!1},e.syncCameraEditor=function(){},e.update=function(t){var e;if(void 0===t&&(t=!1),this._node){var n=!1;(this._node.hasChangedFlags||t)&&(Se.invert(this._matView,this._node.worldMatrix),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,Se.multiply(this._matView,(new Se).scale(this._node.worldScale),this._matView),this._node.getWorldPosition(this._position),n=!0);var i=null===(e=this.window)||void 0===e?void 0:e.swapchain,r=i&&i.surfaceTransform||mt.IDENTITY;if(this._isProjDirty||this._curTransform!==r){this._curTransform=r;var s=this._device.capabilities.clipSpaceSignY;if(this._proj===tc.PERSPECTIVE)Se.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===Jh.VERTICAL,this._device.capabilities.clipSpaceMinZ,s,r);else{var o=this._orthoHeight*this._aspect,a=this._orthoHeight;Se.ortho(this._matProj,-o,o,-a,a,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,s,r)}Se.invert(this._matProjInv,this._matProj),n=!0,this._isProjDirty=!1}n&&(Se.multiply(this._matViewProj,this._matProj,this._matView),Se.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv))}},e.setViewportInOrientedSpace=function(t){var e,n=t.x,i=t.width,r=t.height,s=this._device.capabilities.screenSpaceSignY<0?1-t.y-r:t.y,o=null===(e=this.window)||void 0===e?void 0:e.swapchain;switch(o&&o.surfaceTransform||mt.IDENTITY){case mt.ROTATE_90:this._viewport.x=1-s-r,this._viewport.y=n,this._viewport.width=r,this._viewport.height=i;break;case mt.ROTATE_180:this._viewport.x=1-n-i,this._viewport.y=1-s-r,this._viewport.width=i,this._viewport.height=r;break;case mt.ROTATE_270:this._viewport.x=s,this._viewport.y=1-n-i,this._viewport.width=r,this._viewport.height=i;break;case mt.IDENTITY:this._viewport.x=n,this._viewport.y=s,this._viewport.width=i,this._viewport.height=r}this._orientedViewport.x=n,this._orientedViewport.y=s,this._orientedViewport.width=i,this._orientedViewport.height=r,this.resize(this.width,this.height)},e.initGeometryRenderer=function(){var t;this._geometryRenderer||(this._geometryRenderer=i.internal.GeometryRenderer?new i.internal.GeometryRenderer:null,null===(t=this._geometryRenderer)||void 0===t||t.activate(this._device))},e.changeTargetWindow=function(t){void 0===t&&(t=null),this._window&&this._window.detachCamera(this);var e=t||i.director.root.mainWindow;if(e){e.attachCamera(this),this.window=e;var n=e.swapchain;(n&&n.surfaceTransform||mt.IDENTITY)%2?this.resize(e.height,e.width):this.resize(e.width,e.height)}},e.detachCamera=function(){this._window&&this._window.detachCamera(this)},e.screenPointToRay=function(t,e,n){if(!this._node)return null;var i=this.width,r=this.height,s=this._orientedViewport.x*i,o=this._orientedViewport.y*r,a=this._orientedViewport.width*i,u=this._orientedViewport.height*r,h=this._proj===tc.PERSPECTIVE,c=this._device.capabilities.clipSpaceSignY,l=We[this._curTransform];Oe.set(Tc,(e-s)/a*2-1,(n-o)/u*2-1,h?1:-1);var f=Tc.x,p=Tc.y;return Tc.x=f*l[0]+p*l[2]*c,Tc.y=f*l[1]+p*l[3]*c,Oe.transformMat4(h?Tc:t.o,Tc,this._matViewProjInv),h?(this._node.getWorldPosition(wc),Kn.fromPoints(t,wc,Tc)):Oe.transformQuat(t.d,Oe.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var n=this.width,i=this.height,r=this._orientedViewport.x*n,s=this._orientedViewport.y*i,o=this._orientedViewport.width*n,a=this._orientedViewport.height*i,u=this._device.capabilities.clipSpaceSignY,h=We[this._curTransform];if(this._proj===tc.PERSPECTIVE){Oe.set(t,(e.x-r)/o*2-1,(e.y-s)/a*2-1,1);var c=t.x,l=t.y;t.x=c*h[0]+l*h[2]*u,t.y=c*h[1]+l*h[3]*u,Oe.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(Tc),Oe.lerp(t,Tc,t,Ge(this._nearClip/this._farClip,1,e.z))}else{Oe.set(t,(e.x-r)/o*2-1,(e.y-s)/a*2-1,2*e.z-1);var f=t.x,p=t.y;t.x=f*h[0]+p*h[2]*u,t.y=f*h[1]+p*h[3]*u,Oe.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var n=this._device.capabilities.clipSpaceSignY,i=We[this._curTransform];Oe.transformMat4(t,e,this._matViewProj);var r=t.x,s=t.y;t.x=r*i[0]+s*i[2]*n,t.y=r*i[1]+s*i[3]*n;var o=this.width,a=this.height,u=this._orientedViewport.x*o,h=this._orientedViewport.y*a,c=this._orientedViewport.width*o,l=this._orientedViewport.height*a;return t.x=u+.5*(t.x+1)*c,t.y=h+.5*(t.y+1)*l,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,n,i){Se.multiply(t,this._matViewProj,e),Se.multiply(t,Cc[this._curTransform],t);var r=n/2,s=i/2;return Se.identity(Ac),Se.transform(Ac,Ac,Oe.set(Tc,r,s,0)),Se.scale(Ac,Ac,Oe.set(Tc,r,s,1)),Se.multiply(t,Ac,t),t},e.setExposure=function(t){this._exposure=.833333/Math.pow(2,t)},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(t)},n(t,[{key:"name",get:function(){return this._name}},{key:"scene",get:function(){return this._scene}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"window",get:function(){return this._window},set:function(t){this._window=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"forward",get:function(){return this._forward},set:function(t){this._forward=t}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._apertureValue=yc[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._shutterValue=bc[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._isoValue=Ec[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"exposure",get:function(){return this._exposure}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t}},{key:"clearColor",get:function(){return this._clearColor},set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w}},{key:"clearDepth",get:function(){return this._clearDepth},set:function(t){this._clearDepth=t}},{key:"clearStencil",get:function(){return this._clearStencil},set:function(t){this._clearStencil=t}},{key:"projectionType",get:function(){return this._proj},set:function(t){this._proj=t,this._isProjDirty=!0}},{key:"aspect",get:function(){return this._aspect}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){this._fovAxis=t,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(t){this._farClip=t,this._isProjDirty=!0}},{key:"viewport",get:function(){return this._viewport},set:function(t){_(8302),this.setViewportInOrientedSpace(t)}},{key:"frustum",get:function(){return this._frustum},set:function(t){this._frustum=t}},{key:"matView",get:function(){return this._matView}},{key:"matProj",get:function(){return this._matProj}},{key:"matProjInv",get:function(){return this._matProjInv}},{key:"matViewProj",get:function(){return this._matViewProj}},{key:"matViewProjInv",get:function(){return this._matViewProjInv}},{key:"surfaceTransform",get:function(){return this._curTransform}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"cameraType",get:function(){return this._cameraType},set:function(t){this._cameraType=t}},{key:"trackingType",get:function(){return this._trackingType},set:function(t){this._trackingType=t}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}()),1024);function Sc(t){return!!(Xe.hasFeature(Xe.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}!function(t){t[t.RGB565=bt.R5G6B5]="RGB565",t[t.RGB5A1=bt.RGB5A1]="RGB5A1",t[t.RGBA4444=bt.RGBA4]="RGBA4444",t[t.RGB888=bt.RGB8]="RGB888",t[t.RGB32F=bt.RGB32F]="RGB32F",t[t.RGBA8888=bt.RGBA8]="RGBA8888",t[t.RGBA32F=bt.RGBA32F]="RGBA32F",t[t.A8=bt.A8]="A8",t[t.I8=bt.L8]="I8",t[t.AI8=bt.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=bt.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=bt.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=Oc]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=bt.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=bt.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=1025]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=bt.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=1026]="RGBA_ETC1",t[t.RGB_ETC2=bt.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=bt.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=bt.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=bt.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=bt.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=bt.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=bt.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=bt.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=bt.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=bt.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=bt.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=bt.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=bt.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=bt.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=bt.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=bt.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(fc||(fc=t("bY",{}))),function(t){t[t.REPEAT=Et.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=Et.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=Et.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=Et.BORDER]="CLAMP_TO_BORDER"}(pc||(pc=t("ci",{}))),function(t){t[t.NONE=Tt.NONE]="NONE",t[t.LINEAR=Tt.LINEAR]="LINEAR",t[t.NEAREST=Tt.POINT]="NEAREST"}(_c||(_c=t("bZ",{})));var Rc,xc,Nc,Mc,Pc,Dc,Lc,kc,Fc,Bc,Uc,zc,Hc=t("a9",Xr("cc.ImageAsset")((mc=gc=function(t){function e(e){var n;return(n=t.call(this)||this)._nativeData=void 0,n._exportedExts=void 0,n._format=fc.RGBA8888,n._width=0,n._height=0,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&n.reset(e),n}m(e,t);var i=e.prototype;return i.reset=function(t){Sc(t)||t instanceof HTMLElement?this._nativeData=t:(this._nativeData=t,this._format=t.format)},i.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Sc(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},i._serialize=function(){},i._deserialize=function(t){var n="";"string"==typeof t?n=t:(this._width=t.w,this._height=t.h,n=t.fmt);for(var i,r=$e.gfxDevice,s=n.split("_"),o=Number.MAX_VALUE,a=this._format,u="",h=j.SUPPORT_TEXTURE_FORMATS,c=v(s);!(i=c()).done;){var l=i.value.split("@"),f=parseInt(l[0],void 0),p=e.extnames[f]||l[0],d=h.indexOf(p);if(-1!==d&&d<o){var g=l[1]?parseInt(l[1]):this._format;if(!(".astc"!==p||r&&r.getFormatFeatures(bt.ASTC_RGBA_4X4)&wt.SAMPLED_TEXTURE))continue;if(!(".pvr"!==p||r&&r.getFormatFeatures(bt.PVRTC_RGBA4)&wt.SAMPLED_TEXTURE))continue;if(!(g!==fc.RGB_ETC1&&g!==fc.RGBA_ETC1||r&&r.getFormatFeatures(bt.ETC_RGB8)&wt.SAMPLED_TEXTURE))continue;if(!(g!==fc.RGB_ETC2&&g!==fc.RGBA_ETC2||r&&r.getFormatFeatures(bt.ETC2_RGB8)&wt.SAMPLED_TEXTURE))continue;if(".webp"===p&&!Xe.hasFeature(Xe.Feature.WEBP))continue;o=d,u=p,a=g}}u?(this._setRawAsset(u),this._format=a):_(3121)},i.initDefault=function(n){if(t.prototype.initDefault.call(this,n),e._sharedPlaceHolderCanvas)this.reset(e._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),r=i.getContext("2d"),s=i.width=i.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,s,s),this.reset(i),e._sharedPlaceHolderCanvas=i}},i.validate=function(){return!!this.data},n(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||Sc(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Sc(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=fc.RGB_ETC1&&this._format<=fc.RGBA_ASTC_12x12||this._format>=fc.RGB_A_PVRTC_2BPPV1&&this._format<=fc.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}}]),e}(fo),gc.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],gc._sharedPlaceHolderCanvas=null,E((vc=mc).prototype,"_nativeAsset",[xs],Object.getOwnPropertyDescriptor(vc.prototype,"_nativeAsset"),vc.prototype),dc=vc))||dc);i.ImageAsset=Hc,r(bt);var Vc=new O("Tex"),Gc=t("c0",Xr("cc.TextureBase")((zc=Uc=function(t){function e(){var e;return e=t.call(this)||this,T(e,"_format",Nc,w(e)),T(e,"_minFilter",Mc,w(e)),T(e,"_magFilter",Pc,w(e)),T(e,"_mipFilter",Dc,w(e)),T(e,"_wrapS",Lc,w(e)),T(e,"_wrapT",kc,w(e)),T(e,"_wrapR",Fc,w(e)),T(e,"_anisotropy",Bc,w(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=new At,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=Vc.getNewId(),e._gfxDevice=e._getGFXDevice(),e._textureHash=It(e._id,666),e}m(e,t);var r=e.prototype;return r.getId=function(){return this._id},r.getPixelFormat=function(){return this._format},r.getAnisotropy=function(){return this._anisotropy},r.setWrapMode=function(t,e,n){void 0===n&&(n=t),this._wrapS=t,this._samplerInfo.addressU=t,this._wrapT=e,this._samplerInfo.addressV=e,this._wrapR=n,this._samplerInfo.addressW=n,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},r.setFilters=function(t,e){this._minFilter=t,this._samplerInfo.minFilter=t,this._magFilter=e,this._samplerInfo.magFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},r.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo.mipFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},r.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo.maxAnisotropy=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},r.destroy=function(){var e,n=t.prototype.destroy.call(this);return n&&(null===(e=i.director.root)||void 0===e?void 0:e.batcher2D)&&i.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),n},r.getHash=function(){return this._textureHash},r.getGFXTexture=function(){return null},r.getSamplerInfo=function(){return this._samplerInfo},r.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):z(9302)),this._gfxSampler},r._serialize=function(){return""},r._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},r._getGFXDevice=function(){return $e.gfxDevice},r._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},r._setGFXFormat=function(t){this._format=void 0===t?fc.RGBA8888:t},r._getGFXPixelFormat=function(t){return t===fc.RGBA_ETC1?t=fc.RGB_ETC1:t===fc.RGB_A_PVRTC_4BPPV1?t=fc.RGB_PVRTC_4BPPV1:t===fc.RGB_A_PVRTC_2BPPV1&&(t=fc.RGB_PVRTC_2BPPV1),t},n(e,[{key:"isCompressed",get:function(){return this._format>=fc.RGB_ETC1&&this._format<=fc.RGBA_ASTC_12x12||this._format>=fc.RGB_A_PVRTC_2BPPV1&&this._format<=fc.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(fo),Uc.PixelFormat=fc,Uc.WrapMode=pc,Uc.Filter=_c,Nc=E((xc=zc).prototype,"_format",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fc.RGBA8888}}),Mc=E(xc.prototype,"_minFilter",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _c.LINEAR}}),Pc=E(xc.prototype,"_magFilter",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _c.LINEAR}}),Dc=E(xc.prototype,"_mipFilter",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _c.NONE}}),Lc=E(xc.prototype,"_wrapS",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pc.REPEAT}}),kc=E(xc.prototype,"_wrapT",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pc.REPEAT}}),Fc=E(xc.prototype,"_wrapR",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pc.REPEAT}}),Bc=E(xc.prototype,"_anisotropy",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rc=xc))||Rc);i.TextureBase=Gc;var jc=new WeakMap,Wc=new WeakSet,Kc=new WeakSet;function Yc(t,e){var n;n=Qo.safeFindClass;var i,r=fa.pool.get();try{i=Aa(t,r,{classFinder:n,customEnv:e})}catch(t){throw g(t),fa.pool.put(r),t}i._uuid=e.__uuid__||"";for(var s=r.uuidList,o=r.uuidObjList,u=r.uuidPropList,h=r.uuidTypeList||[],c=[],l=0;l<s.length;l++){var f=s[l];c[l]={uuid:$s(f),owner:o[l],prop:u[l],type:a.getClassById(h[l])}}return jc.set(i,c),i._native&&Wc.add(i),fa.pool.put(r),i}var qc,Xc=function(){function t(){this._depends=new Ps}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?W({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),n=[];return this._descend(t,e,n),n},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var n,i,r=null;if(Array.isArray(e)||e.__type__||e instanceof ta){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(i=(n=e[5])[n.length-1])&&i<0)try{var s=Yc(e,{__uuid__:t});(r=this._parseDepsFromAsset(s)).nativeDep&&(r.nativeDep.uuid=t),Bs.add(t+"@import",s)}catch(e){Fs.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0},n=jc.get(t),i=0,r=n.length;i<r;i++)e.deps.push(n[i].uuid);return Wc.has(t)&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=function(t){return n=(e=t)[1],e[10].map((function(t){return n[t]}));var e,n}(t);return e.forEach((function(t,n){return e[n]=$s(t)})),e},e._descend=function(t,e,n){for(var i=this.getDeps(t),r=0;r<i.length;r++){var s=i[r];e[s]||(e[s]=!0,n.push(s),this._descend(s,e,n))}},t}(),Qc=t("bz",new Xc),$c=[new St];function Zc(t){return t&&0==(t&t-1)}var Jc,tl,el,nl,il,rl,sl=Xr("cc.SimpleTexture")(qc=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gfxTexture=null,e._gfxTextureView=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e._baseLevel=0,e._maxLevel=1e3,e}m(e,t);var i=e.prototype;return i.getGFXTexture=function(){return this._gfxTextureView},i.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),t.prototype.destroy.call(this)},i.updateImage=function(){this.updateMipmaps(0)},i.updateMipmaps=function(){},i.uploadData=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var i=this._getGFXDevice();if(i){var r=$c[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?i.copyBuffersToTexture([t],this._gfxTexture,$c):i.copyTexImagesToTexture([t],this._gfxTexture,$c)}}},i._assignImage=function(t,e,n){var i=t.data;if(i&&(this.uploadData(i,e,n),this._checkTextureLoaded(),j.CLEANUP_IMAGE_CACHE)){var r=Qc.getDeps(this._uuid),s=r.indexOf(t._uuid);-1!==s&&(K(r,s),t.decRef())}},i._checkTextureLoaded=function(){this._textureReady()},i._textureReady=function(){this.loaded=!0,this.emit("load")},i._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},i._setMipRange=function(t,e){this._baseLevel=t<1?0:t,this._maxLevel=e<1?0:e},i.setMipRange=function(t,e){A(t<=e,3124),this._setMipRange(t,e);var n=this._getGFXDevice();if(n){var i=this._createTextureView(n);this._tryDestroyTextureView(),this._gfxTextureView=i}},i._getGfxTextureCreateInfo=function(){return null},i._getGfxTextureViewCreateInfo=function(){return null},i._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&(this._createTexture(t),this._gfxTextureView=this._createTextureView(t))}},i.isUsingOfflineMipmaps=function(){return!1},i._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=Ct.NONE;this._mipFilter!==_c.NONE&&function(t,e,n){return!(t.gfxAPI===Rt.WEBGL)||Zc(e)&&Zc(n)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var n=Math.max(t,e),i=0;n;)n>>=1,i++;return i}(this._width,this._height),this.isUsingOfflineMipmaps()||(e=Ct.GEN_MIPMAP));var n=this._getGfxTextureCreateInfo({usage:Ot.SAMPLED|Ot.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(n){var i=t.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},i._createTextureView=function(t){if(!this._gfxTexture)return null;var e=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,n=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:e-this._baseLevel+1});return n?t.createTexture(n):null},i._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},i._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},n(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(Gc))||qc;i.SimpleTexture=sl;var ol,al,ul,hl,cl,ll,fl,pl,_l,dl,vl=t("aa",(Jc=Xr("cc.Texture2D"),tl=Rs([Hc]),Jc((rl=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"_mipmaps",il,w(e)),e}m(e,t);var i=e.prototype;return i.initialize=function(){this.mipmaps=this._mipmaps},i.onLoaded=function(){this.initialize()},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},i.create=function(t,e,n,i,r,s){void 0===n&&(n=fc.RGBA8888),void 0===i&&(i=1),void 0===r&&(r=0),void 0===s&&(s=1e3),this.reset({width:t,height:e,format:n,mipmapLevel:i,baseLevel:r,maxLevel:s})},i.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},i.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var n=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),i=0;i<n;++i){var r=t+i;this._assignImage(this._mipmaps[r],r)}},i.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},i.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},i.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},i.releaseTexture=function(){this.destroy()},i._serialize=function(){return null},i._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new Hc,i.mipmaps[r]){var s=i.mipmaps[r];n.result.push(this._mipmaps,""+r,s,a.getClassId(Hc))}},i._getGfxTextureCreateInfo=function(t){var e=new xt(Nt.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t),e},i._getGfxTextureViewCreateInfo=function(t){var e=new Mt;return e.type=Nt.TEX2D,Object.assign(e,t),e},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new Hc;n.initDefault(),this.image=n},i.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},n(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){e._assignImage(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(sl),il=E((nl=rl).prototype,"_mipmaps",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),el=nl))||el));i.Texture2D=vl,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(_l||(_l={})),function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.BAKED_CONVOLUTION_MAP=2]="BAKED_CONVOLUTION_MAP"}(dl||(dl={}));var gl=t("ab",Xr("cc.TextureCube")((pl=fl=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"isRGBE",ul,w(e)),T(e,"_mipmapAtlas",hl,w(e)),T(e,"_mipmapMode",cl,w(e)),T(e,"_mipmaps",ll,w(e)),e}m(e,t);var i=e.prototype;return i.isUsingOfflineMipmaps=function(){return this._mipmapMode===dl.BAKED_CONVOLUTION_MAP},e.fromTexture2DArray=function(t,n){for(var i=[],r=t.length/6,s=0;s<r;s++){var o=6*s;i.push({front:t[o+_l.front].image,back:t[o+_l.back].image,left:t[o+_l.left].image,right:t[o+_l.right].image,top:t[o+_l.top].image,bottom:t[o+_l.bottom].image})}return(n=n||new e).mipmaps=i,n},i.onLoaded=function(){this._mipmapMode===dl.BAKED_CONVOLUTION_MAP?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},i.updateMipmaps=function(t,e){var n=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=function(e){var i=t+e;ml(n._mipmaps[i],(function(t,e){n._assignImage(t,i,e)}))},s=0;s<i;++s)r(s)},i.destroy=function(){return this._mipmaps=[],this._mipmapAtlas=null,t.prototype.destroy.call(this)},i.releaseTexture=function(){this.mipmaps=[],this._mipmapAtlas=null},i._serialize=function(){return null},i._deserialize=function(e,n){var i=e;if(t.prototype._deserialize.call(this,i.base,n),this.isRGBE=i.rgbe,this._mipmapMode=i.mipmapMode,this._mipmapMode===dl.BAKED_CONVOLUTION_MAP){var r=i.mipmapAtlas,s=i.mipmapLayout;this._mipmapAtlas={atlas:{},layout:s},this._mipmapAtlas.atlas={front:new Hc,back:new Hc,left:new Hc,right:new Hc,top:new Hc,bottom:new Hc};var o=a.getClassId(Hc);n.result.push(this._mipmapAtlas.atlas,"front",r.front,o),n.result.push(this._mipmapAtlas.atlas,"back",r.back,o),n.result.push(this._mipmapAtlas.atlas,"left",r.left,o),n.result.push(this._mipmapAtlas.atlas,"right",r.right,o),n.result.push(this._mipmapAtlas.atlas,"top",r.top,o),n.result.push(this._mipmapAtlas.atlas,"bottom",r.bottom,o)}else{this._mipmaps=new Array(i.mipmaps.length);for(var u=0;u<i.mipmaps.length;++u){this._mipmaps[u]={front:new Hc,back:new Hc,left:new Hc,right:new Hc,top:new Hc,bottom:new Hc};var h=i.mipmaps[u],c=a.getClassId(Hc);n.result.push(this._mipmaps[u],"front",h.front,c),n.result.push(this._mipmaps[u],"back",h.back,c),n.result.push(this._mipmaps[u],"left",h.left,c),n.result.push(this._mipmaps[u],"right",h.right,c),n.result.push(this._mipmaps[u],"top",h.top,c),n.result.push(this._mipmaps[u],"bottom",h.bottom,c)}}},i._getGfxTextureCreateInfo=function(t){var e=new xt(Nt.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e},i._getGfxTextureViewCreateInfo=function(t){var e=new Mt;return e.type=Nt.CUBE,e.baseLayer=0,e.layerCount=6,Object.assign(e,t),e},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new Hc;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},i.validate=function(){if(this._mipmapMode===dl.BAKED_CONVOLUTION_MAP){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var t=this.mipmapAtlas.atlas;return!!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},n(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){ml(t,(function(t,i){e._assignImage(t,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(t){var e=this;if(this._mipmapAtlas=t,this._mipmapAtlas){var n=this._mipmapAtlas.atlas.front;if(n.data){var i=this._mipmapAtlas.atlas,r=this._mipmapAtlas.layout,s=r[0],o=Object.assign(document.createElement("canvas"),{width:n.width,height:n.height}).getContext("2d");this.reset({width:s.width,height:s.height,format:n.format,mipmapLevel:r.length});for(var a=function(t){var s=r[t];ml(i,(function(t,i){o.clearRect(0,0,n.width,n.height);var r=t.data;o.drawImage(r,0,0);var a=o.getImageData(s.left,s.top,s.width,s.height),u=new Hc({_data:a.data,_compressed:t.isCompressed,width:a.width,height:a.height,format:t.format});e._assignImage(u,s.level,i)}))},u=0;u<r.length;u++)a(u)}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(sl),fl.FaceIndex=_l,ul=E((al=pl).prototype,"isRGBE",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hl=E(al.prototype,"_mipmapAtlas",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cl=E(al.prototype,"_mipmapMode",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dl.NONE}}),ll=E(al.prototype,"_mipmaps",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ol=al))||ol);function ml(t,e){e(t.front,_l.front),e(t.back,_l.back),e(t.left,_l.left),e(t.right,_l.right),e(t.top,_l.top),e(t.bottom,_l.bottom)}i.TextureCube=gl;var yl=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Ps,this.scenes=new Ps,this.paths=new Ps}var e=t.prototype;return e.init=function(t){var e=this;!function(t){var e=t.uuids,n=t.paths,i=t.types,r=t.deps,s=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,a=e.length;o<a;o++)e[o]=$s(e[o]);for(var u in n){var h=n[u],c=h[1];h[1]=i[c]}}else{for(var l=Object.create(null),f=0,p=e.length;f<p;f++){var _=e[f];e[f]=l[_]=$s(_)}e=l}for(var d in n){var v=n[d];s[e[d]]=v}var g=t.scenes;for(var m in g){var y=g[m];g[m]=e[y]}var b=t.packs;for(var E in b)for(var T=b[E],w=0;w<T.length;++w)T[w]=e[T[w]];var A=t.versions;if(A)for(var I in A)for(var C=A[I],O=0;O<C.length;O+=2){var S=C[O];C[O]=e[S]||S}var R=t.redirect;if(R)for(var x=0;x<R.length;x+=2)R[x]=e[R[x]],R[x+1]=r[R[x+1]];if(t.extensionMap){var N=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(i,r){t.extensionMap[n][r]=e[i]||i}))};for(var M in t.extensionMap)N(M)}}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(t){var i=e.assetInfos.get(t);i&&(i.extension=n)}))};for(var i in t.extensionMap)n(i)},e.getInfoWithPath=function(t,e){if(!t)return null;t=no(t);var n=this.paths.get(t);if(n){if(!e)return n[0];for(var i=0,r=n.length;i<r;i++){var s=n[i];if(a.isChildClassOf(s.ctor,e))return s}}return null},e.getDirWithPath=function(t,e,n){"/"===(t=no(t))[t.length-1]&&(t=t.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(r,t)||!t)for(var s=0,o=n.length;s<o;s++){var u=n[s];e&&!a.isChildClassOf(u.ctor,e)||i.push(u)}})),i},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,n){return n.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,n=t.length;e<n;e++){var i=t[e];this.assetInfos.add(i,{uuid:i})}}},e._initPath=function(t){if(t){var e=this.paths;for(var n in e.clear(),t){var i=t[n],r=i[0],s=i[1],o=3===i.length,u=this.assetInfos.get(n);u.path=r,u.ctor=a.getClassById(s),e.has(r)?o?e.get(r).push(u):e.get(r).unshift(u):e.add(r,[u])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var n=this.assetInfos;for(var i in t){var r=t[i],s=n.get(r);s.url=i,e.add(i,s)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var n in t){var i=t[n],r={uuid:n,packedUuids:i,ext:".json"};e.add(n,r);for(var s=0,o=i.length;s<o;s++){var a=i[s],u=e.get(a),h=u.packs;h?1===o?h.unshift(r):h.push(r):u.packs=[r]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,n=t.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var s=n[i];e.get(s).ver=n[i+1]}if(n=t.native)for(var o=0,a=n.length;o<a;o+=2){var u=n[o];e.get(u).nativeVer=n[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,n=0,i=t.length;n<i;n+=2){var r=t[n];e.get(r).redirect=t[n+1]}},t}();function bl(t,e){t._uuid&&e.push(t._uuid)}function El(t,e){for(var n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var s=t[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof fo&&bl(a,e)}else if(s.constructor&&s.constructor!==Object)s instanceof fo&&bl(s,e);else for(var u=Object.getOwnPropertyNames(s),h=0;h<u.length;h++){var c=s[u[h]];c instanceof fo&&bl(c,e)}}}}function Tl(t,e){for(var n=0;n<t._components.length;n++)El(t._components[n],e);for(var i=0;i<t._children.length;i++)Tl(t._children[i],e)}function wl(t,e,n,i){n.push(t._uuid);for(var r=Qc.getDeps(t._uuid),s=0,o=r.length;s<o;s++){var a=ks.get(r[s]);if(a){var u=a._uuid;u in e?e[u]+=i:e[u]=a.refCount+i,n.includes(u)||wl(a,e,n,i)}}}var Al=[],Il=function(){function t(){this._persistNodeDeps=new Ps,this._toDelete=new Ps,this._eventListener=!1,this._dontDestroyAssets=[]}var e=t.prototype;return e.addIgnoredAsset=function(t){this._dontDestroyAssets.push(t._uuid)},e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];Tl(t,e);for(var n=0,i=e.length;n<i;n++){var r=ks.get(e[n]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),n=0,i=e.length;n<i;n++){var r=ks.get(e[n]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,n){if(t){for(var i=Qc.getDeps(t.uuid),r=0,s=i.length;r<s;r++){var o=ks.get(i[r]);o&&o.decRef(t.autoReleaseAssets)}var a=Qc._depends.get(t.uuid);if(a&&a.persistDeps)for(var u=a.persistDeps,h=0,c=u.length;h<c;h++){var l=ks.get(u[h]);l&&l.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&Qc.remove(t.uuid)}var f=Qc._depends.get(e.uuid);for(var p in f&&(f.persistDeps=[]),n){for(var _,d,g=n[p],m=this._persistNodeDeps.get(g.uuid),y=v(m);!(d=y()).done;){var b=d.value,E=ks.get(b);E&&E.addRef()}f&&(_=f.persistDeps).push.apply(_,m)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof fo&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,Y(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var n=t._uuid;if(this._toDelete.remove(n),Pt(t,!0)&&-1===this._dontDestroyAssets.indexOf(n)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,wl(t,e,Al,-1),Al.length=0,0!==e[t._uuid])return e[t._uuid];for(var n in e)0!==e[n]&&wl(ks.get(n),e,Al,1);return Al.length=0,e[t._uuid]}(t)>0)){ks.remove(n);for(var i=Qc.getDeps(n),r=0,s=i.length;r<s;r++){var o=ks.get(i[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),Qc.remove(n)}},t}(),Cl=t("bE",new Il),Ol=null;function Sl(t,e){for(var n=0,i=t.input.length;n<i;n++){var r=t.input[n];e&&!r.isNative&&r.content instanceof fo&&r.content.decRef(!1),r.recycle()}t.input=null}function Rl(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function xl(t,e,n,i,r){void 0===r&&(r=0),t(r,(function(s,o){r++,!s||r>e?i&&i(s,o):setTimeout((function(){xl(t,e,n,i,r)}),n)}))}function Nl(t,e,n,i,r){try{for(var s=Qc.parse(t,e),o=0,a=s.deps.length;o<a;o++){var u=s.deps[o];u in n||(n[u]=!0,i.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),i.push(W({},s.nativeDep)))}catch(t){g(t.message,t.stack)}}function Ml(t,e,n){e&&(n=void 0!==n?n:i.assetManager.cacheAsset,eo(e)||!n||e.isDefault||ks.add(t,e))}function Pl(t,e,n){var i=0,r=[],s=t.length;0===s&&n&&n(r);for(var o=function(t){t&&r.push(t),++i===s&&n&&n(r)},a=0;a<s;a++)e(t[a],o)}function Dl(t,e,n){var i=t,r=e,s=n;if(void 0===n){var o="function"==typeof t;e?(s=e,o||(r=null)):void 0===e&&o&&(s=t,i=null,r=null),void 0!==e&&o&&(r=t,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:s}}function Ll(t,e,n){var i=t,r=e,s=n;if(void 0===n){var o=a.isChildClassOf(t,fo);e?(s=e,o&&(r=null)):void 0!==e||o||(s=t,r=null,i=null),void 0===e||o||(r=t,i=null)}return{type:i,onProgress:r||Ol,onComplete:s}}function kl(t,e,n,i){if(void 0===i&&(i={}),!n[e]||i[e])return!1;i[e]=!0;var r=!1,s=Qc.getDeps(e);if(s)for(var o=0,a=s.length;o<a;o++){var u=s[o];if(u===t||kl(t,u,n,i)){r=!0;break}}return r}function Fl(t){return function(e,n){if(t){var i=[];Array.isArray(n)?n.forEach((function(t){return t instanceof fo&&i.push(t.addRef())})):n instanceof fo&&i.push(n.addRef()),Y((function(){i.forEach((function(t){return t.decRef(!1)})),t(e,n)}))}}}var Bl=function(){function t(){this._config=new yl}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,n){return this._config.getDirWithPath(t,e,n)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),Us.add(t.name,this)},e.load=function(t,e,n,r){var s=Ll(e,n,r),o=s.type,a=s.onProgress,u=s.onComplete,h={__requestType__:Ls.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(t)};i.assetManager.loadAny(t,h,a,u)},e.preload=function(t,e,n,r){var s=Ll(e,n,r),o=s.type,a=s.onProgress,u=s.onComplete;i.assetManager.preloadAny(t,{__requestType__:Ls.PATH,type:o,bundle:this.name},a,u)},e.loadDir=function(t,e,n,r){var s=Ll(e,n,r),o=s.type,a=s.onProgress,u=s.onComplete;i.assetManager.loadAny(t,{__requestType__:Ls.DIR,type:o,bundle:this.name,__outputAsArray__:!0},a,u)},e.preloadDir=function(t,e,n,r){var s=Ll(e,n,r),o=s.type,a=s.onProgress,u=s.onComplete;i.assetManager.preloadAny(t,{__requestType__:Ls.DIR,type:o,bundle:this.name},a,u)},e.loadScene=function(t,e,n,r){var s=Dl(e,n,r),o=s.options,a=s.onProgress,u=s.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,i.assetManager.loadAny({scene:t},o,a,(function(t,e){if(t)g(t.message,t.stack);else if(e.scene){var n=e.scene;n._id=e._uuid,n.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");u&&u(t,e)}))},e.preloadScene=function(t,e,n,r){var s=Dl(e,n,r),o=s.options,a=s.onProgress,u=s.onComplete;o.bundle=this.name,i.assetManager.preloadAny({scene:t},o,a,(function(e){e&&z(1210,t,e.message),u&&u(e)}))},e.get=function(t,e){var n=this.getInfoWithPath(t,e);return n&&ks.get(n.uuid)||null},e.release=function(t,e){var n=this.get(t,e);n&&Cl.tryRelease(n,!0)},e.releaseUnusedAssets=function(){var t=this;ks.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&Cl.tryRelease(e)}))},e.releaseAll=function(){var t=this;ks.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&Cl.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},n(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),Ul=t("am",new Bl);function zl(t,e,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",s),n&&n(null,i)}function s(){i.removeEventListener("load",r),i.removeEventListener("error",s),n&&n(new Error(b(4930,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",s),i.src=t,i}function Hl(t,e,n,i){var r=new XMLHttpRequest,s="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+s+r.status+"(no response)"))},n&&(r.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),r.onerror=function(){i&&i(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+s+r.status+"(abort)"))},r.send(null),r}i.resources=Ul;var Vl={};function Gl(t,e,n){if(Vl[t])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",s,!1),Vl[t]=!0,n&&n(null)}function s(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",s,!1),n&&n(new Error(b(4928,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=e.scriptAsyncLoading||!1,i.src=t,i.addEventListener("load",r,!1),i.addEventListener("error",s,!1),document.body.appendChild(i),i}var jl,Wl,Kl,Yl,ql,Xl,Ql,$l,Zl=/^(?:\w+:\/\/|\.+\/).+/,Jl=function(t,e,n){(Xe.hasFeature(Xe.Feature.IMAGE_BITMAP)&&i.assetManager.allowImageBitmap?tf:zl)(t,e,n)},tf=function(t,e,n){e.xhrResponseType="blob",Hl(t,e,e.onFileProgress,n)},ef=function(t,e,n){e.xhrResponseType="json",Hl(t,e,e.onFileProgress,n)},nf=function(t,e,n){e.xhrResponseType="arraybuffer",Hl(t,e,e.onFileProgress,n)},rf=function(t,e,n){ef(t,e,(function(e,i){if(e)n(e);else{var r=ea(i);Promise.all(r.chunks.map((function(n){return new Promise((function(i,r){nf(""+In(t)+n,{},(function(t,n){e?r(e):i(new Uint8Array(n))}))}))}))).then((function(t){var e=new ta(r.document,t);n(null,e)})).catch((function(t){n(t)}))}}))},sf=function(t,e,n){nf(t,e,(function(t,e){if(t)n(t);else try{var i=na(new Uint8Array(e));n(null,i)}catch(t){n(t)}}))},of=function(t,e,n){e.xhrResponseType="text",Hl(t,e,e.onFileProgress,n)},af=function(t,e,n){var i=Cn(t),r=t;Zl.test(r)||(r=-1!==hf.remoteBundles.indexOf(i)?hf.remoteServerAddress+"remote/"+i:"assets/"+i);var s=e.version||hf.bundleVers[i],o=0,a=null,u=null;ef(r+"/config."+(s?s+".":"")+"json",e,(function(t,e){u=t,(a=e)&&(a.base=r+"/"),2==++o&&n(u,a)})),Gl(r+"/index."+(s?s+".":"")+"js",e,(function(t){u=t,2==++o&&n(t,a)}))},uf=function(){function t(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!q,this.limited=!q,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=zl,this.downloadDomAudio=null,this.downloadFile=Hl,this.downloadScript=Gl,this._downloaders={".png":Jl,".jpg":Jl,".bmp":Jl,".jpeg":Jl,".gif":Jl,".ico":Jl,".tiff":Jl,".webp":Jl,".image":Jl,".pvr":nf,".pkm":nf,".astc":nf,".txt":of,".xml":of,".vsh":of,".fsh":of,".atlas":of,".tmx":of,".tsx":of,".json":ef,".ExportJson":ef,".plist":of,".ccon":rf,".cconb":sf,".fnt":of,".binary":nf,".bin":nf,".dbbin":nf,".skel":nf,".js":Gl,bundle:af,default:of},this._downloading=new Ps,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var e=t.prototype;return e.init=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=n},e.register=function(t,e){"object"==typeof t?a.mixin(this._downloaders,t):this._downloaders[t]=e},e.download=function(t,e,n,i,r){var s=this,o=Fs.get(t);if(o)r(null,o);else{var a=this._downloading.get(t);if(a){a.push(r);var u=this._queue.find((function(e){return e.id===t}));if(!u)return;var h=i.priority||0;u.priority<h&&(u.priority=h,this._queueDirty=!0)}else{var c=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,l=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,f=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,p=this._downloaders[n]||this._downloaders.default;xl((function(n,o){if(0===n&&s._downloading.add(t,[r]),s.limited){s._updateTime();var a=function(t,e){s._totalNum--,s._handleQueueInNextFrame(l,f),o(t,e)};s._totalNum<l&&s._totalNumThisPeriod<f?(p(Rl(e,s.appendTimeStamp),i,a),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:t,priority:i.priority||0,url:e,options:i,done:a,handler:p}),s._queueDirty=!0,s._totalNum<l&&s._handleQueueInNextFrame(l,f))}else p(Rl(e,s.appendTimeStamp),i,o)}),c,this.retryInterval,(function(e,n){e||Fs.add(t,n);for(var i=s._downloading.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))}}},e.loadSubpackage=function(t,e){i.assetManager.loadBundle(t,null,e)},e._updateTime=function(){var t=performance.now(),e=i.game.deltaTime,n=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=t)},e._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(Rl(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(t,e)},e._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(Y(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},n(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}(),hf=t("bA",new uf),cf=t("a8",Xr("cc.JsonAsset")((Yl=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"json",Kl,w(e)),e}return m(e,t),e}(fo),Kl=E((Wl=Yl).prototype,"json",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jl=Wl))||jl);i.JsonAsset=cf;var lf,ff,pf,_f=t("a7",Xr("cc.TextAsset")(($l=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"text",Ql,w(e)),e}return m(e,t),e.prototype.toString=function(){return this.text},e}(fo),Ql=E((Xl=$l).prototype,"text",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ql=Xl))||ql);i.TextAsset=_f;var df=t("a3",Xr("cc.BufferAsset")((pf=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._buffer=null,e}m(e,t);var i=e.prototype;return i.buffer=function(){return X(this._buffer),this._buffer},i.validate=function(){return!!this.buffer},n(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(fo),E((ff=pf).prototype,"_nativeAsset",[xs],Object.getOwnPropertyDescriptor(ff.prototype,"_nativeAsset"),ff.prototype),lf=ff))||lf);function vf(t,e,n,i){var r=null,s=null;try{(r=new Hc)._nativeUrl=t,r._nativeAsset=e}catch(t){s=t}i(s,r)}function gf(t,e,n,i){var r=new cf;r.json=e,i(null,r)}function mf(t,e,n,i){var r=new _f;r.text=e,i(null,r)}function yf(t,e,n,i){var r=new df;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function bf(t,e,n,i){var r=new fo;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function Ef(t,n,i,r){var s=Us.get(n.name);s||(s=n.name===js.RESOURCES?Ul:new Bl,n.base=n.base||t+"/",s.init(n)),e.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}i.BufferAsset=df;var Tf=function(){function t(){this._creating=new Ps,this._producers={".png":vf,".jpg":vf,".bmp":vf,".jpeg":vf,".gif":vf,".ico":vf,".tiff":vf,".webp":vf,".image":vf,".pvr":vf,".pkm":vf,".txt":mf,".xml":mf,".vsh":mf,".fsh":mf,".atlas":mf,".tmx":mf,".tsx":mf,".fnt":mf,".json":gf,".ExportJson":gf,".binary":yf,".bin":yf,".dbbin":yf,".skel":yf,bundle:Ef,default:bf}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?a.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,n,i,r){var s=this,o=this._producers[n]||this._producers.default,a=ks.get(t);if(i.reloadAsset||!a){var u=this._creating.get(t);u?u.push(r):(this._creating.add(t,[r]),o(t,e,i,(function(e,n){!e&&n instanceof fo&&(n._uuid=t,Ml(t,n,i.cacheAsset));for(var r=s._creating.remove(t),o=0,a=r.length;o<a;o++)r[o](e,n)})))}else r(null,a)},t}(),wf=t("bG",new Tf),Af=new(function(){function t(){this._loading=new Ps,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,n,i){var r=a.createMap(!0),s=null;if(Array.isArray(e)){(e=function(t){if(t[0]<1)throw new Error(b(5304,t[0]));Ta(t,!0,void 0,Aa.reportMissingClass),wa(t);for(var e=new Ia(t[0]),n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=0;a<o.length;++a)o[a].unshift(e,n,i,r,s);return o}(e)).length!==t.length&&z(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var u=a.getClassId(vl),h=a.getClassId(Hc);if(e.type===u&&e.data){var c=e.data;c.length!==t.length&&z(4915);for(var l=0;l<t.length;l++)r[t[l]+"@import"]=Ca(u,{base:c[l][0],mipmaps:c[l][1]})}else if(e.type===h&&e.data){var f=e.data;f.length!==t.length&&z(4915);for(var p=0;p<t.length;p++)r[t[p]+"@import"]=f[p]}else s=new Error("unmatched type pack!"),r=null}i(s,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?a.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,n,i,r){e?(0,this._unpackers[n])(t,e,i,r):r(new Error("package data is wrong!"))},e.load=function(t,e,n){var i=this;if(!t.isNative&&t.info&&t.info.packs)if(Fs.has(t.id))n(null,Fs.get(t.id));else{var r=t.info.packs,s=r.find((function(t){return i._loading.has(t.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:n,id:t.id});else{s=r[0],this._loading.add(s.uuid,[{onComplete:n,id:t.id}]);var o=io(s.uuid,{ext:s.ext,bundle:t.config.name});hf.download(s.uuid,o,s.ext,t.options,(function(e,n){Fs.remove(s.uuid),e&&g(e.message,e.stack),i.unpack(s.packedUuids,n,s.ext,t.options,(function(t,n){if(!t)for(var r in n)Fs.add(r,n[r]);for(var o=i._loading.remove(s.uuid),a=0,u=o.length;a<u;a++){var h=o[a];if(e||t)h.onComplete(e||t);else{var c=n[h.id];c?h.onComplete(null,c):h.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else hf.download(t.id,t.url,t.ext,t.options,n)},t}());function If(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,s=t.progress,o=[],a=s.total,u=r.__exclude__=r.__exclude__||Object.create(null);t.output=[],Pl(t.input,(function(r,h){if(!r.isNative&&ks.has(r.uuid)){var c=ks.get(r.uuid);return r.content=c.addRef(),t.output.push(r),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r),void h()}Af.load(r,t.options,(function(c,l){c?t.isFinish||(!i.assetManager.force||n?(g(c.message,c.stack),s.canInvoke=!1,e(c)):(t.output.push(r),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r))):t.isFinish||(r.file=l,t.output.push(r),r.isNative||(u[r.uuid]=!0,Nl(r.uuid,l,u,o,r.config),s.total=a+o.length),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r)),h()}))}),(function(){if(t.isFinish)return Sl(t,!0),void t.dispatch("error");if(o.length>0){var i=Ks.create({input:o,progress:s,options:r,onProgress:t.onProgress,onError:Ks.prototype.recycle,onComplete:function(r){var s;r||((s=t.output).push.apply(s,i.output),i.recycle()),n&&Cf(t),e(r)}});Hs.async(i)}else n&&Cf(t),e()}))}function Cf(t){for(var e=t.output,n=0,i=e.length;n<i;n++)e[n].content&&e[n].content.decRef(!1)}var Of=new(function(t){function e(){return t.apply(this,arguments)||this}m(e,t);var n=e.prototype;return n.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return _(5100),{};for(var n=null,i=0,r=e.childNodes.length;i<r&&1!==(n=e.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(t){var e=null,n=t.tagName;if("dict"===n)e=this._parseDict(t);else if("array"===n)e=this._parseArray(t);else if("string"===n)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===n?e=!1:"true"===n?e=!0:"real"===n?e=parseFloat(t.firstChild.nodeValue):"integer"===n&&(e=parseInt(t.firstChild.nodeValue,10));return e},n._parseArray=function(t){for(var e=[],n=0,i=t.childNodes.length;n<i;n++){var r=t.childNodes[n];1===r.nodeType&&e.push(this._parseNode(r))}return e},n._parseDict=function(t){for(var e={},n="",i=0,r=t.childNodes.length;i<r;i++){var s=t.childNodes[i];1===s.nodeType&&("key"===s.tagName?n=s.firstChild.nodeValue:e[n]=this._parseNode(s))}return e},e}(t("ct",function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}())));function Sf(t,e){return t[e]<<8|t[e+1]}var Rf=function(){function t(){this._parsing=new Ps,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},e.parsePVRTex=function(t,e,n){var i=null,r=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(s,0,13);if(55727696===o[0]){var a=o[7],u=o[6],h=o[12]+52;r={_data:new Uint8Array(s,h),_compressed:!0,width:a,height:u,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var c=o[0],l=o[1],f=o[2];r={_data:new Uint8Array(s,c),_compressed:!0,width:f,height:l,format:0}}}catch(t){i=t}n(i,r)},e.parsePKMTex=function(t,e,n){var i=null,r=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s),a=Sf(o,6);if(0!==a&&1!==a&&3!==a)throw new Error("Invalid magic number in ETC header");var u=Sf(o,12),h=Sf(o,14);Sf(o,8),Sf(o,10),r={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:h,format:0}}catch(t){i=t}n(i,r)},e.parseASTCTex=function(t,e,n){var i=null,r=null;try{var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var a=o[4],u=o[5],h=o[6];if((a<3||a>6||u<3||u>6||h<3||h>6)&&(a<4||7===a||9===a||11===a||a>12||u<4||7===u||9===u||11===u||u>12||1!==h))throw new Error("Invalid block number in ASTC header");var c=function(t,e){return 4===t?fc.RGBA_ASTC_4x4:5===t?4===e?fc.RGBA_ASTC_5x4:fc.RGBA_ASTC_5x5:6===t?5===e?fc.RGBA_ASTC_6x5:fc.RGBA_ASTC_6x6:8===t?5===e?fc.RGBA_ASTC_8x5:6===e?fc.RGBA_ASTC_8x6:fc.RGBA_ASTC_8x8:10===t?5===e?fc.RGBA_ASTC_10x5:6===e?fc.RGBA_ASTC_10x6:8===e?fc.RGBA_ASTC_10x8:fc.RGBA_ASTC_10x10:10===e?fc.RGBA_ASTC_12x10:fc.RGBA_ASTC_12x12}(a,u),l=o[7]+(o[8]<<8)+(o[9]<<16),f=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],r={_data:new Uint8Array(s,16),_compressed:!0,width:l,height:f,format:c}}catch(t){i=t}n(i,r)},e.parsePlist=function(t,e,n){var i=null,r=Of.parse(t);r||(i=new Error("parse failed")),n(i,r)},e.parseImport=function(t,e,n){if(t){var i=null,r=null;try{i=Yc(t,e)}catch(t){r=t}n(r,i)}else n(new Error("The json file of asset "+e.__uuid__+" is empty or missing"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?a.mixin(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,n,i,r){var s=this,o=Bs.get(t);if(o)r(null,o);else{var a=this._parsing.get(t);if(a)a.push(r);else{var u=this._parsers[n];u?(this._parsing.add(t,[r]),u(e,i,(function(e,n){e?Fs.remove(t):eo(n)||Bs.add(t,n);for(var i=s._parsing.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))):r(null,e)}}},t}(),xf=t("bB",new Rf);function Nf(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,s=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],Pl(t.input,(function(o,a){var u=Ks.create({input:o,onProgress:t.onProgress,options:r,progress:s,onComplete:function(r,h){r&&!t.isFinish&&(!i.assetManager.force||n?(g(r.message,r.stack),s.canInvoke=!1,e(r)):s.canInvoke&&t.dispatch("progress",++s.finish,s.total,o)),t.output.push(h),u.recycle(),a(null)}});Mf.async(u)}),(function(){if(r.__exclude__=null,t.isFinish)return Sl(t,!0),void t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var n=t.output=[],i=0,r=e.length;i<r;i++)n.push(e[i].content);else t.output=e[0].content}(t),Sl(t,!0),e()}))}var Mf=new Ds("loadOneAsset",[function(t,e){var n=t.output=t.input,i=n.options,r=n.isNative,s=n.uuid,o=n.file,a=i.reloadAsset;o||!a&&!r&&ks.has(s)?e():Af.load(n,t.options,(function(t,i){n.file=i,e(t)}))},function(t,e){var n=t.output=t.input,i=t.progress,r=t.options.__exclude__,s=n.id,o=n.file,a=n.options;if(n.isNative)xf.parse(s,o,n.ext,a,(function(r,o){r?e(r):(n.content=o,i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),Fs.remove(s),Bs.remove(s),e())}));else{var u=n.uuid;if(u in r){var h=r[u],c=h.finish,l=h.content,f=h.err,p=h.callbacks;i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),c||kl(u,u,r)?(l&&l.addRef(),n.content=l,e(f)):p.push({done:e,item:n})}else if(!a.reloadAsset&&ks.has(u)){var _=ks.get(u);n.content=_.addRef(),i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),e()}else a.__uuid__=u,xf.parse(s,o,"import",a,(function(n,i){n?e(n):function(t,e,n){var i=t.input,r=t.progress,s=i,o=s.uuid,a=s.id,u=s.options,h=s.config,c=u.cacheAsset,l=[];e.addRef&&e.addRef(),Nl(o,e,Object.create(null),l,h),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=l.length,i);var f=t.options.__exclude__[o]={content:e,finish:!1,callbacks:[{done:n,item:i}]},p=Ks.create({input:l,options:t.options,onProgress:t.onProgress,onError:Ks.prototype.recycle,progress:r,onComplete:function(t){if(e.decRef&&e.decRef(!1),f.finish=!0,f.err=t,!t){for(var n,i=Array.isArray(p.output)?p.output:[p.output],r=Object.create(null),s=v(i);!(n=s()).done;){var u=n.value;u&&(r[u instanceof fo?u._uuid+"@import":o+"@native"]=u)}!function(t,e,n){var i=jc.get(e);if(i){for(var r=0,s=i.length;r<s;r++){var o=i[r],a=n[o.uuid+"@import"];if(a)o.owner[o.prop]=a.addRef();else{if(g("The asset "+o.uuid+" is missing!"),o.type&&o.type!==fo){var u=new o.type;u.initDefault(o.uuid),o.owner[o.prop]=u}!0}}jc.delete(e)}Wc.has(e)&&(n[t+"@native"]?e._nativeAsset=n[t+"@native"]:(!0,console.error("the native asset of "+t+" is missing!")),Wc.delete(e))}(o,e,r);try{"function"!=typeof e.onLoaded||Kc.has(e)||Wc.has(e)||(e.onLoaded(),Kc.add(e))}catch(t){g("The asset "+o+" is invalid for some reason, detail message: "+t.message+", stack: "+t.stack)}Fs.remove(a),Bs.remove(a),Ml(o,e,c),p.recycle()}for(var h=f.callbacks,l=0,_=h.length;l<_;l++){var d=h[l];e.addRef&&e.addRef(),d.item.content=e,d.done(t)}h.length=0}});zs.async(p)}(t,i,e)}))}}]);function Pf(t,e){var n=t.options,i=Object.create(null),r=Object.create(null);for(var s in n)switch(s){case Ls.PATH:case Ls.UUID:case Ls.DIR:case Ls.SCENE:case Ls.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[s]=n[s];break;case"__exclude__":case"__outputAsArray__":r[s]=n[s];break;default:i[s]=n[s],r[s]=n[s]}t.options=r;var o=Ks.create({input:t.input,options:i}),a=null;try{t.output=t.source=Vs.sync(o)}catch(t){a=t;for(var u=0,h=o.output.length;u<h;u++)o.output[u].recycle()}o.recycle(),e(a)}var Df=function(){function t(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},n(t,[{key:"id",get:function(){return this._id||(this._id=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this._id}}]),t}();Df.MAX_DEAD_NUM=500,Df._deadPool=[];var Lf=[];function kf(t){var e=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var i=function(i){var r,s=n[i],o=Df.create(),u=null,h=null;if("string"==typeof s&&((s=Object.create(null))[e.__requestType__||Ls.UUID]=n[i]),"object"==typeof s)for(var c in a.addon(s,e),s.preset&&a.addon(s,Ws[s.preset]),s){switch(c){case Ls.UUID:if("break"===function(){var t,e=o.uuid=$s(s.uuid);if(!s.bundle){var n=Us.find((function(t){return!!t.getAssetInfo(e)}));s.bundle=n&&n.name}if(Us.has(s.bundle)){if(u=Us.get(s.bundle).config,(h=u.getAssetInfo(e))&&h.redirect){if(!Us.has(h.redirect))throw new Error("Please load bundle "+h.redirect+" first");u=Us.get(h.redirect).config,h=u.getAssetInfo(e)}o.config=u,o.info=h}return o.ext=s.ext||(null===(t=h)||void 0===t?void 0:t.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Ls.DIR:if(Us.has(s.bundle)){Us.get(s.bundle).config.getDirWithPath(s.dir,s.type,Lf);for(var l,f=v(Lf);!(l=f()).done;){var p=l.value;n.push({uuid:p.uuid,__isNative__:!1,ext:p.extension||".json",bundle:s.bundle})}Lf.length=0}o.recycle(),o=null;break;case Ls.PATH:if(Us.has(s.bundle)){if(u=Us.get(s.bundle).config,(h=u.getInfoWithPath(s.path,s.type))&&h.redirect){if(!Us.has(h.redirect))throw new Error("you need to load bundle "+h.redirect+" first");u=Us.get(h.redirect).config,h=u.getAssetInfo(h.uuid)}if(!h)throw o.recycle(),new Error("Bundle "+s.bundle+" doesn't contain "+s.path);o.config=u,o.uuid=h.uuid,o.info=h}o.ext=s.ext||(null===(r=h)||void 0===r?void 0:r.extension)||".json";break;case Ls.SCENE:if(!s.bundle){var _=Us.find((function(t){return!!t.getSceneInfo(s.scene)}));s.bundle=_&&_.name}if(Us.has(s.bundle)){if(u=Us.get(s.bundle).config,(h=u.getSceneInfo(s.scene))&&h.redirect){if(!Us.has(h.redirect))throw new Error("you need to load bundle "+h.redirect+" first");u=Us.get(h.redirect).config,h=u.getAssetInfo(h.uuid)}if(!h)throw o.recycle(),new Error("Bundle "+u.name+" doesn't contain scene "+s.scene);o.config=u,o.uuid=h.uuid,o.info=h}break;case"__isNative__":o.isNative=s.__isNative__;break;case Ls.URL:o.url=s.url,o.uuid=s.uuid||s.url,o.ext=s.ext||An(s.url),o.isNative=void 0===s.__isNative__||s.__isNative__;break;default:o.options[c]=s[c]}if(!o)break}if(!o)return"continue";if(t.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(s))},r=0;r<n.length;r++)i(r);return null}function Ff(t){for(var e=t.output=t.input,n=0;n<e.length;n++){var i=e[n];!Gs.has(i.uuid)||function(){var t=Gs.get(i.uuid),e=Us.find((function(e){return!!e.getAssetInfo(t)}));if(e){var n;i.overrideUuid=t;var r=e.config,s=r.getAssetInfo(t);if(s&&s.redirect){if(!Us.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");s=(r=Us.get(s.redirect).config).getAssetInfo(t)}i.config=r,i.info=s,i.ext=i.isNative?i.ext:(null===(n=s)||void 0===n?void 0:n.extension)||".json"}else _(16201,t,i.uuid)}()}}function Bf(t){for(var e=t.output=t.input,n=0;n<e.length;n++){var r=e[n];if(!r.url){var s,o,a=r.config;o=r.isNative?a&&a.nativeBase?a.base+a.nativeBase:i.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:i.assetManager.generalImportBase;var u=r.overrideUuid||r.uuid,h="";r.info&&(h=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),s=".ttf"===r.ext?o+"/"+u.slice(0,2)+"/"+u+h+"/"+r.options.__nativeName__:o+"/"+u.slice(0,2)+"/"+u+h+r.ext,r.url=s}}return null}var Uf=t("al",function(){function t(){this.pipeline=zs.append(Pf).append(Nf),this.fetchPipeline=Hs.append(Pf).append(If),this.transformPipeline=Vs.append(kf).append(Ff).append(Bf),this.bundles=Us,this.assets=ks,this.assetsOverrideMap=Gs,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Qc,this.force=Z,this.allowImageBitmap=!Xe.isMobile,this.utils=lo,this.downloader=hf,this.parser=xf,this.packManager=Af,this.cacheAsset=!0,this.cacheManager=null,this.presets=Ws,this.factory=wf,this.preprocessPipe=Pf,this.fetchPipe=If,this.loadPipe=Nf,this.references=null,this._releaseManager=Cl,this._files=Fs,this._parsed=Bs,this._parsePipeline=null,this._projectBundles=[]}var e=t.prototype;return e.init=function(t){void 0===t&&(t={});var e=t.server||Q.querySettings($.Category.ASSETS,"server")||"",n=t.bundleVers||Q.querySettings($.Category.ASSETS,"bundleVers")||{},i=t.remoteBundles||Q.querySettings($.Category.ASSETS,"remoteBundles")||[];this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e,n,i),this.parser.init(),this.dependUtil.init();var r=t.importBase||Q.querySettings($.Category.ASSETS,"importBase")||"";r&&r.endsWith("/")&&(r=r.substr(0,r.length-1));var s=t.nativeBase||Q.querySettings($.Category.ASSETS,"nativeBase")||"";s&&s.endsWith("/")&&(s=s.substr(0,s.length-1)),this.generalImportBase=r,this.generalNativeBase=s,this._projectBundles=Q.querySettings($.Category.ASSETS,"projectBundles")||[];var o=Q.querySettings($.Category.ASSETS,"assetsOverrides")||{};for(var a in o)this.assetsOverrideMap.set(a,o[a])},e.getBundle=function(t){return Us.get(t)||null},e.removeBundle=function(t){t._destroy(),Us.remove(t.name)},e.loadAny=function(t,e,n,i){var r=Dl(e,n,i),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"default",t=Array.isArray(t)?t.slice():t;var u=Ks.create({input:t,onProgress:o,onComplete:Fl(a),options:s});zs.async(u)},e.preloadAny=function(t,e,n,i){var r=Dl(e,n,i),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"preload",t=Array.isArray(t)?t.slice():t;var u=Ks.create({input:t,onProgress:o,onComplete:Fl(a),options:s});Hs.async(u)},e.loadRemote=function(t,e,n){var i=Dl(e,void 0,n),r=i.options,s=i.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,n){e?(g(e.message,e.stack),s&&s(e,n)):wf.create(t,n,r.ext||An(t),r,(function(t,e){s&&s(t,e)}))}))):Fl(s)(null,this.assets.get(t))},e.loadBundle=function(t,e,n){var i=Dl(e,void 0,n),r=i.options,s=i.onComplete,o=Cn(t);this.bundles.has(o)?Fl(s)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,n){e?(g(e.message,e.stack),s&&s(e,n)):wf.create(t,n,"bundle",r,(function(t,e){s&&s(t,e)}))})))},e.releaseAsset=function(t){Cl.tryRelease(t,!0)},e.releaseUnusedAssets=function(){ks.forEach((function(t){Cl.tryRelease(t)}))},e.releaseAll=function(){ks.forEach((function(t){Cl.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},n(t,[{key:"main",get:function(){return Us.get(js.MAIN)||null}},{key:"resources",get:function(){return Us.get(js.RESOURCES)||null}}]),t}());Uf.Pipeline=Ds,Uf.Task=Ks,Uf.Cache=Ps,Uf.RequestItem=Df,Uf.Bundle=Bl,Uf.BuiltinBundleName=js;var zf=t("ak",i.assetManager=new Uf);i.AssetManager=Uf;var Hf,Vf,Gf,jf,Wf=function(){function t(){this._resources={},this._materialsToBeCompiled=[]}var e=t.prototype;return e.init=function(){for(var t=this._resources,e=new Uint8Array(16),n=new Uint8Array(16),r=new Uint8Array(16),s=new Uint8Array(16),o=new Uint8Array(16),a=0,u=0;u<4;u++)e[a]=0,e[a+1]=0,e[a+2]=0,e[a+3]=255,n[a]=0,n[a+1]=0,n[a+2]=0,n[a+3]=0,r[a]=119,r[a+1]=119,r[a+2]=119,r[a+3]=255,s[a]=255,s[a+1]=255,s[a+2]=255,s[a+3]=255,o[a]=127,o[a+1]=127,o[a+2]=255,o[a+3]=255,a+=4;var h=new Uint8Array(1024);a=0;for(var c=0;c<256;c++)h[a]=221,h[a+1]=221,h[a+2]=221,h[a+3]=255,a+=4;a=0;for(var l=0;l<8;l++){for(var f=0;f<8;f++)h[a]=85,h[a+1]=85,h[a+2]=85,h[a+3]=255,a+=4;a+=32}a+=32;for(var p=0;p<8;p++){for(var _=0;_<8;_++)h[a]=85,h[a+1]=85,h[a+2]=85,h[a+3]=255,a+=4;a+=32}var d={width:2,height:2,_data:e,_compressed:!1,format:vl.PixelFormat.RGBA8888},v={width:2,height:2,_data:n,_compressed:!1,format:vl.PixelFormat.RGBA8888},g={width:2,height:2,_data:r,_compressed:!1,format:vl.PixelFormat.RGBA8888},m={width:2,height:2,_data:s,_compressed:!1,format:vl.PixelFormat.RGBA8888},y={width:2,height:2,_data:o,_compressed:!1,format:vl.PixelFormat.RGBA8888},b={width:16,height:16,_data:h,_compressed:!1,format:vl.PixelFormat.RGBA8888},E=new Hc(d),T=new vl;T._uuid="black-texture",T.image=E,t[T._uuid]=T;var w=new Hc(v),A=new vl;A._uuid="empty-texture",A.image=w,t[A._uuid]=A;var I=new gl;I._uuid="black-cube-texture",I.setMipFilter(gl.Filter.NEAREST),I.image={front:new Hc(d),back:new Hc(d),left:new Hc(d),right:new Hc(d),top:new Hc(d),bottom:new Hc(d)},t[I._uuid]=I;var C=new Hc(g),O=new vl;O._uuid="grey-texture",O.image=C,t[O._uuid]=O;var S=new gl;S._uuid="grey-cube-texture",S.setMipFilter(gl.Filter.NEAREST),S.image={front:new Hc(g),back:new Hc(g),left:new Hc(g),right:new Hc(g),top:new Hc(g),bottom:new Hc(g)},t[S._uuid]=S;var R=new Hc(m),x=new vl;x._uuid="white-texture",x.image=R,t[x._uuid]=x;var N=new gl;N._uuid="white-cube-texture",N.setMipFilter(gl.Filter.NEAREST),N.image={front:new Hc(m),back:new Hc(m),left:new Hc(m),right:new Hc(m),top:new Hc(m),bottom:new Hc(m)},t[N._uuid]=N;var M=new Hc(y),P=new vl;P._uuid="normal-texture",P.image=M,t[P._uuid]=P;var D=new Hc(b),L=new vl;L._uuid="default-texture",L.image=D,t[L._uuid]=L;var k=new gl;if(k.setMipFilter(gl.Filter.NEAREST),k._uuid="default-cube-texture",k.image={front:new Hc(b),back:new Hc(b),left:new Hc(b),right:new Hc(b),top:new Hc(b),bottom:new Hc(b)},t[k._uuid]=k,i.SpriteFrame){var F=new i.SpriteFrame,B=E,U=new vl;U.image=B,F.texture=U,F._uuid="default-spriteframe",t[F._uuid]=F}},e.addAsset=function(t,e){this._resources[t]=e},e.get=function(t){return this._resources[t]},e.loadBuiltinAssets=function(){var t=this,e=Q.querySettings($.Category.ENGINE,"builtinAssets");if(!e)return Promise.resolve();var n=this._resources;return new Promise((function(r,s){zf.loadBundle(js.INTERNAL,(function(o){o?s(o):zf.loadAny(e,(function(e,o){e?s(e):(o.forEach((function(e){n[e.name]=e,Cl.addIgnoredAsset(e),e instanceof i.Material&&t._materialsToBeCompiled.push(e)})),r())}))}))}))},e.compileBuiltinMaterial=function(){for(var t=0;t<this._materialsToBeCompiled.length;++t)for(var e=this._materialsToBeCompiled[t],n=0;n<e.passes.length;++n)e.passes[n].tryCompile();this._materialsToBeCompiled.length=0},t}(),Kf=t("aM",i.builtinResMgr=new Wf),Yf=t("aj",(Hf=new Map,Vf=0,function(t){return"number"==typeof t?t:(Hf.has(t)||(Hf.set(t,1<<Vf),Vf++),Hf.get(t))})),qf=4227858432,Xf=66060288,Qf=1044480,$f=t("w",(function(t,e,n,i){return void 0===i&&(i=0),e<<26&qf|t<<20&Xf|n<<12&Qf|4095&i})),Zf=t("x",(function(t){return(t&qf)>>>26})),Jf=t("y",(function(t){return(t&Xf)>>>20})),tp=t("z",(function(t){return(t&Qf)>>>12})),ep=t("B",(function(t){return 4095&t})),np=t("D",(function(t,e){return 67108863&t|e<<26&qf})),ip=t("G",((Gf={})[Dt.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Gf[Dt.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]},Gf[Dt.INT2]=function(t,e,n){return void 0===n&&(n=0),Fe.fromArray(e,t,n)},Gf[Dt.INT3]=function(t,e,n){return void 0===n&&(n=0),Oe.fromArray(e,t,n)},Gf[Dt.INT4]=function(t,e,n){return void 0===n&&(n=0),Pe.fromArray(e,t,n)},Gf[Dt.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]},Gf[Dt.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Fe.fromArray(e,t,n)},Gf[Dt.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Oe.fromArray(e,t,n)},Gf[Dt.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),Pe.fromArray(e,t,n)},Gf[Dt.MAT3]=function(t,e,n){return void 0===n&&(n=0),Re.fromArray(e,t,n)},Gf[Dt.MAT4]=function(t,e,n){return void 0===n&&(n=0),Se.fromArray(e,t,n)},Gf)),rp=t("H",((jf={})[Dt.UNKNOWN]=function(){return console.warn("illegal uniform handle")},jf[Dt.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},jf[Dt.INT2]=function(t,e,n){return void 0===n&&(n=0),Fe.toArray(t,e,n)},jf[Dt.INT3]=function(t,e,n){return void 0===n&&(n=0),Oe.toArray(t,e,n)},jf[Dt.INT4]=function(t,e,n){return void 0===n&&(n=0),Pe.toArray(t,e,n)},jf[Dt.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},jf[Dt.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Fe.toArray(t,e,n)},jf[Dt.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Oe.toArray(t,e,n)},jf[Dt.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),Pe.toArray(t,e,n)},jf[Dt.MAT3]=function(t,e,n){return void 0===n&&(n=0),Re.toArray(t,e,n)},jf[Dt.MAT4]=function(t,e,n){return void 0===n&&(n=0),Se.toArray(t,e,n)},jf)),sp=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function op(t){switch(t){case Dt.BOOL:case Dt.INT:case Dt.UINT:case Dt.FLOAT:return sp[0];case Dt.BOOL2:case Dt.INT2:case Dt.UINT2:case Dt.FLOAT2:return sp[1];case Dt.BOOL4:case Dt.INT4:case Dt.UINT4:case Dt.FLOAT4:return sp[2];case Dt.MAT4:return sp[3];case Dt.SAMPLER2D:return"default-texture";case Dt.SAMPLER_CUBE:return"default-cube-texture";case Dt.SAMPLER2D_ARRAY:return"default-array-texture";case Dt.SAMPLER3D:return"default-3d-texture"}return sp[0]}function ap(t){switch(t){case Dt.SAMPLER2D:return"-texture";case Dt.SAMPLER_CUBE:return"-cube-texture";case Dt.SAMPLER2D_ARRAY:return"-array-texture";case Dt.SAMPLER3D:return"-3d-texture";default:return"-unknown"}}function up(t,e){for(var n=Object.entries(e),i=!1,r=0;r<n.length;r++)t[n[r][0]]!==n[r][1]&&(t[n[r][0]]=n[r][1],i=!0);return i}var hp=new Lt;function cp(t){return Math.ceil(Math.log2(Math.max(t,2)))}function lp(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function fp(t,e,n,i,r){for(var s=t.builtins[i],o=[],a=function(t){var e=s.blocks[t],i=n.layouts[e.name],a=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&a&&a.descriptorType&Zt))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(i),r&&!r.includes(a)&&r.push(a)},u=0;u<s.blocks.length;u++)a(u);Array.prototype.unshift.apply(e.shaderInfo.blocks,o);for(var h=[],c=function(t){var e=s.samplerTextures[t],i=n.layouts[e.name],o=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&o&&o.descriptorType&Jt))return console.warn("builtin samplerTexture '"+e.name+"' not available!"),"continue";h.push(i),r&&!r.includes(o)&&r.push(o)},l=0;l<s.samplerTextures.length;l++)c(l);Array.prototype.unshift.apply(e.shaderInfo.samplerTextures,h),r&&r.sort((function(t,e){return t.binding-e.binding}))}function pp(t){return t.members.reduce((function(t,e){return t+Ft(e.type)*e.count}),0)}function _p(t,e){for(var n=0;n<t.length;n++){var i=t[n];if("!"===i[0]){if(e[i.slice(1)])return!1}else if(!e[i])return!1}return!0}var dp=function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var i=t.techniques[n],r=0;r<i.passes.length;r++){var s=i.passes[r];void 0!==s.propertyIndex&&void 0===s.properties&&(s.properties=i.passes[s.propertyIndex].properties)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var n=W({},t),i=0,r=function(t){var e=n.defines[t],r=1;if("number"===e.type){var s=e.range;r=cp(s[1]-s[0]+1),e._map=function(t){return t-s[0]}}else"string"===e.type?(r=cp(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=i,i+=r},s=0;s<n.defines.length;s++)r(s);for(var o in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+o+" "+n.builtins.statistics[o]+"\n";if(this._templates[t.name]=n,!this._templateInfos[n.hash]){var a={};a.samplerStartBinding=n.blocks.length,a.shaderInfo=new kt,a.blockSizes=[],a.bindings=[];for(var u=0;u<n.blocks.length;u++){var h=n.blocks[u];a.blockSizes.push(pp(h)),a.bindings.push(new Bt(h.binding,Ut.UNIFORM_BUFFER,1,h.stageFlags)),a.shaderInfo.blocks.push(new zt(Ze.MATERIAL,h.binding,h.name,h.members.map((function(t){return new Ht(t.name,t.type,t.count)})),1))}for(var c=0;c<n.samplerTextures.length;c++){var l=n.samplerTextures[c];a.bindings.push(new Bt(l.binding,Ut.SAMPLER_TEXTURE,l.count,l.stageFlags)),a.shaderInfo.samplerTextures.push(new Vt(Ze.MATERIAL,l.binding,l.name,l.type,l.count))}for(var f=0;f<n.samplers.length;f++){var p=n.samplers[f];a.bindings.push(new Bt(p.binding,Ut.SAMPLER,p.count,p.stageFlags)),a.shaderInfo.samplers.push(new Gt(Ze.MATERIAL,p.binding,p.name,p.count))}for(var _=0;_<n.textures.length;_++){var d=n.textures[_];a.bindings.push(new Bt(d.binding,Ut.TEXTURE,d.count,d.stageFlags)),a.shaderInfo.textures.push(new jt(Ze.MATERIAL,d.binding,d.name,d.type,d.count))}for(var v=0;v<n.buffers.length;v++){var g=n.buffers[v];a.bindings.push(new Bt(g.binding,Ut.STORAGE_BUFFER,1,g.stageFlags)),a.shaderInfo.buffers.push(new Wt(Ze.MATERIAL,g.binding,g.name,1,g.memoryAccess))}for(var m=0;m<n.images.length;m++){var y=n.images[m];a.bindings.push(new Bt(y.binding,Ut.STORAGE_IMAGE,y.count,y.stageFlags)),a.shaderInfo.images.push(new Kt(Ze.MATERIAL,y.binding,y.name,y.type,y.count,y.memoryAccess))}for(var b=0;b<n.subpassInputs.length;b++){var E=n.subpassInputs[b];a.bindings.push(new Bt(E.binding,Ut.INPUT_ATTACHMENT,E.count,E.stageFlags)),a.shaderInfo.subpassInputs.push(new Yt(Ze.MATERIAL,E.binding,E.name,E.count))}a.gfxAttributes=[];for(var T=0;T<n.attributes.length;T++){var w=n.attributes[T];a.gfxAttributes.push(new qt(w.name,w.format,w.isNormalized,0,w.isInstanced,w.location))}fp(n,a,Je,"locals"),a.shaderInfo.stages.push(new Xt(Qt.VERTEX,"")),a.shaderInfo.stages.push(new Xt(Qt.FRAGMENT,"")),a.handleMap=function(t){for(var e={},n=0;n<t.blocks.length;n++)for(var i=t.blocks[n],r=i.members,s=0,o=0;o<r.length;o++){var a=r[o];e[a.name]=$f(i.binding,a.type,a.count,s),s+=(Ft(a.type)>>2)*a.count}for(var u=0;u<t.samplerTextures.length;u++){var h=t.samplerTextures[u];e[h.name]=$f(h.binding,h.type,h.count)}return e}(n),a.setLayouts=[],this._templateInfos[n.hash]=a}return n},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,n){void 0===n&&(n=!1);var i=this._templates[e],r=this._templateInfos[i.hash];return r.setLayouts.length||(hp.bindings=r.bindings,r.setLayouts[Ze.MATERIAL]=t.createDescriptorSetLayout(hp),hp.bindings=Je.bindings,r.setLayouts[Ze.LOCAL]=t.createDescriptorSetLayout(hp)),r.setLayouts[n?Ze.LOCAL:Ze.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var n=this._templates[t],i=n.defines;if(n.uber){for(var r="",s=0;s<i.length;s++){var o=i[s],a=e[o.name];if(a&&o._map){var u=o._map(a);r+=""+o._offset+u+"|"}}return""+r+n.hash}for(var h=0,c=0;c<i.length;c++){var l=i[c],f=e[l.name];f&&l._map&&(h|=l._map(f)<<l._offset)}return h.toString(16)+"|"+n.hash},e.destroyShaderByDefines=function(t){var e=this,n=Object.keys(t);if(n.length)for(var i=n.map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+e+n)})),r=Object.keys(this._cache).filter((function(t){return i.every((function(n){return n.test(e._cache[t].name)}))})),s=0;s<r.length;s++){var o=r[s],a=this._cache[o];y("destroyed shader "+a.name),a.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(e,n));var s=this._cache[r];if(s)return s;var o=this._templates[e],a=this._templateInfos[o.hash];a.pipelineLayout||(this.getDescriptorSetLayout(t,e),fp(o,a,tn,"globals"),a.setLayouts[Ze.GLOBAL]=i.descriptorSetLayout,a.pipelineLayout=t.createPipelineLayout(new $t(a.setLayouts)));var u=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],s=r.name,o=t[s],a=lp(r,o),u=!o||"0"===o;n.push({name:s,value:a,isDefault:u})}return n}(n,o.defines),h=i.constantMacros+o.constantMacros+u.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),""),c=o.glsl3,l=vp(t);return l?c=o[l]:console.error("Invalid GFX API!"),a.shaderInfo.stages[0].source=h+c.vert,a.shaderInfo.stages[1].source=h+c.frag,a.shaderInfo.attributes=function(t,e,n){for(var i=[],r=t.attributes,s=e.gfxAttributes,o=0;o<r.length;o++)_p(r[o].defines,n)&&i.push(s[o]);return i}(o,a,n),a.shaderInfo.name=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,u),this._cache[r]=t.createShader(a.shaderInfo)},t}();function vp(t){switch(t.gfxAPI){case Rt.GLES2:case Rt.WEBGL:return"glsl1";case Rt.GLES3:case Rt.WEBGL2:return"glsl3";default:return"glsl4"}}var gp=t("O",new dp);i.programLib=gp;var mp,yp=t("ai",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,n){void 0===n&&(n=null);var i=t.instancedAttributeBlock,r=i.buffer.length;if(r){var s=t.inputAssembler,o=t.descriptorSet.getTexture(en),a=n;a||(a=t.shaders[e]);for(var u=t.descriptorSet,h=0;h<this.instances.length;++h){var c,l,f=this.instances[h];if(!((null===(c=f.ia.indexBuffer)||void 0===c?void 0:c.objectID)!==(null===(l=s.indexBuffer)||void 0===l?void 0:l.objectID)||f.count>=1024)&&f.lightingMap.objectID===o.objectID&&f.stride===r){if(f.count>=f.capacity){f.capacity<<=1;var p=f.stride*f.capacity,_=f.data;f.data=new Uint8Array(p),f.data.set(_),f.vb.resize(p)}return f.shader=a,f.descriptorSet=u,f.data.set(i.buffer,f.stride*f.count++),void(this.hasPendingModels=!0)}}for(var d=this._device.createBuffer(new te(ee.VERTEX|ee.TRANSFER_DST,ne.HOST|ne.DEVICE,32*r,r)),v=new Uint8Array(32*r),g=s.vertexBuffers.slice(),m=s.attributes.slice(),y=s.indexBuffer,b=0;b<i.attributes.length;b++){var E=i.attributes[b],T=new qt(E.name,E.format,E.isNormalized,g.length,!0);m.push(T)}v.set(i.buffer),g.push(d);var w=new ie(m,g,y),A=this._device.createInputAssembler(w);this.instances.push({count:1,capacity:32,vb:d,data:v,ia:A,stride:r,shader:a,descriptorSet:u,lightingMap:o}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var n=this.instances[e];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}()),bp=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],n=0;n<e.vbs.length;++n)e.vbs[n].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,n){var i=t.subMesh.flatBuffers;if(0!==i.length){for(var r=0,s=0,o=i[0].count,a=t.passes[e],u=t.shaders[e],h=t.descriptorSet,c=!1,l=0;l<this.batches.length;++l){var f=this.batches[l];if(f.vbs.length===i.length&&f.mergeCount<nn.BATCHING_COUNT){c=!0;for(var p=0;p<f.vbs.length;++p)if(f.vbs[p].stride!==i[p].stride){c=!1;break}if(c){for(var _=0;_<f.vbs.length;++_){var d=i[_],v=f.vbs[_],g=f.vbDatas[_];(r=(o+f.vbCount)*d.stride)>v.size&&(v.resize(r),f.vbDatas[_]=new Uint8Array(r),f.vbDatas[_].set(g)),f.vbDatas[_].set(d.buffer,f.vbCount*d.stride)}var m=f.vbIdxData;(s=4*(o+f.vbCount))>f.vbIdx.size&&(f.vbIdx.resize(s),f.vbIdxData=new Float32Array(s/Float32Array.BYTES_PER_ELEMENT),f.vbIdxData.set(m),m=f.vbIdxData);var y=f.vbCount,b=y+o,E=f.mergeCount;if(m[y]!==E||m[b-1]!==E)for(var T=y;T<b;T++)m[T]=E+.1;return Se.toArray(f.uboData,n.transform.worldMatrix,nn.MAT_WORLDS_OFFSET+16*f.mergeCount),f.mergeCount||(h.bindBuffer(nn.BINDING,f.ubo),h.update(),f.pass=a,f.shader=u,f.descriptorSet=h),++f.mergeCount,f.vbCount+=o,void(f.ia.vertexCount+=o)}}}for(var w=[],A=[],I=[],C=0;C<i.length;++C){var O=i[C],S=this._device.createBuffer(new te(ee.VERTEX|ee.TRANSFER_DST,ne.HOST|ne.DEVICE,O.count*O.stride,O.stride));S.update(O.buffer.buffer),w.push(S),A.push(new Uint8Array(S.size)),I.push(S)}var R=this._device.createBuffer(new te(ee.VERTEX|ee.TRANSFER_DST,ne.HOST|ne.DEVICE,4*o,4)),x=new Float32Array(o);x.fill(0),R.update(x),I.push(R);for(var N=t.inputAssembler.attributes,M=new Array(N.length+1),P=0;P<N.length;++P)M[P]=N[P];M[N.length]=new qt("a_dyn_batch_id",bt.R32F,!1,i.length);var D=new ie(M,I),L=this._device.createInputAssembler(D),k=this._device.createBuffer(new te(ee.UNIFORM|ee.TRANSFER_DST,ne.HOST|ne.DEVICE,nn.SIZE,nn.SIZE));h.bindBuffer(nn.BINDING,k),h.update();var F=new Float32Array(nn.COUNT);Se.toArray(F,n.transform.worldMatrix,nn.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:w,vbDatas:A,vbIdx:R,vbIdxData:x,vbCount:o,ia:L,ubo:k,uboData:F,pass:a,shader:u,descriptorSet:h})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}(),Ep=new te(ee.UNIFORM|ee.TRANSFER_DST,ne.DEVICE),Tp=new oe(null),wp=new ae(null);!function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(mp||(mp=t("L",{})));var Ap=t("M",function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new ue,this._dss=new he,this._rs=new ce,this._priority=rn.DEFAULT,this._stage=sn.DEFAULT,this._phase=Yf("default"),this._primitive=lt.TRIANGLE_LIST,this._batchingScheme=mp.NONE,this._dynamicStates=le.NONE,this._instancedBuffers={},this._batchedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._rootBufferDirty=!1,this._root=t,this._device=$e.gfxDevice}t.fillPipelineInfo=function(t,e){void 0!==e.priority&&(t._priority=e.priority),void 0!==e.primitive&&(t._primitive=e.primitive),void 0!==e.stage&&(t._stage=e.stage),void 0!==e.dynamicStates&&(t._dynamicStates=e.dynamicStates),void 0!==e.phase&&(t._phase=Yf(e.phase));var n=t._bs;if(e.blendState){var i=e.blendState,r=i.targets;r&&r.forEach((function(t,e){n.setTarget(e,t)})),void 0!==i.isA2C&&(n.isA2C=i.isA2C),void 0!==i.isIndepend&&(n.isIndepend=i.isIndepend),void 0!==i.blendColor&&(n.blendColor=i.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t){var e,n=gp.getKey(t.program,t.defines)+","+t._primitive+","+t._dynamicStates;return n+=function(t){for(var e,n=",bs,"+t.isA2C,i=v(t.targets);!(e=i()).done;){var r=e.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(t._bs),n+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),n+=",rs,"+(e=t._rs).cullMode+","+e.depthBias+","+e.isFrontFaceCCW,It(n,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=Dt.UNKNOWN);var i=this._propertyHandleMap[t];return i?(n?i=np(i,n):e&&(i=np(i,Zf(i)-e)),i+e):0},e.getBinding=function(e){var n=this.getHandle(e);return n?t.getBindingFromHandle(n):-1},e.setUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),s=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);rp[r](o,n,s),this._rootBufferDirty=!0},e.getUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),s=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);return ip[r](o,n,s)},e.setUniformArray=function(e,n){for(var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),s=Ft(r)>>2,o=this._getBlockView(r,i),a=t.getOffsetFromHandle(e),u=0;u<n.length;u++,a+=s)null!==n[u]&&rp[r](o,n[u],a);this._rootBufferDirty=!0},e.bindTexture=function(t,e,n){this._descriptorSet.bindTexture(t,e,n||0)},e.bindSampler=function(t,e,n){this._descriptorSet.bindSampler(t,e,n||0)},e.setDynamicState=function(t,e){var n=this._dynamics[t];n&&n.value===e||(n.value=e,n.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e._setRootBufferDirty=function(t){this._rootBufferDirty=t},e.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):z(12006)},e.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new yp(this))},e.getBatchedBuffer=function(t){return void 0===t&&(t=0),this._batchedBuffers[t]||(this._batchedBuffers[t]=new bp(this))},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();for(var i in this._batchedBuffers)this._batchedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},e.resetUniform=function(e){var n=this.getHandle(e);if(n){for(var i=t.getTypeFromHandle(n),r=t.getBindingFromHandle(n),s=t.getOffsetFromHandle(n),o=t.getCountFromHandle(n),a=this._getBlockView(i,r),u=this._properties[e],h=u&&u.value||op(i),c=(Ft(i)>>2)*o,l=0;l+h.length<=c;l+=h.length)a.set(h,s+l);this._rootBufferDirty=!0}},e.resetTexture=function(e,n){var i=this.getHandle(e);if(i){var r=t.getTypeFromHandle(i),s=t.getBindingFromHandle(i),o=this._properties[e],a=o&&o.value,u=a?""+a+ap(r):op(r),h=Kf.get(u),c=h&&h.getGFXTexture(),l=o&&void 0!==o.samplerHash?re.unpackFromHash(o.samplerHash):h&&h.getSamplerInfo(),f=this._device.getSampler(l);this._descriptorSet.bindSampler(s,f,n||0),this._descriptorSet.bindTexture(s,c,n||0)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],n=0,i=0;i<e.members.length;i++){for(var r=e.members[i],s=this._getBlockView(r.type,e.binding),o=this._properties[r.name],a=o&&o.value||op(r.type),u=(Ft(r.type)>>2)*r.count,h=0;h+a.length<=u;h+=a.length)s.set(a,n+h);n+=u}this._rootBufferDirty=!0},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplerTextures.length;t++)for(var e=this._shaderInfo.samplerTextures[t],n=0;n<e.count;n++)this.resetTexture(e.name,n)},e.tryCompile=function(){var e=this._root.pipeline;if(!e)return!1;this._syncBatchingScheme();var n=gp.getGFXShader(this._device,this._programName,this._defines,e);return n?(this._shader=n,this._pipelineLayout=gp.getTemplateInfo(this._programName).pipelineLayout,this._hash=t.getPassHash(this),!0):(console.warn("create shader "+this._programName+" failed"),!1)},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return console.warn("pass resources incomplete"),null;if(!t)return this._shader;for(var e=this._root.pipeline,n=0;n<t.length;n++){var i=t[n];this._defines[i.name]=i.value}for(var r=gp.getGFXShader(this._device,this._programName,this._defines,e),s=0;s<t.length;s++){var o=t[s];delete this._defines[o.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._doInit=function(e,n){void 0===n&&(n=!1),this._priority=rn.DEFAULT,this._stage=sn.DEFAULT,this._phase=Yf("default"),this._primitive=lt.TRIANGLE_LIST,this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=n?W({},e.defines):e.defines,this._shaderInfo=gp.getTemplate(e.program),this._properties=e.properties||this._properties;var i=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),wp.layout=gp.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(wp);for(var r=this._shaderInfo.blocks,s=gp.getTemplateInfo(e.program),o=s.blockSizes,a=s.handleMap,u=i.capabilities.uboOffsetAlignment,h=[],c=0,l=0,f=0;f<r.length;f++){var p=o[f];h.push(l),l+=Math.ceil(p/u)*u,c=p}var _=h[h.length-1]+c;_&&(Ep.size=16*Math.ceil(_/16),this._rootBuffer=i.createBuffer(Ep),this._rootBlock=new ArrayBuffer(_));for(var d=0,v=0;d<r.length;d++){var g=r[d].binding,m=o[d];Tp.buffer=this._rootBuffer,Tp.offset=h[v++],Tp.range=16*Math.ceil(m/16);var y=this._buffers[g]=i.createBuffer(Tp);this._blocks[g]=new Float32Array(this._rootBlock,Tp.offset,m/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[g]=new Int32Array(this._blocks[g].buffer,this._blocks[g].byteOffset,this._blocks[g].length),this._descriptorSet.bindBuffer(g,y)}var b=this._propertyHandleMap=a,E={};for(var T in this._properties){var w=this._properties[T];w.handleInfo&&(E[T]=this.getHandle.apply(this,w.handleInfo))}Object.assign(b,E)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(se.INSTANCED_ARRAYS)?this._batchingScheme=mp.INSTANCING:(this._defines.USE_INSTANCING=!1,this._batchingScheme=mp.NONE):this._defines.USE_BATCHING?this._batchingScheme=mp.VB_MERGING:this._batchingScheme=mp.NONE},e._getBlockView=function(t,e){return t<Dt.FLOAT?this._blocksInt[e]:this._blocks[e]},e._initPassFromTarget=function(t,e,n){this._priority=t.priority,this._stage=t.stage,this._phase=t.phase,this._batchingScheme=t.batchingScheme,this._primitive=t.primitive,this._dynamicStates=t.dynamicStates,this._bs=t.blendState,this._dss=e,this._descriptorSet=t.descriptorSet,this._rs=t.rasterizerState,this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,this._pipelineLayout=gp.getTemplateInfo(this._programName).pipelineLayout,this._hash=t._hash^n},e._updatePassHash=function(){this._hash=t.getPassHash(this)},n(t,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return gp.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}());Ap.getTypeFromHandle=Zf,Ap.getBindingFromHandle=Jf,Ap.getCountFromHandle=tp,Ap.getOffsetFromHandle=ep;var Ip,Cp,Op,Sp,Rp,xp,Np,Mp,Pp=t("A",function(){function t(){this._groundAlbedoHDR=new Pe(.2,.2,.2,1),this._skyColorHDR=new Pe(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new Pe(.2,.2,.2,1),this._skyColorLDR=new Pe(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return t.prototype.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}}]),t}());Pp.SUN_ILLUM=65e3,Pp.SKY_ILLUM=2e4,i.Ambient=Pp;var Dp=["planar-shadow","skybox","deferred-lighting","bloom","post-process","profiler","splash-screen","standard","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer"],Lp=t("ac",Xr("cc.EffectAsset")((Mp=Np=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"techniques",Op,w(e)),T(e,"shaders",Sp,w(e)),T(e,"combinations",Rp,w(e)),T(e,"hideInEditor",xp,w(e)),e}m(e,t),e.register=function(t){e._effects[t.name]=t,e._layoutValid=!1},e.remove=function(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name]===t&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return void delete e._effects[n]}},e.get=function(t){if(e._effects[t])return e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return e._effects[n];return Dp.includes(t)&&_(16101,t),null},e.getAll=function(){return e._effects},e.isLayoutValid=function(){return e._layoutValid},e.setLayoutValid=function(){e._layoutValid=!0};var n=e.prototype;return n.onLoaded=function(){gp.register(this),e.register(this),i.game.once(i.Game.EVENT_RENDERER_INITED,this._precompile,this)},n._precompile=function(){for(var t=this,e=i.director.root,n=function(n){var i=t.shaders[n],r=t.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(t,e){return t.reduce((function(t,n){for(var i=r[e],s=0;s<i.length;++s){var o=W({},n);o[e]=i[s],t.push(o)}return t}),[])}),[{}]).forEach((function(t){return gp.getGFXShader($e.gfxDevice,i.name,t,e.pipeline)}))},r=0;r<this.shaders.length;r++)n(r)},n.destroy=function(){return e.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var i=e.get("builtin-unlit");this.name="builtin-unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}(fo),Np._effects={},Np._layoutValid=!0,Op=E((Cp=Mp).prototype,"techniques",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sp=E(Cp.prototype,"shaders",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rp=E(Cp.prototype,"combinations",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xp=E(Cp.prototype,"hideInEditor",[is,ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ip=Cp))||Ip);i.EffectAsset=Lp;var kp=new fe,Fp=new pe;function Bp(t,e){t.x=e.x*e.x,t.y=e.y*e.y,t.z=e.z*e.z}var Up,zp,Hp,Vp,Gp,jp,Wp,Kp,Yp,qp,Xp=null,Qp=new Pe,$p=t("ad",(Up=Xr("cc.Material"),zp=Rs(Lp),Up((qp=function(t){function e(){var e;return e=t.call(this)||this,T(e,"_effectAsset",Gp,w(e)),T(e,"_techIdx",jp,w(e)),T(e,"_defines",Wp,w(e)),T(e,"_states",Kp,w(e)),T(e,"_props",Yp,w(e)),e._passes=[],e._hash=0,e}m(e,t),e.getHash=function(t){for(var e,n=0,i=v(t.passes);!(e=i()).done;)n^=e.value.hash;return n};var r=e.prototype;return r.initialize=function(t){this._passes.length?_(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(t),this._update())},r.reset=function(t){this.initialize(t)},r.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},r.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},r.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},r.onLoaded=function(){this._update()},r.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var n,i=v(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},r.setProperty=function(t,e,n){var i=!1;if(void 0===n)for(var r=this._passes,s=r.length,o=0;o<s;o++){var a=r[o];this._uploadProperty(a,t,e)&&(this._props[a.propertyIndex][t]=e,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var u=this._passes[n];this._uploadProperty(u,t,e)&&(this._props[u.propertyIndex][t]=e,i=!0)}i||console.warn("illegal property name: "+t+".")},r.getProperty=function(t,e){if(void 0===e)for(var n=this._props,i=n.length,r=0;r<i;r++){var s=n[r];if(t in s)return s[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},r.copy=function(t,e){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=W({},t._props[n]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=W({},t._defines[i]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=W({},t._states[r]);this._effectAsset=t._effectAsset,e&&this._fillInfo(e),this._update()},r._fillInfo=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=Lp.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states)},r._prepareInfo=function(t,e){var n=t;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(e[r]||(e[r]={}),n[r])},r._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,n=[],r=0;r<e;++r){var s=t.passes[r],o=s.passIndex=r,a=s.defines=this._defines[o]||(this._defines[o]={});if(s.stateOverrides=this._states[o]||(this._states[o]={}),void 0!==s.propertyIndex&&Object.assign(a,this._defines[s.propertyIndex]),void 0!==s.embeddedMacros&&Object.assign(a,s.embeddedMacros),!s.switch||a[s.switch]){var u=new Ap(i.director.root);u.initialize(s),n.push(u)}}return n},r._update=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this._createPasses();var i=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=i,t)this._passes.forEach((function(t,e){var i=n._props[e];for(var r in i||(i=n._props[e]={}),void 0!==t.propertyIndex&&Object.assign(i,n._props[t.propertyIndex]),i)n._uploadProperty(t,r,i[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=e.getHash(this)},r._uploadProperty=function(t,e,n){var i=t.getHandle(e);if(!i)return!1;if(Ap.getTypeFromHandle(i)<Dt.SAMPLER1D)if(Array.isArray(n))t.setUniformArray(i,n);else if(null!==n){var r;if(null===(r=t.properties[e])||void 0===r?void 0:r.linear){var s=n;Bp(Qp,s),Qp.w=s.w,n=Qp}t.setUniform(i,n)}else t.resetUniform(e);else if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(t,i,n[o],o);else n?this._bindTexture(t,i,n):t.resetTexture(e);return!0},r._bindTexture=function(t,e,n,i){var r=Ap.getBindingFromHandle(e);if(n instanceof _e)t.bindTexture(r,n,i);else if(n instanceof Gc){var s=n.getGFXTexture();if(!s||!s.width||!s.height)return;t.bindTexture(r,s,i),t.bindSampler(r,n.getGFXSampler(),i)}},r._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=v(this._passes);!(t=e()).done;)t.value.destroy();this._passes.length=0},r.initDefault=function(e){t.prototype.initDefault.call(this,e),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new Be("#ff00ff"))},r.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},n(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(fo),Gp=E((Vp=qp).prototype,"_effectAsset",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jp=E(Vp.prototype,"_techIdx",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wp=E(Vp.prototype,"_defines",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kp=E(Vp.prototype,"_states",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yp=E(Vp.prototype,"_props",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hp=Vp))||Hp));i.Material=$p;var Zp=t("R",function(t){function e(e,n){var i;(i=t.call(this,e.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=e,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var s=i._shaderInfo.blocks[r],o=i._blocks[s.binding],a=i._parent.blocks[s.binding];o.set(a)}i._rootBufferDirty=!0;for(var u=i._parent,h=0;h<i._shaderInfo.samplerTextures.length;h++)for(var c=i._shaderInfo.samplerTextures[h],l=0;l<c.count;l++){var f=u._descriptorSet.getSampler(c.binding,l),p=u._descriptorSet.getTexture(c.binding,l);i._descriptorSet.bindSampler(c.binding,f,l),i._descriptorSet.bindTexture(c.binding,p,l)}return t.prototype.tryCompile.call(w(i)),i}m(e,t);var i=e.prototype;return i.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),Ap.fillPipelineInfo(this,t),Ap.fillPipelineInfo(this,e),this._onStateChange()},i.tryCompile=function(e){if(e&&!up(this._defines,e))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},i.beginChangeStatesSilently=function(){this._dontNotify=!0},i.endChangeStatesSilently=function(){this._dontNotify=!1},i._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this._batchingScheme=mp.NONE},i._onStateChange=function(){this._hash=Ap.getPassHash(this),this._owner.onPassStateChange(this._dontNotify)},n(e,[{key:"parent",get:function(){return this._parent}}]),e}(Ap)),Jp=t("Q",function(t){function e(e){var n;return(n=t.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=e.parent,n._owner=e.owner||null,n._subModelIdx=e.subModelIdx||0,n.copy(n._parent),n}m(e,t);var i=e.prototype;return i.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var n,i=v(this._passes);!(n=i()).done;)n.value.tryCompile(t);else this._passes[e].tryCompile(t)},i.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],s=this._states[i]||(this._states[i]={});for(var o in t)s[o]=t[o];r.overridePipelineStates(n[r.passIndex],s)}else{var a=this._states[e]||(this._states[e]={});for(var u in t)a[u]=t[u];this._passes[e].overridePipelineStates(n[e],a)}}},i.destroy=function(){return this._doDestroy(),!0},i.onPassStateChange=function(t){this._hash=$p.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},i._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var n=0;n<e.length;++n)t.push(new Zp(e[n],this));return t},n(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}($p)),t_=null,e_=null,n_=t("E",J({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2})),i_=t("o",function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var e=t.prototype;return e.initialize=function(t){this._activated=!1,this._enabled=t.enabled,this._useIBL=t.useIBL,this._useDiffuseMap=t.applyDiffuseMap,this._useHDR=t.useHDR},e.setEnvMaps=function(t,e){this._envmapHDR=t,this._envmapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setDiffuseMaps=function(t,e){this._diffuseMapHDR=t,this._diffuseMapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setSkyboxMaterial=function(t){t?(this._editableMaterial=new Jp({parent:t}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},e.setReflectionMaps=function(t,e){this._reflectionHDR=t,this._reflectionLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setRotationAngle=function(t){this._rotationAngle=t},e.getRotationAngle=function(){return this._rotationAngle},e.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},e.activate=function(){var t=i.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=Kf.get("default-cube-texture"),this._model||(this._model=i.director.root.createModel(i.renderer.scene.Model));var e=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(e=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!e_){var n=new $p;n.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:e}}),e_=new Jp({parent:n})}this.enabled&&(t_||(t_=i.utils.createMesh(i.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,t_.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,t_.renderingSubMeshes[0],e_)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},e._updatePipeline=function(){var t=i.director.root,e=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,r=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,s=this.useHDR,o=this.useConvolutionMap;if(e.macros.CC_USE_IBL===n&&e.macros.CC_USE_DIFFUSEMAP===r&&e.macros.CC_USE_HDR===s&&e.macros.CC_IBL_CONVOLUTED===o||(e.macros.CC_USE_IBL=n,e.macros.CC_USE_DIFFUSEMAP=r,e.macros.CC_USE_HDR=s,e.macros.CC_IBL_CONVOLUTED=o,this._activated&&t.onGlobalPipelineStateChanged()),this.enabled){var a=this.envmap?this.envmap:this._default,u=this._editableMaterial?this._editableMaterial:e_;u&&(u.setProperty("environmentMap",a),u.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,u),this._updateSubModes())}},e._updateGlobalBinding=function(){if(this._globalDSManager){var t=$e.gfxDevice;if(this.reflectionMap){var e=this.reflectionMap.getGFXTexture(),n=t.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(an,n),this._globalDSManager.bindTexture(an,e)}else{var i=this.envmap?this.envmap:this._default;if(i){var r=i.getGFXTexture(),s=t.getSampler(i.getSamplerInfo());this._globalDSManager.bindSampler(an,s),this._globalDSManager.bindTexture(an,r)}}var o=this.diffuseMap?this.diffuseMap:this._default;if(o){var a=o.getGFXTexture(),u=t.getSampler(o.getSamplerInfo());this._globalDSManager.bindSampler(un,u),this._globalDSManager.bindTexture(un,a)}this._globalDSManager.update()}},e._updateSubModes=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;e++)t[e].update()},n(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._useHDR=t,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._useIBL=t,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"reflectionMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR}}]),t}());i.Skybox=i_;var r_=t("p",J({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048})),s_=t("q",J({Planar:0,ShadowMap:1})),o_=(t("P",J({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3})),t("r",J({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4})),t("t",J({NONE:1,RemoveDuplicates:2,DisableRotationFix:3})),s_.ShadowMap+1),a_=t("u",function(){function t(){this.fixedSphere=new Jn(0,0,0,.01),this.maxReceived=4,this._matLight=new Se,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=o_,this._distance=0,this._normal=new Oe(0,1,0),this._shadowColor=new Be(0,0,0,76),this._size=new Fe(1024,1024),this._shadowMapDirty=!1}var e=t.prototype;return e.getPlanarShader=function(t){this._material||(this._material=new $p,this._material.initialize({effectName:"pipeline/planar-shadow"}));var e=this._material.passes;return e.length>0?e[0].getShaderVariant(t):null},e.getPlanarInstanceShader=function(t){this._instancingMaterial||(this._instancingMaterial=new $p,this._instancingMaterial.initialize({effectName:"pipeline/planar-shadow",defines:{USE_INSTANCING:!0}}));var e=this._instancingMaterial.passes;return e.length>0?e[0].getShaderVariant(t):null},e.initialize=function(t){this._enabled=t.enabled,this._type=this.enabled?t.type:o_,this.normal=t.planeDirection,this.distance=t.planeHeight,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,t.shadowMapSize!==this._size.x&&(this.size.set(t.shadowMapSize,t.shadowMapSize),this._shadowMapDirty=!0)},e.activate=function(){if(this._enabled)if(this.type===s_.Planar)this._updatePlanarInfo();else{var t=i.director.root;t.pipeline.macros.CC_SHADOW_TYPE=2,t.onGlobalPipelineStateChanged()}else{var e=i.director.root;e.pipeline.macros.CC_SHADOW_TYPE=0,e.onGlobalPipelineStateChanged()}},e._updatePlanarInfo=function(){this._material||(this._material=new $p,this._material.initialize({effectName:"pipeline/planar-shadow"})),this._instancingMaterial||(this._instancingMaterial=new $p,this._instancingMaterial.initialize({effectName:"pipeline/planar-shadow",defines:{USE_INSTANCING:!0}}));var t=i.director.root;t.pipeline.macros.CC_SHADOW_TYPE=1,t.onGlobalPipelineStateChanged()},e.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:o_,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){Oe.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),t}());a_.MAX_FAR=2e3,a_.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),i.Shadows=a_;var u_,h_,c_=new Pe,l_=t("F",J({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3})),f_=l_.LAYERED+1,p_=t("v",function(){function t(){this._fogColor=new Be("#C8C8C8"),this._colorArray=new Pe(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var e=t.prototype;return e.initialize=function(t){this._activated=!1,this.fogColor=t.fogColor,this._enabled=t.enabled,this._type=this.enabled?t.type:f_,this._accurate=t.accurate,this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},e.activate=function(){this._updatePipeline(),this._activated=!0},e._updatePipeline=function(){var t=i.director.root,e=this.enabled?this.type:f_,n=this.accurate?1:0,r=t.pipeline;r.macros.CC_USE_FOG===e&&r.macros.CC_USE_ACCURATE_FOG===n||(r.macros.CC_USE_FOG=e,r.macros.CC_USE_ACCURATE_FOG=n,this._activated&&t.onGlobalPipelineStateChanged())},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():(this._type=f_,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate=t,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),c_.set(t.x,t.y,t.z,t.w),Bp(this._colorArray,c_)}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:f_,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}}]),t}());function __(t,e){for(var n,i=v(e);!(n=i()).done;){var r=n.value;Array.isArray(r)?__(t,r):t.push(r)}}function d_(t){var e=[];return __(e,t),e.join("")}i.Fog=p_,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(u_||(u_=t("as",{}))),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(h_||(h_=t("at",{}))),i.internal.TransformBit=h_;var v_=pt.Flags.Destroyed,g_=pt.Flags.PersistentMask,m_=k+"default",y_=o.IDENTIFIER_RE,b_="var ",E_="o",T_={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},w_=o.escapeForJS,A_=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return b_+this.varName+"="+this.expression+";"},t}();function I_(t,e){return e instanceof A_?new A_(e.varName,t+e.expression):t+e}function C_(t,e,n){Array.isArray(n)?(n[0]=I_(e,n[0]),t.push(n)):t.push(I_(e,n)+";")}var O_=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];C_(t,e+S_(i[0])+"=",i[1])}},t}();function S_(t){return y_.test(t)?"."+t:"["+w_(t)+"]"}O_.pool=void 0,O_.pool=new x((function(t){t._exps.length=0,t._targetExp=null}),1),O_.pool.get=function(t){var e=this._get()||new O_;return e._targetExp=t,e};var R_=function(){function t(t,e){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=tt(),et(this.funcModuleCache,T_),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=b_+this.globalVariables.join(",")+";");var i=d_(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,s=this.objsToClear_iN$t.length;r<s;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var n=C(t);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var o="F["+s+"]";return e&&(o="("+o+")"),this.funcModuleCache[n]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,n,i){var r=O_.pool.get(i),s=e.constructor.__props__;s||(s=Object.keys(e));for(var o=0;o<s.length;o++){var a=s[o],u=n[a];if(e[a]!==u){var h=this.enumerateField(n,a,u);r.append(a,h)}}r.writeCode(t),O_.pool.put(r)},e.enumerateCCClass=function(t,e,n){for(var r=n.__values__,s=N(n),a=0;a<r.length;a++){var u=r[a],h=e[u],c=s[u+m_];if(!x_(c,h))if("object"==typeof h&&h instanceof i.ValueType&&(c=o.getDefault(c))&&c.constructor===h.constructor){var l=E_+S_(u);this.setValueType(t,c,h,l)}else this.setObjProp(t,e,u,h)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,n=[new A_(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var i=0;i<t.length;++i)C_(n,e+"["+i+"]=",this.enumerateField(t,i,t[i]));return n},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var n="a"+ ++this.localVariableId,i=[new A_(n,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&C_(i,n+"["+r+"]=",t[r]);return i},e.enumerateField=function(t,e,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var s=i.source[0];i.source[0]=I_(r+"=",s)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?w_(n):("_objFlags"===e&&dt(t)&&(n&=g_),n)},e.setObjProp=function(t,e,n,i){C_(t,E_+S_(n)+"=",this.enumerateField(e,n,i))},e.enumerateObject=function(t,e){var n=e.constructor;if(H(n))this.enumerateCCClass(t,e,n);else for(var i in e)if(e.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=e[i];"object"==typeof r&&r&&r===e._iN$t||this.setObjProp(t,e,i,r)}},e.instantiateObj=function(t){if(t instanceof i.ValueType)return o.getNewValueTypeCode(t);if(t instanceof i.Asset)return this.getObjRef(t);if(t._objFlags&v_)return null;var e,n=t.constructor;if(H(n)){if(this.parent)if(this.parent instanceof i.Component){if(t instanceof i._BaseNode||t instanceof i.Component)return this.getObjRef(t)}else if(this.parent instanceof i._BaseNode)if(t instanceof i._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof i.Component){var r;if(!(null===(r=t.node)||void 0===r?void 0:r.isChildOf(this.parent)))return this.getObjRef(t)}e=new A_(E_,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)e=new A_(E_,"{}");else{if(n)return this.getObjRef(t);e=new A_(E_,"Object.create(null)")}var s=[e];return t._iN$t={globalVar:"",source:s},this.objsToClear_iN$t.push(t),this.enumerateObject(s,t),["(function(){",s,"return o;})();"]},t}();function x_(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof i.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return nt(t)&&nt(e)}return!1}var N_,M_,P_,D_,L_,k_,F_,B_,U_,z_,H_=function(){function t(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=t}return t.prototype.applyOpacity=function(t){this._opacity=this._localOpacity*t},t.markOpacityTree=function(){},n(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?_(12002):this._uiComp=t}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t,this.colorDirty=!0}}]),t}();pt.Flags.Destroying,function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed",t.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed",t.COMPONENT_ADDED="component-added",t.COMPONENT_REMOVED="component-removed"}(N_||(N_=t("au",{})));var V_=pt.Flags.Destroying,G_=pt.Flags.DontDestroy,j_=pt.Flags.Deactivating,W_=new O("Node");function K_(t){return t?"string"==typeof t?rt(t):t:(z(3804),null)}var Y_,q_,X_,Q_,$_,Z_,J_,td,ed,nd,id,rd=t("an",Xr("cc.BaseNode")((z_=U_=function(t){m(r,t),r._setScene=function(t){t._updateScene()},r._findComponent=function(t,e){var n=e,i=t._components;if(n._sealed)for(var r=0;r<i.length;++r){var s=i[r];if(s.constructor===e)return s}else for(var o=0;o<i.length;++o){var a=i[o];if(a instanceof e)return a}return null},r._findComponents=function(t,e,n){var i=e,r=t._components;if(i._sealed)for(var s=0;s<r.length;++s){var o=r[s];o.constructor===e&&n.push(o)}else for(var a=0;a<r.length;++a){var u=r[a];u instanceof e&&n.push(u)}},r._findChildComponent=function(t,e){for(var n=0;n<t.length;++n){var i=t[n],s=r._findComponent(i,e);if(s)return s;if(i._children.length>0&&(s=r._findChildComponent(i._children,e)))return s}return null},r._findChildComponents=function(t,e,n){for(var i=0;i<t.length;++i){var s=t[i];r._findComponents(s,e,n),s._children.length>0&&r._findChildComponents(s._children,e,n)}};var e=r.prototype;function r(e){var n;return n=t.call(this,e)||this,T(n,"_parent",D_,w(n)),T(n,"_children",L_,w(n)),T(n,"_active",k_,w(n)),T(n,"_components",F_,w(n)),T(n,"_prefab",B_,w(n)),n._scene=null,n._activeInHierarchy=!1,n._id=W_.getNewId(),n._name=void 0,n._eventProcessor=new i.NodeEventProcessor(w(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._name=void 0!==e?e:"New Node",n}return e._updateScene=function(){null==this._parent?g("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},e.attr=function(t){et(this,t)},e.getParent=function(){return this._parent},e.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var n=this._parent,i=t;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,e),this.emit&&this.emit(N_.PARENT_CHANGED,n),n&&!(n._objFlags&V_)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(N_.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(N_.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},e.getChildByUuid=function(t){if(!t)return it("Invalid uuid"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._id===t)return e[n];return null},e.getChildByName=function(t){if(!t)return it("Invalid name"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._name===t)return e[n];return null},e.getChildByPath=function(t){for(var e=t.split("/"),n=this,i=function(t){var i=e[t];if(0===i.length)return"continue";var r=n.children.find((function(t){return t.name===i}));if(!r)return{v:null};n=r},r=0;r<e.length;++r){var s=i(r);if("continue"!==s&&"object"==typeof s)return s.v}return n},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.setParent(this),t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&j_)z(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var n=e.indexOf(this);t!==n&&(e.splice(n,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},e.walk=function(t,e){var n=1,i=null,s=null,o=0,a=r._stacks[r._stackId];a||(a=[],r._stacks.push(a)),r._stackId++,a.length=0,a[0]=this;for(var u=null,h=!1;n;)if(s=a[--n])if(!h&&t?t(s):h&&e&&e(s),a[n]=null,h){if(u===this._parent)break;if(h=!1,i)if(i[++o])a[n]=i[o],n++;else if(u&&(a[n]=u,n++,h=!0,u._parent?(o=(i=u._parent._children).indexOf(u),u=u._parent):(u=null,i=null),o<0))break}else s._children.length>0?(u=s,i=s._children,o=0,a[n]=i[o],n++):(a[n]=s,n++,h=!0);a.length=0,r._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var n=t[e];n&&(n.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=K_(t);return e?r._findComponent(this,e):null},e.getComponents=function(t){var e=K_(t),n=[];return e&&r._findComponents(this,e,n),n},e.getComponentInChildren=function(t){var e=K_(t);return e?r._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=K_(t),n=[];return e&&(r._findComponents(this,e,n),r._findChildComponents(this._children,e,n)),n},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=rt(t)))throw i._RF.peek()&&z(3808,t),TypeError(b(3807,t))}else{if(!t)throw TypeError(b(3804));e=t}if("function"!=typeof e)throw TypeError(b(3809));if(!D(e,i.Component))throw TypeError(b(3810));var n=e._requireComponent;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){var s=n[r];this.getComponent(s)||this.addComponent(s)}else{var o=n;this.getComponent(o)||this.addComponent(o)}var a=new e;return a.node=this,this._components.push(a),this.emit(N_.COMPONENT_ADDED,a),this._activeInHierarchy&&i.director._nodeActivator.activateComp(a),a},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof qo?t:this.getComponent(t))&&e.destroy()}else z(3813)},e.on=function(t,e,n,i){switch(void 0===i&&(i=!1),t){case N_.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,n,i)},e.off=function(t,e,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(t,e,n,i),!this._eventProcessor.hasEventListener(t))switch(t){case N_.TRANSFORM_CHANGED:this._eventMask&=-2}},e.once=function(t,e,n,i){this._eventProcessor.once(t,e,n,i)},e.emit=function(t,e,n,i,r,s){this._eventProcessor.emit(t,e,n,i,r,s)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},e.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(N_.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&V_)){var e=this._components.indexOf(t);-1!==e?(this._components.splice(e,1),this.emit(N_.COMPONENT_REMOVED,t)):t.node!==this&&z(3815)}}else z(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(N_.SIBLING_ORDER_CHANGED)},e._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(r._setScene))},e._onPostActivated=function(){},e._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent._children.indexOf(this))},e._onPreDestroy=function(){this._onPreDestroyBase()},e._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},e._instantiate=function(t,e){return t||(t=i.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof i.Scene||i.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&i.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=V_;var t=this._parent,e=!!t&&0!=(t._objFlags&V_);if(!e&&q&&this._registerIfAttached(!1),this._persistNode&&i.game.removePersistRootNode(this),!e&&t){this.emit(N_.PARENT_CHANGED,this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(N_.CHILD_REMOVED,this)}this.emit(N_.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,s=0;s<r.length;++s)r[s]._destroyImmediate();for(var o=this._components,a=0;a<o.length;++a)o[a]._destroyImmediate();return e},n(r,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&G_)>0},set:function(t){t?this._objFlags|=G_:this._objFlags&=~G_}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&i.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),r}(pt),U_.idGenerator=W_,U_._stacks=[[]],U_._stackId=0,E((P_=z_).prototype,"_persistNode",[Jr],Object.getOwnPropertyDescriptor(P_.prototype,"_persistNode"),P_.prototype),E(P_.prototype,"name",[_s],Object.getOwnPropertyDescriptor(P_.prototype,"name"),P_.prototype),E(P_.prototype,"children",[_s],Object.getOwnPropertyDescriptor(P_.prototype,"children"),P_.prototype),E(P_.prototype,"active",[_s],Object.getOwnPropertyDescriptor(P_.prototype,"active"),P_.prototype),E(P_.prototype,"activeInHierarchy",[_s],Object.getOwnPropertyDescriptor(P_.prototype,"activeInHierarchy"),P_.prototype),E(P_.prototype,"parent",[_s],Object.getOwnPropertyDescriptor(P_.prototype,"parent"),P_.prototype),D_=E(P_.prototype,"_parent",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L_=E(P_.prototype,"_children",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k_=E(P_.prototype,"_active",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F_=E(P_.prototype,"_components",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B_=E(P_.prototype,"_prefab",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M_=P_))||M_);i._BaseNode=rd;var sd,od=new Oe,ad=new Le,ud=new Le,hd=new Le,cd=new Re,ld=new Re,fd=new Se,pd=[],_d=Symbol("ReserveContentsForAllSyncablePrefab"),dd=0,vd=t("ao",(Y_=Xr("cc.Node"),q_=Rs(Oe),Y_((id=nd=function(t){function e(e){var n;return(n=t.call(this,e)||this)._uiProps=new H_(w(n)),n._static=!1,T(n,"_lpos",$_,w(n)),T(n,"_lrot",Z_,w(n)),T(n,"_lscale",J_,w(n)),T(n,"_layer",td,w(n)),T(n,"_euler",ed,w(n)),n._dirtyFlags=h_.NONE,n._eulerDirty=!1,n._flagChangeVersion=0,n._hasChangedFlags=0,n._pos=new Oe,n._rot=new Le,n._scale=new Oe(1,1,1),n._mat=new Se,n}m(e,t),e.isNode=function(t){return t instanceof e&&(t.constructor===e||!(t instanceof i.Scene))};var r=e.prototype;return r._onPreDestroy=function(){return this._onPreDestroyBase()},r[Zo]=function(t){t.writeThis()},r.setParent=function(e,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,n)},r._onSetParent=function(e,n){if(t.prototype._onSetParent.call(this,e,n),n){var i=this._parent;i?(i.updateWorldTransform(),ke(Se.determinant(i._mat),0,xe)?(_(14300),this._dirtyFlags|=h_.TRS,this.updateWorldTransform()):(Se.multiply(fd,Se.invert(fd,i._mat),this._mat),Se.toRTS(fd,this._lrot,this._lpos,this._lscale))):(Oe.copy(this._lpos,this._pos),Le.copy(this._lrot,this._rot),Oe.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(h_.TRS)},r._onHierarchyChanged=function(e){this.eventProcessor.reattach(),t.prototype._onHierarchyChangedBase.call(this,e)},r._onBatchCreated=function(t){this.hasChangedFlags=h_.TRS,this._dirtyFlags|=h_.TRS;for(var e=this._children.length,n=0;n<e;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},r._onBeforeSerialize=function(){this.eulerAngles},r._onPostActivated=function(t){t?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(h_.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},r.translate=function(t,e){var n=e||u_.LOCAL;if(n===u_.LOCAL)Oe.transformQuat(od,t,this._lrot),this._lpos.x+=od.x,this._lpos.y+=od.y,this._lpos.z+=od.z;else if(n===u_.WORLD)if(this._parent){Le.invert(ad,this._parent.worldRotation),Oe.transformQuat(od,t,ad);var i=this.worldScale;this._lpos.x+=od.x/i.x,this._lpos.y+=od.y/i.y,this._lpos.z+=od.z/i.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(h_.POSITION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.POSITION)},r.rotate=function(t,e){var n=e||u_.LOCAL;if(Le.normalize(ad,t),n===u_.LOCAL)Le.multiply(this._lrot,this._lrot,ad);else if(n===u_.WORLD){var i=this.worldRotation;Le.multiply(ud,ad,i),Le.invert(ad,i),Le.multiply(ud,ad,ud),Le.multiply(this._lrot,this._lrot,ud)}this._eulerDirty=!0,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)},r.lookAt=function(t,e){this.getWorldPosition(od),Oe.subtract(od,od,t),Oe.normalize(od,od),Le.fromViewUp(ad,od,e),this.setWorldRotation(ad)},r.invalidateChildren=function(t){var e,n,i=0,r=0,s=0,o=0,a=t|h_.POSITION;for(pd[0]=this;i>=0;){if(o=(e=pd[i--]).hasChangedFlags,e.isValid&&(e._dirtyFlags&o&t)!==t)for(e._dirtyFlags|=t,e.hasChangedFlags=o|t,s=(n=e._children).length,r=0;r<s;r++)pd[++i]=n[r];t=a}},r.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,n=0;e&&e._dirtyFlags;)pd[n++]=e,e=e._parent;for(var i=0;n;)i|=(t=pd[--n])._dirtyFlags,e?(i&h_.POSITION&&(Oe.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&h_.RS&&(Se.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Se.multiply(t._mat,e._mat,t._mat),i&h_.ROTATION&&Le.multiply(t._rot,e._rot,t._lrot),Re.fromQuat(cd,Le.conjugate(hd,t._rot)),Re.multiplyMat4(cd,cd,t._mat),t._scale.x=cd.m00,t._scale.y=cd.m04,t._scale.z=cd.m08)):(i&h_.POSITION&&(Oe.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&h_.RS&&(i&h_.ROTATION&&Le.copy(t._rot,t._lrot),i&h_.SCALE&&(Oe.copy(t._scale,t._lscale),Se.fromRTS(t._mat,t._rot,t._pos,t._scale)))),t._dirtyFlags=h_.NONE,e=t}},r.setPosition=function(t,e,n){void 0===e&&void 0===n?Oe.copy(this._lpos,t):void 0===n?Oe.set(this._lpos,t,e,this._lpos.z):Oe.set(this._lpos,t,e,n),this.invalidateChildren(h_.POSITION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.POSITION)},r.getPosition=function(t){return t?Oe.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Oe.copy(new Oe,this._lpos)},r.setRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?Le.copy(this._lrot,t):Le.set(this._lrot,t,e,n,i),this._eulerDirty=!0,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)},r.setRotationFromEuler=function(t,e,n){var i=void 0===n?this._euler.z:n;void 0===e?(Oe.copy(this._euler,t),Le.fromEuler(this._lrot,t.x,t.y,t.z)):(Oe.set(this._euler,t,e,i),Le.fromEuler(this._lrot,t,e,i)),this._eulerDirty=!1,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)},r.getRotation=function(t){return t?Le.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Le.copy(new Le,this._lrot)},r.setScale=function(t,e,n){void 0===e&&void 0===n?Oe.copy(this._lscale,t):void 0===n?Oe.set(this._lscale,t,e,this._lscale.z):Oe.set(this._lscale,t,e,n),this.invalidateChildren(h_.SCALE),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.SCALE)},r.getScale=function(t){return t?Oe.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Oe.copy(new Oe,this._lscale)},r.inverseTransformPoint=function(t,e){Oe.copy(t,e);for(var n=this,i=0;n._parent;)pd[i++]=n,n=n._parent;for(;i>=0;)Oe.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=pd[--i];return t},r.setWorldPosition=function(t,e,n){void 0===e||void 0===n?Oe.copy(this._pos,t):Oe.set(this._pos,t,e,n);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Oe.transformMat4(r,this._pos,Se.invert(fd,i._mat))):Oe.copy(r,this._pos),this.invalidateChildren(h_.POSITION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.POSITION)},r.getWorldPosition=function(t){return this.updateWorldTransform(),t?Oe.copy(t,this._pos):Oe.copy(new Oe,this._pos)},r.setWorldRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?Le.copy(this._rot,t):Le.set(this._rot,t,e,n,i),this._parent?(this._parent.updateWorldTransform(),Le.multiply(this._lrot,Le.conjugate(this._lrot,this._parent._rot),this._rot)):Le.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)},r.setWorldRotationFromEuler=function(t,e,n){Le.fromEuler(this._rot,t,e,n),this._parent?(this._parent.updateWorldTransform(),Le.multiply(this._lrot,Le.conjugate(this._lrot,this._parent._rot),this._rot)):Le.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)},r.getWorldRotation=function(t){return this.updateWorldTransform(),t?Le.copy(t,this._rot):Le.copy(new Le,this._rot)},r.setWorldScale=function(t,e,n){void 0===e||void 0===n?Oe.copy(this._scale,t):Oe.set(this._scale,t,e,n);var i=this._parent;i?(i.updateWorldTransform(),Re.fromQuat(cd,Le.conjugate(hd,i._rot)),Re.multiplyMat4(cd,cd,i._mat),ld.m00=this._scale.x,ld.m04=this._scale.y,ld.m08=this._scale.z,Re.multiply(cd,ld,Re.invert(cd,cd)),this._lscale.x=Oe.set(od,cd.m00,cd.m01,cd.m02).length(),this._lscale.y=Oe.set(od,cd.m03,cd.m04,cd.m05).length(),this._lscale.z=Oe.set(od,cd.m06,cd.m07,cd.m08).length()):Oe.copy(this._lscale,this._scale),this.invalidateChildren(h_.SCALE),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.SCALE)},r.getWorldScale=function(t){return this.updateWorldTransform(),t?Oe.copy(t,this._scale):Oe.copy(new Oe,this._scale)},r.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Se;return Se.copy(e,this._mat)},r.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Se;return Se.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},r.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Se;return Se.fromRT(e,this._rot,this._pos)},r.setRTS=function(t,e,n){var i=0;t&&(i|=h_.ROTATION,void 0!==t.w?(Le.copy(this._lrot,t),this._eulerDirty=!0):(Oe.copy(this._euler,t),Le.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(Oe.copy(this._lpos,e),i|=h_.POSITION),n&&(Oe.copy(this._lscale,n),i|=h_.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,i))},r.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},r.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},e.resetHasChangedFlags=function(){dd+=1},e.clearNodeArray=function(){e.ClearFrame<e.ClearRound&&!q?e.ClearFrame++:(e.ClearFrame=0,pd.length=0)},r.getPathInHierarchy=function(){for(var t=this.name,n=this.parent;n&&n instanceof e;)t=n.name+"/"+t,n=n.parent;return t},n(e,[{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(Le.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this._euler.z},set:function(t){Oe.set(this._euler,0,0,t),Le.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(h_.ROTATION),1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Se.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(h_.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(N_.TRANSFORM_CHANGED,h_.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Oe.transformQuat(new Oe,Oe.FORWARD,this.worldRotation)},set:function(t){var e=t.length();Oe.multiplyScalar(od,t,-1/e),Le.fromViewUp(ad,od),this.setWorldRotation(ad)}},{key:"up",get:function(){return Oe.transformQuat(new Oe,Oe.UP,this.worldRotation)}},{key:"right",get:function(){return Oe.transformQuat(new Oe,Oe.RIGHT,this.worldRotation)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(N_.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===dd?this._hasChangedFlags:0},set:function(t){this._flagChangeVersion=dd,this._hasChangedFlags=t}}]),e}(rd),nd.EventType=N_,nd.NodeSpace=u_,nd.TransformDirtyBit=h_,nd.TransformBit=h_,nd.reserveContentsForAllSyncablePrefabTag=_d,nd.ClearFrame=0,nd.ClearRound=1e3,$_=E((Q_=id).prototype,"_lpos",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe}}),Z_=E(Q_.prototype,"_lrot",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Le}}),J_=E(Q_.prototype,"_lscale",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(1,1,1)}}),td=E(Q_.prototype,"_layer",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hn.Enum.DEFAULT}}),ed=E(Q_.prototype,"_euler",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe}}),E(Q_.prototype,"eulerAngles",[q_],Object.getOwnPropertyDescriptor(Q_.prototype,"eulerAngles"),Q_.prototype),E(Q_.prototype,"angle",[_s],Object.getOwnPropertyDescriptor(Q_.prototype,"angle"),Q_.prototype),E(Q_.prototype,"layer",[_s],Object.getOwnPropertyDescriptor(Q_.prototype,"layer"),Q_.prototype),X_=Q_))||X_));i.Node=vd,o.Attr.setClassAttr(Wo,"target","type","Object"),o.Attr.setClassAttr(Wo,"target","ctor",vd),t("aF",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},e.destroy=function(){},n(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}()).Priority=J({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var gd=new de;gd.format=bt.RGBA8;var md=new ve;md.format=bt.DEPTH_STENCIL;var yd,bd,Ed,Td,wd,Ad,Id,Cd,Od,Sd,Rd,xd,Nd,Md,Pd,Dd,Ld,kd,Fd,Bd,Ud,zd,Hd,Vd,Gd,jd,Wd,Kd,Yd,qd,Xd,Qd,$d,Zd,Jd,tv,ev,nv,iv,rv,sv,ov,av,uv,hv,cv,lv,fv,pv,_v,dv,vv,gv,mv,yv,bv,Ev,Tv,wv,Av,Iv,Cv,Ov,Sv,Rv,xv,Nv,Mv,Pv,Dv,Lv,kv,Fv=new ge([gd],md),Bv={width:1,height:1,renderPassInfo:Fv},Uv=t("ae",Xr("cc.RenderTexture")(sd=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._window=null,e}m(e,t);var r=e.prototype;return r.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},r.reset=function(t){this.initialize(t)},r.destroy=function(){if(this._window){var e=i.director.root;null==e||e.destroyWindow(this._window),this._window=null}return t.prototype.destroy.call(this)},r.resize=function(t,e){this._width=Math.floor(je(t,1,2048)),this._height=Math.floor(je(e,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},r._serialize=function(){return{}},r._deserialize=function(e,n){var i=e;this._width=i.w,this._height=i.h,this._name=i.n,t.prototype._deserialize.call(this,i.base,n)},r.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},r.onLoaded=function(){this._initWindow()},r._initWindow=function(t){var e=i.director.root;Bv.title=this._name,Bv.width=this._width,Bv.height=this._height,Bv.renderPassInfo=t&&t.passInfo?t.passInfo:Fv,gd.barrier=$e.gfxDevice.getGeneralBarrier(new me(ye.FRAGMENT_SHADER_READ_TEXTURE,ye.FRAGMENT_SHADER_READ_TEXTURE)),this._window?(this._window.destroy(),this._window.initialize($e.gfxDevice,Bv)):this._window=e.createWindow(Bv)},r.initDefault=function(e){t.prototype.initDefault.call(this,e),this._width=this._height=1,this._initWindow()},r.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},r.readPixels=function(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),n=n||this.width,i=i||this.height;var s=this.getGFXTexture();if(!s)return z(7606),null;var o=4*n*i;if(void 0===r)r=new Uint8Array(o);else if(r.length<o)return z(7607,o),null;var a=this._getGFXDevice(),u=[],h=[],c=new St;return c.texOffset.x=t,c.texOffset.y=e,c.texExtent.width=n,c.texExtent.height=i,h.push(c),u.push(r),null==a||a.copyTextureToBuffers(s,u,h),r},n(e,[{key:"window",get:function(){return this._window}}]),e}(Gc))||sd);i.RenderTexture=Uv;var zv,Hv,Vv,Gv,jv,Wv,Kv,Yv,qv,Xv=new Oe,Qv=J(tc),$v=J(Jh),Zv=J(ec),Jv=J(ic),tg=J(nc),eg=J({SKYBOX:Ic|gt.DEPTH_STENCIL,SOLID_COLOR:gt.ALL,DEPTH_ONLY:gt.DEPTH_STENCIL,DONT_CLEAR:gt.NONE}),ng=t("aJ",(yd=Xr("cc.Camera"),bd=ps(),Ed=hs(),Td=ws(),wd=ms(),Ad=Rs(hn.BitMask),Id=ws(),Cd=ms(),Od=Rs(eg),Sd=ws(),Rd=ms(),xd=ws(),Nd=ms(),Md=ws(),Pd=ms(),Dd=ws(),Ld=ms(),kd=Rs(Qv),Fd=ws(),Bd=ms(),Ud=Rs($v),zd=ws(),Hd=ds(),Vd=ms(),Gd=ws(),jd=ds(),Wd=ms(),Kd=ws(),Yd=ds(),qd=ms(),Xd=ws(),Qd=ms(),$d=ws(),Zd=ms(),Jd=Rs(Zv),tv=ws(),ev=ms(),nv=Rs(Jv),iv=ws(),rv=ms(),sv=Rs(tg),ov=ws(),av=ms(),uv=ws(),hv=ms(),cv=Rs(Uv),lv=ws(),fv=ms(),yd(pv=bd(pv=Ed(pv=us((kv=Lv=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"_projection",dv,w(e)),T(e,"_priority",vv,w(e)),T(e,"_fov",gv,w(e)),T(e,"_fovAxis",mv,w(e)),T(e,"_orthoHeight",yv,w(e)),T(e,"_near",bv,w(e)),T(e,"_far",Ev,w(e)),T(e,"_color",Tv,w(e)),T(e,"_depth",wv,w(e)),T(e,"_stencil",Av,w(e)),T(e,"_clearFlags",Iv,w(e)),T(e,"_rect",Cv,w(e)),T(e,"_aperture",Ov,w(e)),T(e,"_shutter",Sv,w(e)),T(e,"_iso",Rv,w(e)),T(e,"_screenScale",xv,w(e)),T(e,"_visibility",Nv,w(e)),T(e,"_targetTexture",Mv,w(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,T(e,"_cameraType",Pv,w(e)),T(e,"_trackingType",Dv,w(e)),e}m(e,t);var r=e.prototype;return r.onLoad=function(){this._createCamera()},r.onEnable=function(){this.node.hasChangedFlags|=h_.POSITION,this._camera&&this._attachToScene()},r.onDisable=function(){this._camera&&this._detachFromScene()},r.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},r.screenPointToRay=function(t,e,n){return n||(n=Kn.create()),this._camera&&this._camera.screenPointToRay(n,t,e),n},r.worldToScreen=function(t,e){return e||(e=new Oe),this._camera&&this._camera.worldToScreen(e,t),e},r.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},r.convertToUINode=function(t,e,n){if(n||(n=new Oe),!this._camera)return n;this.worldToScreen(t,Xv);var r=e.getComponent("cc.UITransform"),s=i.view.getVisibleSize(),o=Xv.x-.5*this._camera.width,a=Xv.y-.5*this._camera.height;return Xv.x=o/i.view.getScaleX()+.5*s.width,Xv.y=a/i.view.getScaleY()+.5*s.height,r&&r.convertToNodeSpaceAR(Xv,n),n},r._createCamera=function(){this._camera||(this._camera=i.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=Ke(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},r._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},r._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},r._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},r._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},n(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===Jh.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=Ke(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var n=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(n),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?i.director.root&&i.director.root.mainWindow:i.director.root&&i.director.root.tempWindow)}},{key:"cameraType",get:function(){return this._cameraType},set:function(t){this._cameraType!==t&&(this._cameraType=t,this.camera&&(this.camera.cameraType=t))}},{key:"trackingType",get:function(){return this._trackingType},set:function(t){this._trackingType!==t&&(this._trackingType=t,this.camera&&(this.camera.trackingType=t))}}]),e}(qo),Lv.ProjectionType=Qv,Lv.FOVAxis=$v,Lv.ClearFlag=eg,Lv.Aperture=Zv,Lv.Shutter=Jv,Lv.ISO=tg,Lv.TARGET_TEXTURE_CHANGE="tex-change",dv=E((_v=kv).prototype,"_projection",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qv.PERSPECTIVE}}),vv=E(_v.prototype,"_priority",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gv=E(_v.prototype,"_fov",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),mv=E(_v.prototype,"_fovAxis",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $v.VERTICAL}}),yv=E(_v.prototype,"_orthoHeight",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),bv=E(_v.prototype,"_near",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ev=E(_v.prototype,"_far",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Tv=E(_v.prototype,"_color",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be("#333333")}}),wv=E(_v.prototype,"_depth",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Av=E(_v.prototype,"_stencil",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iv=E(_v.prototype,"_clearFlags",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eg.SOLID_COLOR}}),Cv=E(_v.prototype,"_rect",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ze(0,0,1,1)}}),Ov=E(_v.prototype,"_aperture",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zv.F16_0}}),Sv=E(_v.prototype,"_shutter",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jv.D125}}),Rv=E(_v.prototype,"_iso",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tg.ISO100}}),xv=E(_v.prototype,"_screenScale",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Nv=E(_v.prototype,"_visibility",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qe}}),Mv=E(_v.prototype,"_targetTexture",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pv=E(_v.prototype,"_cameraType",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rc.DEFAULT}}),Dv=E(_v.prototype,"_trackingType",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sc.NO_TRACKING}}),E(_v.prototype,"priority",[Td,wd],Object.getOwnPropertyDescriptor(_v.prototype,"priority"),_v.prototype),E(_v.prototype,"visibility",[Ad,Id,Cd],Object.getOwnPropertyDescriptor(_v.prototype,"visibility"),_v.prototype),E(_v.prototype,"clearFlags",[Od,Sd,Rd],Object.getOwnPropertyDescriptor(_v.prototype,"clearFlags"),_v.prototype),E(_v.prototype,"clearColor",[xd,Nd],Object.getOwnPropertyDescriptor(_v.prototype,"clearColor"),_v.prototype),E(_v.prototype,"clearDepth",[Md,Pd],Object.getOwnPropertyDescriptor(_v.prototype,"clearDepth"),_v.prototype),E(_v.prototype,"clearStencil",[Dd,Ld],Object.getOwnPropertyDescriptor(_v.prototype,"clearStencil"),_v.prototype),E(_v.prototype,"projection",[kd,Fd,Bd],Object.getOwnPropertyDescriptor(_v.prototype,"projection"),_v.prototype),E(_v.prototype,"fovAxis",[Ud,zd,Hd,Vd],Object.getOwnPropertyDescriptor(_v.prototype,"fovAxis"),_v.prototype),E(_v.prototype,"fov",[Gd,jd,Wd],Object.getOwnPropertyDescriptor(_v.prototype,"fov"),_v.prototype),E(_v.prototype,"orthoHeight",[Kd,Yd,qd],Object.getOwnPropertyDescriptor(_v.prototype,"orthoHeight"),_v.prototype),E(_v.prototype,"near",[Xd,Qd],Object.getOwnPropertyDescriptor(_v.prototype,"near"),_v.prototype),E(_v.prototype,"far",[$d,Zd],Object.getOwnPropertyDescriptor(_v.prototype,"far"),_v.prototype),E(_v.prototype,"aperture",[Jd,tv,ev],Object.getOwnPropertyDescriptor(_v.prototype,"aperture"),_v.prototype),E(_v.prototype,"shutter",[nv,iv,rv],Object.getOwnPropertyDescriptor(_v.prototype,"shutter"),_v.prototype),E(_v.prototype,"iso",[sv,ov,av],Object.getOwnPropertyDescriptor(_v.prototype,"iso"),_v.prototype),E(_v.prototype,"rect",[uv,hv],Object.getOwnPropertyDescriptor(_v.prototype,"rect"),_v.prototype),E(_v.prototype,"targetTexture",[cv,lv,fv],Object.getOwnPropertyDescriptor(_v.prototype,"targetTexture"),_v.prototype),pv=_v))||pv)||pv)||pv)||pv));i.Camera=ng;var ig,rg,sg,og,ag={parent:null,owner:null,subModelIdx:0},ug=t("aL",(zv=Xr("cc.Renderer"),Hv=Rs($p),Vv=ws(),Gv=gs(),jv=Rs([$p]),zv(Wv=Zr((qv=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"_materials",Yv,w(e)),e._materialInstances=[],e}m(e,t);var i=e.prototype;return i.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},i.setMaterial=function(t,e){t&&t instanceof Jp&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var n=this._materialInstances[e];n&&(n.destroy(),this._materialInstances[e]=null),this._onMaterialModified(e,this._materials[e])},i.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){ag.parent=this._materials[t],ag.owner=this,ag.subModelIdx=t;var e=new Jp(ag);ag.parent=null,ag.owner=null,ag.subModelIdx=0,this.setMaterialInstance(e,t)}return this._materialInstances[t]},i.setMaterialInstance=function(t,e){if("number"==typeof t){_(12007);var n=t;t=e,e=n}var i=this._materialInstances[e];t&&t.parent?t!==i&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):(t!==this._materials[e]||i)&&this.setMaterial(t,e)},i.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},i._onMaterialModified=function(){},i._onRebuildPSO=function(){},i._clearMaterials=function(){},n(e,[{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){for(var e=t.length,n=this._materials.length,i=e;i<n;i++)this.setMaterialInstance(null,i);this._materials.length=e,this._materialInstances.length=e;for(var r=0;r<e;r++)this._materialInstances[r]!=t[r]&&this.setMaterialInstance(t[r],r)}}]),e}(qo),E((Kv=qv).prototype,"sharedMaterials",[Hv,Vv,Gv],Object.getOwnPropertyDescriptor(Kv.prototype,"sharedMaterials"),Kv.prototype),Yv=E(Kv.prototype,"_materials",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wv=Kv))||Wv)||Wv)),hg=t("aK",Xr("cc.ModelRenderer")((og=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"_visFlags",sg,w(e)),e._models=[],e._priority=0,e}m(e,t);var i=e.prototype;return i._collectModels=function(){return this._models},i.onEnable=function(){this._updatePriority()},i._attachToScene=function(){},i._detachFromScene=function(){},i._onVisibilityChange=function(){},i._updatePriority=function(){if(this._models.length>0)for(var t=0;t<this._models.length;t++)this._models[t].priority=this._priority},n(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"priority",get:function(){return this._priority},set:function(t){t!==this._priority&&(this._priority=t,this._updatePriority())}}]),e}(ug),sg=E((rg=og).prototype,"_visFlags",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hn.Enum.NONE}}),ig=rg))||ig);Ne(ng,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),Ne(ng.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),i.CameraComponent=ng,a.setClassAlias(ng,"cc.CameraComponent"),i.RenderableComponent=hg,a.setClassAlias(hg,"cc.RenderableComponent");var cg,lg=t("aU",(function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=n,this.timestamp=i})),fg=new Array(16),pg=null,_g=new Fe,dg=[N_.TOUCH_START,N_.TOUCH_MOVE,N_.TOUCH_END,N_.TOUCH_CANCEL],vg=[N_.MOUSE_DOWN,N_.MOUSE_ENTER,N_.MOUSE_MOVE,N_.MOUSE_LEAVE,N_.MOUSE_UP,N_.MOUSE_WHEEL];!function(t){t[t.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",t[t.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",t[t.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(cg||(cg=t("ck",{})));var gg,mg,yg,bg,Eg,Tg,wg,Ag,Ig,Cg,Og,Sg,Rg,xg,Ng,Mg,Pg,Dg,Lg,kg,Fg,Bg,Ug,zg,Hg,Vg,Gg,jg,Wg,Kg,Yg,qg,Xg,Qg,$g,Zg,Jg,tm,em,nm,im,rm,sm,om,am,um,hm,cm,lm,fm,pm,_m,dm,vm,gm,mm,ym,bm,Em,Tm,wm,Am,Im,Cm,Om,Sm,Rm,xm,Nm,Mm,Pm,Dm,Lm,km,Fm,Bm,Um,zm,Hm,Vm,Gm,jm,Wm,Km,Ym,qm,Xm,Qm,$m,Zm,Jm,ty,ey,ny,iy,ry,sy,oy,ay,uy,hy,cy,ly,fy,py,_y,dy,vy,gy,my,yy,by,Ey,Ty,wy,Ay,Iy,Cy,Oy,Sy,Ry,xy,Ny,My,Py,Dy,Ly,ky,Fy,By,Uy,zy,Hy,Vy,Gy,jy,Wy,Ky,Yy,qy,Xy,Qy,$y,Zy,Jy,tb,eb,nb,ib,rb,sb,ob,ab,ub,hb,cb,lb,fb,pb,_b,db,vb,gb=t("ch",function(){function t(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._dispatchingTouch=null,this._isEnabled=!1,this._node=void 0,this._node=t}var e=t.prototype;return e.setEnabled=function(e,n){if(void 0===n&&(n=!1),this._isEnabled!==e){this._isEnabled=e;var i=this.node.children;if(e&&this._attachMask(),t.callbacksInvoker.emit(cg.MARK_LIST_DIRTY),n&&i.length>0)for(var r=0;r<i.length;++r)i[r]._eventProcessor.setEnabled(e,!0)}},e.reattach=function(){var e,n=this;this.node.walk((function(i){e||(e=n._searchComponentsInParent(t._maskComp)),i.eventProcessor.maskList=e}))},e.destroy=function(){if(pg===this._node&&(pg=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),t.callbacksInvoker.emit(cg.REMOVE_POINTER_EVENT_PROCESSOR,this),this._dispatchingTouch){var e=new ln([this._dispatchingTouch],!0,fn.TOUCH_CANCEL);e.touch=this._dispatchingTouch,this.dispatchEvent(e),this._dispatchingTouch=null}},e.on=function(t,e,n,i){var r,s;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n),e},e.once=function(t,e,n,i){var r,s;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n,!0),e},e.off=function(t,e,n,i){var r;null===(r=(i=!!i)?this.capturingTarget:this.bubblingTarget)||void 0===r||r.off(t,e,n)},e.targetOff=function(e){var n,i;null===(n=this.capturingTarget)||void 0===n||n.removeAll(e),null===(i=this.bubblingTarget)||void 0===i||i.removeAll(e),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||t.callbacksInvoker.emit(cg.REMOVE_POINTER_EVENT_PROCESSOR,this)},e.emit=function(t,e,n,i,r,s){var o;null===(o=this.bubblingTarget)||void 0===o||o.emit(t,e,n,i,r,s)},e.dispatchEvent=function(t){var e,n=this.node,i=0;for(t.target=n,fg.length=0,this.getCapturingTargets(t.type,fg),t.eventPhase=1,i=fg.length-1;i>=0;--i)if((e=fg[i]).eventProcessor.capturingTarget&&(t.currentTarget=e,e.eventProcessor.capturingTarget.emit(t.type,t,fg),t.propagationStopped))return void(fg.length=0);if(fg.length=0,t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(this.getBubblingTargets(t.type,fg),t.eventPhase=3,i=0;i<fg.length;++i)if((e=fg[i]).eventProcessor.bubblingTarget&&(t.currentTarget=e,e.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void(fg.length=0);fg.length=0},e.hasEventListener=function(t,e,n){var i=!1;return this.bubblingTarget&&(i=this.bubblingTarget.hasEventListener(t,e,n)),!i&&this.capturingTarget&&(i=this.capturingTarget.hasEventListener(t,e,n)),i},e.getCapturingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.capturingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},e.getBubblingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.bubblingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},e._searchComponentsInParent=function(t){var e=this.node;if(t){for(var n=0,i=[],r=e;r&&vd.isNode(r);r=r.parent,++n){var s=r.getComponent(t);if(s){var o={index:n,comp:s};i?i.push(o):i=[o]}}return i.length>0?i:null}return null},e._attachMask=function(){this.maskList=this._searchComponentsInParent(t._maskComp)},e._isTouchEvent=function(t){return-1!==dg.indexOf(t)},e._isMouseEvent=function(t){return-1!==vg.indexOf(t)},e._hasTouchListeners=function(){for(var t=0;t<dg.length;++t){var e=dg[t];if(this.hasEventListener(e))return!0}return!1},e._hasMouseListeners=function(){for(var t=0;t<vg.length;++t){var e=vg[t];if(this.hasEventListener(e))return!0}return!1},e._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},e._tryEmittingAddEvent=function(e){var n=this._isTouchEvent(e),i=this._isMouseEvent(e);n?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!n&&!i||this._hasPointerListeners()||t.callbacksInvoker.emit(cg.ADD_POINTER_EVENT_PROCESSOR,this)},e._newCallbacksInvoker=function(){var e=this,n=new be;return n._registerOffCallback((function(){e.shouldHandleEventTouch&&!e._hasTouchListeners()&&(e.shouldHandleEventTouch=!1),e.shouldHandleEventMouse&&!e._hasMouseListeners()&&(e.shouldHandleEventMouse=!1),e._hasPointerListeners()||t.callbacksInvoker.emit(cg.REMOVE_POINTER_EVENT_PROCESSOR,e)})),n},e._handleEventMouse=function(t){switch(t.type){case fn.MOUSE_DOWN:return this._handleMouseDown(t);case fn.MOUSE_MOVE:return this._handleMouseMove(t);case fn.MOUSE_UP:return this._handleMouseUp(t);case fn.MOUSE_WHEEL:return this._handleMouseWheel(t);default:return!1}},e._handleMouseDown=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(_g),!e._uiProps.uiTransformComp.hitTest(_g)||(t.type=N_.MOUSE_DOWN,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseMove=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(_g),e._uiProps.uiTransformComp.hitTest(_g)?(this.previousMouseIn||(pg&&pg!==e&&(t.type=N_.MOUSE_LEAVE,pg.dispatchEvent(t),pg.eventProcessor.previousMouseIn=!1),pg=e,t.type=N_.MOUSE_ENTER,e.dispatchEvent(t),this.previousMouseIn=!0),t.type=N_.MOUSE_MOVE,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type=N_.MOUSE_LEAVE,e.dispatchEvent(t),this.previousMouseIn=!1,pg=null),1)))},e._handleMouseUp=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(_g),!e._uiProps.uiTransformComp.hitTest(_g)||(t.type=N_.MOUSE_UP,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseWheel=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(_g),!e._uiProps.uiTransformComp.hitTest(_g)||(t.type=N_.MOUSE_WHEEL,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleEventTouch=function(t){switch(t.type){case fn.TOUCH_START:return this._handleTouchStart(t);case fn.TOUCH_MOVE:return this._handleTouchMove(t);case fn.TOUCH_END:return this._handleTouchEnd(t);case fn.TOUCH_CANCEL:return this._handleTouchCancel(t);default:return!1}},e._handleTouchStart=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(_g),!e._uiProps.uiTransformComp.hitTest(_g)||(t.type=N_.TOUCH_START,t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0)))},e._handleTouchMove=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.type=N_.TOUCH_MOVE,t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0))},e._handleTouchEnd=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.getLocation(_g),e._uiProps.uiTransformComp.hitTest(_g)?t.type=N_.TOUCH_END:t.type=N_.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t),this._dispatchingTouch=null)},e._handleTouchCancel=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.type=N_.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},n(t,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),t}());gb._maskComp=null,gb.callbacksInvoker=new be,i.NodeEventProcessor=gb;var mb=new Oe(0,1,0),yb=new Oe,bb=new Pe,Eb=new Be,Tb=new Le,wb=function(t){var e=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);e<1&&(t.x*=e,t.y*=e,t.z*=e)},Ab=t("av",(gg=Xr("cc.AmbientInfo"),mg=ds(),yg=ms(),bg=Rs(c),Eg=ms(),Tg=ds(),wg=ms(),Ag=rs("_skyColor"),Ig=rs("_skyIllum"),Cg=rs("_groundAlbedo"),gg((Lg=function(){function t(){T(this,"_skyColorHDR",Rg,this),T(this,"_skyIllumHDR",xg,this),T(this,"_groundAlbedoHDR",Ng,this),T(this,"_skyColorLDR",Mg,this),T(this,"_skyIllumLDR",Pg,this),T(this,"_groundAlbedoLDR",Dg,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},n(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=i.director.root.pipeline.pipelineSceneData.isHDR;return bb.set(t?this._skyColorHDR:this._skyColorLDR),wb(bb),Eb.set(255*bb.x,255*bb.y,255*bb.z,255)},set:function(t){bb.set(t.x,t.y,t.z,t.w),i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(bb):this._skyColorLDR.set(bb),this._resource&&this._resource.skyColor.set(bb)}},{key:"skyColor",set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=i.director.root.pipeline.pipelineSceneData.isHDR;return bb.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),wb(bb),Eb.set(255*bb.x,255*bb.y,255*bb.z,255)},set:function(t){bb.set(t.x,t.y,t.z,t.w),i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(bb):this._groundAlbedoLDR.set(bb),this._resource&&this._resource.groundAlbedo.set(bb)}},{key:"groundAlbedo",set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),E((Sg=Lg).prototype,"skyLightingColor",[mg,_s,yg],Object.getOwnPropertyDescriptor(Sg.prototype,"skyLightingColor"),Sg.prototype),E(Sg.prototype,"skyIllum",[_s,bg,Eg],Object.getOwnPropertyDescriptor(Sg.prototype,"skyIllum"),Sg.prototype),E(Sg.prototype,"groundLightingColor",[Tg,_s,wg],Object.getOwnPropertyDescriptor(Sg.prototype,"groundLightingColor"),Sg.prototype),Rg=E(Sg.prototype,"_skyColorHDR",[is,Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(.2,.5,.8,1)}}),xg=E(Sg.prototype,"_skyIllumHDR",[is,Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pp.SKY_ILLUM}}),Ng=E(Sg.prototype,"_groundAlbedoHDR",[is,Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(.2,.2,.2,1)}}),Mg=E(Sg.prototype,"_skyColorLDR",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(.2,.5,.8,1)}}),Pg=E(Sg.prototype,"_skyIllumLDR",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pp.SKY_ILLUM}}),Dg=E(Sg.prototype,"_groundAlbedoLDR",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(.2,.2,.2,1)}}),Og=Sg))||Og));i.AmbientInfo=Ab;var Ib=t("aw",(kg=Xr("cc.SkyboxInfo"),Fg=ms(),Bg=Rs(n_),Ug=ms(),zg=ms(),Hg=Rs(gl),Vg=ms(),Gg=Rs(c),jg=ys(),Wg=Es(),Kg=ms(),Yg=ds(),qg=Rs(gl),Xg=ws(),Qg=ds(),$g=Rs(gl),Zg=ws(),Jg=Rs($p),tm=ms(),em=Rs(gl),nm=rs("_envmap"),im=Rs(gl),rm=Rs(gl),sm=Rs(gl),om=Rs($p),am=Rs(gl),um=Rs(gl),kg((Tm=function(){function t(){T(this,"_envLightingType",lm,this),T(this,"_envmapHDR",fm,this),T(this,"_envmapLDR",pm,this),T(this,"_diffuseMapHDR",_m,this),T(this,"_diffuseMapLDR",dm,this),T(this,"_enabled",vm,this),T(this,"_useHDR",gm,this),T(this,"_editableMaterial",mm,this),T(this,"_reflectionHDR",ym,this),T(this,"_reflectionLDR",bm,this),T(this,"_rotationAngle",Em,this),this._resource=null}return t.prototype.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setSkyboxMaterial(this._editableMaterial),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.setRotationAngle(this._rotationAngle),this._resource.activate()},n(t,[{key:"applyDiffuseMap",get:function(){return n_.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||n_.HEMISPHERE_DIFFUSE===t?(n_.HEMISPHERE_DIFFUSE===t?(this.useIBL=!1,this.applyDiffuseMap=!1):n_.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===t?(this.useIBL=!0,this.applyDiffuseMap=!1):n_.DIFFUSEMAP_WITH_REFLECTION===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=n_.HEMISPHERE_DIFFUSE,_(15001))}},{key:"useIBL",get:function(){return n_.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR=t,this._useHDR=t,this._resource&&this.envLightingType===n_.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=n_.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,_(15e3)):this.diffuseMap.isDefault&&_(15002)),this._resource&&(this._resource.useHDR=this._useHDR,this._resource.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var e=i.director.root.pipeline.pipelineSceneData.isHDR;e?(this._envmapHDR=t,this._reflectionHDR=null):(this._envmapLDR=t,this._reflectionLDR=null),t||(e?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=n_.HEMISPHERE_DIFFUSE,_(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=t)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(t){this._rotationAngle=t,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return i.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR},set:function(t){i.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR=t:this._reflectionLDR=t,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(t){this._editableMaterial=t,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),t}(),E((cm=Tm).prototype,"enabled",[_s,Fg],Object.getOwnPropertyDescriptor(cm.prototype,"enabled"),cm.prototype),E(cm.prototype,"envLightingType",[_s,Bg,Ug],Object.getOwnPropertyDescriptor(cm.prototype,"envLightingType"),cm.prototype),E(cm.prototype,"useHDR",[_s,zg],Object.getOwnPropertyDescriptor(cm.prototype,"useHDR"),cm.prototype),E(cm.prototype,"envmap",[_s,Hg,Vg],Object.getOwnPropertyDescriptor(cm.prototype,"envmap"),cm.prototype),E(cm.prototype,"rotationAngle",[Gg,jg,Wg,Ts,Kg],Object.getOwnPropertyDescriptor(cm.prototype,"rotationAngle"),cm.prototype),E(cm.prototype,"diffuseMap",[Yg,_s,vs,qg,Xg],Object.getOwnPropertyDescriptor(cm.prototype,"diffuseMap"),cm.prototype),E(cm.prototype,"reflectionMap",[Qg,_s,vs,$g,Zg],Object.getOwnPropertyDescriptor(cm.prototype,"reflectionMap"),cm.prototype),E(cm.prototype,"skyboxMaterial",[_s,Jg,tm],Object.getOwnPropertyDescriptor(cm.prototype,"skyboxMaterial"),cm.prototype),lm=E(cm.prototype,"_envLightingType",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return n_.HEMISPHERE_DIFFUSE}}),fm=E(cm.prototype,"_envmapHDR",[is,em,nm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pm=E(cm.prototype,"_envmapLDR",[is,im],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_m=E(cm.prototype,"_diffuseMapHDR",[is,rm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dm=E(cm.prototype,"_diffuseMapLDR",[is,sm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vm=E(cm.prototype,"_enabled",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gm=E(cm.prototype,"_useHDR",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mm=E(cm.prototype,"_editableMaterial",[is,om],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ym=E(cm.prototype,"_reflectionHDR",[is,am],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bm=E(cm.prototype,"_reflectionLDR",[is,um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Em=E(cm.prototype,"_rotationAngle",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hm=cm))||hm));i.SkyboxInfo=Ib;var Cb=t("ax",(wm=Xr("cc.FogInfo"),Am=ms(),Im=ws(),Cm=ms(),Om=ws(),Sm=ms(),Rm=Rs(l_),xm=ws(),Nm=ms(),Mm=ds(),Pm=Rs(c),Dm=ys(),Lm=Es(),km=ms(),Fm=ds(),Bm=Rs(c),Um=Es(),zm=ms(),Hm=ds(),Vm=Rs(c),Gm=Es(),jm=ms(),Wm=ds(),Km=Rs(c),Ym=bs(),qm=Es(),Xm=ms(),Qm=ds(),$m=Rs(c),Zm=Es(),Jm=ms(),ty=ds(),ey=Rs(c),ny=Es(),iy=ms(),wm((gy=vy=function(){function t(){T(this,"_type",oy,this),T(this,"_fogColor",ay,this),T(this,"_enabled",uy,this),T(this,"_fogDensity",hy,this),T(this,"_fogStart",cy,this),T(this,"_fogEnd",ly,this),T(this,"_fogAtten",fy,this),T(this,"_fogTop",py,this),T(this,"_fogRange",_y,this),T(this,"_accurate",dy,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate!==t&&(this._accurate=t,this._resource&&(this._resource.accurate=t,t&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),vy.FogType=l_,E((sy=gy).prototype,"enabled",[_s,Am,Im],Object.getOwnPropertyDescriptor(sy.prototype,"enabled"),sy.prototype),E(sy.prototype,"accurate",[_s,Cm,Om],Object.getOwnPropertyDescriptor(sy.prototype,"accurate"),sy.prototype),E(sy.prototype,"fogColor",[_s,Sm],Object.getOwnPropertyDescriptor(sy.prototype,"fogColor"),sy.prototype),E(sy.prototype,"type",[_s,Rm,xm,Nm],Object.getOwnPropertyDescriptor(sy.prototype,"type"),sy.prototype),E(sy.prototype,"fogDensity",[Mm,Pm,Dm,Lm,Ts,km],Object.getOwnPropertyDescriptor(sy.prototype,"fogDensity"),sy.prototype),E(sy.prototype,"fogStart",[Fm,Bm,Um,zm],Object.getOwnPropertyDescriptor(sy.prototype,"fogStart"),sy.prototype),E(sy.prototype,"fogEnd",[Hm,Vm,Gm,jm],Object.getOwnPropertyDescriptor(sy.prototype,"fogEnd"),sy.prototype),E(sy.prototype,"fogAtten",[Wm,Km,Ym,qm,Xm],Object.getOwnPropertyDescriptor(sy.prototype,"fogAtten"),sy.prototype),E(sy.prototype,"fogTop",[Qm,$m,Zm,Jm],Object.getOwnPropertyDescriptor(sy.prototype,"fogTop"),sy.prototype),E(sy.prototype,"fogRange",[ty,ey,ny,iy],Object.getOwnPropertyDescriptor(sy.prototype,"fogRange"),sy.prototype),oy=E(sy.prototype,"_type",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return l_.LINEAR}}),ay=E(sy.prototype,"_fogColor",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be("#C8C8C8")}}),uy=E(sy.prototype,"_enabled",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hy=E(sy.prototype,"_fogDensity",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),cy=E(sy.prototype,"_fogStart",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ly=E(sy.prototype,"_fogEnd",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),fy=E(sy.prototype,"_fogAtten",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),py=E(sy.prototype,"_fogTop",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),_y=E(sy.prototype,"_fogRange",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),dy=E(sy.prototype,"_accurate",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ry=sy))||ry)),Ob=t("ay",(my=Xr("cc.ShadowsInfo"),yy=ms(),by=ms(),Ey=Rs(s_),Ty=ms(),wy=ds(),Ay=ms(),Iy=ds(),Cy=ms(),Oy=Rs(c),Sy=ds(),Ry=ms(),xy=Rs(p),Ny=ds(),My=ms(),Py=Rs(r_),Dy=ds(),my((jy=function(){function t(){T(this,"_enabled",Fy,this),T(this,"_type",By,this),T(this,"_normal",Uy,this),T(this,"_distance",zy,this),T(this,"_shadowColor",Hy,this),T(this,"_maxReceived",Vy,this),T(this,"_size",Gy,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(Tb),this.planeDirection=Oe.transformQuat(yb,mb,Tb),t.getWorldPosition(yb),this.planeHeight=Oe.dot(this._normal,yb)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){Oe.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){this._size.set(t,t),this._resource&&(this._resource.size.set(t,t),this._resource.shadowMapDirty=!0)}}]),t}(),E((ky=jy).prototype,"enabled",[_s,yy],Object.getOwnPropertyDescriptor(ky.prototype,"enabled"),ky.prototype),E(ky.prototype,"type",[by,_s,Ey],Object.getOwnPropertyDescriptor(ky.prototype,"type"),ky.prototype),E(ky.prototype,"shadowColor",[Ty,wy],Object.getOwnPropertyDescriptor(ky.prototype,"shadowColor"),ky.prototype),E(ky.prototype,"planeDirection",[Ay,Iy],Object.getOwnPropertyDescriptor(ky.prototype,"planeDirection"),ky.prototype),E(ky.prototype,"planeHeight",[Cy,_s,Oy,Sy],Object.getOwnPropertyDescriptor(ky.prototype,"planeHeight"),ky.prototype),E(ky.prototype,"maxReceived",[Ry,xy,Ny],Object.getOwnPropertyDescriptor(ky.prototype,"maxReceived"),ky.prototype),E(ky.prototype,"shadowMapSize",[My,Py,Dy],Object.getOwnPropertyDescriptor(ky.prototype,"shadowMapSize"),ky.prototype),Fy=E(ky.prototype,"_enabled",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),By=E(ky.prototype,"_type",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s_.Planar}}),Uy=E(ky.prototype,"_normal",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(0,1,0)}}),zy=E(ky.prototype,"_distance",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hy=E(ky.prototype,"_shadowColor",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be(0,0,0,76)}}),Vy=E(ky.prototype,"_maxReceived",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),Gy=E(ky.prototype,"_size",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Fe(1024,1024)}}),Ly=ky))||Ly));i.ShadowsInfo=Ob;var Sb=t("az",new Oe(-1024,-1024,-1024)),Rb=t("aA",new Oe(1024,1024,1024)),xb=t("aB",8),Nb=t("aC",(Wy=Xr("cc.OctreeInfo"),Ky=ms(),Yy=ms(),qy=gs(),Xy=ms(),Qy=gs(),$y=ys(),Zy=Rs(p),Jy=ms(),Wy((ob=function(){function t(){T(this,"_enabled",nb,this),T(this,"_minPos",ib,this),T(this,"_maxPos",rb,this),T(this,"_depth",sb,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},n(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),E((eb=ob).prototype,"enabled",[_s,Ky],Object.getOwnPropertyDescriptor(eb.prototype,"enabled"),eb.prototype),E(eb.prototype,"minPos",[_s,Yy,qy],Object.getOwnPropertyDescriptor(eb.prototype,"minPos"),eb.prototype),E(eb.prototype,"maxPos",[_s,Xy,Qy],Object.getOwnPropertyDescriptor(eb.prototype,"maxPos"),eb.prototype),E(eb.prototype,"depth",[_s,$y,Ts,Zy,Jy],Object.getOwnPropertyDescriptor(eb.prototype,"depth"),eb.prototype),nb=E(eb.prototype,"_enabled",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ib=E(eb.prototype,"_minPos",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(Sb)}}),rb=E(eb.prototype,"_maxPos",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(Rb)}}),sb=E(eb.prototype,"_depth",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xb}}),tb=eb))||tb)),Mb=t("aD",(ab=Xr("cc.SceneGlobals"),ub=Rs(Ib),ab((vb=function(){function t(){T(this,"ambient",lb,this),T(this,"shadows",fb,this),T(this,"_skybox",pb,this),T(this,"fog",_b,this),T(this,"octree",db,this)}return t.prototype.activate=function(){var t=i.director.root.pipeline.pipelineSceneData;this.skybox.activate(t.skybox),this.ambient.activate(t.ambient),this.shadows.activate(t.shadows),this.fog.activate(t.fog),this.octree.activate(t.octree),i.director.root.onGlobalPipelineStateChanged()},n(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),lb=E((cb=vb).prototype,"ambient",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ab}}),fb=E(cb.prototype,"shadows",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ob}}),pb=E(cb.prototype,"_skybox",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ib}}),_b=E(cb.prototype,"fog",[_s,is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cb}}),E(cb.prototype,"skybox",[_s,ub],Object.getOwnPropertyDescriptor(cb.prototype,"skybox"),cb.prototype),db=E(cb.prototype,"octree",[_s,is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Nb}}),hb=cb))||hb));i.SceneGlobals=Mb,Ye({SystemEventType:{newName:"Input.EventType",since:"3.3.0",removed:!1}}),Ye({SystemEvent:{newName:"Input",since:"3.4.0",removed:!1},systemEvent:{newName:"input",since:"3.4.0",removed:!1}});var Pb=function(){function t(){this._isStarted=!1,this._accelMode="normal",this._eventTarget=new Ee,this._didAccelerateFunc=void 0,this._didAccelerateFunc=this._didAccelerate.bind(this)}var e=t.prototype;return e._registerEvent=function(){Te.onAccelerometerChange(this._didAccelerateFunc)},e._unregisterEvent=function(){Te.offAccelerometerChange(this._didAccelerateFunc)},e._didAccelerate=function(t){var e=performance.now(),n=new lg(t.x,t.y,t.z,e),i=new pn(n);this._eventTarget.emit(fn.DEVICEMOTION,i)},e.start=function(){var t=this;this._registerEvent(),Te.startAccelerometer({interval:this._accelMode,success:function(){t._isStarted=!0}})},e.stop=function(){var t=this;Te.stopAccelerometer({success:function(){t._isStarted=!1},fail:function(){console.error("failed to stop accelerometer")}}),this._unregisterEvent()},e.setInterval=function(t){this._accelMode=t>=200?"normal":t>=60?"ui":"game",this._isStarted&&(this.stop(),this.start())},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),Db=function(){},Lb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(Db),kb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(Db),Fb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(Db),Bb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(Db),Ub=function(t){function e(e){var n;return(n=t.call(this)||this).positive=void 0,n.negative=void 0,n.positive=e.positive,n.negative=e.negative,n}return m(e,t),e.prototype.getValue=function(){var t=this.positive.getValue(),e=this.negative.getValue();return Math.abs(t)>Math.abs(e)?t:-e},e}(Lb),zb=function(t){function e(e){var n;return(n=t.call(this)||this).up=void 0,n.down=void 0,n.left=void 0,n.right=void 0,n.xAxis=void 0,n.yAxis=void 0,n.up=e.up,n.down=e.down,n.left=e.left,n.right=e.right,n.xAxis=new Ub({positive:n.right,negative:n.left}),n.yAxis=new Ub({positive:n.up,negative:n.down}),n}return m(e,t),e.prototype.getValue=function(){return new Fe(this.xAxis.getValue(),this.yAxis.getValue())},e}(kb),Hb=(function(t){function e(e){var n;return(n=t.call(this)||this).up=void 0,n.down=void 0,n.left=void 0,n.right=void 0,n.forward=void 0,n.backward=void 0,n.xAxis=void 0,n.yAxis=void 0,n.zAxis=void 0,n.up=e.up,n.down=e.down,n.left=e.left,n.right=e.right,n.forward=e.forward,n.backward=e.backward,n.xAxis=new Ub({positive:n.right,negative:n.left}),n.yAxis=new Ub({positive:n.up,negative:n.down}),n.zAxis=new Ub({positive:n.forward,negative:n.backward}),n}m(e,t),e.prototype.getValue=function(){return new Oe(this.xAxis.getValue(),this.yAxis.getValue(),this.zAxis.getValue())}}(Fb),function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){return t.prototype.getValue.call(this)},e}(Lb)),Vb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(zb),Gb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e}(zb),jb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){return t.prototype.getValue.call(this)},e}(Bb),Wb=function(t){function e(){return t.apply(this,arguments)||this}return m(e,t),e.prototype.getValue=function(){return t.prototype.getValue.call(this)},e}(Fb),Kb=function(){function t(t){this._deviceId=-1,this._connected=!1,this._deviceId=t,this._initInputSource()}return t._init=function(){},t._on=function(e,n,i){t._eventTarget.on(e,n,i)},t.prototype._initInputSource=function(){this._buttonNorth=new Hb,this._buttonNorth.getValue=function(){return 0},this._buttonEast=new Hb,this._buttonEast.getValue=function(){return 0},this._buttonWest=new Hb,this._buttonWest.getValue=function(){return 0},this._buttonSouth=new Hb,this._buttonSouth.getValue=function(){return 0},this._buttonL1=new Hb,this._buttonL1.getValue=function(){return 0},this._buttonL2=new Hb,this._buttonL2.getValue=function(){return 0},this._buttonL3=new Hb,this._buttonL3.getValue=function(){return 0},this._buttonR1=new Hb,this._buttonR1.getValue=function(){return 0},this._buttonR2=new Hb,this._buttonR2.getValue=function(){return 0},this._buttonR3=new Hb,this._buttonR3.getValue=function(){return 0},this._buttonShare=new Hb,this._buttonShare.getValue=function(){return 0},this._buttonOptions=new Hb,this._buttonOptions.getValue=function(){return 0};var t=new Hb;t.getValue=function(){return 0};var e=new Hb;e.getValue=function(){return 0};var n=new Hb;n.getValue=function(){return 0};var i=new Hb;i.getValue=function(){return 0},this._dpad=new Vb({up:t,down:e,left:n,right:i});var r=new Hb;r.getValue=function(){return 0};var s=new Hb;s.getValue=function(){return 0};var o=new Hb;o.getValue=function(){return 0};var a=new Hb;a.getValue=function(){return 0},this._leftStick=new Gb({up:r,down:s,left:o,right:a});var u=new Hb;u.getValue=function(){return 0};var h=new Hb;h.getValue=function(){return 0};var c=new Hb;c.getValue=function(){return 0};var l=new Hb;l.getValue=function(){return 0},this._rightStick=new Gb({up:u,down:h,left:c,right:l}),this._buttonStart=new Hb,this._buttonStart.getValue=function(){return 0}},n(t,[{key:"buttonNorth",get:function(){return this._buttonNorth}},{key:"buttonEast",get:function(){return this._buttonEast}},{key:"buttonWest",get:function(){return this._buttonWest}},{key:"buttonSouth",get:function(){return this._buttonSouth}},{key:"buttonL1",get:function(){return this._buttonL1}},{key:"buttonL2",get:function(){return this._buttonL2}},{key:"buttonL3",get:function(){return this._buttonL3}},{key:"buttonR1",get:function(){return this._buttonR1}},{key:"buttonR2",get:function(){return this._buttonR2}},{key:"buttonR3",get:function(){return this._buttonR3}},{key:"buttonShare",get:function(){return this._buttonShare}},{key:"buttonOptions",get:function(){return this._buttonOptions}},{key:"dpad",get:function(){return this._dpad}},{key:"leftStick",get:function(){return this._leftStick}},{key:"rightStick",get:function(){return this._rightStick}},{key:"buttonStart",get:function(){return this._buttonStart}},{key:"deviceId",get:function(){return this._deviceId}},{key:"connected",get:function(){return this._connected}}]),t}();Kb.all=[],Kb._eventTarget=new Ee;var Yb=function(){function t(){this._eventTarget=new Ee,this._initInputSource()}var e=t.prototype;return e._on=function(t,e,n){this._eventTarget.on(t,e,n)},e._initInputSource=function(){this._buttonNorth=new Hb,this._buttonNorth.getValue=function(){return 0},this._buttonEast=new Hb,this._buttonEast.getValue=function(){return 0},this._buttonWest=new Hb,this._buttonWest.getValue=function(){return 0},this._buttonSouth=new Hb,this._buttonSouth.getValue=function(){return 0},this._buttonTriggerLeft=new Hb,this._buttonTriggerLeft.getValue=function(){return 0},this._buttonTriggerRight=new Hb,this._buttonTriggerRight.getValue=function(){return 0},this._triggerLeft=new Hb,this._triggerLeft.getValue=function(){return 0},this._triggerRight=new Hb,this._triggerRight.getValue=function(){return 0},this._gripLeft=new Hb,this._gripLeft.getValue=function(){return 0},this._gripRight=new Hb,this._gripRight.getValue=function(){return 0},this._buttonLeftStick=new Hb,this._buttonLeftStick.getValue=function(){return 0};var t=new Hb;t.getValue=function(){return 0};var e=new Hb;e.getValue=function(){return 0};var n=new Hb;n.getValue=function(){return 0};var i=new Hb;i.getValue=function(){return 0},this._leftStick=new Gb({up:t,down:e,left:n,right:i}),this._buttonRightStick=new Hb,this._buttonRightStick.getValue=function(){return 0};var r=new Hb;r.getValue=function(){return 0};var s=new Hb;s.getValue=function(){return 0};var o=new Hb;o.getValue=function(){return 0};var a=new Hb;a.getValue=function(){return 0},this._rightStick=new Gb({up:r,down:s,left:o,right:a}),this._handLeftPosition=new Wb,this._handLeftPosition.getValue=function(){return Oe.ZERO},this._handLeftOrientation=new jb,this._handLeftOrientation.getValue=function(){return Le.IDENTITY},this._handRightPosition=new Wb,this._handRightPosition.getValue=function(){return Oe.ZERO},this._handRightOrientation=new jb,this._handRightOrientation.getValue=function(){return Le.IDENTITY},this._aimLeftPosition=new Wb,this._aimLeftPosition.getValue=function(){return Oe.ZERO},this._aimLeftOrientation=new jb,this._aimLeftOrientation.getValue=function(){return Le.IDENTITY},this._aimRightPosition=new Wb,this._aimRightPosition.getValue=function(){return Oe.ZERO},this._aimRightOrientation=new jb,this._aimRightOrientation.getValue=function(){return Le.IDENTITY}},n(t,[{key:"buttonNorth",get:function(){return this._buttonNorth}},{key:"buttonEast",get:function(){return this._buttonEast}},{key:"buttonWest",get:function(){return this._buttonWest}},{key:"buttonSouth",get:function(){return this._buttonSouth}},{key:"buttonTriggerLeft",get:function(){return this._buttonTriggerLeft}},{key:"buttonTriggerRight",get:function(){return this._buttonTriggerRight}},{key:"triggerLeft",get:function(){return this._triggerLeft}},{key:"triggerRight",get:function(){return this._triggerRight}},{key:"gripLeft",get:function(){return this._gripLeft}},{key:"gripRight",get:function(){return this._gripRight}},{key:"leftStick",get:function(){return this._leftStick}},{key:"rightStick",get:function(){return this._rightStick}},{key:"buttonLeftStick",get:function(){return this._buttonLeftStick}},{key:"buttonRightStick",get:function(){return this._buttonRightStick}},{key:"handLeftPosition",get:function(){return this._handLeftPosition}},{key:"handLeftOrientation",get:function(){return this._handLeftOrientation}},{key:"handRightPosition",get:function(){return this._handRightPosition}},{key:"handRightOrientation",get:function(){return this._handRightOrientation}},{key:"aimLeftPosition",get:function(){return this._aimLeftPosition}},{key:"aimLeftOrientation",get:function(){return this._aimLeftOrientation}},{key:"aimRightPosition",get:function(){return this._aimRightPosition}},{key:"aimRightOrientation",get:function(){return this._aimRightOrientation}}]),t}(),qb=function(){function t(){this._eventTarget=new Ee,this._initInputSource()}var e=t.prototype;return e._on=function(t,e,n){this._eventTarget.on(t,e,n)},e._initInputSource=function(){this._viewLeftPosition=new Wb,this._viewLeftPosition.getValue=function(){return Oe.ZERO},this._viewLeftOrientation=new jb,this._viewLeftOrientation.getValue=function(){return Le.IDENTITY},this._viewRightPosition=new Wb,this._viewRightPosition.getValue=function(){return Oe.ZERO},this._viewRightOrientation=new jb,this._viewRightOrientation.getValue=function(){return Le.IDENTITY},this._headMiddlePosition=new Wb,this._headMiddlePosition.getValue=function(){return Oe.ZERO},this._headMiddleOrientation=new jb,this._headMiddleOrientation.getValue=function(){return Le.IDENTITY}},n(t,[{key:"viewLeftPosition",get:function(){return this._viewLeftPosition}},{key:"viewLeftOrientation",get:function(){return this._viewLeftOrientation}},{key:"viewRightPosition",get:function(){return this._viewRightPosition}},{key:"viewRightOrientation",get:function(){return this._viewRightOrientation}},{key:"headMiddlePosition",get:function(){return this._headMiddlePosition}},{key:"headMiddleOrientation",get:function(){return this._headMiddleOrientation}}]),t}(),Xb={Backspace:_n.BACKSPACE,Tab:_n.TAB,Enter:_n.ENTER,ShiftLeft:_n.SHIFT_LEFT,ControlLeft:_n.CTRL_LEFT,AltLeft:_n.ALT_LEFT,ShiftRight:_n.SHIFT_RIGHT,ControlRight:_n.CTRL_RIGHT,AltRight:_n.ALT_RIGHT,Pause:_n.PAUSE,CapsLock:_n.CAPS_LOCK,Escape:_n.ESCAPE,Space:_n.SPACE,PageUp:_n.PAGE_UP,PageDown:_n.PAGE_DOWN,End:_n.END,Home:_n.HOME,ArrowLeft:_n.ARROW_LEFT,ArrowUp:_n.ARROW_UP,ArrowRight:_n.ARROW_RIGHT,ArrowDown:_n.ARROW_DOWN,Insert:_n.INSERT,Delete:_n.DELETE,Digit0:_n.DIGIT_0,Digit1:_n.DIGIT_1,Digit2:_n.DIGIT_2,Digit3:_n.DIGIT_3,Digit4:_n.DIGIT_4,Digit5:_n.DIGIT_5,Digit6:_n.DIGIT_6,Digit7:_n.DIGIT_7,Digit8:_n.DIGIT_8,Digit9:_n.DIGIT_9,KeyA:_n.KEY_A,KeyB:_n.KEY_B,KeyC:_n.KEY_C,KeyD:_n.KEY_D,KeyE:_n.KEY_E,KeyF:_n.KEY_F,KeyG:_n.KEY_G,KeyH:_n.KEY_H,KeyI:_n.KEY_I,KeyJ:_n.KEY_J,KeyK:_n.KEY_K,KeyL:_n.KEY_L,KeyM:_n.KEY_M,KeyN:_n.KEY_N,KeyO:_n.KEY_O,KeyP:_n.KEY_P,KeyQ:_n.KEY_Q,KeyR:_n.KEY_R,KeyS:_n.KEY_S,KeyT:_n.KEY_T,KeyU:_n.KEY_U,KeyV:_n.KEY_V,KeyW:_n.KEY_W,KeyX:_n.KEY_X,KeyY:_n.KEY_Y,KeyZ:_n.KEY_Z,Numpad0:_n.NUM_0,Numpad1:_n.NUM_1,Numpad2:_n.NUM_2,Numpad3:_n.NUM_3,Numpad4:_n.NUM_4,Numpad5:_n.NUM_5,Numpad6:_n.NUM_6,Numpad7:_n.NUM_7,Numpad8:_n.NUM_8,Numpad9:_n.NUM_9,NumpadMultiply:_n.NUM_MULTIPLY,NumpadAdd:_n.NUM_PLUS,NumpadSubtract:_n.NUM_SUBTRACT,NumpadDecimal:_n.NUM_DECIMAL,NumpadDivide:_n.NUM_DIVIDE,NumpadEnter:_n.NUM_ENTER,F1:_n.F1,F2:_n.F2,F3:_n.F3,F4:_n.F4,F5:_n.F5,F6:_n.F6,F7:_n.F7,F8:_n.F8,F9:_n.F9,F10:_n.F10,F11:_n.F11,F12:_n.F12,NumLock:_n.NUM_LOCK,ScrollLock:_n.SCROLL_LOCK,Semicolon:_n.SEMICOLON,Equal:_n.EQUAL,Comma:_n.COMMA,Minus:_n.DASH,Period:_n.PERIOD,Slash:_n.SLASH,Backquote:_n.BACK_QUOTE,BracketLeft:_n.BRACKET_LEFT,Backslash:_n.BACKSLASH,BracketRight:_n.BRACKET_RIGHT,Quote:_n.QUOTE};function Qb(t){return Xb[t]||_n.NONE}var $b,Zb,Jb=function(){function t(){this._eventTarget=new Ee,this._keyStateMap={},ht.hasFeature(we.EVENT_KEYBOARD)&&this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){var t,e,n,i,r=this;null===(t=Te.wx)||void 0===t||null===(e=t.onKeyDown)||void 0===e||e.call(t,(function(t){var e=Qb(t.code);if(r._keyStateMap[e]){var n=r._getInputEvent(t,fn.KEY_PRESSING);r._eventTarget.emit(fn.KEY_PRESSING,n)}else{var i=r._getInputEvent(t,fn.KEY_DOWN);r._eventTarget.emit(fn.KEY_DOWN,i)}r._keyStateMap[e]=!0})),null===(n=Te.wx)||void 0===n||null===(i=n.onKeyUp)||void 0===i||i.call(n,(function(t){var e=Qb(t.code),n=r._getInputEvent(t,fn.KEY_UP);r._keyStateMap[e]=!1,r._eventTarget.emit(fn.KEY_UP,n)}))},e._getInputEvent=function(t,e){var n=Qb(t.code);return new dn(n,e)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),tE=function(){function t(){this._eventTarget=new Ee,this._isPressed=!1,this._preMousePos=new Fe,ht.hasFeature(we.EVENT_MOUSE)&&this._registerEvent()}var e=t.prototype;return e._getLocation=function(t){var e=cn.windowSize,n=cn.devicePixelRatio,i=t.x*n,r=e.height-t.y*n;return new Fe(i,r)},e._registerEvent=function(){var t,e,n,i,r,s,o,a;null===(t=Te.wx)||void 0===t||null===(e=t.onMouseDown)||void 0===e||e.call(t,this._createCallback(fn.MOUSE_DOWN)),null===(n=Te.wx)||void 0===n||null===(i=n.onMouseMove)||void 0===i||i.call(n,this._createCallback(fn.MOUSE_MOVE)),null===(r=Te.wx)||void 0===r||null===(s=r.onMouseUp)||void 0===s||s.call(r,this._createCallback(fn.MOUSE_UP)),null===(o=Te.wx)||void 0===o||null===(a=o.onWheel)||void 0===a||a.call(o,this._handleMouseWheel.bind(this))},e._createCallback=function(t){var e=this;return function(n){var i=e._getLocation(n),r=n.button;switch(t){case fn.MOUSE_DOWN:e._isPressed=!0;break;case fn.MOUSE_UP:e._isPressed=!1;break;case fn.MOUSE_MOVE:e._isPressed||(r=vn.BUTTON_MISSING)}var s=new vn(t,!1,e._preMousePos);s.setLocation(i.x,i.y),s.setButton(r),s.movementX=i.x-e._preMousePos.x,s.movementY=e._preMousePos.y-i.y,e._preMousePos.set(i.x,i.y),e._eventTarget.emit(t,s)}},e._handleMouseWheel=function(t){var e=fn.MOUSE_WHEEL,n=this._getLocation(t),i=t.button,r=new vn(e,!1,this._preMousePos);r.setLocation(n.x,n.y),r.setButton(i),r.movementX=n.x-this._preMousePos.x,r.movementY=this._preMousePos.y-n.y,r.setScrollData(t.deltaX,t.deltaY),this._preMousePos.set(n.x,n.y),this._eventTarget.emit(fn.MOUSE_WHEEL,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),eE=new Fe,nE=new(function(){function t(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}var e=t.prototype;return e._cloneTouch=function(t){var e=t.getID();t.getStartLocation(eE);var n=new gn(eE.x,eE.y,e);return t.getLocation(eE),n.setPoint(eE.x,eE.y),t.getPreviousLocation(eE),n.setPrevPoint(eE),n},e._createTouch=function(t,e,n){if(this._touchMap.has(t))console.log("Cannot create the same touch object.");else{if(!this._checkTouchMapSizeMoreThanMax(t)){var i=new gn(e,n,t);return this._touchMap.set(t,i),this._updateTouch(i,e,n),this._cloneTouch(i)}console.log("The touches is more than MAX_TOUCHES.")}},e.releaseTouch=function(t){this._touchMap.has(t)&&this._touchMap.delete(t)},e.getTouch=function(t,e,n){var i=this._touchMap.get(t);return i?this._updateTouch(i,e,n):i=this._createTouch(t,e,n),i?this._cloneTouch(i):void 0},e.getAllTouches=function(){var t=this,e=[];return this._touchMap.forEach((function(n){if(n){var i=t._cloneTouch(n);e.push(i)}})),e},e._updateTouch=function(t,e,n){t.getLocation(eE),t.setPrevPoint(eE),t.setPoint(e,n)},e._checkTouchMapSizeMoreThanMax=function(t){var e=this;if(this._touchMap.has(t))return!1;var n=j.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<n)return!1;var i=performance.now();return this._touchMap.forEach((function(t){i-t.lastModified>j.TOUCH_TIMEOUT&&(console.log("The touches is more than MAX_TOUCHES, release touch id "+t.getID()+"."),e.releaseTouch(t.getID()))})),n>=this._touchMap.size},t}()),iE=function(){function t(){this._eventTarget=new Ee,this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){Te.onTouchStart(this._createCallback(fn.TOUCH_START)),Te.onTouchMove(this._createCallback(fn.TOUCH_MOVE)),Te.onTouchEnd(this._createCallback(fn.TOUCH_END)),Te.onTouchCancel(this._createCallback(fn.TOUCH_CANCEL))},e._createCallback=function(t){var e=this;return function(n){for(var i=[],r=cn.windowSize,s=cn.devicePixelRatio,o=n.changedTouches.length,a=0;a<o;++a){var u=n.changedTouches[a],h=u.identifier;if(null!==h){var c=e._getLocation(u,r,s),l=nE.getTouch(h,c.x,c.y);l&&(t!==fn.TOUCH_END&&t!==fn.TOUCH_CANCEL||nE.releaseTouch(h),i.push(l))}}if(i.length>0){var f=new ln(i,!1,t,j.ENABLE_MULTI_TOUCH?nE.getAllTouches():i);e._eventTarget.emit(t,f)}}},e._getLocation=function(t,e,n){var i=t.clientX*n,r=e.height-t.clientY*n;return new Fe(i,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}();!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.UI=1]="UI"}(Zb||(Zb=t("cj",{})));var rE=function(){function t(t){this.priority=Zb.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=t}return t.prototype.dispatchEvent=function(t){return this._inputEventTarget.emit(t.type,t),!0},t}(),sE=(($b={})[fn.MOUSE_DOWN]=fn.TOUCH_START,$b[fn.MOUSE_MOVE]=fn.TOUCH_MOVE,$b[fn.MOUSE_UP]=fn.TOUCH_END,$b),oE=t("aW",function(){function t(){this._dispatchImmediately=!st,this._eventTarget=new Ee,this._touchInput=new iE,this._mouseInput=new tE,this._keyboardInput=new Jb,this._accelerometerInput=new Pb,this._handleInput=new Yb,this._hmdInput=new qb,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._eventGamepadList=[],this._eventHandleList=[],this._eventHMDList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new rE(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher),Kb._init()}var e=t.prototype;return e._dispatchMouseDownEvent=function(t){var e,n;null===(e=(n=this._mouseInput).dispatchMouseDownEvent)||void 0===e||e.call(n,t)},e._dispatchMouseMoveEvent=function(t){var e,n;null===(e=(n=this._mouseInput).dispatchMouseMoveEvent)||void 0===e||e.call(n,t)},e._dispatchMouseUpEvent=function(t){var e,n;null===(e=(n=this._mouseInput).dispatchMouseUpEvent)||void 0===e||e.call(n,t)},e._dispatchMouseScrollEvent=function(t){var e,n;null===(e=(n=this._mouseInput).dispatchScrollEvent)||void 0===e||e.call(n,t)},e._dispatchKeyboardDownEvent=function(t){var e,n;null===(e=(n=this._keyboardInput).dispatchKeyboardDownEvent)||void 0===e||e.call(n,t)},e._dispatchKeyboardUpEvent=function(t){var e,n;null===(e=(n=this._keyboardInput).dispatchKeyboardUpEvent)||void 0===e||e.call(n,t)},e.on=function(t,e,n){return this._eventTarget.on(t,e,n),e},e.once=function(t,e,n){return this._eventTarget.once(t,e,n),e},e.off=function(t,e,n){this._eventTarget.off(t,e,n)},e.setAccelerometerEnabled=function(t){t?this._accelerometerInput.start():this._accelerometerInput.stop()},e.setAccelerometerInterval=function(t){this._accelerometerInput.setInterval(t)},e._simulateEventTouch=function(t){var e=sE[t.type],n=nE.getTouch(0,t.getLocationX(),t.getLocationY());if(n){var i=[n],r=new ln(i,!1,e,e===fn.TOUCH_END?[]:i);e===fn.TOUCH_END&&nE.releaseTouch(0),this._dispatchOrPushEventTouch(r,this._eventTouchList)}},e._registerEventDispatcher=function(t){this._eventDispatcherList.push(t),this._eventDispatcherList.sort((function(t,e){return e.priority-t.priority}))},e._emitEvent=function(t){for(var e=this._eventDispatcherList.length,n=0;n<e&&this._eventDispatcherList[n].dispatchEvent(t);++n);},e._registerEvent=function(){var t=this;if(Xe.hasFeature(Xe.Feature.INPUT_TOUCH)){var e=this._eventTouchList;this._touchInput.on(fn.TOUCH_START,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(fn.TOUCH_MOVE,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(fn.TOUCH_END,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(fn.TOUCH_CANCEL,(function(n){t._dispatchOrPushEventTouch(n,e)}))}if(Xe.hasFeature(Xe.Feature.EVENT_MOUSE)){var n=this._eventMouseList;this._mouseInput.on(fn.MOUSE_DOWN,(function(e){t._needSimulateTouchMoveEvent=!0,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(fn.MOUSE_MOVE,(function(e){t._needSimulateTouchMoveEvent&&t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(fn.MOUSE_UP,(function(e){t._needSimulateTouchMoveEvent=!1,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(fn.MOUSE_WHEEL,(function(e){t._dispatchOrPushEvent(e,n)}))}if(Xe.hasFeature(Xe.Feature.EVENT_KEYBOARD)){var i=this._eventKeyboardList;this._keyboardInput.on(fn.KEY_DOWN,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(fn.KEY_PRESSING,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(fn.KEY_UP,(function(e){t._dispatchOrPushEvent(e,i)}))}if(Xe.hasFeature(Xe.Feature.EVENT_ACCELEROMETER)){var r=this._eventAccelerationList;this._accelerometerInput.on(fn.DEVICEMOTION,(function(e){t._dispatchOrPushEvent(e,r)}))}if(Xe.hasFeature(Xe.Feature.EVENT_GAMEPAD)){var s=this._eventGamepadList;Kb._on(fn.GAMEPAD_CHANGE,(function(e){t._dispatchOrPushEvent(e,s)})),Kb._on(fn.GAMEPAD_INPUT,(function(e){t._dispatchOrPushEvent(e,s)}))}if(Xe.hasFeature(Xe.Feature.EVENT_HANDLE)){var o=this._eventHandleList;this._handleInput._on(fn.HANDLE_INPUT,(function(e){t._dispatchOrPushEvent(e,o)})),this._handleInput._on(fn.HANDLE_POSE_INPUT,(function(e){t._dispatchOrPushEvent(e,o)}))}if(Xe.hasFeature(Xe.Feature.EVENT_HMD)){var a=this._eventHMDList;this._hmdInput._on(fn.HMD_POSE_INPUT,(function(e){t._dispatchOrPushEvent(e,a)}))}},e._clearEvents=function(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0,this._eventGamepadList.length=0,this._eventHandleList.length=0,this._eventHMDList.length=0},e._dispatchOrPushEvent=function(t,e){this._dispatchImmediately?this._emitEvent(t):e.push(t)},e._dispatchOrPushEventTouch=function(t,e){if(this._dispatchImmediately)for(var n=t.getTouches(),i=n.length,r=0;r<i;++r)t.touch=n[r],t.propagationStopped=t.propagationImmediateStopped=!1,this._emitEvent(t);else e.push(t)},e._frameDispatchEvents=function(){for(var t=this._eventMouseList,e=0,n=t.length;e<n;++e){var i=t[e];this._emitEvent(i)}for(var r=this._eventTouchList,s=0,o=r.length;s<o;++s)for(var a=r[s],u=a.getTouches(),h=u.length,c=0;c<h;++c)a.touch=u[c],a.propagationStopped=a.propagationImmediateStopped=!1,this._emitEvent(a);for(var l=this._eventKeyboardList,f=0,p=l.length;f<p;++f){var _=l[f];this._emitEvent(_)}for(var d=this._eventAccelerationList,v=0,g=d.length;v<g;++v){var m=d[v];this._emitEvent(m)}for(var y=this._eventGamepadList,b=0,E=y.length;b<E;++b){var T=y[b];this._emitEvent(T)}for(var w=this._eventHandleList,A=0,I=w.length;A<I;++A){var C=w[A];this._emitEvent(C)}for(var O=this._eventHMDList,S=0,R=O.length;S<R;++S){var x=O[S];this._emitEvent(x)}this._clearEvents()},t}());oE.EventType=fn;var aE=t("aV",new oE),uE=t("aY",function(t){function e(){var e;return e=t.call(this)||this,aE.on(fn.MOUSE_DOWN,(function(t){e.emit(mn.MOUSE_DOWN,t)})),aE.on(fn.MOUSE_MOVE,(function(t){e.emit(mn.MOUSE_MOVE,t)})),aE.on(fn.MOUSE_UP,(function(t){e.emit(mn.MOUSE_UP,t)})),aE.on(fn.MOUSE_WHEEL,(function(t){e.emit(mn.MOUSE_WHEEL,t)})),aE.on(fn.TOUCH_START,(function(t){e.emit(mn.TOUCH_START,t.touch,t)})),aE.on(fn.TOUCH_MOVE,(function(t){e.emit(mn.TOUCH_MOVE,t.touch,t)})),aE.on(fn.TOUCH_END,(function(t){e.emit(mn.TOUCH_END,t.touch,t)})),aE.on(fn.TOUCH_CANCEL,(function(t){e.emit(mn.TOUCH_CANCEL,t.touch,t)})),aE.on(fn.KEY_DOWN,(function(t){e.emit(mn.KEY_DOWN,t)})),aE.on(fn.KEY_PRESSING,(function(t){e.emit(mn.KEY_DOWN,t)})),aE.on(fn.KEY_UP,(function(t){e.emit(mn.KEY_UP,t)})),aE.on(fn.DEVICEMOTION,(function(t){e.emit(mn.DEVICEMOTION,t)})),e}m(e,t);var n=e.prototype;return n.setAccelerometerEnabled=function(t){aE.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){aE.setAccelerometerInterval(t)},n.on=function(e,n,i,r){return t.prototype.on.call(this,e,n,i,r),n},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i)},e}(Ee));uE.EventType=mn,i.SystemEvent=uE;var hE,cE=t("aX",new uE);i.systemEvent=cE,Ne(mn,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),Ne(yn,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:uE.EventType,targetName:"SystemEvent.EventType"}]),qe(yn,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),Ne(vn,"EventMouse",["DOWN","UP","MOVE"].map((function(t){return{name:t,newName:"MOUSE_"+t,target:uE.EventType,targetName:"SystemEvent.EventType"}}))),Ne(vn,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:uE.EventType,targetName:"SystemEvent.EventType"}]),qe(vn.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),Ne(ln,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:uE.EventType,targetName:"SystemEvent.EventType"}]),Ne(ln,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:uE.EventType,targetName:"SystemEvent.EventType"}]),Ne(ln,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:uE.EventType,targetName:"SystemEvent.EventType"}]),Ne(ln,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:uE.EventType,targetName:"SystemEvent.EventType"}]),qe(ln.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),Ne(ln.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:ln,targetName:"EventTouch"}]),qe(j.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((function(t){return{name:t}}))),qe(j.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),qe(j.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),qe(j.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),qe(j,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),Ne(rd.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),Ne(vd.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Fe),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Ue),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){"number"==typeof t?this._uiProps.uiTransformComp.setContentSize(t,e):this._uiProps.uiTransformComp.setContentSize(t)}}]),Me(Mb.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),Ne(Mb.prototype,"SceneGlobals.prototype",[{name:"distance",newName:"planeHeight"},{name:"normal",newName:"planeDirection"},{name:"size",newName:"shadowMapSize"}]),Me(vd.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),Ne(H_.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),Me(hn,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Ne(hn,"Layers",[{name:"Default",newName:"DEFAULT",target:hn.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:hn.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:hn.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:hn.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:hn.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:hn.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:hn.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:hn.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:hn,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:hn,targetName:"Layers"}]),Me(hn.Enum,"Layers.Enum",[{name:"ALWAYS"}]),Me(hn.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var lE,fE,pE,_E,dE,vE=pt.Flags.HideInHierarchy,gE=pt.Flags.DontSave,mE=t("aE",Xr("cc.PrivateNode")(hE=function(t){function e(e){var n;return n=t.call(this,e)||this,_(12003,n.name),n.hideFlags|=gE|vE,n}return m(e,t),e}(vd))||hE);function yE(t){var e=t._prefab;if(e&&e.instance){if(!e.asset)return z(3701,t.name),void(e.instance=void 0);var n=t._objFlags,r=t._parent,s=t._id,o=t._prefab;t[vt],i.game._isCloning=!0;var a=e.asset.data;a._iN$t=t,i.instantiate._clone(a,a),i.game._isCloning=!1,t._objFlags=n,t._parent=r,t._id=s,t._prefab&&(t._prefab.instance=null==o?void 0:o.instance)}}function bE(t,e,n){var i;if(e&&t){var r=e,s=null===(i=t._prefab)||void 0===i?void 0:i.instance;!n&&s&&(e[s.fileId]={},r=e[s.fileId]);var o=t._prefab;o&&(r[o.fileId]=t);for(var a=t.components,u=0;u<a.length;u++){var h=a[u];h.__prefab&&(r[h.__prefab.fileId]=h)}for(var c=0;c<t.children.length;c++)bE(t.children[c],r,!1)}}function EE(t,e){if(!t)return null;for(var n=e,i=0;i<t.length;i++){if(!n)return null;n=n[t[i]]}return n}function TE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var s=EE(r.targetInfo.localID,n);if(!s)continue;var o=n,a=r.targetInfo.localID;if(a.length>0)for(var u=0;u<a.length-1;u++)o=o[a[u]];if(r.nodes)for(var h=0;h<r.nodes.length;h++){var c=r.nodes[h];c&&!s._children.includes(c)&&(s._children.push(c),c._parent=s,bE(c,o,!1),c._siblingIndex=s._children.length-1,OE(c,!0))}}}}function wE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var s=EE(r.targetInfo.localID,n);if(!s)continue;if(r.components)for(var o=0;o<r.components.length;o++){var a=r.components[o];a&&(a.node=s,s._components.push(a))}}}}function AE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r){var s=EE(r.localID,n);if(!s||!s.node)continue;var o=s.node.components.indexOf(s);o>=0&&s.node._components.splice(o,1)}}}function IE(t,e,n){if(!(e.length<=0))for(var i=null,r=0;r<e.length;r++){var s=e[r];if(s&&s.targetInfo){if(!(i=EE(s.targetInfo.localID,n)))continue;var o=i,a=s.propertyPath.slice();if(a.length>0){var u=a.pop();if(!u)continue;for(var h=0;h<a.length&&(o=o[a[h]]);h++);if(!o)continue;if(Array.isArray(o))if("length"===u)o[u]=s.value;else{var c=Number.parseInt(u);Number.isInteger(c)&&c<o.length&&(o[u]=s.value)}else o[u]instanceof V?o[u].set(s.value):o[u]=s.value}}}}function CE(t){var e,n=null===(e=t._prefab)||void 0===e?void 0:e.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,s,o=n[i],a=o.source,u=o.sourceInfo;if(u){var h,c,l=null===(h=o.source)||void 0===h||null===(c=h._prefab)||void 0===c?void 0:c.instance;l&&l.targetMap&&(a=EE(u.localID,l.targetMap))}if(a){var f,p=o.targetInfo;if(p){var _=null===(r=o.target)||void 0===r||null===(s=r._prefab)||void 0===s?void 0:s.instance;if(_&&_.targetMap&&(f=EE(p.localID,_.targetMap))){var d=o.propertyPath.slice(),v=a;if(d.length>0){var g=d.pop();if(!g)return;for(var m=0;m<d.length&&(v=v[d[m]]);m++);if(!v)continue;v[g]=f}}}}}}function OE(t,e){void 0===e&&(e=!1);var n=t._prefab,i=null==n?void 0:n.instance;if(i&&!i.expanded){yE(t),e&&t&&t.children&&t.children.forEach((function(t){OE(t,!0)}));var r={};i.targetMap=r,bE(t,r,!0),TE(0,i.mountedChildren,r),AE(0,i.removedComponents,r),wE(0,i.mountedComponents,r),IE(0,i.propertyOverrides,r),i.expanded=!0}else e&&t&&t.children&&t.children.forEach((function(t){OE(t,!0)}))}function SE(t){var e=t._prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((function(t){OE(t)}))}Ne(mn,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((function(t){return{name:t,target:vd.EventType,targetName:"Node.EventType"}}))),Ne(vd.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:uE.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:uE.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:uE.EventType,targetName:"SystemEvent.EventType"}]),i.PrivateNode=mE;var RE=t("ap",Xr("cc.Scene")((dE=function(t){m(r,t);var e=r.prototype;function r(e){var n;return n=t.call(this,e)||this,T(n,"autoReleaseAssets",pE,w(n)),T(n,"_globals",_E,w(n)),n.dependAssets=null,n._renderScene=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Oe.ZERO,n._rot=Le.IDENTITY,n._scale=Oe.ONE,n._mat=Se.IDENTITY,n._dirtyFlags=0,n._lpos=Oe.ZERO,n._lrot=Le.IDENTITY,n._lscale=Oe.ONE,n._activeInHierarchy=!1,i.director&&i.director.root&&(n._renderScene=i.director.root.createScene({})),n._inited=!i.game||!i.game._isCloning,n}return e._updateScene=function(){this._scene=this},e.destroy=function(){var t=pt.prototype.destroy.call(this);if(t)for(var e=this._children,n=0;n<e.length;++n)e[n].active=!1;return this._renderScene&&i.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(b(3822))},e._onHierarchyChanged=function(){},e._onBatchCreated=function(e){t.prototype._onBatchCreated.call(this,e);for(var n=this._children.length,i=0;i<n;++i)this._children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},e.getPosition=function(t){return Oe.copy(t||new Oe,Oe.ZERO)},e.getRotation=function(t){return Le.copy(t||new Le,Le.IDENTITY)},e.getScale=function(t){return Oe.copy(t||new Oe,Oe.ONE)},e.getWorldPosition=function(t){return Oe.copy(t||new Oe,Oe.ZERO)},e.getWorldRotation=function(t){return Le.copy(t||new Le,Le.IDENTITY)},e.getWorldScale=function(t){return Oe.copy(t||new Oe,Oe.ONE)},e.getWorldMatrix=function(t){return Se.copy(t||new Se,Se.IDENTITY)},e.getWorldRS=function(t){return Se.copy(t||new Se,Se.IDENTITY)},e.getWorldRT=function(t){return Se.copy(t||new Se,Se.IDENTITY)},e.updateWorldTransform=function(){},e._instantiate=function(){},e._load=function(){this._inited||(SE(this),CE(this),this._onBatchCreated(q),this._inited=!0),this.walk(rd._setScene)},e._activate=function(t){t=!1!==t,i.director._nodeActivator.activateNode(this,t),this._globals.activate()},n(r,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"position",get:function(){return Oe.ZERO}},{key:"worldPosition",get:function(){return Oe.ZERO}},{key:"rotation",get:function(){return Le.IDENTITY}},{key:"worldRotation",get:function(){return Le.IDENTITY}},{key:"scale",get:function(){return Oe.ONE}},{key:"worldScale",get:function(){return Oe.ONE}},{key:"eulerAngles",get:function(){return Oe.ZERO}},{key:"worldMatrix",get:function(){return Se.IDENTITY}}]),r}(rd),E((fE=dE).prototype,"globals",[_s],Object.getOwnPropertyDescriptor(fE.prototype,"globals"),fE.prototype),pE=E(fE.prototype,"autoReleaseAssets",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_E=E(fE.prototype,"_globals",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mb}}),lE=fE))||lE);function xE(t,e){if(!e){var n=i.director.getScene();if(!n)return null;e=n}return e.getChildByPath(t)}i.Scene=RE,i.find=xE;var NE=ot.fastRemoveAt,ME=pt.Flags.IsStartCalled,PE=pt.Flags.IsOnEnableCalled;function DE(t,e){for(var n=e.constructor._executionOrder,i=e._id,r=0,s=t.length-1,o=s>>>1;r<=s;o=r+s>>>1){var a=t[o],u=a.constructor._executionOrder;if(u>n)s=o-1;else if(u<n)r=o+1;else{var h=a._id;if(h>i)s=o-1;else{if(!(h<i))return o;r=o+1}}}return~r}function LE(t,e){for(var n=t.array,i=t.i+1;i<n.length;){var r=n[i];r.node._activeInHierarchy?++i:(t.removeAt(i),e&&(r._objFlags&=~e))}}pt.Flags.IsEditorOnEnableCalled;var kE=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=at;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function FE(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}kE.stableRemoveInactive=LE;var BE=function(t){function e(){return t.apply(this,arguments)||this}m(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){LE(this._zero,t),LE(this._neg,t),LE(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(FE),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(FE),this._invoke(e),e.array.length=0)},e}(kE),UE=function(t){function e(){return t.apply(this,arguments)||this}m(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var n=e<0?this._neg.array:this._pos.array,i=DE(n,t);i<0&&n.splice(~i,0,t)}},n.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var n=e<0?this._neg:this._pos,i=DE(n.array,t);i>=0&&n.removeAt(i)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(kE);function zE(t,e,n){return function(r,s){try{e(r,s)}catch(e){i._throw(e);var o=r.array;for(n&&(o[r.i]._objFlags|=n),++r.i;r.i<o.length;++r.i)try{t(o[r.i],s)}catch(t){i._throw(t),n&&(o[r.i]._objFlags|=n)}}}}var HE=zE((function(t){t.start(),t._objFlags|=ME}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var n=e[t.i];n.start(),n._objFlags|=ME}}),ME),VE=zE((function(t,e){t.update(e)}),(function(t,e){var n=t.array;for(t.i=0;t.i<n.length;++t.i)n[t.i].update(e)})),GE=zE((function(t,e){t.lateUpdate(e)}),(function(t,e){var n=t.array;for(t.i=0;t.i<n.length;++t.i)n[t.i].lateUpdate(e)})),jE=function(t){var e=i.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var r=n[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||e._onEnabled(r))}},WE=(t("ba",function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new BE(HE),this.updateInvoker=new UE(VE),this.lateUpdateInvoker=new UE(GE),this._updating=!1},e._onEnabled=function(t){i.director.getScheduler().resumeTarget(t),t._objFlags|=PE,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){i.director.getScheduler().pauseTarget(t),t._objFlags&=~PE;var e=this._deferredComps.indexOf(t);e>=0?NE(this._deferredComps,e):(!t.start||t._objFlags&ME||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&PE)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&PE&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&ME||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,n=t.length;e<n;e++)this._scheduleImmediate(t[e]);t.length=0},t}()),pt.Flags.IsPreloadStarted),KE=pt.Flags.IsOnLoadStarted,YE=pt.Flags.IsOnLoadCalled,qE=pt.Flags.Deactivating,XE=function(t){function e(){return t.apply(this,arguments)||this}m(e,t);var n=e.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){kE.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(kE),QE=zE((function(t){t.__preload()}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].__preload()})),$E=zE((function(t){t.onLoad(),t._objFlags|=YE}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var n=e[t.i];n.onLoad(),n._objFlags|=YE}}),YE),ZE=new x(4);function JE(t,e,n){z(3817,t.name,n),console.log("Corrupted component value:",e),e?t._removeComponent(e):ot.removeAt(t._components,n)}ZE.get=function(){var t=this._get()||{preload:new XE(QE),onLoad:new BE($E),onEnable:new BE(jE)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t},t("ar",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var n=ZE.get();this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),ZE.put(n)}else{this._deactivateNodeRecursively(t);for(var i,r=this._activatingStack,s=v(r);!(i=s()).done;){var o=i.value;o.preload.cancelInactive(WE),o.onLoad.cancelInactive(KE),o.onEnable.cancelInactive()}}t.emit(N_.ACTIVE_IN_HIERARCHY_CHANGED,t)},e.activateComp=function(t,e,n,r){if(Pt(t,!0)&&(t._objFlags&WE||(t._objFlags|=WE,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&KE||(t._objFlags|=KE,t.onLoad?n?n.add(t):(t.onLoad(),t._objFlags|=YE):t._objFlags|=YE),t._enabled)){if(!t.node._activeInHierarchy)return;i.director._compScheduler.enableComp(t,r)}},e.destroyComp=function(t){i.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&YE&&t.onDestroy()},e._activateNodeRecursively=function(t,e,n,r){if(t._objFlags&qE)z(3816,t.name);else{t._activeInHierarchy=!0;for(var s=t._components.length,o=0;o<s;++o){var a=t._components[o];a instanceof i.Component?this.activateComp(a,e,n,r):(JE(t,a,o),--o,--s)}for(var u=0,h=t._children.length;u<h;++u){var c=t._children[u];c._active&&this._activateNodeRecursively(c,e,n,r)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=qE,t._activeInHierarchy=!1;for(var e=t._components.length,n=0;n<e;++n){var r=t._components[n];if(r._enabled&&(i.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~qE)}for(var s=0,o=t._children.length;s<o;++s){var a=t._children[s];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),t._activeInHierarchy))return void(t._objFlags&=~qE)}t._onPostActivated(!1),t._objFlags&=~qE},t}());var tT,eT,nT,iT,rT,sT,oT,aT,uT,hT,cT,lT,fT,pT,_T,dT,vT,gT,mT,yT,bT,ET,TT,wT,AT,IT,CT,OT,ST,RT,xT,NT,MT,PT,DT,LT,kT,FT,BT,UT,zT,HT,VT,GT,jT,WT,KT,YT,qT,XT,QT,$T,ZT,JT,tw,ew,nw,iw,rw,sw,ow,aw,uw,hw,cw,lw,fw,pw,_w,dw=Xr("cc.TargetInfo")((nT=E((eT=function(){T(this,"localID",nT,this)}).prototype,"localID",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tT=eT))||tT,vw=(iT=Xr("cc.TargetOverrideInfo"),rT=Rs(pt),sT=Rs(dw),oT=Rs(vd),aT=Rs(dw),iT((cT=E((hT=function(){T(this,"source",cT,this),T(this,"sourceInfo",lT,this),T(this,"propertyPath",fT,this),T(this,"target",pT,this),T(this,"targetInfo",_T,this)}).prototype,"source",[is,rT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lT=E(hT.prototype,"sourceInfo",[is,sT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fT=E(hT.prototype,"propertyPath",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pT=E(hT.prototype,"target",[is,oT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_T=E(hT.prototype,"targetInfo",[is,aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uT=hT))||uT),gw=Xr("cc.CompPrefabInfo")((gT=E((vT=function(){T(this,"fileId",gT,this)}).prototype,"fileId",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dT=vT))||dT,mw=(mT=Xr("CCPropertyOverrideInfo"),yT=Rs(dw),mT((IT=function(){function t(){T(this,"targetInfo",TT,this),T(this,"propertyPath",wT,this),T(this,"value",AT,this)}return t.prototype.isTarget=function(){},t}(),TT=E((ET=IT).prototype,"targetInfo",[is,yT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wT=E(ET.prototype,"propertyPath",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AT=E(ET.prototype,"value",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=ET))||bT),yw=(CT=Xr("cc.MountedChildrenInfo"),OT=Rs(dw),ST=Rs([vd]),CT((PT=function(){function t(){T(this,"targetInfo",NT,this),T(this,"nodes",MT,this)}return t.prototype.isTarget=function(){},t}(),NT=E((xT=PT).prototype,"targetInfo",[is,OT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MT=E(xT.prototype,"nodes",[is,ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RT=xT))||RT),bw=(DT=Xr("cc.MountedComponentsInfo"),LT=Rs(dw),kT=Rs([qo]),DT((HT=function(){function t(){T(this,"targetInfo",UT,this),T(this,"components",zT,this)}return t.prototype.isTarget=function(){},t}(),UT=E((BT=HT).prototype,"targetInfo",[is,LT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zT=E(BT.prototype,"components",[is,kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FT=BT))||FT),Ew=(VT=Xr("cc.PrefabInstance"),GT=Rs(vd),jT=Rs([yw]),WT=Rs([bw]),KT=Rs([mw]),YT=Rs([dw]),VT((nw=function(){function t(){T(this,"fileId",QT,this),T(this,"prefabRootNode",$T,this),T(this,"mountedChildren",ZT,this),T(this,"mountedComponents",JT,this),T(this,"propertyOverrides",tw,this),T(this,"removedComponents",ew,this),this.targetMap={},this.expanded=!1}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),QT=E((XT=nw).prototype,"fileId",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$T=E(XT.prototype,"prefabRootNode",[is,GT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=E(XT.prototype,"mountedChildren",[is,jT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JT=E(XT.prototype,"mountedComponents",[is,WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tw=E(XT.prototype,"propertyOverrides",[is,KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ew=E(XT.prototype,"removedComponents",[is,YT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qT=XT))||qT),Tw=(iw=Xr("cc.PrefabInfo"),rw=Rs(vd),sw=Rs(Ew),ow=Rs([vw]),iw((hw=E((uw=function(){T(this,"root",hw,this),T(this,"asset",cw,this),T(this,"fileId",lw,this),T(this,"instance",fw,this),T(this,"targetOverrides",pw,this),T(this,"nestedPrefabInstanceRoots",_w,this)}).prototype,"root",[is,rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cw=E(uw.prototype,"asset",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lw=E(uw.prototype,"fileId",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fw=E(uw.prototype,"instance",[is,sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pw=E(uw.prototype,"targetOverrides",[is,ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_w=E(uw.prototype,"nestedPrefabInstanceRoots",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aw=uw))||aw);i._PrefabInfo=Tw;var ww,Aw,Iw,Cw,Ow,Sw,Rw,xw,Nw=Object.freeze({__proto__:null,TargetInfo:dw,TargetOverrideInfo:vw,CompPrefabInfo:gw,PropertyOverrideInfo:mw,MountedChildrenInfo:yw,MountedComponentsInfo:bw,PrefabInstance:Ew,PrefabInfo:Tw,createNodeWithPrefab:yE,generateTargetMap:bE,getTarget:EE,applyMountedChildren:TE,applyMountedComponents:wE,applyRemovedComponents:AE,applyPropertyOverrides:IE,applyTargetOverrides:CE,expandPrefabInstanceNode:OE,expandNestedPrefabInstanceNode:SE,applyNodeAndComponentId:function t(e,n){for(var i=e.components,r=e.children,s=0;s<i.length;s++){var o,a=i[s];a._id=""+n+(null===(o=a.__prefab)||void 0===o?void 0:o.fileId)}for(var u=0;u<r.length;u++){var h,c=r[u];c._id=""+n+(null===(h=c._prefab)||void 0===h?void 0:h.fileId),t(c,n)}}}),Mw=J({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Pw=t("a4",Xr("cc.Prefab")((Rw=Sw=function(t){function e(){var e;return e=t.call(this)||this,T(e,"data",Iw,w(e)),T(e,"optimizationPolicy",Cw,w(e)),T(e,"persistent",Ow,w(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}m(e,t);var n=e.prototype;return n.createNode=function(t){var e=i.instantiate(this);e.name=this.name,t(null,e)},n.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof i._BaseNode&&t,new R_(t,e).result)},n._doInstantiate=function(t){return this.data._prefab||_(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},n._instantiate=function(){var t;return t=this.data._instantiate(),++this._instantiatedTimes,t},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.data=new vd,this.data.name="(Missing Node)";var n=new i._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;SE(t),CE(t)},e}(fo),Sw.OptimizationPolicy=Mw,Sw.OptimizationPolicyThreshold=3,Iw=E((Aw=Rw).prototype,"data",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cw=E(Aw.prototype,"optimizationPolicy",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mw.AUTO}}),Ow=E(Aw.prototype,"persistent",[is,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ww=Aw))||ww);a.value(Pw,"_utils",Nw),i.Prefab=Pw,ut(i,"cc._Prefab","Prefab"),Me(Gc.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Ne(Uv.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var Dw=((xw={})[Ae.UNORM]="Uint",xw[Ae.SNORM]="Int",xw[Ae.UINT]="Uint",xw[Ae.INT]="Int",xw[Ae.UFLOAT]="Float",xw[Ae.FLOAT]="Float",xw.default="Uint",xw);function Lw(t){return""+(Dw[t.type]||Dw.default)+t.size/t.count*8}function kw(t,e,n,i,r,s,o){void 0===n&&(n=bt.R32F),void 0===i&&(i=0),void 0===r&&(r=t.byteLength-i),void 0===s&&(s=0),o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var a=Ie[n];s||(s=a.size);for(var u="set"+Lw(a),h="get"+Lw(a),c=a.size/a.count,l=Math.floor(r/s),f=Xe.isLittleEndian,p=0;p<l;++p)for(var _=i+s*p,d=0;d<a.count;++d){var v=_+c*d,g=t[h](v,f);o[u](v,e(g,d,t),f)}return o}t("a5",function(){function t(t,e,n,i,r,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===s&&(s=!0),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._isOwnerOfIndexBuffer=!0,this._drawInfo=null,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new ie(e,t,i,r),this._isOwnerOfIndexBuffer=s}var e=t.prototype;return e.invalidateGeometricInfo=function(){this._geometricInfo=void 0},e.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(e=n.indexView.count);for(var i=0;i<n.vertexBundelIndices.length;i++){var r=n.vertexBundelIndices[i],s=t.struct.vertexBundles[r],o=n.indexView?n.indexView.count:s.view.count,a=s.view.stride,u=a*o,h=new Uint8Array(t.data.buffer,s.view.offset,s.view.length),c=new Uint8Array(n.indexView?u:s.view.length);if(n.indexView){for(var l=t.readIndices(this.subMeshIdx),f=0;f<e;++f)for(var p=f*a,_=l[f]*a,d=0;d<a;++d)c[p+d]=h[_+d];this._flatBuffers.push({stride:a,count:o,buffer:c})}else c.set(t.data.subarray(s.view.offset,s.view.offset+s.view.length)),this._flatBuffers.push({stride:a,count:o,buffer:c})}}},e.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._isOwnerOfIndexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},e.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(t);this._vertexBuffers.push(i),this._attributes.push(new qt("a_vertexId",bt.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:n}}},e._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(e),i=0;i<e;++i)n[i]=i+.5;var r=t.createBuffer(new te(ee.VERTEX|ee.TRANSFER_DST,ne.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},n(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Oe.ZERO,max:Oe.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Oe.ZERO,max:Oe.ZERO}};var t=this.mesh,e=this.subMeshIdx,n=t.readAttribute(e,Ce.ATTR_POSITION),i=t.readIndices(e),r=new Oe,s=new Oe,o=this.attributes.find((function(t){return t.name===Ce.ATTR_POSITION}));if(o){var a=Ie[o.format].count;2===a?(r.set(n[0],n[1],0),s.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),s.set(n[0],n[1],n[2]));for(var u=0;u<n.length;u+=a)2===a?(r.x=n[u]>r.x?n[u]:r.x,r.y=n[u+1]>r.y?n[u+1]:r.y,s.x=n[u]<s.x?n[u]:s.x,s.y=n[u+1]<s.y?n[u+1]:s.y):(r.x=n[u]>r.x?n[u]:r.x,r.y=n[u+1]>r.y?n[u+1]:r.y,r.z=n[u+2]>r.z?n[u+2]:r.z,s.x=n[u]<s.x?n[u]:s.x,s.y=n[u+1]<s.y?n[u+1]:s.y,s.z=n[u+2]<s.z?n[u+2]:s.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:s}},this._geometricInfo}},{key:"drawInfo",get:function(){return this._drawInfo},set:function(t){this._drawInfo=t}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var r,s,o=this.mesh.struct,a=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===a.jointMapIndex||!o.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var u=i.director.root.device,h=0;h<a.vertexBundelIndices.length;h++){var c=o.vertexBundles[a.vertexBundelIndices[h]];s=0,r=bt.UNKNOWN;for(var l=0;l<c.attributes.length;l++){var f=c.attributes[l];if(f.name===Ce.ATTR_JOINTS){r=f.format;break}s+=Ie[f.format].size}r?function(){var i=new Uint8Array(t.mesh.data.buffer,c.view.offset,c.view.length),l=new DataView(i.slice().buffer),f=o.jointMaps[a.jointMapIndex];kw(l,(function(t){return f.indexOf(t)}),r,s,c.view.length,c.view.stride,l);var p=u.createBuffer(new te(ee.VERTEX|ee.TRANSFER_DST,ne.DEVICE,c.view.length,c.view.stride));p.update(l.buffer),e.push(p),n.push(h)}():e.push(this.vertexBuffers[a.vertexBundelIndices[h]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(u)),e}},{key:"iaInfo",get:function(){return this._iaInfo}}]),t}());var Fw,Bw,Uw,zw,Hw=t("a6",Xr("cc.SceneAsset")((zw=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,T(e,"scene",Uw,w(e)),e}m(e,t);var n=e.prototype;return n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.scene=new RE("New Scene")},n.validate=function(){return!!this.scene},e}(fo),Uw=E((Bw=zw).prototype,"scene",[_s,is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fw=Bw))||Fw);i.SceneAsset=Hw}}}));
