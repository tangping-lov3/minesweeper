System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./scene-asset-10397f71.js","./math-base-02e87bf8.js","./pipeline-state-manager-f4a950fe.js","./deprecated-dacf9914.js"],(function(t){"use strict";var e,i,n,s,a,r,h,o,_,u,O,T,A,f,I,E,N,l;return{setters:[function(t){e=t.t,i=t.l},function(t){n=t.aT,s=t.b0,a=t.ah,r=t.h,h=t.i,o=t.c,_=t.a6},function(t){u=t.M,O=t.n,T=t.u},function(t){A=t.N,f=t.L},function(t){I=t.c},function(t){E=t.R,N=t.a,l=t.d}],execute:function(){var L,R;function c(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function m(t,e){return Math.ceil(t/e)*e}t({A:void 0,P:void 0,R:void 0,a:void 0,b:void 0,d:void 0,f:void 0,n:c}),function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(L||(L=t("R",{}))),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(R||(R=t("P",{}))),t("T",function(){function t(t){this._device=void 0,this._format=o.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new _,this._region1=new _,this._region2=new _,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var i=t.prototype;return i.initialize=function(t){var e=n[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=s(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},i.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},i.alloc=function(t,e){t=m(t,this._alignment);var i=-1,n=-1;if(void 0!==e&&(i=e,n=this._findAvailableSpace(t,i)),n<0)for(var s=0;s<this._chunkCount&&(i=s,!((n=this._findAvailableSpace(t,i))>=0));++s);if(n>=0){var a=this._chunks[i];a.start+=t;var r={chunkIdx:i,start:n,end:n+t,texture:a.texture};return this._handles.push(r),r}var h=Math.sqrt(t/this._formatSize),o=this._roundUpFn&&this._roundUpFn(h,this._formatSize)||Math.max(1024,c(h)),_=this._chunks[this.createChunk(o)];_.start+=t;var u={chunkIdx:this._chunkCount-1,start:0,end:t,texture:_.texture};return this._handles.push(u),u},i.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},i.createChunk=function(t){var i=t*t*this._formatSize;e("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+i+", format: "+this._format);var n={texture:this._device.createTexture(new a(r.TEX2D,h.SAMPLED|h.TRANSFER_DST,this._format,t,t)),size:i,start:0,end:i};return this._chunks[this._chunkCount]=n,this._chunkCount++},i.update=function(t,e){var i=[],n=[],s=t.start/this._formatSize,a=e.byteLength/this._formatSize,r=s%t.texture.width,h=Math.floor(s/t.texture.width),o=Math.min(t.texture.width-r,a),_=0;r>0&&(this._region0.texOffset.x=r,this._region0.texOffset.y=h,this._region0.texExtent.width=o,this._region0.texExtent.height=1,i.push(new this._bufferViewCtor(e,_*this._formatSize,o*this._channels)),n.push(this._region0),r=0,h+=1,a-=o,_+=o),a>0&&(this._region1.texOffset.x=r,this._region1.texOffset.y=h,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),o=this._region1.texExtent.width*this._region1.texExtent.height):(o=a,this._region1.texExtent.width=o,this._region1.texExtent.height=1),i.push(new this._bufferViewCtor(e,_*this._formatSize,o*this._channels)),n.push(this._region1),r=0,h+=this._region1.texExtent.height,a-=o,_+=o),a>0&&(this._region2.texOffset.x=r,this._region2.texOffset.y=h,this._region2.texExtent.width=a,this._region2.texExtent.height=1,i.push(new this._bufferViewCtor(e,_*this._formatSize,a*this._channels)),n.push(this._region2)),this._device.copyBuffersToTexture(i,t.texture,n)},i._findAvailableSpace=function(t,e){var i=this._chunks[e],n=!1,s=i.start;if(s+t<=i.size)n=!0;else{s=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),r=0;r<a.length;r++){var h=a[r];if(s+t<=h.start){n=!0;break}s=h.end}!n&&s+t<=i.size&&(n=!0)}return n?s:-1},i._McDonaldAlloc=function(t){t=m(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var i=this._chunks[e],n=!1,s=i.start;if(s+t<=i.end?n=!0:s>i.end?s+t<=i.size?n=!0:t<=i.end&&(i.start=s=0,n=!0):s===i.end&&(i.start=s=0,i.end=i.size,t<=i.end&&(n=!0)),n){i.start+=t;var a={chunkIdx:e,start:s,end:s+t,texture:i.texture};return this._handles.push(a),a}}var r=Math.sqrt(t/this._formatSize),h=this._roundUpFn&&this._roundUpFn(r,this._formatSize)||Math.max(1024,c(r)),o=this._chunks[this.createChunk(h)];o.start+=t;var _={chunkIdx:this._chunkCount,start:0,end:t,texture:o.texture};return this._handles.push(_),_},t}());var d,C,S,g,p,v,M,y,U,D=function(){function t(t,e,i){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=i*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(U||(U={}));var F,w,P=function(){function t(t,e,i,n,s){void 0===s&&(s=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=s,this._dataType=e,this._dataMembers=i,this._stride=4*this._elementCount,this._entriesPerChunk=1<<s,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new D(t,s,this._stride);var a=U.NEVER,r=!1,h=!1;for(var o in e){if(r=this._hasFloat32,(h=this._hasUint32)&&r)break;a=e[o],r||a!==U.FLOAT32?h||a!==U.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freeLists.length;t++){var e=this._freeLists[t];if(e.length){var i=e[e.length-1];return e.length--,(t<<this._entryBits)+i+this._poolFlag}}for(var n=this._nativePool.allocateNewChunk(),s=[],a=[],r=[],h=this._hasFloat32,o=this._hasUint32,_=0;_<this._entriesPerChunk;_++)h&&s.push(new Float32Array(n,this._stride*_,this._elementCount)),o&&a.push(new Uint32Array(n,this._stride*_,this._elementCount)),_&&r.push(_);return o&&this._uint32BufferViews.push(a),h&&this._float32BufferViews.push(s),this._freeLists.push(r),this._arrayBuffers.push(n),(t<<this._entryBits)+this._poolFlag},e.getBuffer=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][i]},e.getTypedArray=function(t,e){var i=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t,s=e,a=(this._dataType[e]===U.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][n],r=this._dataMembers[e];return a.subarray(s,s+r)},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][i].fill(0),this._freeLists[e].push(i)},t}();!function(t){t[t.NODE=0]="NODE",t[t.PASS=1]="PASS",t[t.AABB=2]="AABB",t[t.RENDER2D=3]="RENDER2D"}(F||(F=t("a",{}))),t("N",0),function(t){t[t.POSITION=0]="POSITION",t[t.UV=3]="UV",t[t.COLOR=5]="COLOR",t[t.COUNT=9]="COUNT"}(w||(w=t("b",{})));var k,x=((d={})[w.POSITION]=U.FLOAT32,d[w.UV]=U.FLOAT32,d[w.COLOR]=U.UINT32,d[w.COUNT]=U.NEVER,d),V=((C={})[w.POSITION]=w.UV-w.POSITION,C[w.UV]=w.COLOR-w.UV,C[w.COLOR]=w.COUNT-w.COLOR,C[w.COUNT]=1,C);t("c",new P(F.RENDER2D,x,V,w)),function(t){t[t.DIRTY_FLAG=0]="DIRTY_FLAG",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.LOCAL_SCALE=28]="LOCAL_SCALE",t[t.LOCAL_POSITION=31]="LOCAL_POSITION",t[t.LOCAL_ROTATION=34]="LOCAL_ROTATION",t[t.COUNT=38]="COUNT"}(k||(k=t("d",{})));var B,H=((S={})[k.DIRTY_FLAG]=U.UINT32,S[k.LAYER]=U.UINT32,S[k.WORLD_SCALE]=U.FLOAT32,S[k.WORLD_POSITION]=U.FLOAT32,S[k.WORLD_ROTATION]=U.FLOAT32,S[k.WORLD_MATRIX]=U.FLOAT32,S[k.LOCAL_SCALE]=U.FLOAT32,S[k.LOCAL_POSITION]=U.FLOAT32,S[k.LOCAL_ROTATION]=U.FLOAT32,S[k.COUNT]=U.NEVER,S),b=((g={})[k.DIRTY_FLAG]=k.LAYER-k.DIRTY_FLAG,g[k.LAYER]=k.WORLD_SCALE-k.LAYER,g[k.WORLD_SCALE]=k.WORLD_POSITION-k.WORLD_SCALE,g[k.WORLD_POSITION]=k.WORLD_ROTATION-k.WORLD_POSITION,g[k.WORLD_ROTATION]=k.WORLD_MATRIX-k.WORLD_ROTATION,g[k.WORLD_MATRIX]=k.LOCAL_SCALE-k.WORLD_MATRIX,g[k.LOCAL_SCALE]=k.LOCAL_POSITION-k.LOCAL_SCALE,g[k.LOCAL_POSITION]=k.LOCAL_ROTATION-k.LOCAL_POSITION,g[k.LOCAL_ROTATION]=k.COUNT-k.LOCAL_ROTATION,g[k.COUNT]=1,g);t("e",new P(F.NODE,H,b,k)),function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.PRIMITIVE=3]="PRIMITIVE",t[t.BATCHING_SCHEME=4]="BATCHING_SCHEME",t[t.DYNAMIC_STATE=5]="DYNAMIC_STATE",t[t.HASH=6]="HASH",t[t.COUNT=7]="COUNT"}(B||(B=t("f",{})));var W,G=((p={})[B.PRIORITY]=U.UINT32,p[B.STAGE]=U.UINT32,p[B.PHASE]=U.UINT32,p[B.PRIMITIVE]=U.UINT32,p[B.BATCHING_SCHEME]=U.UINT32,p[B.DYNAMIC_STATE]=U.UINT32,p[B.HASH]=U.UINT32,p[B.COUNT]=U.NEVER,p),z=((v={})[B.PRIORITY]=B.STAGE-B.PRIORITY,v[B.STAGE]=B.PHASE-B.STAGE,v[B.PHASE]=B.PRIMITIVE-B.PHASE,v[B.PRIMITIVE]=B.BATCHING_SCHEME-B.PRIMITIVE,v[B.BATCHING_SCHEME]=B.DYNAMIC_STATE-B.BATCHING_SCHEME,v[B.DYNAMIC_STATE]=B.HASH-B.DYNAMIC_STATE,v[B.HASH]=B.COUNT-B.HASH,v[B.COUNT]=1,v);t("g",new P(F.PASS,G,z,B)),function(t){t[t.CENTER=0]="CENTER",t[t.HALFEXTENTS=3]="HALFEXTENTS",t[t.COUNT=6]="COUNT"}(W||(W=t("A",{})));var Y=((M={})[W.CENTER]=U.FLOAT32,M[W.HALFEXTENTS]=U.FLOAT32,M[W.COUNT]=U.NEVER,M),X=((y={})[W.CENTER]=W.HALFEXTENTS-W.CENTER,y[W.HALFEXTENTS]=W.COUNT-W.HALFEXTENTS,y[W.COUNT]=1,y);t("h",new P(F.AABB,Y,X,W)),A(E.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),A(E.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]),A(N.prototype,"Model.prototype",[{name:"isInstancingEnabled"},{name:"instancedAttributes"}]);var j=t("C",{});A(j,"CameraVisFlags",[{name:"GENERAL"}]),f(j,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:I.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:I.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:I.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:I.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:I.BitMask,targetName:"UI_2D"}]),i.CameraVisFlags=j;var Z=t("V",{});A(Z,"VisibilityFlags",[{name:"GENERAL"}]),f(Z,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:I.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:I.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:I.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:I.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:I.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:I.Enum,targetName:"UI_2D"}]),i.VisibilityFlags=Z,f(u.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),A(O.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),A(T.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),A(l.prototype,"SpotLight.prototype",[{name:"aspect"}])}}}));
