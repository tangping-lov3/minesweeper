System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./scene-asset-10397f71.js","./math-base-02e87bf8.js","./index-f2c2eec3.js","./pipeline-state-manager-f4a950fe.js","./deprecated-dacf9914.js","./touch-37ec7c16.js","./game-1e6d0834.js","./create-mesh-c5031db7.js","./mesh-20100c2c.js","./sprite-renderer-e42860e7.js","./sprite-eb671685.js","./ui-renderer-09c699a1.js","./ZipUtils-3ae2be0b.js"],(function(t){"use strict";var e,i,r,s,n,o,a,h,l,u,f,g,d,_,p,c,m,y,v,w,A,b,S,T,x,I,C,D,N,O,E,P,G,z,F,L,M,R,X,U,H,j,B,k,Y,V,Z,K,W,q,J,$,Q,tt;return{setters:[function(t){e=t.m,i=t.c,r=t.f,s=t.A,n=t.p,o=t.F,a=t.w,h=t.G,l=t.H,u=t.I,f=t.r,g=t.s,d=t.i,_=t.J},function(t){p=t.bn,c=t.q},function(t){m=t.ct,y=t.a$,v=t.b0,w=t.bS,A=t.au,b=t.bT,S=t.bU,T=t.cf,x=t.aI,I=t.ao,C=t.a7,D=t.a2,N=t.b1,O=t.b7,E=t.b5},function(t){P=t.V,G=t.C,z=t.S,F=t.R,L=t.e,M=t.a},function(){},function(t){R=t.a},function(t){X=t.k,U=t.j},function(){},function(){},function(){},function(){},function(t){H=t.S},function(t){j=t.c,B=t.a},function(t){k=t.a,Y=t.l,V=t.m,Z=t.R,K=t.d,W=t.e,q=t.U,J=t.j,$=t.i},function(t){Q=t.c,tt=t._}],execute:function(){var et,it,rt,st,nt,ot,at;!function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(et||(et={})),e(et),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(it||(it={})),e(it),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(rt||(rt={})),e(rt),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(st||(st={})),e(st),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(nt||(nt={})),e(nt),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(ot||(ot={})),e(ot),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(at||(at={})),e(at);var ht=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new z(0,0),this.tileOffset=new P(0,0),this._tileSize=new z(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new F(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;r&=rt.FLIPPED_MASK,r-=this.firstGid;var s=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return i.x=Math.round(r%s*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/s)*(this._tileSize.height+this.spacing)+this.margin),i},t}(),lt=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new G(255,255,255,255),this.offset=new P(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),ut=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new P(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();ut.ATTRIB_NONE=1,ut.ATTRIB_BASE64=2,ut.ATTRIB_GZIP=4,ut.ATTRIB_ZLIB=8;var ft=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new P(0,0),this.opacity=0,this.trans=new G(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function gt(t){var e=j.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function dt(t){var e=j.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function _t(t){if(!t)return new G(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,s=parseInt(t.substr(6,2),16)||0;return new G(i,r,s,e)}var n=parseInt(t.substr(0,2),16)||0,o=parseInt(t.substr(2,2),16)||0,a=parseInt(t.substr(4,2),16)||0;return new G(n,o,a,255)}function pt(t,e){for(var i=[],r=t.getElementsByTagName("properties"),s=0;s<r.length;++s)for(var n=r[s].getElementsByTagName("property"),o=0;o<n.length;++o)i.push(n[o]);e=e||{};for(var a=0;a<i.length;a++){var h=i[a],l=h.getAttribute("name"),u=h.getAttribute("type")||"string",f=h.getAttribute("value");"int"===u?f=parseInt(f):"float"===u?f=parseFloat(f):"bool"===u?f="true"===f:"color"===u&&(f=_t(f)),e[l]=f}return e}var ct,mt,yt,vt,wt,At,bt,St,Tt,xt,It,Ct,Dt,Nt,Ot,Et,Pt=function(){function t(t,e,i,r,s){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=ot.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new z(0,0),this._tileSize=new z(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,s)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new z(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new z(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,s){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=s,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=ut.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,s){var n,o=(new m).parse(e).documentElement,a=o.getAttribute("orientation"),h=o.getAttribute("staggeraxis"),l=o.getAttribute("staggerindex"),u=o.getAttribute("hexsidelength"),f=o.getAttribute("renderorder"),g=o.getAttribute("version")||"1.0.0";if("map"===o.nodeName){var d=g.split("."),_=this._supportVersion;for(n=0;n<_.length;n++){var p=parseInt(d[n])||0;if(_[n]<p){i(7216,g);break}}"orthogonal"===a?this.orientation=et.ORTHO:"isometric"===a?this.orientation=et.ISO:"hexagonal"===a?this.orientation=et.HEX:null!==a&&i(7217,a),this.renderOrder="right-up"===f?ot.RightUp:"left-up"===f?ot.LeftUp:"left-down"===f?ot.LeftDown:ot.RightDown,"x"===h?this.setStaggerAxis(st.STAGGERAXIS_X):"y"===h&&this.setStaggerAxis(st.STAGGERAXIS_Y),"odd"===l?this.setStaggerIndex(nt.STAGGERINDEX_ODD):"even"===l&&this.setStaggerIndex(nt.STAGGERINDEX_EVEN),u&&this.setHexSideLength(parseFloat(u));var c=new z(0,0);c.width=parseFloat(o.getAttribute("width")),c.height=parseFloat(o.getAttribute("height")),this.setMapSize(c),(c=new z(0,0)).width=parseFloat(o.getAttribute("tilewidth")),c.height=parseFloat(o.getAttribute("tileheight")),this.setTileSize(c),this.properties=pt(o)}var y=o.getElementsByTagName("tileset");for("map"!==o.nodeName&&(y=[]).push(o),n=0;n<y.length;n++){var v=y[n],w=v.getAttribute("source");if(w){var A=parseInt(v.getAttribute("firstgid")),b=this._tsxContentMap[w];b&&this.parseXMLString(b,A)}else{var S=v.getElementsByTagName("image"),T=S.length>1,x=S[0],I=x.getAttribute("source");I=I.replace(/\\/g,"/");var C=v.getElementsByTagName("tile"),D=C&&C.length||1,N=null,O=v.getAttribute("name")||"",E=parseInt(v.getAttribute("spacing"))||0,P=parseInt(v.getAttribute("margin"))||0,G=s||parseInt(v.getAttribute("firstgid"))||0,F=new z(0,0);F.width=parseFloat(v.getAttribute("tilewidth")),F.height=parseFloat(v.getAttribute("tileheight"));var L=v.getElementsByTagName("tileoffset")[0],M=0,R=0;L&&(M=parseFloat(L.getAttribute("x"))||0,R=parseFloat(L.getAttribute("y"))||0);for(var X=null,U=0;U<D;U++){var H=S[U]?S[U]:x;if(H){var j=H.getAttribute("source");if(j=j.replace(/\\/g,"/"),!X||T){if((X=new ht).name=O,X.firstGid=G&rt.FLIPPED_MASK,X.tileOffset.x=M,X.tileOffset.y=R,X.collection=T,!T&&(X.imageName=j,X.imageSize.width=parseFloat(H.getAttribute("width"))||0,X.imageSize.height=parseFloat(H.getAttribute("height"))||0,X.sourceImage=this._spriteFrameMap[j],!X.sourceImage)){var B=t.getNameWithPostfix(j);if(X.imageName=B,X.sourceImage=this._spriteFrameMap[B],!X.sourceImage){var k=t.getShortName(j);X.imageName=k,X.sourceImage=this._spriteFrameMap[k],X.sourceImage||(console.error("[error]: "+k+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),r(7221,j),console.warn("Please try asset type of "+j+" to 'sprite-frame'"))}}X.spacing=E,X.margin=P,X._tileSize.width=F.width,X._tileSize.height=F.height,this.setTilesets(X)}if(N=C&&C[U]){this.parentGID=G+(parseInt(N.getAttribute("id"))||0);var Y=N.getElementsByTagName("image");if(Y&&Y.length>0){var V=Y[0],Z=V.getAttribute("source");if(Z=Z.replace(/\\/g,"/"),X.imageName=Z,X.imageSize.width=parseFloat(V.getAttribute("width"))||0,X.imageSize.height=parseFloat(V.getAttribute("height"))||0,X._tileSize.width=X.imageSize.width,X._tileSize.height=X.imageSize.height,X.sourceImage=this._spriteFrameMap[Z],!X.sourceImage){var K=t.getNameWithPostfix(Z);if(X.imageName=K,X.sourceImage=this._spriteFrameMap[K],!X.sourceImage){var W=t.getShortName(Z);X.imageName=W,X.sourceImage=this._spriteFrameMap[W],X.sourceImage||(r(7221,Z),console.warn("Please try asset type of "+Z+" to 'sprite-frame'"))}}X.firstGid=this.parentGID&rt.FLIPPED_MASK}var q=(rt.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(q,pt(N));var J=N.getElementsByTagName("animation");if(J&&J.length>0){var $=J[0].getElementsByTagName("frame"),Q={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(q,Q);for(var tt=Q.frames,it=0;it<$.length;it++){var at=$[it],lt=G+(parseInt(at.getAttribute("tileid"))||0),ut=parseFloat(at.getAttribute("duration"))||0;tt.push({tileid:lt,duration:ut/1e3,grid:null})}}}}}}}var ft=o.childNodes;for(n=0;n<ft.length;n++){var gt=ft[n];if(!this._shouldIgnoreNode(gt)){if("imagelayer"===gt.nodeName){var dt=this._parseImageLayer(gt);dt&&this.setImageLayers(dt)}if("layer"===gt.nodeName){var _t=this._parseLayer(gt);this.setLayers(_t)}if("objectgroup"===gt.nodeName){var ct=this._parseObjectGroup(gt);this.setObjectGroups(ct)}}}return o},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new ft;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var s=t.getAttribute("visible");i.visible=!("0"===s);var n=t.getAttribute("opacity");i.opacity=n?Math.round(255*parseFloat(n)):255;var o=t.getAttribute("tintcolor");i.tintColor=o?_t(o):null;var a=e[0],h=a.getAttribute("source");return i.sourceImage=this._imageLayerSPF[h],i.width=parseInt(a.getAttribute("width"))||0,i.height=parseInt(a.getAttribute("height"))||0,i.trans=_t(a.getAttribute("trans")),i.sourceImage?i:(r(7221,h),console.warn("Please try asset type of "+h+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],r=new ut;r.name=t.getAttribute("name");var s=new z(0,0);s.width=parseFloat(t.getAttribute("width")),s.height=parseFloat(t.getAttribute("height")),r.layerSize=s;var n=t.getAttribute("visible");r.visible=!("0"===n);var o=t.getAttribute("opacity");r.opacity=o?Math.round(255*parseFloat(o)):255,r.offset=new P(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var a=t.getAttribute("tintcolor");r.tintColor=a?_t(a):null;for(var h="",l=0;l<e.childNodes.length;l++)h+=e.childNodes[l].nodeValue;h=h.trim();var u,f=e.getAttribute("compression"),g=e.getAttribute("encoding");if(f&&"gzip"!==f&&"zlib"!==f)return i(7218),null;switch(f){case"gzip":u=Q.unzipBase64AsArray(h,4);break;case"zlib":u=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var s=4*r;i[r]=t[s]+256*t[s+1]+65536*t[s+2]+t[s+3]*(1<<24)}return i}(new tt.Inflate(Q.Base64.decodeAsArray(h,1)).decompress());break;case null:case"":if("base64"===g)u=Q.Base64.decodeAsArray(h,4);else if("csv"===g){u=[];for(var d=h.split(","),_=0;_<d.length;_++)u.push(parseInt(d[_]))}else{var p=e.getElementsByTagName("tile");u=[];for(var c=0;c<p.length;c++)u.push(parseInt(p[c].getAttribute("gid")))}break;default:this.layerAttrs===ut.ATTRIB_NONE&&i(7219)}return u&&(r.tiles=new Uint32Array(u)),r.properties=pt(t),r},e._parseObjectGroup=function(t){var e=new lt;e.name=t.getAttribute("name")||"",e.offset=new P(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var i=t.getAttribute("opacity");e.opacity=i?Math.round(255*parseFloat(i)):255;var r=t.getAttribute("tintcolor");e.tintColor=r?_t(r):null;var s=t.getAttribute("visible");s&&0===parseInt(s)&&(e.visible=!1);var n=t.getAttribute("color");n&&e.color.fromHEX(n);var o=t.getAttribute("draworder");o&&(e.draworder=o),e.setProperties(pt(t));var a=t.getElementsByTagName("object");if(a){for(var h=0;h<a.length;h++){var l=a[h],u={};u.id=l.getAttribute("id")||h,u.name=l.getAttribute("name")||"",u.width=parseFloat(l.getAttribute("width"))||0,u.height=parseFloat(l.getAttribute("height"))||0,u.x=parseFloat(l.getAttribute("x"))||0,u.y=parseFloat(l.getAttribute("y"))||0,u.rotation=parseFloat(l.getAttribute("rotation"))||0,pt(l,u);var f=l.getAttribute("visible");u.visible=!(f&&0===parseInt(f));var g=l.getElementsByTagName("text");if(g&&g.length>0){var d=g[0];u.type=at.TEXT,u.wrap="1"===d.getAttribute("wrap"),u.color=_t(d.getAttribute("color")),u.halign=gt(d.getAttribute("halign")),u.valign=dt(d.getAttribute("valign")),u.pixelsize=parseInt(d.getAttribute("pixelsize"))||16,u.text=d.childNodes[0].nodeValue}var _=l.getAttribute("gid");_&&(u.gid=parseInt(_),u.type=at.IMAGE);var p=l.getElementsByTagName("ellipse");p&&p.length>0&&(u.type=at.ELLIPSE);var c=l.getElementsByTagName("polygon");if(c&&c.length>0){u.type=at.POLYGON;var m=c[0].getAttribute("points");m&&(u.points=this._parsePointsString(m))}var y=l.getElementsByTagName("polyline");if(y&&y.length>0){u.type=at.POLYLINE;var v=y[0].getAttribute("points");v&&(u.polylinePoints=this._parsePointsString(v))}u.type||(u.type=at.RECT),e.objects.push(u)}"index"!==o&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var s=i[r].split(",");e.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.length;return t.substring(e,i)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},s(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),Gt=t("TiledTile",(ct=y("cc.TiledTile"),mt=b(),yt=S(),vt=T(k),wt=v(n),At=v(n),bt=v(n),St=v(n),Tt=v(n),ct(xt=mt(xt=yt(xt=vt(xt=w((Nt=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,l(e,"_x",Ct,u(e)),l(e,"_y",Dt,u(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this.node.on(A.TRANSFORM_CHANGED,this._updatePosition,this),this.node.on(A.SIZE_CHANGED,this._updatePosition,this),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile(),this.node.off(A.TRANSFORM_CHANGED,this._updatePosition,this),this.node.off(A.SIZE_CHANGED,this._updatePosition,this)},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))a("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this),this._layer.markForUpdateRenderData()}}},i._updatePosition=function(){this._layer.markForUpdateRenderData()},s(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?a("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?a("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(x),Ct=h((It=Nt).prototype,"_x",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Dt=h(It.prototype,"_y",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h(It.prototype,"x",[bt],Object.getOwnPropertyDescriptor(It.prototype,"x"),It.prototype),h(It.prototype,"y",[St],Object.getOwnPropertyDescriptor(It.prototype,"y"),It.prototype),h(It.prototype,"grid",[Tt],Object.getOwnPropertyDescriptor(It.prototype,"grid"),It.prototype),xt=It))||xt)||xt)||xt)||xt)||xt));function zt(t,e,i){var r=i||t.sourceImage,s=r.texture,n=t.collection;if(!t.imageSize.width||!t.imageSize.height){var o=t.sourceImage;t.imageSize.width=o.width,t.imageSize.height=o.height}var a=t.imageSize.width,h=t.imageSize.height,l=t._tileSize.width,u=t._tileSize.height,f=r.width,g=r.height,d=t.spacing,_=t.margin,p=1;if(!n){var c=Math.floor((a-2*_+d)/(l+d)),m=Math.floor((h-2*_+d)/(u+d));p=Math.max(1,m*c)}for(var y=t.firstGid,v=null,w=!!e.get(y),A=t.firstGid+p,b=y;b<A&&(w&&!e.get(b)&&(w=!1),w||!e.get(b));++b){if(v={tileset:t,x:0,y:0,width:l,height:u,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:b,spriteFrame:r,texture:s},t.rectForGID(b,v),!i||p>1)if(i){v._name=i.name;var S=i.unbiasUV[0],T=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];v.l=S+(v.x+.5)/f,v.t=T+(v.y+.5)/g,v.r=S+(v.x+v.width-.5)/f,v.b=T+(v.y+v.height-.5)/g,v._rect=new F(v.x,v.y,v.width,v.height)}else v.l=v.x/f,v.t=v.y/g,v.r=(v.x+v.width)/f,v.b=(v.y+v.height)/g,v._rect=new F(v.x,v.y,v.width,v.height);else i.rotated?(v._rotated=!0,v._name=i.name,v._rect=i.getRect(),v.l=i.unbiasUV[0],v.t=i.unbiasUV[1],v.r=i.unbiasUV[4],v.b=i.unbiasUV[3]):(v._name=i.name,v._rect=i.getRect(),v.l=i.unbiasUV[0],v.t=i.unbiasUV[5],v.r=i.unbiasUV[2],v.b=i.unbiasUV[1]);v.cx=(v.l+v.r)/2,v.cy=(v.t+v.b)/2,e.set(b,v)}}for(var Ft,Lt,Mt,Rt,Xt,Ut,Ht,jt,Bt,kt,Yt,Vt,Zt,Kt,Wt,qt,Jt,$t,Qt,te,ee,ie,re,se,ne,oe,ae,he,le,ue,fe,ge,de,_e,pe,ce,me,ye,ve,we=new L,Ae=new P,be=new M,Se=new M,Te={row:0,col:0},xe=t("TiledUserNodeData",y("cc.TiledUserNodeData")(Ot=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return o(e,t),e}(x))||Ot),Ie=t("TiledLayer",y("cc.TiledLayer")(Et=function(t){o(r,t);var e=r.prototype;function r(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._tiledDataArray=[],e._drawInfoList=[],e._tiledDataArrayIdx=0,e}return e.requestDrawInfo=function(t){return this._drawInfoList[t]||(this._drawInfoList[t]=new Y,this._drawInfoList[t].setDrawInfoType(V.MIDDLEWARE)),this._drawInfoList[t]},e.hasTiledNode=function(){return this._hasTiledNodeGrid},e.hasAnimation=function(){return this._hasAniGrid},e.addUserNode=function(t){var e=t.getComponent(xe);return e?(a("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(xe),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),Ae),this._positionToRowCol(Ae.x,Ae.y,Te),this._addUserNodeToGrid(e,Te),this._updateCullingOffsetByUserNode(t),t.on(A.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(A.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},e.removeUserNode=function(t){var e=t.getComponent(xe);return e?(t.off(A.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(A.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(a("CCTiledLayer:removeUserNode node is not exist"),!1)},e.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},e._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},e.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},e.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},e._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),Ae),this._positionToRowCol(Ae.x,Ae.y,Te),this._addUserNodeToGrid(e,Te),this._updateCullingOffsetByUserNode(e.node)}},e._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},e._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},e._userNodePosChange=function(){var t=this,e=t.node,i=t._tiledLayer;i._nodeLocalPosToLayerPos(e.getPosition(),Ae),i._positionToRowCol(Ae.x,Ae.y,Te),i._limitInLayer(Te),Te.row===t._row&&Te.col===t._col||(i._removeUserNodeFromGrid(t),i._addUserNodeToGrid(t,Te))},e._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,s=this._userNodeGrid[e],n=s&&s[i];n&&(s.count--,n.count--,n.list[r]=null,n.count<=0&&(n.list.length=0,n.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},e._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},e._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,s=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},n=s[r]=s[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=n.list.length,s.count++,n.count++,n.list.push(t),this._userNodeDirty=!0},e.isUserNodeDirty=function(){return this._userNodeDirty},e.setUserNodeDirty=function(t){this._userNodeDirty=t},e.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(A.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(A.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(A.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(A.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(A.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},e.onDisable=function(){var e,i;t.prototype.onDisable.call(this),null===(e=this.node.parent)||void 0===e||e.off(A.SIZE_CHANGED,this.updateCulling,this),null===(i=this.node.parent)||void 0===i||i.off(A.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(A.SIZE_CHANGED,this.updateCulling,this),this.node.off(A.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(A.ANCHOR_CHANGED,this._syncAnchorPoint,this)},e._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},e.getLayerName=function(){return this._layerName},e.setLayerName=function(t){this._layerName=t},e.getProperty=function(t){return this._properties[t]},e.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case et.ORTHO:return this._positionForOrthoAt(i,e);case et.ISO:return this._positionForIsoAt(i,e);case et.HEX:return this._positionForHexAt(i,e)}return null},e.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},e._positionForIsoAt=function(t,e){var i=0,r=0,s=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiles[s];if(n){var o=(n&rt.FLIPPED_MASK)>>>0,a=this.texGrids.get(o).tileset.tileOffset;i=a.x,r=a.y}return new P(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-r)},e._positionForOrthoAt=function(t,e){var i=0,r=0,s=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiles[s];if(n){var o=(n&rt.FLIPPED_MASK)>>>0,a=this.texGrids.get(o).tileset.tileOffset;i=a.x,r=a.y}return new P(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-r)},e._positionForHexAt=function(t,e){var i,r=this._mapTileSize.width,s=this._mapTileSize.height,n=this._layerSize.height,o=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=(this.tiles[o]&rt.FLIPPED_MASK)>>>0;i=this.texGrids.get(a)?this.texGrids.get(a).tileset.tileOffset:{x:0,y:0};var h=this._staggerIndex===nt.STAGGERINDEX_ODD?1:-1,l=0,u=0,f=0,g=0;switch(this._staggerAxis){case st.STAGGERAXIS_Y:f=0,e%2==1&&(f=r/2*h),l=t*r+f+i.x,u=(n-e-1)*(s-(s-this._hexSideLength)/2)-i.y;break;case st.STAGGERAXIS_X:g=0,t%2==1&&(g=s/2*-h),l=t*(r-(r-this._hexSideLength)/2)+i.x,u=(n-e-1)*s+g-i.y}return new P(l,u)},e.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var s=0,n=e+r,o=i;;o++)for(var a=e;a<n;a++){if(s>=t.length)return;this._updateTileForGID(t[s],a,o),s++}}},e.setTileGIDAt=function(t,e,r,s){var n=(t&rt.FLIPPED_MASK)>>>0;if(e=Math.floor(e),r=Math.floor(r),this.isInvalidPosition(e,r))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==n&&n<this._tilesets[0].firstGid?i(7239,t):(s=s||0,this._updateTileForGID((n|s)>>>0,e,r)):i(7238)},e._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var s=(t&rt.FLIPPED_MASK)>>>0;this.texGrids.get(s)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},e.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return i(7237),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[r]&rt.FLIPPED_MASK)>>>0},e.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return i(7240),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[r]&rt.FLIPPED_ALL)>>>0},e.setCullingDirty=function(t){this._cullingDirty=t},e.isCullingDirty=function(){return this._cullingDirty},e.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var s=1;this._layerOrientation===et.ISO&&(s=2);var n=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=n-this._leftOffset,h=o-this._downOffset,l=n+i+this._rightOffset,u=o+r+this._topOffset,f=this._cullingRect.leftDown,g=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,Te),Te.row-=s,Te.col-=s,Te.row=Te.row>0?Te.row:0,Te.col=Te.col>0?Te.col:0,Te.row===f.row&&Te.col===f.col||(f.row=Te.row,f.col=Te.col,this._cullingDirty=!0),l<0||u<0?(Te.row=-1,Te.col=-1):(this._positionToRowCol(l,u,Te),Te.row++,Te.col++),Te.row>this._rightTop.row&&(Te.row=this._rightTop.row),Te.col>this._rightTop.col&&(Te.col=this._rightTop.col),Te.row===g.row&&Te.col===g.col||(g.row=Te.row,g.col=Te.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},e._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,s=this._mapTileSize.height,n=.5*r,o=.5*s,a=0,h=0,l=0,u=0,f=this._staggerAxis;switch(this._layerOrientation){case et.ORTHO:h=Math.floor(t/r),a=Math.floor(e/s);break;case et.ISO:h=Math.floor(t/n),a=Math.floor(e/o);break;case et.HEX:f===st.STAGGERAXIS_Y?(l=(a=Math.floor(e/(s-this._diffY1)))%2==1?n*this._odd_even:0,h=Math.floor((t-l)/r)):(u=(h=Math.floor(t/(r-this._diffX1)))%2==1?o*-this._odd_even:0,a=Math.floor((e-u)/s))}return i.row=a,i.col=h,i},e.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),L.invert(we,this.node.getWorldMatrix());var t=X.root.batcher2D.getFirstRenderCamera(this.node);t&&(be.x=0,be.y=0,be.z=0,Se.x=t.width,Se.y=t.height,Se.z=0,t.screenToWorld(be,be),t.screenToWorld(Se,Se),M.transformMat4(be,be,we),M.transformMat4(Se,Se,we),this.updateViewPort(be.x,be.y,Se.x-be.x,Se.y-be.y))}},e.getLayerOrientation=function(){return this._layerOrientation},e.getProperties=function(){return this._properties},e._updateVertex=function(t,e){var i=rt.FLIPPED_MASK,r=this.vertices,s=this._layerOrientation,n=this.tiles;if(n){var o,a,h,l,u=this._rightTop,f=this._mapTileSize.width,g=this._mapTileSize.height,d=.5*f,_=.5*g,p=this._layerSize.height,c=this._layerSize.width,m=this.texGrids,y=0,v=0;s===et.HEX&&(o=this._staggerAxis,a=this._diffX1,h=this._diffY1,l=this._odd_even);var w,A,b,S=0,T=0,x=0,I=0,C=e*c+t;w=(n[C]&i)>>>0;var D=m.get(w);if(D){switch(this._animations.get(w)&&(this._hasAniGrid=this._hasAniGrid||!0),s){case et.ORTHO:y=(S=t)*f,v=(T=p-e-1)*g;break;case et.ISO:y=d*(S=p+t-e-1),v=_*(T=p+c-t-e-2);break;case et.HEX:y=t*(f-a)+(o===st.STAGGERAXIS_Y&&e%2==1?d*l:0),v=(p-e-1)*(g-h)+(o===st.STAGGERAXIS_X&&t%2==1?_*-l:0),S=t,T=p-e-1}var N=r[T]=r[T]||{minCol:0,maxCol:0},O=N[S]=N[S]||{};N.minCol>S&&(N.minCol=S),N.maxCol<S&&(N.maxCol=S),u.row<T&&(u.row=T,s===et.ISO&&(u.row+=1)),u.col<S&&(u.col=S,s===et.ISO&&(u.col+=1));var E=D.tileset.tileOffset;y+=this._offset.x+E.x+D.offsetX,v+=this._offset.y-E.y-D.offsetY,x=(x=-E.y+D.tileset._tileSize.height-g)<0?0:x,A=E.y<0?0:E.y,b=-E.x<0?0:-E.x,I=(I=E.x+D.tileset._tileSize.width-f)<0?0:I,this._rightOffset<b&&(this._rightOffset=b),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<A&&(this._topOffset=A),this._downOffset<x&&(this._downOffset=x),O.left=y,O.bottom=v,O.index=C,this._cullingDirty=!0}}},e._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var s=0;s<i;++s)this._updateVertex(s,r);this._verticesDirty=!1}},e.getTiledTileAt=function(t,e,r){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return i(7236),null;var s=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiledTiles[s];if(!n&&r){var o=new I;return(n=o.addComponent(Gt))._x=t,n._y=e,n._layer=this,n.updateInfo(),o.parent=this.node,n}return n},e.setTiledTileAt=function(t,e,r){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return i(7236),null;var s=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[s]=r,this._cullingDirty=!0,this._hasTiledNodeGrid=!!r||this.tiledTiles.some((function(t){return!!t})),r},e.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},e.getTextures=function(){return this._textures},e.setTexture=function(t){this.setTextures([t])},e.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},e.getLayerSize=function(){return this._layerSize},e.getMapTileSize=function(){return this._mapTileSize},e.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},e.getTileSets=function(){return this._tilesets},e.setTileSet=function(t){this.setTileSets([t])},e.setTileSets=function(t){this._tilesets=t;var e=this._textures=[],i=this.texGrids;i.clear();for(var r=0;r<t.length;r++){var s=t[r];s&&(e[r]=s.sourceImage)}for(var n=0,o=t.length;n<o;++n){var a=t[n];a&&zt(a,i,a.sourceImage)}this._prepareToRender()},e.init=function(t,e,i,r,s){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var n=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=n,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=r,this.texGrids=s,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var o=this._mapTileSize.width,a=this._mapTileSize.height,h=this._layerSize.width,l=this._layerSize.height;if(this._layerOrientation===et.HEX){var u=0,f=0;this._odd_even=this._staggerIndex===nt.STAGGERINDEX_ODD?1:-1,this._staggerAxis===st.STAGGERAXIS_X?(this._diffX1=(o-this._hexSideLength)/2,this._diffY1=0,f=a*(l+.5),u=(o+this._hexSideLength)*Math.floor(h/2)+o*(h%2)):(this._diffX1=0,this._diffY1=(a-this._hexSideLength)/2,u=o*(h+.5),f=(a+this._hexSideLength)*Math.floor(l/2)+a*(l%2)),this.node._uiProps.uiTransformComp.setContentSize(u,f)}else if(this._layerOrientation===et.ISO){var g=h+l;this.node._uiProps.uiTransformComp.setContentSize(.5*o*g,.5*a*g)}else this.node._uiProps.uiTransformComp.setContentSize(h*o,l*a);this._offset=new P(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},e._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},e.requestTiledRenderData=function(){for(var t=this._tiledDataArray;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){var e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}var i={renderData:null,texture:null};return this._tiledDataArray.push(i),i},e.requestSubNodesData=function(){var t=this._tiledDataArray;if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._tiledDataArray.push(e),e},e.destroyRenderData=function(){this._tiledDataArray.forEach((function(t){var e=t.renderData;e&&Z.remove(e)})),this._tiledDataArray.length=0,t.prototype.destroyRenderData.call(this)},e._flushAssembler=function(){var t=r.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t,this._assembler.createData(this)),0===this._tiledDataArray.length&&(this.markForUpdateRenderData(),this._updateColor())},e._render=function(t){for(var e=0;e<this._tiledDataArray.length;e++){this._tiledDataArrayIdx=e;var i=this._tiledDataArray[e];if(i.subNodes)i.subNodes.forEach((function(e){e&&t.walk(e.node)}));else{var r=i;r.texture&&t.commitComp(this,r.renderData,r.texture,this._assembler,null)}}this.node._static=!0},e.createRenderEntity=function(){return new K(W.CROSSED)},e.fillIndicesBuffer=function(t,e){var i=t.chunk.meshBuffer.iData,r=t.chunk.meshBuffer.indexOffset;e.setIndexOffset(r);for(var s=t.chunk.vertexOffset,n=t.vertexCount/4,o=0;o<n;o+=1)i[r]=s,i[r+1]=s+1,i[r+2]=s+2,i[r+3]=s+2,i[r+4]=s+1,i[r+5]=s+3,r+=6,s+=4;t.chunk.meshBuffer.indexOffset=r,e.setIBCount(6*n)},e.prepareDrawData=function(){var t=this;this._drawInfoList.length=0;var e=this.renderEntity;e.clearDynamicRenderDrawInfos();var i=this._tiledDataArray,r=0;i.forEach((function(i){if(i.subNodes)i.subNodes.forEach((function(i){if(i){t._drawInfoList[r]||(t._drawInfoList[r]=new Y);var s=t._drawInfoList[r];s.setDrawInfoType(V.SUB_NODE),s.setSubNode(i.node),e.setDynamicRenderDrawInfo(s,r),r++}}));else{var s=i;if(s.texture){t._drawInfoList[r]||(t._drawInfoList[r]=new Y);var n=t._drawInfoList[r];s.renderData.fillDrawInfoAttributes(n),n.setTexture(s.texture.getGFXTexture()),n.setSampler(s.texture.getGFXSampler()),n.setMaterial(t.getRenderMaterial(0)),t.fillIndicesBuffer(s.renderData,n),e.setDynamicRenderDrawInfo(n,r),r++}}}))},s(r,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"tiledDataArray",get:function(){return this._tiledDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),r}(q))||Et),Ce=t("TiledObjectGroup",(Ft=y("cc.TiledObjectGroup"),Lt=b(),Mt=T(k),Rt=v(f),Ft(Xt=Lt(Xt=Mt((Ht=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}o(e,t);var i=e.prototype;return i.getPositionOffset=function(){return this._positionOffset},i.getProperties=function(){return this._properties},i.getGroupName=function(){return this._groupName},i.getProperty=function(t){return this._properties[t.toString()]},i.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},i.getObjects=function(){return this._objects},i._init=function(t,e,i){var r=rt.FLIPPED_MASK,s=rt.HORIZONTAL,n=rt.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new P(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=i,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var o=e.mapSize,a=e.tileSize,h=0,l=0,u=new G,f=et.ISO===e.orientation;if(e.orientation===et.HEX)e.getStaggerAxis()===st.STAGGERAXIS_X?(l=a.height*(o.height+.5),h=(a.width+e.getHexSideLength())*Math.floor(o.width/2)+a.width*(o.width%2)):(h=a.width*(o.width+.5),l=(a.height+e.getHexSideLength())*Math.floor(o.height/2)+a.height*(o.height%2));else if(f){var g=o.width+o.height;h=.5*a.width*g,l=.5*a.height*g}else h=o.width*a.width,l=o.height*a.height;var d=this.node._uiProps.uiTransformComp;d.setContentSize(h,l);for(var _=h*d.anchorX,m=l*(1-d.anchorY),y=t.objects,v={},w=0,A=y.length;w<A;w++){var b=y[w],S=b.type;b.offset=new P(b.x,b.y);var T=b.points||b.polylinePoints;if(T)for(var x=0;x<T.length;x++)T[x].y*=-1;if(f){var C=b.x/a.height,D=b.y/a.height;b.x=.5*a.width*(o.height+C-D),b.y=.5*a.height*(o.width+o.height-C-D)}else b.y=l-b.y;if(S===at.TEXT){var N="text"+b.id;v[N]=!0;var O=this.node.getChildByName(N);O||(O=new I),O.setRotationFromEuler(0,0,-b.rotation),O.setPosition(b.x-_,b.y-m),O.name=N,O.parent=this.node,O.setSiblingIndex(w);var E=O.getComponent(j);E||(E=O.addComponent(j));var z=O._uiProps.uiTransformComp;O.active=b.visible,z.anchorX=0,z.anchorY=1,this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,E.color.set(u)):E.color.a*=this._opacity/255,E.overflow=j.Overflow.SHRINK,E.lineHeight=b.height,E.string=b.text,E.horizontalAlign=b.halign,E.verticalAlign=b.valign,E.fontSize=b.pixelsize,z.setContentSize(b.width,b.height)}else if(S===at.IMAGE){var F=b.gid,L=(F&r)>>>0,M=i.get(L);if(!M)continue;var R=M.tileset,X="img"+b.id;v[X]=!0;var U=this.node.getChildByName(X);b.width=b.width||M.width,b.height=b.height||M.height,U&&U._objFlags&p.Flags.HideInHierarchy&&(U.removeFromParent(),U.hideFlags|=p.Flags.DontSave,U.destroy(),U=null),U||(U=new I),this._animations.get(L)&&(this.aniObjects.push({object:b,imgNode:U,gridGID:L}),this._hasAniObj=!0);var k=R.tileOffset.x,Y=R.tileOffset.y;U.active=b.visible,U.setRotationFromEuler(0,0,-b.rotation),U.setPosition(b.x-_,b.y-m),U.name=X,U.parent=this.node,U.setSiblingIndex(w);var V=U.getComponent(B);V||(V=U.addComponent(B));var Z=U._uiProps.uiTransformComp;f?(Z.anchorX=.5+k/b.width,Z.anchorY=Y/b.height):(Z.anchorX=k/b.width,Z.anchorY=Y/b.height),this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,V.color.set(u)):V.color.a*=this._opacity/255,V.sizeMode=B.SizeMode.CUSTOM;var K=this._premultiplyAlpha?c.ONE:c.SRC_ALPHA;V._srcBlendFactor!==K&&(V._srcBlendFactor=K,V.material&&V._updateBlendFunc());var W=M.spriteFrame;W=W?W.clone():new H,(F&s)>>>0&&(W.flipUVX=!W.flipUVX),(F&n)>>>0&&(W.flipUVY=!W.flipUVY),W.rotated=M._rotated,W.rect=M._rect,V.spriteFrame=W,Z.setContentSize(b.width,b.height),V.markForUpdateRenderData()}}this._objects=y;for(var q=this.node.children,J=/^(?:img|text)\d+$/,$=0,Q=q.length;$<Q;$++){var tt=q[$],it=tt.name;J.test(it)&&!v[it]&&tt.destroy()}},i.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=et.ISO===this._mapInfo.orientation,r=0,s=t.length;r<s;r++){var n=t[r],o=n.gridGID,a=e.get(o);if(a){var h=a.tileset,l=n.object,u=n.imgNode,f=h.tileOffset.x,g=h.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+f/l.width,d.anchorY=g/l.height):(d.anchorX=f/l.width,d.anchorY=g/l.height);var _=u.getComponent(B),p=_.spriteFrame;p.rotated=a._rotated,p.rect=a._rect,_.spriteFrame=p,_.markForUpdateRenderData()}}},s(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(x),h((Ut=Ht).prototype,"premultiplyAlpha",[Rt],Object.getOwnPropertyDescriptor(Ut.prototype,"premultiplyAlpha"),Ut.prototype),Xt=Ut))||Xt)||Xt)||Xt)),De=t("TiledMapAsset",(jt=y("cc.TiledMapAsset"),Bt=v([C]),kt=v([g]),Yt=v([H]),Vt=v([H]),Zt=v([g]),Kt=v([g]),Wt=v([z]),jt((oe=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,l(e,"tmxXmlStr",$t,u(e)),l(e,"tsxFiles",Qt,u(e)),l(e,"tsxFileNames",te,u(e)),l(e,"spriteFrames",ee,u(e)),l(e,"imageLayerSpriteFrame",ie,u(e)),l(e,"imageLayerSpriteFrameNames",re,u(e)),l(e,"spriteFrameNames",se,u(e)),l(e,"spriteFrameSizes",ne,u(e)),e}return o(e,t),e}(D),$t=h((Jt=oe).prototype,"tmxXmlStr",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qt=h(Jt.prototype,"tsxFiles",[N,Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),te=h(Jt.prototype,"tsxFileNames",[N,kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ee=h(Jt.prototype,"spriteFrames",[N,Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ie=h(Jt.prototype,"imageLayerSpriteFrame",[N,Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),re=h(Jt.prototype,"imageLayerSpriteFrameNames",[N,Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),se=h(Jt.prototype,"spriteFrameNames",[N,Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ne=h(Jt.prototype,"spriteFrameSizes",[N,Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qt=Jt))||qt)),Ne=(t("TiledMap",(ae=y("cc.TiledMap"),he=b(),le=S(),ue=T(k),fe=v(De),ge=E(),ae(de=he(de=le(de=ue(de=w((ve=ye=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new z(0,0),e._tileSize=new z(0,0),e._mapOrientation=et.ORTHO,e._isApplied=!1,l(e,"_tmxFile",pe,u(e)),l(e,"_enableCulling",ce,u(e)),l(e,"cleanupImageCache",me,u(e)),e}o(e,t);var r=e.prototype;return r.getMapSize=function(){return this._mapSize},r.getTileSize=function(){return this._tileSize},r.getMapOrientation=function(){return this._mapOrientation},r.getObjectGroups=function(){return this._groups},r.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getGroupName()===t)return s}return null},r.getProperties=function(){return this._properties},r.getLayers=function(){return this._layers},r.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getLayerName()===t)return s}return null},r._changeLayer=function(t,e){for(var i=this._layers,r=0,s=i.length;r<s;r++){var n=i[r];if(n&&n.getLayerName()===t)return void(i[r]=e)}},r.getProperty=function(t){return this._properties[t.toString()]},r.getPropertiesForGID=function(t){return this._tileProperties.get(t)},r.__preload=function(){this._tmxFile&&!1===this._isApplied&&(this._applyFile(),this._isApplied=!0)},r.onEnable=function(){this.node.on(A.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r.onDisable=function(){this.node.off(A.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._applyFile=function(){var t=[],e={},r=this._tmxFile;if(r){for(var s=r.spriteFrameNames,n=r.spriteFrameSizes,o=r.spriteFrames,a={},h={},l=0;l<s.length;++l){var u=s[l];h[u]=n[l],t[l]=o[l];var f=t[l];f&&(e[f.name]=f,a[u]=f)}var g={},d=r.imageLayerSpriteFrame;s=r.imageLayerSpriteFrameNames;for(var _=0;_<d.length;++_)g[s[_]]=d[_];for(var p=r.tsxFileNames,c=r.tsxFiles,m={},y=0;y<p.length;++y)p[y].length>0&&(m[p[y]]=c[y].text);var v=new Pt(r.tmxXmlStr,m,a,h,g),w=v.getTilesets();w&&0!==w.length||i(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},r._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++){var r,s;null===(r=t[e].node.parent)||void 0===r||r.off(A.SIZE_CHANGED,t[e].updateCulling,t[e]),null===(s=t[e].node.parent)||void 0===s||s.off(A.TRANSFORM_CHANGED,t[e].updateCulling,t[e]),t[e].node.removeFromParent(),t[e].node.destroy()}t.length=0;for(var n=this._groups,o=0,a=n.length;o<a;o++)n[o].node.removeFromParent(),n[o].node.destroy();n.length=0;for(var h=this._images,l=0,u=h.length;l<u;l++)h[l].removeFromParent(),h[l].destroy();h.length=0},r._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,s=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var n=this._groups[t],o=n.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var a=n.offset.x-r+o.width*o.anchorX,h=n.offset.y+s-o.height*o.anchorY;n.node.setPosition(a,h)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-r+l.width*l.anchorX,f=this._images[t]._offset.y+s-l.height*l.anchorY;this._images[t].setPosition(u,f)}},r._fillAniGrids=function(t,e){for(var i,r=d(e.keys());!(i=r()).done;){var s=i.value,n=e.get(s);if(n)for(var o=n.frames,a=0;a<o.length;a++){var h=o[a];h.grid=t.get(h.tileid)}}},r._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,i=this._animations;e.clear();for(var r=0,s=t.length;r<s;++r){var n=t[r];n&&(n.sourceImage?zt(n,e,n.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+r))}this._fillAniGrids(e,i);for(var o=this._layers,a=this._groups,h=this._images,l={},u=0,f=o.length;u<f;u++)l[o[u].node.name]=!0;for(var g=0,d=a.length;g<d;g++)l[a[g].node.name]=!0;for(var _=0,p=h.length;_<p;_++)l[h[_].name]=!0;o=this._layers=[],a=this._groups=[],h=this._images=[];var c=this._mapInfo,m=this.node,y=c.getAllChildren(),v=this._textures,w=0,A=0;if(y&&y.length>0)for(var b=0,S=y.length;b<S;b++){var T=y[b],x=T.name,C=this.node.getChildByName(x);if(l[x]=!1,C||((C=new I).name=x,C.layer=m.layer,m.addChild(C)),C.setSiblingIndex(b),C.active=T.visible,T instanceof ut){var D=C.getComponent(Ie);D||(D=C.addComponent(Ie)),D.init(T,c,t,v,e),D.enableCulling=this._enableCulling,T.ownTiles=!1,o.push(D)}else if(T instanceof lt){var N=C.getComponent(Ce);N||(N=C.addComponent(Ce)),N._init(T,c,e),a.push(N)}else if(T instanceof ft){var O=T.sourceImage;C.layerInfo=T,C._offset=new P(T.offset.x,-T.offset.y);var E=C.getComponent(B);E||(E=C.addComponent(B)),E.color.a*=T.opacity,E.spriteFrame=O;var G=O.width,z=O.height;O.original&&(G=O.originalSize.width,z=O.originalSize.height),C._uiProps.uiTransformComp.setContentSize(G,z),h.push(C)}w=Math.max(w,C._uiProps.uiTransformComp.width),A=Math.max(A,C._uiProps.uiTransformComp.height)}for(var F=m.children,L=0,M=F.length;L<M;L++){var R=F[L];l[R.name]&&R.destroy()}this.node._uiProps.uiTransformComp.setContentSize(w,A),this._syncAnchorPoint()},r._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var i=this._tilesets;this._textures.length=0;for(var r=[],s=0,n=i.length;s<n;++s){var o=i[s];o&&o.sourceImage&&(this._textures[s]=o.sourceImage,r.push(o.sourceImage))}for(var a=0;a<this._imageLayers.length;a++){var h=this._imageLayers[a];h&&h.sourceImage&&r.push(h.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((function(t){e.doCleanupImageCache(t)}))},r.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":R.hasFeature(R.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},r.lateUpdate=function(t){for(var e,i=this._animations,r=this._texGrids,s=d(i.keys());!(e=s()).done;){var n=e.value,o=i.get(n),a=o.frames,h=a[o.frameIdx];o.dt+=t,h.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=a.length&&(o.frameIdx=0),h=a[o.frameIdx]),r.set(n,h.grid)}for(var l=this.getLayers(),u=0,f=l.length;u<f;u++){var g=l[u];(g.hasAnimation()||g.node.hasChangedFlags)&&g.markForUpdateRenderData()}},s(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||_)&&(this._tmxFile=t,this._applyFile(),this._isApplied=!0)}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(x),ye.Orientation=et,ye.Property=it,ye.TileFlag=rt,ye.StaggerAxis=st,ye.StaggerIndex=nt,ye.TMXObjectType=at,ye.RenderOrder=ot,pe=h((_e=ve).prototype,"_tmxFile",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h(_e.prototype,"tmxAsset",[fe,ge],Object.getOwnPropertyDescriptor(_e.prototype,"tmxAsset"),_e.prototype),ce=h(_e.prototype,"_enableCulling",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),h(_e.prototype,"enableCulling",[O],Object.getOwnPropertyDescriptor(_e.prototype,"enableCulling"),_e.prototype),me=h(_e.prototype,"cleanupImageCache",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),de=_e))||de)||de)||de)||de)||de)),Math.ceil(10922.5)),Oe=[],Ee=0;Ee<4;Ee++)Oe.push(new M);var Pe,Ge,ze,Fe=new L,Le=new M,Me={row:0,col:0},Re={x:0,y:0},Xe={x:0,y:0},Ue={x:0,y:0},He={x:0,y:0},je=0,Be=0,ke=0,Ye=0,Ve=null,Ze=null,Ke={ensureAccessor:function(){if(!Ze){var t=X.root.device;X.root.batcher2D,Ze=new J(t,$,this.vCount),X.on(U.EVENT_BEFORE_DRAW,(function(){Ze.reset()}))}},createData:function(){},fillBuffers:function(t){if(t&&0!==t.tiledDataArray.length){for(var e=t.tiledDataArray[t._tiledDataArrayIdx].renderData,i=e.chunk.meshBuffer.iData,r=e.chunk.meshBuffer.indexOffset,s=e.chunk.vertexOffset,n=e.vertexCount/4,o=0;o<n;o+=1)i[r]=s,i[r+1]=s+1,i[r+2]=s+2,i[r+3]=s+2,i[r+4]=s+1,i[r+5]=s+3,r+=6,s+=4;e.chunk.meshBuffer.indexOffset=r}},updateRenderData:function(t){if(t.updateCulling(),Be=t.leftDownToCenterX,ke=t.leftDownToCenterY,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){var e,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var r=t.cullingRect;e=r.leftDown,i=r.rightTop}else e=Me,i=t.rightTop;switch(t.renderOrder){case ot.RightDown:Je(e,i,-1,1,t);break;case ot.LeftDown:Je(e,i,-1,-1,t);break;case ot.RightUp:Je(e,i,1,1,t);break;case ot.LeftUp:default:Je(e,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[3]=e.a/255;for(var r,s=t.tiledDataArray,n=d(s);!(r=n()).done;){var o=r.value;if(o.renderData)for(var a=o.renderData,h=a.vData,l=a.vertexStart,u=a.vertexCount;l<u;l++)h.set(i,9*l+5)}}};function We(t,e){var i;t._rotated?(Re.x=t.r,Re.y=t.t,Xe.x=t.l,Xe.y=t.t,Ue.x=t.r,Ue.y=t.b,He.x=t.l,He.y=t.b):(Re.x=t.l,Re.y=t.t,Xe.x=t.l,Xe.y=t.b,Ue.x=t.r,Ue.y=t.t,He.x=t.r,He.y=t.b),(e&rt.DIAGONAL)>>>0&&(i=Xe,Xe=Ue,Ue=i),(e&rt.HORIZONTAL)>>>0&&(i=Re,Re=Ue,Ue=i,i=Xe,Xe=He,He=i),(e&rt.VERTICAL)>>>0&&(i=Re,Re=Xe,Xe=i,i=Ue,Ue=He,He=i)}function qe(){if(!(Ye<1)&&Ve){var t=4*Ye,e=6*Ye,i=Ge.requestTiledRenderData();i.renderData=Z.add($),i.texture=Ve;var r=i.renderData;r.resize(t,e),r.chunk.vb.set(Pe.subarray(0,9*t),0),Ye=0,Ve=null}}function Je(t,e,i,r,s){if(!(e.row<0||e.col<0)){Ge=s;var n=s.node.worldMatrix;je=0;var o,a,h,l,u,f,g,d,_,p=s.tiledTiles,c=s.texGrids,m=s.tiles,y=18,v=27,w=s.vertices,A=0,b=0,S=0,T=0,x=0,I=0,C=!0;ze=We;var D=new Float32Array(4);D[0]=s.color.r/255,D[1]=s.color.g/255,D[2]=s.color.b/255,D[3]=s.color.a/255,-1===i?(l=e.row,u=t.row):(l=t.row,u=e.row);var N=Math.abs(t.row-e.row)+1,O=Math.abs(e.col-t.col)+1;Pe=new Float32Array(N*O*36),Ye=0;for(var E=Pe;(u-l)*i>=0;l+=i)for(o=w[l],I=s.getNodesCountByRow(l),C=o&&0===I,1===r?(a=C&&t.col<o.minCol?o.minCol:t.col,h=C&&e.col>o.maxCol?o.maxCol:e.col):(a=C&&e.col>o.maxCol?o.maxCol:e.col,h=C&&t.col<o.minCol?o.minCol:t.col);(h-a)*r>=0;a+=r){if(f=o&&o[a],I>0){qe();var P=s.requestSubNodesData(),G=s.getNodesByRowCol(l,a);G&&G.count>0&&(P.subNodes=G.list)}f&&(A=m[f.index],(d=c.get((A&rt.FLIPPED_MASK)>>>0))&&(Ve!==d.texture&&(qe(),Ve=d.texture),g=d.tileset._tileSize,b=f.left-Be,S=f.bottom-ke,T=b+g.width,x=S+g.height,_=p[f.index],je=36*Ye,_?_.node.active&&$e(_.node,D,E,b,T,x,S,!1):(Oe[0].x=b,Oe[0].y=x,Oe[1].x=b,Oe[1].y=S,Oe[2].x=T,Oe[2].y=x,Oe[3].x=T,Oe[3].y=S,Oe[0].transformMat4(n),E[je]=Oe[0].x,E[je+1]=Oe[0].y,E[je+2]=Oe[0].z,Oe[1].transformMat4(n),E[je+9]=Oe[1].x,E[je+9+1]=Oe[1].y,E[je+9+2]=Oe[1].z,Oe[2].transformMat4(n),E[je+y]=Oe[2].x,E[je+y+1]=Oe[2].y,E[je+y+2]=Oe[2].z,Oe[3].transformMat4(n),E[je+v]=Oe[3].x,E[je+v+1]=Oe[3].y,E[je+v+2]=Oe[3].z,E.set(D,je+5),E.set(D,je+9+5),E.set(D,je+y+5),E.set(D,je+v+5)),ze(d,A),E[je+3]=Re.x,E[je+4]=Re.y,E[je+9+3]=Xe.x,E[je+9+4]=Xe.y,E[je+y+3]=Ue.x,E[je+y+4]=Ue.y,E[je+v+3]=He.x,E[je+v+4]=He.y,++Ye>=Ne&&qe()))}qe()}}function $e(t,e,i,r,s,n,o,a){var h=18,l=27;t.updateWorldTransform(),L.fromRTS(Fe,t.rotation,t.position,t.scale),M.set(Le,-(r+Be),-(o+ke),0),L.transform(Fe,Fe,Le),L.multiply(Fe,t.parent.worldMatrix,Fe);var u=Fe,f=u.m12,g=u.m13,d=u.m00,_=u.m01,p=u.m04,c=u.m05,m=1===d&&0===_&&0===p&&1===c;if(a){var y=(r+s)/2,v=(n+o)/2;m?(i[je]=y+f,i[je+1]=n+g,i[je+9]=r+f,i[je+9+1]=v+g,i[je+h]=s+f,i[je+h+1]=v+g,i[je+l]=y+f,i[je+l+1]=o+g):(i[je]=y*d+n*p+f,i[je+1]=y*_+n*c+g,i[je+9]=r*d+v*p+f,i[je+9+1]=r*_+v*c+g,i[je+h]=s*d+v*p+f,i[je+h+1]=s*_+v*c+g,i[je+l]=y*d+o*p+f,i[je+l+1]=y*_+o*c+g)}else m?(i[je]=r+f,i[je+1]=n+g,i[je+9]=r+f,i[je+9+1]=o+g,i[je+h]=s+f,i[je+h+1]=n+g,i[je+l]=s+f,i[je+l+1]=o+g):(i[je]=r*d+n*p+f,i[je+1]=r*_+n*c+g,i[je+9]=r*d+o*p+f,i[je+9+1]=r*_+o*c+g,i[je+h]=s*d+n*p+f,i[je+h+1]=s*_+n*c+g,i[je+l]=s*d+o*p+f,i[je+l+1]=s*_+o*c+g);i.set(e,je+5),i.set(e,je+9+5),i.set(e,je+h+5),i.set(e,je+l+5)}var Qe=t("tiledLayerAssembler",{getAssembler:function(){return Ke}});Ie.Assembler=Qe}}}));
