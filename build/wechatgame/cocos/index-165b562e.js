System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./scene-asset-10397f71.js","./math-base-02e87bf8.js","./index-f2c2eec3.js","./pipeline-state-manager-f4a950fe.js","./deprecated-dacf9914.js","./deprecated-8c84be32.js","./touch-37ec7c16.js","./sprite-renderer-e42860e7.js","./sprite-eb671685.js","./ui-renderer-09c699a1.js","./graphics-1a828c83.js","./deprecated-62cdfa51.js"],(function(t){"use strict";var e,r,a,i,n,s,o,h,u,l,c,f,d,v,_,p,x,m,g,y,S,D,w,T,C,M,E,b,B,L,R,A,I,F,P,O,k,H,N,V,U,z,W,Z,Q,q,G,X,j,Y,K,J,$,tt,et,rt,at,it,nt,st,ot,ht,ut,lt,ct,ft,dt,vt,_t,pt,xt,mt,gt,yt,St,Dt,wt,Tt,Ct,Mt,Et,bt,Bt;return{setters:[function(t){e=t.av,r=t.ag,a=t.l,i=t.i,n=t.c,s=t.f,o=t.M,h=t.Q,u=t.A,l=t.F,c=t.d},function(t){f=t.aT,d=t.q,v=t.ac,_=t.e,p=t.g,x=t.y,m=t.aH,g=t.C,y=t.P},function(t){S=t.ci,D=t.aW,w=t.cj,T=t.aV,C=t.ch,M=t.ck,E=t.aM,b=t.a5,B=t.ad,L=t.bA,R=t.bG},function(t){A=t.e,I=t.i,F=t.C,P=t.a,O=t.R,k=t.S,H=t.V,N=t.O,V=t.L,U=t.N},function(){},function(t){z=t.g,W=t.Y,Z=t.d},function(t){Q=t.a},function(){},function(t){q=t.I},function(t){G=t.d,X=t.S},function(t){j=t.m,Y=t.n,K=t.b,J=t.O,$=t.e,tt=t.i,et=t.H,rt=t.V,at=t.o,it=t.p,nt=t.c,st=t.s,ot=t.l,ht=t.d,ut=t.g,lt=t.B,ct=t.a,ft=t.T},function(t){dt=t.S,vt=t.i,_t=t.h,pt=t.j,xt=t.c,mt=t.k,gt=t.M,yt=t.b,St=t.R},function(t){Dt=t.L,wt=t.a,Tt=t.P,Ct=t.b,Mt=t.G},function(t){Et=t.L,bt=t.b,Bt=t.D}],execute:function(){t("e",$t);var Lt=new A;function Rt(t,e,r,a){var i=r.chunk,n=r.data,s=i.vb,o=r.vertexCount;t.getWorldMatrix(Lt);for(var h=0,u=0;u<o;u++){var l=n[u],c=l.x,f=l.y,d=Lt.m03*c+Lt.m07*f+Lt.m15;d=d?Math.abs(1/d):1,s[h+0]=(Lt.m00*c+Lt.m04*f+Lt.m12)*d,s[h+1]=(Lt.m01*c+Lt.m05*f+Lt.m13)*d,s[h+2]=(Lt.m02*c+Lt.m06*f+Lt.m14)*d,F.toArray(s,a,h+5),h+=9}i.bufferId;for(var v=i.vertexOffset,_=i.meshBuffer,p=i.meshBuffer.iData,x=_.indexOffset,m=0,g=o/4;m<g;m++){var y=v+4*m;p[x++]=y,p[x++]=y+1,p[x++]=y+2,p[x++]=y+1,p[x++]=y+3,p[x++]=y+2}_.indexOffset+=r.indexCount,_.setDirty()}var At=function(t,e,r){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=r};function It(t,e,r,a,i){var n=0,s=null;if(i===function(t,e,r,a){for(var i=0,n=e,s=r-a;n<r;n+=a)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}(t,e,r,a)>0)for(n=e;n<r;n+=a)s=Kt(n,t[n],t[n+1],s);else for(n=r-a;n>=e;n-=a)s=Kt(n,t[n],t[n+1],s);return s&&Gt(s,s.next)&&(Jt(s),s=s.next),s}function Ft(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var r=t,a=!1;do{if(a=!1,r.steiner||!Gt(r,r.next)&&0!==qt(r.prev,r,r.next))r=r.next;else{if(Jt(r),(r=e=r.prev)===r.next)return null;a=!0}}while(a||r!==e);return e}function Pt(t,e,r,a,i,n,s){if(void 0===s&&(s=0),t){!s&&n&&function(t,e,r,a){var i=t;do{null===i.z&&(i.z=zt(i.x,i.y,e,r,a)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e=0,r=null,a=null,i=null,n=null,s=0,o=0,h=0,u=1;do{for(r=t,t=null,n=null,s=0;r;){for(s++,a=r,o=0,e=0;e<u&&(o++,a=a.nextZ);e++);for(h=u;o>0||h>0&&a;)0===o?(i=a,a=a.nextZ,h--):0!==h&&a?r.z<=a.z?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,h--):(i=r,r=r.nextZ,o--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;r=a}n.nextZ=null,u*=2}while(s>1)}(i)}(t,a,i,n);for(var o=t,h=null,u=null;t.prev!==t.next;)if(h=t.prev,u=t.next,n?kt(t,a,i,n):Ot(t))e.push(h.i/r),e.push(t.i/r),e.push(u.i/r),Jt(t),t=u.next,o=u.next;else if((t=u)===o){s?1===s?Pt(t=Ht(t,e,r),e,r,a,i,n,2):2===s&&Nt(t,e,r,a,i,n):Pt(Ft(t),e,r,a,i,n,1);break}}}function Ot(t){var e=t.prev,r=t,a=t.next;if(qt(e,r,a)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Zt(e.x,e.y,r.x,r.y,a.x,a.y,i.x,i.y)&&qt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function kt(t,e,r,a){var i=t.prev,n=t,s=t.next;if(qt(i,n,s)>=0)return!1;for(var o=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,h=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,u=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,l=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,c=zt(o,h,e,r,a),f=zt(u,l,e,r,a),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Zt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&qt(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&Zt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&qt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function Ht(t,e,r){var a=t;do{var i=a.prev,n=a.next.next;!Gt(i,n)&&Xt(i,a,a.next,n)&&jt(i,n)&&jt(n,i)&&(e.push(i.i/r),e.push(a.i/r),e.push(n.i/r),Jt(a),Jt(a.next),a=t=n),a=a.next}while(a!==t);return a}function Nt(t,e,r,a,i,n){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Qt(s,o)){var h=Yt(s,o);return s=Ft(s,s.next),h=Ft(h,h.next),Pt(s,e,r,a,i,n),void Pt(h,e,r,a,i,n)}o=o.next}s=s.next}while(s!==t)}function Vt(t,e){return t.x-e.x}function Ut(t,e){if(e=function(t,e){var r=e,a=t.x,i=t.y,n=-1/0,s=null;do{if(i<=r.y&&i>=r.next.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>n){if(n=o,o===a){if(i===r.y)return r;if(i===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(a===n)return s.prev;var h,u=s,l=s.x,c=s.y,f=1/0;for(r=s.next;r!==u;)a>=r.x&&r.x>=l&&Zt(i<c?a:n,i,l,c,i<c?n:a,i,r.x,r.y)&&((h=Math.abs(i-r.y)/(a-r.x))<f||h===f&&r.x>s.x)&&jt(r,t)&&(s=r,f=h),r=r.next;return s}(t,e)){var r=Yt(e,t);Ft(r,r.next)}}function zt(t,e,r,a,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wt(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Zt(t,e,r,a,i,n,s,o){return(i-s)*(e-o)-(t-s)*(n-o)>=0&&(t-s)*(a-o)-(r-s)*(e-o)>=0&&(r-s)*(n-o)-(i-s)*(a-o)>=0}function Qt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Xt(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&jt(t,e)&&jt(e,t)&&function(t,e){var r=t,a=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(a=!a),r=r.next}while(r!==t);return a}(t,e)}function qt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Gt(t,e){return t.x===e.x&&t.y===e.y}function Xt(t,e,r,a){return!!(Gt(t,e)&&Gt(r,a)||Gt(t,a)&&Gt(r,e))||qt(t,e,r)>0!=qt(t,e,a)>0&&qt(r,a,t)>0!=qt(r,a,e)>0}function jt(t,e){return qt(t.prev,t,t.next)<0?qt(t,e,t.next)>=0&&qt(t,t.prev,e)>=0:qt(t,e,t.prev)<0||qt(t,t.next,e)<0}function Yt(t,e){var r=new At(t.i,t.x,t.y),a=new At(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,a.next=r,r.prev=a,n.next=a,a.prev=n,a}function Kt(t,e,r,a){var i=new At(t,e,r);return a?(i.next=a.next,i.prev=a,a.next.prev=i,a.next=i):(i.prev=i,i.next=i),i}function Jt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $t(t,e,r){r=r||3;var a=e?e.length:0,i=a?e[0]*r:t.length,n=It(t,0,i,r,!0),s=[];if(!n)return s;var o=0,h=0,u=0,l=0,c=0,f=0,d=0;if(a&&(n=function(t,e,r,a){var i,n=[],s=0,o=null;for(s=0,i=e.length;s<i;s++)(o=It(t,e[s]*a,s<i-1?e[s+1]*a:t.length,a,!1))&&(o===o.next&&(o.steiner=!0),n.push(Wt(o)));if(n.sort(Vt),!r)return r;for(s=0;s<n.length;s++)Ut(n[s],r),r=Ft(r,r.next);return r}(t,e,n,r)),t.length>80*r){o=u=t[0],h=l=t[1];for(var v=r;v<i;v+=r)(c=t[v])<o&&(o=c),(f=t[v+1])<h&&(h=f),c>u&&(u=c),f>l&&(l=f);d=Math.max(u-o,l-h)}return Pt(n,s,r,o,h,d),s}for(var te=Math.PI,ee=Math.min,re=Math.max,ae=Math.ceil,ie=Math.acos,ne=Math.cos,se=Math.sin,oe=Math.atan2,he=null,ue=null,le=new F,ce=[],fe=0;fe<4;fe++)ce.push(new P);function de(t,e,r){return t<e?e:t>r?r:t}var ve={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!ue)return null;var r=ue.getRenderDataList(),a=r[ue.dataOffset];if(!a)return null;var i=a,n=i?i.vertexStart+e:0;return(n>65535||3*n>131070)&&(++ue.dataOffset,ue.dataOffset<r.length?a=r[ue.dataOffset]:(a=ue.requestRenderData(),r[ue.dataOffset]=a),i=a),i&&i.vertexCount<n&&i.request(e,3*e),a},stroke:function(t){F.copy(le,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){F.copy(le,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,r=t.lineCap,a=t.lineJoin,i=t.miterLimit;if(ue=t.impl){var n,s,o,h,u=(n=e,s=te,o=ue.tessTol,h=2*ie(n/(n+o)),re(2,ae(s/h)));this._calculateJoins(ue,e,a,i);for(var l=ue.paths,c=0,f=ue.pathOffset,d=ue.pathLength;f<d;f++){var v=l[f],_=v.points.length;a===Dt.ROUND?c+=2*(_+v.bevel*(u+2)+1):c+=2*(_+5*v.bevel+1),v.closed||(r===wt.ROUND?c+=2*(2*u+2):c+=12)}var p=he=this.getRenderData(t,c);if(p){for(var x=p.vData,m=p.iData,g=ue.pathOffset,y=ue.pathLength;g<y;g++){var S=l[g],D=S.points,w=D.length,T=p.vertexStart,C=void 0,M=void 0,E=0,b=0,B=S.closed;if(B?(C=D[w-1],M=D[0],E=0,b=w):(C=D[0],M=D[1],E=1,b=w-1),M=M||C,!B){var L=new Tt(M.x,M.y);L.subtract(C),L.normalize();var R=L.x,A=L.y;r===wt.BUTT?this._buttCapStart(C,R,A,e,0):r===wt.SQUARE?this._buttCapStart(C,R,A,e,e):r===wt.ROUND&&this._roundCapStart(C,R,A,e,u)}for(var I=E;I<b;++I)a===Dt.ROUND?this._roundJoin(C,M,e,e,u):0!=(M.flags&(Ct.PT_BEVEL|Ct.PT_INNERBEVEL))?this._bevelJoin(C,M,e,e):(this._vSet(M.x+M.dmx*e,M.y+M.dmy*e,1),this._vSet(M.x-M.dmx*e,M.y-M.dmy*e,-1)),C=M,M=D[I+1];if(B){var F=8*T;this._vSet(x[F],x[F+1],1),this._vSet(x[F+8],x[F+8+1],-1)}else{var P=new Tt(M.x,M.y);P.subtract(C),P.normalize();var O=P.x,k=P.y;r===wt.BUTT?this._buttCapEnd(M,O,k,e,0):r===wt.SQUARE?this._buttCapEnd(M,O,k,e,e):r===wt.ROUND&&this._roundCapEnd(M,O,k,e,u)}for(var H=p.indexStart,N=T+2,V=p.vertexStart;N<V;N++)m[H++]=N-2,m[H++]=N-1,m[H++]=N;p.indexStart=H}he=null,ue=null}}},_expandFill:function(t){if(ue=t.impl){for(var e=ue.paths,r=0,a=ue.pathOffset,i=ue.pathLength;a<i;a++)r+=e[a].points.length;var n=he=this.getRenderData(t,r);if(n){for(var s=n,o=s.vData,h=s.iData,u=ue.pathOffset,l=ue.pathLength;u<l;u++){var c=e[u],f=c.points,d=f.length;if(0!==d){for(var v=n.vertexStart,_=0;_<d;++_)this._vSet(f[_].x,f[_].y);var p=n.indexStart;if(c.complex){for(var x=[],m=v,g=n.vertexStart;m<g;m++){var y=8*m;x.push(o[y++]),x.push(o[y++]),x.push(o[y++])}var S=$t(x,null,3);if(!S||0===S.length)continue;for(var D=0,w=S.length;D<w;D++)h[p++]=S[D]+v}else for(var T=v,C=v+2,M=s.vertexStart;C<M;C++)h[p++]=T,h[p++]=C-1,h[p++]=C;s.indexStart=p}}he=null,ue=null}}},_calculateJoins:function(t,e,r,a){var i=0;e>0&&(i=1/e);for(var n=t.paths,s=t.pathOffset,o=t.pathLength;s<o;s++){var h=n[s],u=h.points,l=u.length,c=u[l-1],f=u[0];h.bevel=0;for(var d=0;d<l;d++){var v,_,p=c.dy,x=-c.dx,m=f.dy,g=-f.dx;if(f.dmx=.5*(p+m),f.dmy=.5*(x+g),(v=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var y=1/v;y>600&&(y=600),f.dmx*=y,f.dmy*=y}f.dx*c.dy-c.dx*f.dy>0&&(f.flags|=Ct.PT_LEFT),v*(_=re(11,ee(c.len,f.len)*i))*_<1&&(f.flags|=Ct.PT_INNERBEVEL),f.flags&Ct.PT_CORNER&&(v*a*a<1||r===Dt.BEVEL||r===Dt.ROUND)&&(f.flags|=Ct.PT_BEVEL),0!=(f.flags&(Ct.PT_BEVEL|Ct.PT_INNERBEVEL))&&h.bevel++,c=f,f=u[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,r=t.pathOffset,a=t.pathLength;r<a;r++){var i=e[r],n=i.points,s=n[n.length-1],o=n[0];n.length>2&&s.equals(o)&&(i.closed=!0,n.pop(),s=n[n.length-1]);for(var h=0,u=n.length;h<u;h++){var l=new Tt(o.x,o.y);l.subtract(s),s.len=l.length(),(l.x||l.y)&&l.normalize(),s.dx=l.x,s.dy=l.y,s=o,o=n[h+1]}}},_chooseBevel:function(t,e,r,a){var i=r.x,n=r.y,s=0,o=0,h=0,u=0;return 0!==t?(s=i+e.dy*a,o=n-e.dx*a,h=i+r.dy*a,u=n-r.dx*a):(s=h=i+r.dmx*a,o=u=n+r.dmy*a),[s,o,h,u]},_buttCapStart:function(t,e,r,a,i){var n=t.x-e*i,s=t.y-r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_buttCapEnd:function(t,e,r,a,i){var n=t.x+e*i,s=t.y+r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapStart:function(t,e,r,a,i){for(var n=t.x,s=t.y,o=r,h=-e,u=0;u<i;u++){var l=u/(i-1)*te,c=ne(l)*a,f=se(l)*a;this._vSet(n-o*c-e*f,s-h*c-r*f,1),this._vSet(n,s,0)}this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapEnd:function(t,e,r,a,i){var n=t.x,s=t.y,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1);for(var u=0;u<i;u++){var l=u/(i-1)*te,c=ne(l)*a,f=se(l)*a;this._vSet(n,s,0),this._vSet(n-o*c+e*f,s-h*c+r*f,1)}},_roundJoin:function(t,e,r,a,i){var n=t.dy,s=-t.dx,o=e.dy,h=-e.dx,u=e.x,l=e.y;if(0!=(e.flags&Ct.PT_LEFT)){var c=this._chooseBevel(e.flags&Ct.PT_INNERBEVEL,t,e,r),f=c[0],d=c[1],v=c[2],_=c[3],p=oe(-s,-n),x=oe(-h,-o);x>p&&(x-=2*te),this._vSet(f,d,1),this._vSet(u-n*a,e.y-s*a,-1);for(var m=de(ae((p-x)/te)*i,2,i),g=0;g<m;g++){var y=p+g/(m-1)*(x-p),S=u+ne(y)*a,D=l+se(y)*a;this._vSet(u,l,0),this._vSet(S,D,-1)}this._vSet(v,_,1),this._vSet(u-o*a,l-h*a,-1)}else{var w=this._chooseBevel(e.flags&Ct.PT_INNERBEVEL,t,e,-a),T=w[0],C=w[1],M=w[2],E=w[3],b=oe(s,n),B=oe(h,o);B<b&&(B+=2*te),this._vSet(u+n*a,l+s*a,1),this._vSet(T,C,-1);for(var L=de(ae((B-b)/te)*i,2,i),R=0;R<L;R++){var A=b+R/(L-1)*(B-b),I=u+ne(A)*r,F=l+se(A)*r;this._vSet(I,F,1),this._vSet(u,l,0)}this._vSet(u+o*a,l+h*a,1),this._vSet(M,E,-1)}},_bevelJoin:function(t,e,r,a){var i=0,n=0,s=0,o=0,h=0,u=0,l=0,c=0,f=t.dy,d=-t.dx,v=e.dy,_=-e.dx;if(e.flags&Ct.PT_LEFT){var p=this._chooseBevel(e.flags&Ct.PT_INNERBEVEL,t,e,r);h=p[0],u=p[1],l=p[2],c=p[3],this._vSet(h,u,1),this._vSet(e.x-f*a,e.y-d*a,-1),this._vSet(l,c,1),this._vSet(e.x-v*a,e.y-_*a,-1)}else{var x=this._chooseBevel(e.flags&Ct.PT_INNERBEVEL,t,e,-a);i=x[0],n=x[1],s=x[2],o=x[3],this._vSet(e.x+f*r,e.y+d*r,1),this._vSet(i,n,-1),this._vSet(e.x+v*r,e.y+_*r,1),this._vSet(s,o,-1)}},_vSet:function(t,e,r){if(void 0===r&&(r=0),he){var a=he,i=8*a.vertexStart,n=a.vData;n[i++]=t,n[i++]=e,n[i++]=0,F.toArray(n,le,i),i+=4,n[i++]=r,a.vertexStart++}}},_e=t("g",{getAssembler:function(){return ve}});Mt.Assembler=_e;var pe,xe=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},me=new O,ge=new j(64,64),ye=new at(null),Se=null,De=null,we=[],Te=[],Ce=[],Me=[],Ee=new k,be=new k,Be=new H,Le=null,Re=0,Ae=0,Ie=0,Fe=0,Pe=0,Oe=1,ke=null,He="",Ne=0,Ve=0,Ue=0,ze=0,We=0,Ze=0,Qe=0,qe=!1,Ge=0,Xe=0,je=0,Ye={updateRenderData:function(t){t.renderData&&Se!==t&&(t.renderData.vertDirty&&(De=(Se=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),Se.actualFontSize=Ne,De.setContentSize(be),this.updateUVs(t),this.updateColor(t),Se.renderData.vertDirty=!1,Se=null,this._resetProperties()),t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame))},updateUVs:function(t){for(var e=t.renderData,r=e.chunk.vb,a=e.vertexCount,i=e.data,n=3,s=0;s<a;s++){var o=i[s];r[n]=o.u,r[n+1]=o.v,n+=9}},updateColor:function(){},_updateFontScale:function(){Oe=Ne/Ve},_updateFontFamily:function(t){var e=t.font;ke=e.spriteFrame,Le=e.fntConfig,Y.fontAtlas=e.fontDefDictionary,Y.fontAtlas||(t.cacheMode===K.CHAR?Y.fontAtlas=ge:Y.fontAtlas=ye),G.packToDynamicAtlas(t,ke)},_updateLabelInfo:function(){Y.hash="",Y.margin=0},_updateProperties:function(t){He=t.string.toString(),Ne=t.fontSize,Ve=Le?Le.fontSize:t.fontSize,Ue=t.horizontalAlign,ze=t.verticalAlign,We=t.spacingX,Qe=t.overflow,Ze=t._lineHeight;var e=De.contentSize;be.width=e.width,be.height=e.height,Qe===J.NONE?(qe=!1,be.width+=2*Y.margin,be.height+=2*Y.margin):Qe===J.RESIZE_HEIGHT?(qe=!0,be.height+=2*Y.margin):qe=t.enableWrapText,Y.lineHeight=Ze,Y.fontSize=Ne,this._setupBMFontOverflowMetrics()},_resetProperties:function(){Le=null,ke=null,Y.hash="",Y.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){var t=He,e=t.length,r=Le.kerningDict,a=we;if(r)for(var i=-1,n=0;n<e;++n){var s=t.charCodeAt(n),o=r[i<<16|65535&s]||0;a[n]=n<e-1?o:0,i=s}},_multilineTextWrap:function(t){for(var e=He.length,r=0,a=0,i=0,n=0,s=0,o=0,h=0,u=null,l=0;l<e;){var c=He.charAt(l);if("\n"!==c){for(var f=t(He,l,e),d=o,v=h,_=s,p=a,x=!1,m=0;m<f;++m){var g=l+m;if("\r"!==(c=He.charAt(g)))if(u=Y.fontAtlas.getLetterDefinitionForChar(c,Y)){var y=p+u.offsetX*Oe-Y.margin;if(qe&&je>0&&a>0&&y+u.w*Oe>je&&!$(c)){Ce.push(s),s=0,r++,a=0,i-=Ze*this._getFontScale()+0,x=!0;break}Be.x=y,Be.y=i-u.offsetY*Oe,this._recordLetterInfo(Be,c,g,r),g+1<we.length&&g<e-1&&(p+=we[g+1]),p+=u.xAdvance*Oe+We,_=Be.x+u.w*Oe,d<Be.y&&(d=Be.y),v>Be.y-u.h*Oe&&(v=Be.y-u.h*Oe)}else this._recordPlaceholderInfo(g,c),console.log("Can't find letter definition in texture atlas "+Le.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(g,c)}x||(a=p,o<d&&(o=d),h>v&&(h=v),n<(s=_)&&(n=s),l+=f)}else Ce.push(s),s=0,r++,a=0,i-=Ze*this._getFontScale()+0,this._recordPlaceholderInfo(l,c),l++}return Ce.push(s),Ae=(Re=r+1)*Ze*this._getFontScale(),Re>1&&(Ae+=0*(Re-1)),be.width=Ge,be.height=Xe,Ge<=0&&(be.width=parseFloat(n.toFixed(2))+2*Y.margin),Xe<=0&&(be.height=parseFloat(Ae.toFixed(2))+2*Y.margin),Fe=be.height,Pe=0,o>0&&(Fe=be.height+o),h<-Ae&&(Pe=Ae+h),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return Qe===J.SHRINK?Oe:1},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(tt(a)||"\n"===a||$(a))return 1;var i=1,n=Y.fontAtlas.getLetterDefinitionForChar(a,Y);if(!n)return i;for(var s=n.xAdvance*Oe+We,o=e+1;o<r&&(a=t.charAt(o),n=Y.fontAtlas.getLetterDefinitionForChar(a,Y));++o){if(s+n.offsetX*Oe+n.w*Oe>je&&!$(a)&&je>0)return i;if(s+=n.xAdvance*Oe+We,"\n"===a||$(a)||tt(a))break;i++}return i},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=Te.length){var r=new xe;Te.push(r)}Te[t].char=e,Te[t].hash=""+e.charCodeAt(0)+Y.hash,Te[t].valid=!1},_recordLetterInfo:function(t,e,r,a){if(r>=Te.length){var i=new xe;Te.push(i)}var n=""+e.charCodeAt(0)+Y.hash;Te[r].line=a,Te[r].char=e,Te[r].hash=n,Te[r].valid=Y.fontAtlas.getLetter(n).valid,Te[r].x=t.x,Te[r].y=t.y},_alignText:function(){Ae=0,Ce.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),Qe===J.SHRINK&&Ne>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||Qe===J.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),Ne=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,r=0|Ne,a=0;e<r;){var i=a=e+r+1>>1;if(i<=0)break;Oe=i/Ve,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=a-1:e=a}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return Ae>be.height},_isHorizontalClamp:function(){for(var t=!1,e=0,r=He.length;e<r;++e){var a=Te[e];if(a.valid){var i=Y.fontAtlas.getLetterDefinitionForChar(a.char,Y);if(!i)continue;var n=a.x+i.w*Oe,s=a.line;if(Ge>0)if(qe){if(Ce[s]>be.width&&(n>be.width||n<0)){t=!0;break}}else if(n>be.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var r=Ce[e],a=t>be.width||t<0;return qe?r>be.width&&a:a},_updateQuads:function(){if(!Se)return!1;var t=ke?ke.texture:Y.fontAtlas.getTexture(),e=Se.renderData;e.dataLength=0,e.resize(0,0);for(var r=De.anchorPoint,a=be,i=r.x*a.width,n=r.y*a.height,s=!0,o=0,h=He.length;o<h;++o){var u=Te[o];if(u.valid){var l=Y.fontAtlas.getLetter(u.hash);if(l){me.height=l.h,me.width=l.w,me.x=l.u,me.y=l.v;var c=u.y+Ie;if(Xe>0){if(c>Fe){var f=c-Fe;me.y+=f,me.height-=f,c-=f}c-me.height*Oe<Pe&&Qe===J.CLAMP&&(me.height=c<Pe?0:(c-Pe)/Oe)}var d=u.line,v=u.x+l.w/2*Oe+Me[d];if(Ge>0&&this._isHorizontalClamped(v,d))if(Qe===J.CLAMP)me.width=0;else if(Qe===J.SHRINK){if(be.width>l.w){s=!1;break}me.width=0}if(me.height>0&&me.width>0){var _=this._determineRect(),p=u.x+Me[u.line];this.appendQuad(Se,t,me,_,p-i,c-n,Oe)}}else console.warn("Can't find letter in this bitmap-font")}}var x=e.indexCount;return this.createQuadIndices(x),e.chunk.setIndexBuffer(pe),s},createQuadIndices:function(t){if(t%6==0){var e=t/6;pe=null,pe=new Uint16Array(t);for(var r=0,a=0;a<e;a++)pe[r++]=0+4*a,pe[r++]=1+4*a,pe[r++]=2+4*a,pe[r++]=1+4*a,pe[r++]=3+4*a,pe[r++]=2+4*a}else console.error("illegal index count!")},appendQuad:function(){},_determineRect:function(){var t=ke.isRotated(),e=ke.getOriginalSize(),r=ke.getRect(),a=ke.getOffset(),i=a.x+(e.width-r.width)/2,n=a.y-(e.height-r.height)/2;if(t){var s=me.x;me.x=r.x+r.height-me.y-me.height-n,me.y=s+r.y-i,me.y<0&&(me.height+=n)}else me.x+=r.x-i,me.y+=r.y+n;return t},_computeAlignmentOffset:function(){switch(Me.length=0,Ue){case et.LEFT:for(var t=0;t<Re;++t)Me.push(0);break;case et.CENTER:for(var e=0,r=Ce.length;e<r;e++)Me.push((be.width-Ce[e])/2);break;case et.RIGHT:for(var a=0,i=Ce.length;a<i;a++)Me.push(be.width-Ce[a])}if(Ie=be.height,ze!==rt.TOP){var n=be.height-Ae+Ze*this._getFontScale()-Ve*Oe;ze===rt.BOTTOM?Ie-=n:Ie-=n/2}},_setupBMFontOverflowMetrics:function(){var t=be.width,e=be.height;Qe===J.RESIZE_HEIGHT&&(e=0),Qe===J.NONE&&(t=0,e=0),Ge=t,Xe=e,Ee.width=t,Ee.height=e,je=t}},Ke=new F(255,255,255,255),Je={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){var e=t.node;Ke.set(t.color),Ke.a=255*e._uiProps.opacity,Rt(e,0,t.renderData,Ke)},appendQuad:function(t,e,r,a,i,n,s){var o=t.renderData;if(o){var h=o.dataLength;o.dataLength+=4,o.resize(o.dataLength,o.dataLength/2*3);var u=o.data,l=e.width,c=e.height,f=r.width,d=r.height,v=0,_=0,p=0,x=0;a?(v=r.x/l,x=(r.x+d)/l,_=(r.y+f)/c,p=r.y/c,u[h].u=v,u[h].v=p,u[h+1].u=v,u[h+1].v=_,u[h+2].u=x,u[h+2].v=p,u[h+3].u=x,u[h+3].v=_):(v=r.x/l,x=(r.x+f)/l,_=(r.y+d)/c,p=r.y/c,u[h].u=v,u[h].v=_,u[h+1].u=x,u[h+1].v=_,u[h+2].u=v,u[h+2].v=p,u[h+3].u=x,u[h+3].v=p),u[h].x=i,u[h].y=n-d*s,u[h+1].x=i+f*s,u[h+1].y=n-d*s,u[h+2].x=i,u[h+2].y=n,u[h+3].x=i+f*s,u[h+3].y=n}}};e(Je,Ye);var $e=null,tr=r(Ye,{getAssemblerData:function(){return $e||($e=new j(1024,1024)),$e.getTexture()},_updateFontFamily:function(t){Y.fontAtlas=$e,Y.fontFamily=this._getFontFamily(t);var e=t.getComponent(Et);e&&e.enabled?(Y.isOutlined=!0,Y.margin=e.width,Y.out=e.color.clone(),Y.out.a=e.color.a*t.color.a/255):(Y.isOutlined=!1,Y.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){Y.fontDesc=this._getFontDesc(),Y.color=t.color,Y.hash=it(Y)},_getFontDesc:function(){return Y.fontSize.toString()+"px "+Y.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),er=new F(255,255,255,255),rr={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){if(t.renderData){var e=t.node;er.a=255*e._uiProps.opacity,Rt(e,0,t.renderData,er)}},appendQuad:Je.appendQuad};e(rr,tr);var ar=nt.Overflow,ir=ut(),nr=(1/255).toFixed(3),sr=null,or=null,hr=null,ur="",lr="",cr=0,fr=0,dr=[],vr=new k,_r=0,pr=0,xr=0,mr=new F,gr="",yr=ar.NONE,Sr=!1,Dr=null,wr=F.BLACK.clone(),Tr=null,Cr=F.BLACK.clone(),Mr=new O,Er=k.ZERO.clone(),br=k.ZERO.clone(),Br=H.ZERO.clone(),Lr=H.ZERO.clone(),Rr=0,Ar=0,Ir=!1,Fr=!1,Pr=!1,Or=["left","center","right"],kr={getAssemblerData:function(){var t=nt._canvasPool.get();return t.canvas.width=t.canvas.height=1,t},resetAssemblerData:function(t){t&&nt._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData){if(t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this._calDynamicAtlas(t),t.actualFontSize=cr,e.setContentSize(vr),this.updateVertexData(t),this.updateUVs(t),t.renderData.vertDirty=!1,t.contentWidth=br.width,sr=null,or=null,hr=null}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},updateVertexData:function(){},updateUVs:function(){},_updateFontFamily:function(t){gr=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var r=t.assemblerData;r&&(sr=r.context,or=r.canvas,hr=t.spriteFrame,lr=t.string.toString(),cr=t.fontSize,fr=cr,yr=t.overflow,br.width=vr.width=e.width,br.height=vr.height=e.height,Ar=t.underlineHeight,_r=t.lineHeight,pr=t.horizontalAlign,xr=t.verticalAlign,mr=t.color,t.node._uiProps.opacity,Ir=t.isBold,Fr=t.isItalic,Pr=t.isUnderline,Sr=yr!==ar.NONE&&(yr===ar.RESIZE_HEIGHT||t.enableWrapText),(Dr=(Dr=Et&&t.getComponent(Et))&&Dr.enabled&&Dr.width>0?Dr:null)&&wr.set(Dr.color),(Tr=(Tr=bt&&t.getComponent(bt))&&Tr.enabled?Tr:null)&&Cr.set(Tr.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,r=0,a=0,i=0;if(Er.width=Er.height=0,Dr&&(t=e=r=a=i=Dr.width,Er.width=Er.height=2*i),Tr){var n=Tr.blur+i,s=Tr.offset.x,o=Tr.offset.y;r=Math.max(r,-s+n),a=Math.max(a,s+n),t=Math.max(t,o+n),e=Math.max(e,-o+n)}if(Fr){var h=fr*Math.tan(.20943951);a+=h,Er.width+=h}Mr.x=r,Mr.y=t,Mr.width=r+a,Mr.height=t+e},_calculateFillTextStartPosition:function(){var t=0;pr===et.RIGHT?t=vr.width-Mr.width:pr===et.CENTER&&(t=(vr.width-Mr.width)/2);var e=this._getLineHeight()*(dr.length-1),r=cr*(1-ht/2);if(xr!==rt.TOP){var a=e+Mr.height+cr-vr.height;xr===rt.BOTTOM?r-=a+=ht/2*cr:r-=a/2}r+=ir*cr,Br.set(t+Mr.x,r+Mr.y)},_updateTexture:function(t){if(sr&&or){sr.clearRect(0,0,or.width,or.height),sr.font=ur,this._calculateFillTextStartPosition();var e=this._getLineHeight();sr.lineJoin="round",Dr?(sr.fillStyle="rgba("+wr.r+", "+wr.g+", "+wr.b+", "+nr+")",sr.fillRect(0,0,or.width,or.height)):t._srcBlendFactor===d.SRC_ALPHA&&(sr.fillStyle="rgba("+mr.r+", "+mr.g+", "+mr.b+", "+nr+")",sr.fillRect(0,0,or.width,or.height)),sr.fillStyle="rgb("+mr.r+", "+mr.g+", "+mr.b+")";var r=Br.x,a=0;this._drawTextEffect(Br,e);for(var i=0;i<dr.length;++i)a=Br.y+i*e,Dr&&sr.strokeText(dr[i],r,a),sr.fillText(dr[i],r,a);Tr&&(sr.shadowColor="transparent"),this._uploadTexture(t)}},_uploadTexture:function(t){if(t.cacheMode===nt.CacheMode.BITMAP){var e=t.ttfSpriteFrame;G.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}var r;hr&&or&&(r=hr instanceof X?hr.texture:hr,0!==or.width&&0!==or.height&&(r.reset({width:or.width,height:or.height,mipmapLevel:1}),r.uploadData(or),r.setWrapMode(S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE),hr instanceof X&&(hr.rect=new O(0,0,or.width,or.height),hr._calculateUV()),t.renderData&&(t.renderData.textureDirty=!0),a.director.root&&a.director.root.batcher2D&&a.director.root.batcher2D._releaseDescriptorSetCache(r.getHash())))},_calDynamicAtlas:function(t){if(!(t.cacheMode!==nt.CacheMode.BITMAP||!or||or.width<=0||or.height<=0)){var e=t.ttfSpriteFrame;G.packToDynamicAtlas(t,e)}},_setupOutline:function(){sr.strokeStyle="rgba("+wr.r+", "+wr.g+", "+wr.b+", "+wr.a/255+")",sr.lineWidth=2*Dr.width},_setupShadow:function(){sr.shadowColor="rgba("+Cr.r+", "+Cr.g+", "+Cr.b+", "+Cr.a/255+")",sr.shadowBlur=Tr.blur,sr.shadowOffsetX=Tr.offset.x,sr.shadowOffsetY=-Tr.offset.y},_drawTextEffect:function(t,e){if(Tr||Dr||Pr){var r=dr.length>1&&Tr,a=this._measureText(sr,ur),i=0,n=0;Tr&&this._setupShadow(),Dr&&this._setupOutline();for(var s=0;s<dr.length;++s)i=t.x,n=t.y+s*e,r&&(Dr&&sr.strokeText(dr[s],i,n),sr.fillText(dr[s],i,n)),Pr&&(Rr=a(dr[s]),pr===et.RIGHT?Lr.x=t.x-Rr:pr===et.CENTER?Lr.x=t.x-Rr/2:Lr.x=t.x,Lr.y=n+fr/8,sr.fillRect(Lr.x,Lr.y,Rr,Ar));r&&(sr.shadowColor="transparent")}},_updateLabelDimensions:function(){vr.width=Math.min(vr.width,2048),vr.height=Math.min(vr.height,2048);var t=!1;or.width!==vr.width&&(or.width=vr.width,t=!0),or.height!==vr.height&&(or.height=vr.height,t=!0),t&&(sr.font=ur),sr.textAlign=Or[pr],sr.textBaseline="alphabetic"},_getFontDesc:function(){var t=cr.toString()+"px ";return t+=gr,Ir&&(t="bold "+t),Fr&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===_r?cr:_r*cr/fr)},_calculateParagraphLength:function(t,e){for(var r,a=[],n=i(t);!(r=n()).done;){var s=r.value,o=st(e,s,ur);a.push(o)}return a},_measureText:function(t,e){return function(r){return st(t,r,e)}},_calculateShrinkFont:function(t){if(sr){var e=this._calculateParagraphLength(t,sr),r=0,a=0,i=0;if(Sr){var s=br.width,o=br.height;if(s<0||o<0)return;a=o+1;for(var h=0,u=0|cr+1,l=0;h<u;){if((l=h+u+1>>1)<=0){n(4003);break}cr=l,ur=this._getFontDesc(),sr.font=ur;var c=this._getLineHeight();for(a=0,r=0;r<t.length;++r){var f=st(sr,t[r],ur);a+=ot(t[r],f,s,this._measureText(sr,ur)).length*c}a>o?u=l-1:h=l}0===h?n(4003):(cr=h,ur=this._getFontDesc(),sr.font=ur)}else{for(a=t.length*this._getLineHeight(),r=0;r<t.length;++r)i<e[r]&&(i=e[r]);var d=(vr.width-Mr.width)/i,v=vr.height/a;cr=fr*Math.min(1,d,v)|0,ur=this._getFontDesc(),sr.font=ur}}},_calculateWrapText:function(t){if(Sr&&sr){dr=[];for(var e=br.width,r=0;r<t.length;++r){var a=st(sr,t[r],ur),i=ot(t[r],a,e,this._measureText(sr,ur));dr=dr.concat(i)}}},_calculateLabelFont:function(){if(sr){var t=lr.split("\n");switch(dr=t,ur=this._getFontDesc(),sr.font=ur,yr){case ar.NONE:for(var e=0,r=0,a=0;a<t.length;++a){var i=st(sr,t[a],ur);e=e>i?e:i}r=(dr.length+ht)*this._getLineHeight();var n=parseFloat(e.toFixed(2)),s=parseFloat(r.toFixed(2));vr.width=n+Mr.width,vr.height=s+Mr.height,br.width=n+Er.width,br.height=s+Er.height;break;case ar.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case ar.CLAMP:this._calculateWrapText(t);break;case ar.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(dr.length+ht)*this._getLineHeight();vr.height=o+Mr.height,br.height=o+Er.height}}}},Hr=F.WHITE.clone(),Nr=Uint16Array.from([0,1,2,1,3,2]),Vr={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.resize(4,6);var r=e.chunk.vb;r[3]=r[21]=r[22]=r[31]=0,r[4]=r[12]=r[13]=r[30]=1;for(var a=5,i=0;i<4;i++)F.toArray(r,Hr,a),a+=9;return e.vertexRow=2,e.vertexCol=2,e.chunk.setIndexBuffer(Nr),e},fillBuffers:function(t){for(var e=t.renderData,r=e.chunk,a=e.data,i=t.node,n=r.vb,s=i.worldMatrix,o=e.floatStride,h=0,u=a.length,l=0;l<u;l++){var c=a[l],f=c.x,d=c.y,v=s.m03*f+s.m07*d+s.m15;v=v?Math.abs(1/v):1,n[0+(h=l*o)]=(s.m00*f+s.m04*d+s.m12)*v,n[h+1]=(s.m01*f+s.m05*d+s.m13)*v,n[h+2]=(s.m02*f+s.m06*d+s.m14)*v}var _=r.vertexOffset,p=r.meshBuffer,x=r.meshBuffer.iData,m=p.indexOffset;x[m++]=_,x[m++]=_+1,x[m++]=_+2,x[m++]=_+2,x[m++]=_+1,x[m++]=_+3,p.indexOffset+=6},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=r.width,i=r.height,n=r.anchorX*a,s=r.anchorY*i,o=e.data;o[0].x=-n,o[0].y=-s,o[1].x=a-n,o[1].y=-s,o[2].x=-n,o[2].y=i-s,o[3].x=a-n,o[3].y=i-s}},updateUVs:function(t){var e=t.renderData;if(e&&t.ttfSpriteFrame){var r=e.chunk.vb,a=t.ttfSpriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7]}},updateColor:function(){}};e(Vr,kr);var Ur=t("l",{getAssembler:function(t){var e=Vr;return t.font instanceof lt?e=Je:t.cacheMode===nt.CacheMode.CHAR&&(e=rr),e}});nt.Assembler=Ur;var zr,Wr=ct.FillType,Zr=new A,Qr=Uint16Array.from([0,1,2,1,3,2]),qr={updateRenderData:function(t){var e=t.spriteFrame;G.packToDynamicAtlas(t,e);var r=t.renderData;if(r&&e){if(!r.vertDirty)return;var a=t.fillStart,i=t.fillRange;i<0&&(a+=i,i=-i),i=(i=(i=a+i)>1?1:i)<0?0:i;var n=(a=(a=a>1?1:a)<0?0:a)+(i=(i-=a)<0?0:i);n=n>1?1:n,this.updateUVs(t,a,n),this.updateVertexData(t,a,n),r.updateRenderData(t,e)}},updateUVs:function(t,e,r){var a=t.spriteFrame,i=t.renderData.chunk.vb,n=a.width,o=a.height,h=a.rect,u=0,l=0,c=0,f=0,d=0,v=0,_=0,p=0,x=0,m=0;switch(a.isRotated()?(u=h.x/n,l=(h.y+h.width)/o,c=d=u,_=x=(h.x+h.height)/n,v=m=l,f=p=h.y/o):(u=h.x/n,l=(h.y+h.height)/o,c=_=u,d=x=(h.x+h.width)/n,f=v=l,p=m=h.y/o),t.fillType){case Wr.HORIZONTAL:i[3]=c+(d-c)*e,i[4]=f+(v-f)*e,i[12]=c+(d-c)*r,i[13]=f+(v-f)*r,i[21]=_+(x-_)*e,i[22]=p+(m-p)*e,i[30]=_+(x-_)*r,i[31]=p+(m-p)*r;break;case Wr.VERTICAL:i[3]=c+(_-c)*e,i[4]=f+(p-f)*e,i[12]=d+(x-d)*e,i[13]=v+(m-v)*e,i[21]=c+(_-c)*r,i[22]=f+(p-f)*r,i[30]=d+(x-d)*r,i[31]=v+(m-v)*r;break;default:s(2626)}},updateVertexData:function(t,e,r){var a=t.renderData.data,i=t.node._uiProps.uiTransformComp,n=i.width,o=i.height,h=i.anchorX*n,u=i.anchorY*o,l=-h,c=-u,f=n-h,d=o-u,v=0;switch(t.fillType){case Wr.HORIZONTAL:v=l+(f-l)*r,l+=(f-l)*e,f=v;break;case Wr.VERTICAL:v=c+(d-c)*r,c+=(d-c)*e,d=v;break;default:s(2626)}a[0].x=l,a[0].y=c,a[1].x=f,a[1].y=c,a[2].x=l,a[2].y=d,a[3].x=f,a[3].y=d},createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.resize(4,6),e.vertexRow=2,e.vertexCol=2,e.chunk.setIndexBuffer(Qr);for(var r,a=e.data,n=i(a);!(r=n()).done;)r.value.z=0;return e},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(Zr);for(var r=t.renderData.floatStride,a=t.renderData.data,i=e.vb,n=0,s=0;s<4;s++){var o=a[s],h=o.x,u=o.y,l=Zr.m03*h+Zr.m07*u+Zr.m15;l=l?Math.abs(1/l):1,i[n=s*r]=(Zr.m00*h+Zr.m04*u+Zr.m12)*l,i[n+1]=(Zr.m01*h+Zr.m05*u+Zr.m13)*l,i[n+2]=(Zr.m02*h+Zr.m06*u+Zr.m14)*l}},fillBuffers:function(t){var e=t.renderData,r=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,r),e.vertDirty=!1),r.bufferId;var a=r.vertexOffset,i=r.meshBuffer,n=r.meshBuffer.iData,s=i.indexOffset;n[s++]=a,n[s++]=a+1,n[s++]=a+2,n[s++]=a+2,n[s++]=a+1,n[s++]=a+3,i.indexOffset+=6},updateColor:function(t){for(var e=t.renderData,r=e.chunk.vb,a=e.floatStride,i=5,n=t.color,s=n.r/255,o=n.g/255,h=n.b/255,u=t.node._uiProps.opacity,l=0;l<4;l++)r[i]=s,r[i+1]=o,r[i+2]=h,r[i+3]=u,i+=a}},Gr=2*Math.PI,Xr=1e-6,jr=new A,Yr=[new H,new H,new H,new H],Kr=new Array(4),Jr=new Array(8),$r=[new H,new H,new H,new H],ta=[new H,new H,new H,new H],ea=new H,ra=[new H,new H,new H,new H];function aa(t,e,r,a,i,n,s){var o=Math.sin(n);o=Math.abs(o)>Xr?o:0;var h=Math.cos(n),u=0,l=0;if(0!==(h=Math.abs(h)>Xr?h:0)){if(u=o/h,(t-i.x)*h>0){var c=i.y+u*(t-i.x);s[0].x=t,s[0].y=c}if((e-i.x)*h>0){var f=i.y+u*(e-i.x);s[2].x=e,s[2].y=f}}if(0!==o){if(l=h/o,(a-i.y)*o>0){var d=i.x+l*(a-i.y);s[3].x=d,s[3].y=a}if((r-i.y)*o>0){var v=i.x+l*(r-i.y);s[1].x=v,s[1].y=r}}}function ia(t,e){var r=e.x-t.x,a=e.y-t.y;if(0===r&&0===a)return 0;if(0===r)return a>0?.5*Math.PI:1.5*Math.PI;var i=Math.atan(a/r);return r<0&&(i+=Math.PI),i}function na(t,e,r,a,i){var n=Kr,s=n[0],o=n[1],h=n[2],u=n[3];t[e].x=r.x,t[e].y=r.y,t[e+1].x=a.x,t[e+1].y=a.y,t[e+2].x=i.x,t[e+2].y=i.y,sa((r.x-s)/(h-s),(r.y-o)/(u-o),t,e),sa((a.x-s)/(h-s),(a.y-o)/(u-o),t,e+1),sa((i.x-s)/(h-s),(i.y-o)/(u-o),t,e+2)}function sa(t,e,r,a){var i=Jr,n=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,o=i[1]+(i[3]-i[1])*t,h=i[5]+(i[7]-i[5])*t,u=r[a];u.u=n+(s-n)*e,u.v=o+(h-o)*e}for(var oa={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;G.packToDynamicAtlas(t,e),this.updateUVs(t);var r,a,n,s,o,h,u,l,c,f=t.renderData;if(f&&e){if(!f.vertDirty)return;var d=f.data,v=t.fillStart,_=t.fillRange;for(_<0&&(v+=_,_=-_);v>=1;)v-=1;for(;v<0;)v+=1;var p=(v*=Gr)+(_*=Gr);!function(t){var e=t.node._uiProps.uiTransformComp,r=e.width,a=e.height,n=e.anchorX*r,s=e.anchorY*a,o=-n,h=-s,u=r-n,l=a-s,c=Kr;c[0]=o,c[1]=h,c[2]=u,c[3]=l;var f=t.fillCenter,d=ea.x=Math.min(Math.max(0,f.x),1)*(u-o)+o,v=ea.y=Math.min(Math.max(0,f.y),1)*(l-h)+h;Yr[0].x=Yr[3].x=o,Yr[1].x=Yr[2].x=u,Yr[0].y=Yr[1].y=h,Yr[2].y=Yr[3].y=l;for(var _,p=i(ra);!(_=p()).done;){var x=_.value;H.set(x,0,0)}d!==c[0]&&H.set(ra[0],3,0),d!==c[2]&&H.set(ra[2],1,2),v!==c[1]&&H.set(ra[1],0,1),v!==c[3]&&H.set(ra[3],2,3)}(t),a=(r=e).width,n=r.height,s=r.getRect(),o=0,h=0,u=0,l=0,c=Jr,r.isRotated()?(o=s.x/a,h=(s.x+s.height)/a,u=s.y/n,l=(s.y+s.width)/n,c[0]=c[2]=o,c[4]=c[6]=h,c[3]=c[7]=l,c[1]=c[5]=u):(o=s.x/a,h=(s.x+s.width)/a,u=s.y/n,l=(s.y+s.height)/n,c[0]=c[4]=o,c[2]=c[6]=h,c[1]=c[3]=l,c[5]=c[7]=u),aa(Kr[0],Kr[2],Kr[1],Kr[3],ea,v,$r),aa(Kr[0],Kr[2],Kr[1],Kr[3],ea,v+_,ta);for(var x=0,m=0;m<4;++m){var g=ra[m];if(g)if(_>=Gr)f.dataLength=x+3,na(d,x,ea,Yr[g.x],Yr[g.y]),x+=3;else{var y=ia(ea,Yr[g.x]),S=ia(ea,Yr[g.y]);S<y&&(S+=Gr),y-=Gr,S-=Gr;for(var D=0;D<3;++D)y>=p||(y>=v?(f.dataLength=x+3,na(d,x,ea,Yr[g.x],S>=p?ta[m]:Yr[g.y]),x+=3):S>v&&(S<=p?(f.dataLength=x+3,na(d,x,ea,$r[m],Yr[g.y]),x+=3):(f.dataLength=x+3,na(d,x,ea,$r[m],ta[m]),x+=3))),y+=Gr,S+=Gr}}0===x&&(f.dataLength=0),f.resize(x,x),f.updateRenderData(t,e)}},createQuadIndices:function(t){zr=null,zr=new Uint16Array(t);for(var e=0,r=0;r<t;r++)zr[e++]=r},fillBuffers:function(t){var e=t.node,r=t.renderData,a=r.chunk;(e.hasChangedFlags||r.vertDirty)&&(this.updateWorldVertexAndUVData(t,a),r.vertDirty=!1),this.updateColorLate(t),a.bufferId;for(var i=a.vertexOffset,n=a.meshBuffer,s=a.meshBuffer.iData,o=n.indexOffset,h=0;h<r.indexCount;h++)s[o+h]=i+h;n.indexOffset+=r.indexCount,n.setDirty()},updateWorldUVData:function(t){for(var e=t.renderData,r=e.floatStride,a=e.data,i=e.chunk.vb,n=0;n<a.length;n++){var s=n*r;i[s+3]=a[n].u,i[s+4]=a[n].v}},updateWorldVertexAndUVData:function(t,e){t.node.getWorldMatrix(jr);for(var r=t.renderData,a=r.floatStride,i=t.renderData.data,n=e.vb,s=r.vertexCount,o=0,h=0;h<s;h++){var u=i[h],l=u.x,c=u.y,f=jr.m03*l+jr.m07*c+jr.m15;f=f?Math.abs(1/f):1,n[o+0]=(jr.m00*l+jr.m04*c+jr.m12)*f,n[o+1]=(jr.m01*l+jr.m05*c+jr.m13)*f,n[o+2]=(jr.m02*l+jr.m06*c+jr.m14)*f,n[o+3]=u.u,n[o+4]=u.v,o+=a}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},updateColorLate:function(t){for(var e=t.renderData,r=e.chunk.vb,a=e.floatStride,i=e.vertexCount,n=5,s=t.color,o=s.r/255,h=s.g/255,u=s.b/255,l=t.node._uiProps.opacity,c=0;c<i;c++)r[n]=o,r[n+1]=h,r[n+2]=u,r[n+3]=l,n+=a},updateColor:function(){}},ha=Uint16Array.from([0,1,2,1,3,2]),ua={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(4,6),e.vertexRow=2,e.vertexCol=2,e.chunk.setIndexBuffer(ha),e},updateRenderData:function(t){var e=t.spriteFrame;G.packToDynamicAtlas(t,e),this.updateUVs(t);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.updateRenderData(t,e))},updateWorldVerts:function(t,e){for(var r=t.renderData,a=e.vb,i=r.data,n=t.node.worldMatrix,s=r.floatStride,o=0,h=i.length,u=0;u<h;u++){var l=i[u],c=l.x,f=l.y,d=n.m03*c+n.m07*f+n.m15;d=d?Math.abs(1/d):1,a[0+(o=u*s)]=(n.m00*c+n.m04*f+n.m12)*d,a[o+1]=(n.m01*c+n.m05*f+n.m13)*d,a[o+2]=(n.m02*c+n.m06*f+n.m14)*d}},fillBuffers:function(t){if(null!==t){var e=t.renderData,r=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,r),e.vertDirty=!1),r.bufferId;for(var a=r.vertexOffset,i=r.meshBuffer,n=r.meshBuffer.iData,s=i.indexOffset,o=0;o<e.vertexRow-1;o++)for(var h=0;h<e.vertexCol-1;h++){var u=a+o*e.vertexCol+h;n[s++]=u,n[s++]=u+1,n[s++]=u+e.vertexCol,n[s++]=u+1,n[s++]=u+1+e.vertexCol,n[s++]=u+e.vertexCol,i.indexOffset+=6}}},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=e.data,i=r.width,n=r.height,s=r.anchorX*i,o=r.anchorY*n,h=0,u=0,l=0,c=0;if(t.trim)h=-s,u=-o,l=i-s,c=n-o;else{var f=t.spriteFrame,d=f.originalSize,v=i/d.width,_=n/d.height,p=f.trimmedBorder;h=p.x*v-s,u=p.z*_-o,l=i+p.y*v-s,c=n+p.w*_-o}a[0].x=h,a[0].y=u,a[1].x=l,a[1].y=u,a[2].x=h,a[2].y=c,a[3].x=l,a[3].y=c,e.vertDirty=!0}},updateUVs:function(t){if(t.spriteFrame){var e=t.renderData.chunk.vb,r=t.spriteFrame.uv;e[3]=r[0],e[4]=r[1],e[12]=r[2],e[13]=r[3],e[21]=r[4],e[22]=r[5],e[30]=r[6],e[31]=r[7]}},updateColor:function(t){for(var e=t.renderData,r=e.chunk.vb,a=5,i=t.color,n=i.r/255,s=i.g/255,o=i.b/255,h=i.a/255,u=0;u<4;u++,a+=e.floatStride)r[a]=n,r[a+1]=s,r[a+2]=o,r[a+3]=h}},la=new A,ca=[],fa=0;fa<4;fa++)ca.push({x:0,y:0,z:0,u:0,v:0,color:new F});var da,va,_a,pa,xa,ma,ga,ya,Sa={createData:function(t){var e=t.requestRenderData();return e.dataLength=16,e.resize(16,54),e.vertexRow=4,e.vertexCol=4,this.QUAD_INDICES=new Uint16Array(54),this.createQuadIndices(4,4),e.chunk.setIndexBuffer(this.QUAD_INDICES),e},createQuadIndices:function(t,e){for(var r=0,a=0;a<t-1;a++)for(var i=0;i<e-1;i++){var n=a*e+i;this.QUAD_INDICES[r++]=n,this.QUAD_INDICES[r++]=n+1,this.QUAD_INDICES[r++]=n+e,this.QUAD_INDICES[r++]=n+1,this.QUAD_INDICES[r++]=n+1+e,this.QUAD_INDICES[r++]=n+e}},updateRenderData:function(t){var e=t.spriteFrame;G.packToDynamicAtlas(t,e),this.updateUVs(t);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.updateRenderData(t,e))},updateVertexData:function(t){var e=t.renderData,r=e.data,a=t.node._uiProps.uiTransformComp,i=a.width,n=a.height,s=a.anchorX*i,o=a.anchorY*n,h=t.spriteFrame,u=h.insetLeft,l=h.insetRight,c=h.insetTop,f=h.insetBottom,d=i-u-l,v=n-c-f,_=i/(u+l),p=n/(c+f);_=Number.isNaN(_)||_>1?1:_,p=Number.isNaN(p)||p>1?1:p,d=d<0?0:d,v=v<0?0:v,ca[0].x=-s,ca[0].y=-o,ca[1].x=u*_-s,ca[1].y=f*p-o,ca[2].x=ca[1].x+d,ca[2].y=ca[1].y+v,ca[3].x=i-s,ca[3].y=n-o;for(var x=0;x<e.vertexRow;x++)for(var m=0;m<e.vertexCol;m++){var g=x*e.vertexCol+m;g<e.dataLength&&x<ca.length&&m<ca.length&&(r[g].x=ca[m].x,r[g].y=ca[x].y)}},fillBuffers:function(t){var e=t.renderData,r=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,r),e.vertDirty=!1),r.bufferId;for(var a=r.vertexOffset,i=r.meshBuffer,n=r.meshBuffer.iData,s=i.indexOffset,o=0;o<3;++o)for(var h=0;h<3;++h){var u=a+4*o+h;n[s++]=u,n[s++]=u+1,n[s++]=u+4,n[s++]=u+1,n[s++]=u+5,n[s++]=u+4}i.indexOffset=s},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(la);for(var r=t.renderData,a=r.floatStride,i=r.data,n=e.vb,s=0,o=0;o<4;++o)for(var h=i[4*o],u=0;u<4;++u){var l=i[u].x,c=h.y,f=la.m03*l+la.m07*c+la.m15;f=f?Math.abs(1/f):1,n[0+(s=(4*o+u)*a)]=(la.m00*l+la.m04*c+la.m12)*f,n[s+1]=(la.m01*l+la.m05*c+la.m13)*f,n[s+2]=(la.m02*l+la.m06*c+la.m14)*f}},updateUVs:function(t){if(t.spriteFrame)for(var e=t.renderData,r=e.chunk.vb,a=e.floatStride,i=t.spriteFrame.uvSliced,n=3,s=0;s<16;s++)r[n]=i[s].u,r[n+1]=i[s].v,n+=a},updateColor:function(t){for(var e=t.renderData,r=e.chunk.vb,a=e.floatStride,i=5,n=t.color,s=n.r/255,o=n.g/255,h=n.b/255,u=t.node._uiProps.opacity,l=0;l<16;l++)r[i]=s,r[i+1]=o,r[i+2]=h,r[i+3]=u,i+=a}},Da=new A,wa=0,Ta=[];function Ca(t){return t&&(t.insetTop>0||t.insetBottom>0||t.insetLeft>0||t.insetRight>0)?2:0}var Ma={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,r=t.spriteFrame;if(r&&e&&e.vertDirty){var a=t.node._uiProps.uiTransformComp,i=Math.abs(a.width),n=Math.abs(a.height),s=r.getRect(),o=r.insetLeft,h=r.insetRight,u=s.width-o-h,l=r.insetTop,c=r.insetBottom,f=s.height-l-c,d=i-o-h,v=n-l-c;d=d>0?d:0,v=v>0?v:0;var _=0===u?d:d/u,p=0===f?v:v/f,x=Ca(r),m=Math.ceil(p+x),g=Math.ceil(_+x);e.dataLength=4*m*g,this.updateVerts(t,d,v,m,g),e.vertexCount!==m*g*4&&(t.renderEntity.colorDirty=!0),e.resize(m*g*4,m*g*6),e.updateRenderData(t,r)}},createQuadIndices:function(t){if(t%6==0){var e=t/6;ya=null,ya=new Uint16Array(t);for(var r=0,a=0;a<e;a++)ya[r++]=0+4*a,ya[r++]=1+4*a,ya[r++]=2+4*a,ya[r++]=1+4*a,ya[r++]=3+4*a,ya[r++]=2+4*a}else console.error("illegal index count!")},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},fillBuffers:function(t){var e=t.node,r=t.renderData,a=r.chunk;(e.hasChangedFlags||r.vertDirty)&&(this.updateWorldVertexAndUVData(t,a),r.vertDirty=!1),this.updateColorLate(t),a.bufferId;for(var i=a.vertexOffset,n=a.meshBuffer,s=a.meshBuffer.iData,o=n.indexOffset,h=0;h<r.indexCount;h+=6)s[o++]=i,s[o++]=i+1,s[o++]=i+2,s[o++]=i+1,s[o++]=i+3,s[o++]=i+2,i+=4,n.indexOffset+=6;n.setDirty()},updateWorldUVData:function(t){for(var e=t.renderData,r=e.floatStride,a=e.data,i=e.chunk.vb,n=0;n<a.length;n++){var s=n*r;i[s+3]=a[n].u,i[s+4]=a[n].v}},updateWorldVertexAndUVData:function(t,e){t.node.getWorldMatrix(Da);for(var r=t.renderData,a=r.floatStride,i=r.data,n=e.vb,s=i.length,o=0;o<s;o++){var h=i[o].x,u=i[o].y,l=i[o].z,c=Da.m03*h+Da.m07*u+Da.m11*l+Da.m15;c=c?Math.abs(1/c):1;var f=o*a;n[f]=(Da.m00*h+Da.m04*u+Da.m08*l+Da.m12)*c,n[f+1]=(Da.m01*h+Da.m05*u+Da.m09*l+Da.m13)*c,n[f+2]=(Da.m02*h+Da.m06*u+Da.m10*l+Da.m14)*c}this.updateWorldUVData(t)},updateVerts:function(t,e,r,a,i){var n,s,o=t.node._uiProps.uiTransformComp,h=t.renderData.data,u=t.spriteFrame,l=u.rect,c=Math.abs(o.width),f=Math.abs(o.height),d=o.anchorX*c,v=o.anchorY*f,_=u.insetLeft,p=u.insetRight,x=l.width-_-p,m=u.insetTop,g=u.insetBottom,y=l.height-m-g,S=o.width/(_+p)>1?1:o.width/(_+p),D=o.height/(m+g)>1?1:o.height/(m+g);n=x>0?Math.floor(1e3*e)/1e3%x==0?x:e%x:e,s=y>0?Math.floor(1e3*r)/1e3%y==0?y:r%y:r,wa=Math.max(a+1,i+1);for(var w=0;w<wa;w++)Ta.push({x:0,y:0,z:0,u:0,v:0,color:new F});var T=Ca(u);if(0===T)for(var C=0;C<wa;C++)Ta[C].x=C>=i?c-d:C*x-d,Ta[C].y=C>=a?f-v:C*y-v;else for(var M=0;M<wa;M++)0===M?Ta[M].x=-d:1===M?Ta[M].x=_*S-d:M>1&&M<i-1?Ta[M].x=x>0?_*S-d+x*(M-1):_+e-d:M===i-1?Ta[M].x=_*S-d+n+x*(M-2):M>=i&&(Ta[M].x=Math.min(_+e+p,c)-d),0===M?Ta[M].y=-v:1===M?Ta[M].y=g*D-v:M>1&&M<a-1?Ta[M].y=y>0?g*D-v+y*(M-1):g+r-v:M===a-1?Ta[M].y=g*D-v+s+y*(M-2):M>=a&&(Ta[M].y=Math.min(g+r+m,f)-v);for(var E=0,b=0,B=0,L=0,R=0;R<a;++R){B=Ta[R].y,L=Ta[R+1].y;for(var A=0;A<i;++A){E=Ta[A].x,b=Ta[A+1].x;var I=4*(R*i+A);h[I].x=E,h[I].y=B,h[I+1].x=b,h[I+1].y=B,h[I+2].x=E,h[I+2].y=L,h[I+3].x=b,h[I+3].y=L}}var P=u.rotated,O=(u.uv,u.uvSliced);da=O[0],va=O[1],_a=O[2],pa=O[3],xa=O[4],ma=O[8],ga=O[12];for(var k=0,H=0,N=0===x?e:e/x,V=0===y?r:r/y,U=[],z=[],W=0;W<a;++W){H=r>y?r>=(T>0?W:W+1)*y?1:V%1:V;for(var Z=0;Z<i;++Z){k=e>x?e>=(T>0?Z:Z+1)*x?1:N%1:N,P?(0===T?(U[0]=xa.u,U[1]=xa.u,U[2]=xa.u+(ma.u-xa.u)*H,z[0]=va.v,z[1]=va.v+(_a.v-va.v)*k,z[2]=va.v):(0===W?(U[0]=da.u,U[1]=da.u,U[2]=xa.u):W<a-1?(U[0]=xa.u,U[1]=xa.u,U[2]=xa.u+(ma.u-xa.u)*H):W===a-1&&(U[0]=ma.u,U[1]=ma.u,U[2]=ga.u),0===Z?(z[0]=da.v,z[1]=va.v,z[2]=da.v):Z<i-1?(z[0]=va.v,z[1]=va.v+(_a.v-va.v)*k,z[2]=va.v):Z===i-1&&(z[0]=_a.v,z[1]=pa.v,z[2]=_a.v)),U[3]=U[2],z[3]=z[1]):(0===T?(U[0]=va.u,U[1]=va.u+(_a.u-va.u)*k,U[2]=va.u,z[0]=xa.v,z[1]=xa.v,z[2]=xa.v+(ma.v-xa.v)*H):(0===Z?(U[0]=da.u,U[1]=va.u,U[2]=da.u):Z<i-1?(U[0]=va.u,U[1]=va.u+(_a.u-va.u)*k,U[2]=va.u):Z===i-1&&(U[0]=_a.u,U[1]=pa.u,U[2]=_a.u),0===W?(z[0]=da.v,z[1]=da.v,z[2]=xa.v):W<a-1?(z[0]=xa.v,z[1]=xa.v,z[2]=xa.v+(ma.v-xa.v)*H):W===a-1&&(z[0]=ma.v,z[1]=ma.v,z[2]=ga.v)),U[3]=U[1],z[3]=z[2]);var Q=4*(W*i+Z);h[Q].u=U[0],h[Q].v=z[0],h[Q+1].u=U[1],h[Q+1].v=z[1],h[Q+2].u=U[2],h[Q+2].v=z[2],h[Q+3].u=U[3],h[Q+3].v=z[3]}}},updateColorLate:function(t){for(var e=t.renderData,r=e.chunk.vb,a=e.floatStride,i=e.vertexCount,n=5,s=t.color,o=s.r/255,h=s.g/255,u=s.b/255,l=t.node._uiProps.opacity,c=0;c<i;c++)r[n]=o,r[n+1]=h,r[n+2]=u,r[n+3]=l,n+=a},updateColor:function(){}},Ea=ct.Type,ba=ct.FillType,Ba=t("s",{getAssembler:function(t){var e=ua,r=t;switch(r.type){case Ea.SLICED:e=Sa;break;case Ea.TILED:e=Ma;break;case Ea.FILLED:e=r.fillType===ba.RADIAL?oa:qr}return e}});ct.Assembler=Ba;var La=[D.EventType.MOUSE_DOWN,D.EventType.MOUSE_MOVE,D.EventType.MOUSE_UP,D.EventType.MOUSE_WHEEL],Ra=[D.EventType.TOUCH_START,D.EventType.TOUCH_MOVE,D.EventType.TOUCH_END,D.EventType.TOUCH_CANCEL],Aa=(new(function(){function t(){this.priority=w.UI,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],T._registerEventDispatcher(this),C.callbacksInvoker.on(M.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),C.callbacksInvoker.on(M.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this),C.callbacksInvoker.on(M.MARK_LIST_DIRTY,this._markListDirty,this)}var e=t.prototype;return e.dispatchEvent=function(t){var e=t.type;return Ra.includes(e)?this.dispatchEventTouch(t):!La.includes(e)||this.dispatchEventMouse(t)},e.addPointerEventProcessor=function(t){0===this._inDispatchCount?this._pointerEventProcessorList.includes(t)||(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.includes(t)||this._processorListToAdd.push(t),o.array.remove(this._processorListToRemove,t)},e.removePointerEventProcessor=function(t){0===this._inDispatchCount?(o.array.remove(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.includes(t)||this._processorListToRemove.push(t),o.array.remove(this._processorListToAdd,t)},e.dispatchEventMouse=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,r=e.length,a=!0,i=0;i<r;++i){var n=e[i];if(n.isEnabled&&n.shouldHandleEventMouse&&n._handleEventMouse(t)){if(a=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),a},e.dispatchEventTouch=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,r=e.length,a=t.touch,i=!0,n=0;n<r;++n){var s=e[n];if(s.isEnabled&&s.shouldHandleEventTouch)if(t.type===q.TOUCH_START){if(s._handleEventTouch(t)){if(s.claimedTouchIdList.push(a.getID()),i=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(s.claimedTouchIdList.length>0){var h=s.claimedTouchIdList.indexOf(a.getID());if(-1!==h){if(s._handleEventTouch(t),t.type!==q.TOUCH_END&&t.type!==q.TOUCH_CANCEL||o.array.removeAt(s.claimedTouchIdList,h),i=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),i},e._updatePointerEventProcessorList=function(){for(var t=this._processorListToAdd,e=t.length,r=0;r<e;++r)this.addPointerEventProcessor(t[r]);t.length=0;for(var a=this._processorListToRemove,i=a.length,n=0;n<i;++n)this.removePointerEventProcessor(a[n]);a.length=0},e._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var t=this._pointerEventProcessorList,e=t.length,r=0;r<e;++r){var a=t[r],i=a.node;if(i._uiProps){var n=i._uiProps.uiTransformComp;a.cachedCameraPriority=n.cameraPriority}}t.sort(this._sortByPriority),this._isListDirty=!1}},e._sortByPriority=function(t,e){var r=t.node,a=e.node;if(!(e&&a&&a.activeInHierarchy&&a._uiProps.uiTransformComp))return-1;if(!(t&&r&&r.activeInHierarchy&&r._uiProps.uiTransformComp))return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;for(var i=r,n=a,s=!1;(null===(o=i.parent)||void 0===o?void 0:o._id)!==(null===(h=n.parent)||void 0===h?void 0:h._id);){var o,h,u,l,c,f;i=null===(null===(u=i)||void 0===u||null===(l=u.parent)||void 0===l?void 0:l.parent)?(s=!0)&&a:i&&i.parent,n=null===(null===(c=n)||void 0===c||null===(f=c.parent)||void 0===f?void 0:f.parent)?(s=!0)&&r:n&&n.parent}if(i._id===n._id){if(i._id===a._id)return-1;if(i._id===r._id)return 1}var d=i?i.getSiblingIndex():0,v=n?n.getSiblingIndex():0;return s?d-v:v-d},e._markListDirty=function(){this._isListDirty=!0},t}()),new m(null)),Ia=new A,Fa=t("B",function(){function t(t){var e=this;this.device=void 0,this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._drawBatchPool=void 0,this._batches=void 0,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new B,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._currIsMiddleware=!1,this._middlewareEnableBatch=!1,this._middlewareBuffer=null,this._middlewareIndexStart=0,this._middlewareIndexCount=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new Oa,this._meshDataArray=[],this._maskClearModel=null,this._maskClearMtl=null,this._maskModelMesh=null,this._root=t,this.device=t.device,this._batches=new g(64),this._drawBatchPool=new y((function(){return new Bt}),128,(function(t){return t.destroy(e)}))}var e=t.prototype;return e.initialize=function(){return!0},e.destroy=function(){for(var t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy(),this._bufferAccessors.forEach((function(t){t.destroy()})),this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),dt.sharedManager.destroy(),this._maskClearModel&&this._maskModelMesh&&(a.director.root.destroyModel(this._maskClearModel),this._maskModelMesh.destroy()),this._maskClearMtl&&this._maskClearMtl.destroy()},e.syncRootNodesToNative=function(){},e.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},e.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,r=0;r<e.length;r++){var a=e[r];if(a.visibility&t.layer)return a}return null},e.update=function(){for(var t=this._screens,e=0,r=0;r<t.length;++r){var a=t[r],i=a._getRenderScene();if(a.enabledInHierarchy&&i){this._opacityDirty=0,this._pOpacity=1,this.walk(a.node),this.autoMergeBatches(this._currComponent),this.resetRenderStates();var n=0;if(this._batches.length>e)for(;e<this._batches.length;++e){var s=this._batches.array[e];if(s.model)for(var o=s.model.subModels,h=0;h<o.length;h++)o[h].priority=n++;else s.descriptorSet=this._descriptorSetCache.getDescriptorSet(s);i.addBatch(s)}}}},e.uploadBuffers=function(){this._batches.length>0&&(this._meshDataArray.forEach((function(t){t.uploadBuffers()})),this._bufferAccessors.forEach((function(t){t.uploadBuffers(),t.reset()})),this._descriptorSetCache.update())},e.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._bufferAccessors.forEach((function(t){t.reset()})),this._meshDataArray.forEach((function(t){t.freeIAPool()})),this._meshDataArray.length=0,this._staticVBBuffer=null,this._currBID=-1,this._indexStart=0,this._currHash=0,this._currLayer=0,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._batches.clear(),dt.sharedManager.reset()},e.switchBufferAccessor=function(t){void 0===t&&(t=vt);var e=t===vt?36:_t(t);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==e){var r=this._bufferAccessors.get(e);r||(r=new pt(this.device,t),this._bufferAccessors.set(e,r)),this._staticVBBuffer=r,this._currBID=-1}return this._staticVBBuffer},e.registerBufferAccessor=function(t,e){this._bufferAccessors.set(t,e)},e.updateBuffer=function(t,e){var r=this.switchBufferAccessor(t);this._currBID!==e&&(this._currBID=e,this._indexStart=r.getMeshBuffer(e).indexOffset)},e.commitComp=function(t,e,r,a,i){var n,s=0,o=-1;if(e&&e.chunk){if(!e.isValid())return;s=e.dataHash,n=e.material,o=e.chunk.bufferId}t.stencilStage===xt.ENTER_LEVEL||t.stencilStage===xt.ENTER_LEVEL_INVERTED?this._insertMaskBatch(t):t.stencilStage=dt.sharedManager.stage;var h=t.stencilStage;this._currHash===s&&0!==s&&this._currMaterial===n&&this._currDepthStencilStateStage===h||(this.autoMergeBatches(this._currComponent),e&&!e._isMeshBuffer&&this.updateBuffer(e.vertexFormat,o),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=i,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=h,this._currLayer=t.node.layer,r?(this._currTexture=r.getGFXTexture(),this._currSampler=r.getGFXSampler(),this._currTextureHash=r.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),a.fillBuffers(t,this)},e.commitIA=function(t,e,r,a,i){var n;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var s=0;t&&(t.stencilStage=dt.sharedManager.stage,n=null!==t.customMaterial?dt.sharedManager.getStencilStage(t.stencilStage,a):dt.sharedManager.getStencilStage(t.stencilStage),s=dt.sharedManager.getStencilHash(t.stencilStage));var o=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();o.visFlags=t.node.layer,o.inputAssembler=e,o.useLocalData=i||null,r&&(o.texture=r.getGFXTexture(),o.sampler=r.getGFXSampler(),o.textureHash=r.getHash(),o.samplerHash=o.sampler.hash),o.fillPasses(a||null,n,s,null),this._batches.push(o)},e.commitMiddleware=function(t,e,r,a,i,n,s){var o=i.getGFXTexture();s&&this._middlewareEnableBatch&&this._middlewareBuffer===e&&this._currTexture===o&&this._currMaterial.hash===n.hash&&this._middlewareIndexStart+this._middlewareIndexCount===r&&this._currLayer===t.node.layer?this._middlewareIndexCount+=a:(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._currComponent=t,this._currTexture=o,this._currSampler=i.getGFXSampler(),this._currTextureHash=i.getHash(),this._currLayer=t.node.layer,this._currSamplerHash=this._currSampler.hash,this._currHash=0,this._currTransform=s?null:t.node,this._middlewareEnableBatch=s,this._middlewareBuffer=e,this._currMaterial=n,this._middlewareIndexStart=r,this._middlewareIndexCount=a),this._currIsMiddleware=!0},e.commitModel=function(t,e,r){var i;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var n=0;r&&(t.stencilStage===xt.ENTER_LEVEL||t.stencilStage===xt.ENTER_LEVEL_INVERTED?this._insertMaskBatch(t):t.stencilStage=dt.sharedManager.stage,i=dt.sharedManager.getStencilStage(t.stencilStage,r),n=dt.sharedManager.getStencilHash(t.stencilStage));var s=a.director.getTotalFrames();e&&(e.updateTransform(s),e.updateUBOs(s));for(var o=0;o<e.subModels.length;o++){var h=this._drawBatchPool.alloc(),u=e.subModels[o];h.visFlags=t.node.layer,h.model=e,h.texture=null,h.sampler=null,h.useLocalData=null,i||(i=null),h.fillPasses(r,i,n,u.patches),h.inputAssembler=u.inputAssembler,h.model.visFlags=h.visFlags,h.descriptorSet=u.descriptorSet,this._batches.push(h)}},e.setupStaticBatch=function(t,e){this.finishMergeBatches(),this._staticVBBuffer=e,this.currStaticRoot=t},e.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()},e.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(t){if(this._currIsMiddleware)this.mergeBatchesForMiddleware(t);else{var e=this._currMaterial;if(e){var r,a=this._currRenderData,i=this._staticVBBuffer;if(a&&a._isMeshBuffer)r=a.requestIA(this.device),-1===this._meshDataArray.indexOf(a)&&this._meshDataArray.push(a);else if(i){var n=this._currBID,s=i.getMeshBuffer(n);if(!s)return;var o=s.indexOffset-this._indexStart;if(o<=0)return;h(this._indexStart<s.indexOffset),s.setDirty(),(r=s.requireFreeIA(this.device)).firstIndex=this._indexStart,r.indexCount=o,this._indexStart=s.indexOffset}if(this._currBID=-1,r){var u,l=0;t&&(u=null!==t.customMaterial?dt.sharedManager.getStencilStage(t.stencilStage,e):dt.sharedManager.getStencilStage(t.stencilStage),l=dt.sharedManager.getStencilHash(t.stencilStage));var c=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();c.visFlags=this._currLayer,c.texture=this._currTexture,c.sampler=this._currSampler,c.inputAssembler=r,c.useLocalData=this._currTransform,c.textureHash=this._currTextureHash,c.samplerHash=this._currSamplerHash,c.fillPasses(e,u,l,null),this._batches.push(c)}}}},e.mergeBatchesForMiddleware=function(t){var e,r;t.stencilStage=dt.sharedManager.stage,e=null!==t.customMaterial?dt.sharedManager.getStencilStage(t.stencilStage,this._currMaterial):dt.sharedManager.getStencilStage(t.stencilStage),r=dt.sharedManager.getStencilHash(t.stencilStage);var a=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();a.visFlags=t.node.layer;var i=this._middlewareBuffer.requireFreeIA(this.device);i.firstIndex=this._middlewareIndexStart,i.indexCount=this._middlewareIndexCount,a.inputAssembler=i,a.useLocalData=this._currTransform,a.texture=this._currTexture,a.sampler=this._currSampler,a.textureHash=this._currTextureHash,a.samplerHash=this._currSamplerHash,a.fillPasses(this._currMaterial||null,e,r,null),this._batches.push(a),this._currIsMiddleware=!1,this._middlewareBuffer=null},e.forceMergeBatches=function(t,e,r){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=r.node.layer,this.autoMergeBatches(r)},e.resetRenderStates=function(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},e.flushMaterial=function(t){this._currMaterial=t},e.walk=function(t,e){if(void 0===e&&(e=0),t.activeInHierarchy){var r=t.children,a=t._uiProps,i=a.uiComp,n=this._pOpacity,s=n,o=i&&i.color?i.color.a/255:1;if(this._pOpacity=s*=o*a.localOpacity,a._opacity=s,a.colorDirty&&this._opacityDirty++,i&&i.enabledInHierarchy&&i.fillBuffers(this),this._opacityDirty&&i&&!i.useVertexOpacity&&i.renderData&&i.renderData.vertexCount>0){!function(t,e){for(var r,a,i,n=t.vertexFormat,s=t.chunk.vb,o=0,h=0;h<n.length;++h){if(r=n[h],(a=f[r.format]).hasAlpha)if(i=t.floatStride,a.size/a.count==1)for(var u=~~I(Math.round(255*e),0,255),l=o;l<s.length;l+=i)s[l]=(4294967040&s[l]|u)>>>0;else if(a.size/a.count==4)for(var c=o+3;c<s.length;c+=i)s[c]=e;o+=a.size>>2}}(i.renderData,s);var h=i.renderData.getMeshBuffer();h&&h.setDirty()}if(r.length>0&&!t._static)for(var u=0;u<r.length;++u){var l=r[u];this.walk(l,e)}a.colorDirty&&(this._opacityDirty--,a.colorDirty=!1),this._pOpacity=n,i&&i.enabledInHierarchy&&(i.postUpdateAssembler(this),(i.stencilStage===xt.ENTER_LEVEL||i.stencilStage===xt.ENTER_LEVEL_INVERTED)&&dt.sharedManager.getMaskStackSize()>0&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),dt.sharedManager.exitMask())),e+=1}},e._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},e._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},e._createClearModel=function(){if(!this._maskClearModel){this._maskClearMtl=E.get("default-clear-stencil"),this._maskClearModel=a.director.root.createModel(Q);var t=_t(mt),e=Z.gfxDevice,r=e.createBuffer(new v(_.VERTEX|_.TRANSFER_DST,p.DEVICE,4*t,t)),i=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(i);var n=e.createBuffer(new v(_.INDEX|_.TRANSFER_DST,p.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new Uint16Array([0,1,2,2,1,3]);n.update(s),this._maskModelMesh=new b([r],mt,x.TRIANGLE_LIST,n),this._maskModelMesh.subMeshIdx=0,this._maskClearModel.initSubModel(0,this._maskModelMesh,this._maskClearMtl)}},e._insertMaskBatch=function(t){this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._createClearModel(),this._maskClearModel.node=this._maskClearModel.transform=t.node;var e=dt.sharedManager;e.pushMask(1);var r,i=e.clear(t),n=0,s=this._maskClearMtl;s&&(r=e.getStencilStage(i,s),n=e.getStencilHash(i));var o=this._maskClearModel,h=a.director.getTotalFrames();o&&(o.updateTransform(h),o.updateUBOs(h));for(var u=0;u<o.subModels.length;u++){var l=this._drawBatchPool.alloc(),c=o.subModels[u];l.visFlags=t.node.layer,l.model=o,l.texture=null,l.sampler=null,l.useLocalData=null,r||(r=null),l.fillPasses(s,r,n,c.patches),l.inputAssembler=c.inputAssembler,l.model.visFlags=l.visFlags,l.descriptorSet=c.descriptorSet,this._batches.push(l)}e.enableMask()},e.syncMeshBuffersToNative=function(){},u(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"currBufferAccessor",get:function(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),t}()),Pa=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=Z.gfxDevice;this._localData=new Float32Array(z.COUNT),this._localBuffer=t.createBuffer(new v(_.UNIFORM|_.TRANSFER_DST,p.HOST|p.DEVICE,z.SIZE,z.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=Z.gfxDevice;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,Aa.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(Aa),this._descriptorSet.bindBuffer(z.BINDING,this._localBuffer);var r=W.SAMPLER_SPRITE;this._descriptorSet.bindTexture(r,t.texture),this._descriptorSet.bindSampler(r,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.equals=function(t,e,r){return this._transform===t&&this._textureHash===e&&this._samplerHash===r},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.isValid=function(){return this._transform&&this._transform.isValid},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){var e=t.worldMatrix;A.toArray(this._localData,e,z.MAT_WORLD_OFFSET),A.inverseTranspose(Ia,e);var r=A.determinant(Ia),a=1/Math.sqrt(r);A.multiplyScalar(Ia,Ia,a),A.toArray(this._localData,Ia,z.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},u(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),Oa=function(){function t(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new y((function(){return new Pa}),16,(function(t){return t.destroy()}))}var e=t.prototype;return e.getDescriptorSet=function(t){var e;if(a.director.root,t.useLocalData){for(var r=this._localDescriptorSetCache,i=0,n=r.length;i<n;i++){var s=r[i];if(s.equals(t.useLocalData,t.textureHash,t.samplerHash))return s.descriptorSet}var o=this._localCachePool.alloc();return o.initialize(t),this._localDescriptorSetCache.push(o),o.descriptorSet}if(e=t.textureHash^t.samplerHash,this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);Aa.layout=t.passes[0].localSetLayout;var h=Z.gfxDevice.createDescriptorSet(Aa),u=W.SAMPLER_SPRITE;return h.bindTexture(u,t.texture),h.bindSampler(u,t.sampler),h.update(),this._descriptorSetCache.set(e,h),this._dsCacheHashByTexture.set(t.textureHash,e),h},e.update=function(){var t=this._localDescriptorSetCache,e=[];t.forEach((function(r){if(r.isValid())r.uploadLocalData();else{r.reset();var a=t.indexOf(r);e.push(a)}}));for(var r=e.length-1;r>=0;r--)t.splice(e[r],1)},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){var e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.destroy()})),this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t}();a.internal.Batcher2D=Fa,t("U",function(t){function e(){return t.apply(this,arguments)||this}return l(e,t),e}(Bt)),N(gt.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((function(t){return{name:t,suggest:"please use meshBuffer.accessor."+t+" instead"}}))),V(gt.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),U(gt.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),V(Fa.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),U(yt.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),V(yt.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("Q",function(t){function e(e){var r;return r=t.call(this,e)||this,c(9006),r}return l(e,t),e}(yt));var ka,Ha=null,Na=-1,Va="BES bswy:->@123",Ua=Object.create(null),za=[],Wa=3e3;function Za(){for(var t=!0,e=Date.now(),r=za.length-1;r>=0;r--){var a=za[r],i=a.fontFamilyName;if(e-a.startTime>Wa)c(4933,i),a.onComplete(null,i),za.splice(r,1);else{var n=a.refWidth,s="40px "+i;Ha.font=s,n!==st(Ha,Va,s)?(za.splice(r,1),a.onComplete(null,i)):t=!1}}t&&(clearInterval(Na),Na=-1)}function Qa(t,e,r){var a=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var r,a=t.lastIndexOf("/");return-1!==(r=-1===a?t.substring(0,e)+"_LABEL":t.substring(a+1,e)+"_LABEL").indexOf(" ")&&(r='"'+r+'"'),r}(t);if(Ua[a])r(null,a);else{if(!Ha){var i=document.createElement("canvas");i.width=100,i.height=100,Ha=i.getContext("2d")}var n=st(Ha,Va,"40px "+a),s=document.createElement("style");s.type="text/css";var o="";Number.isNaN(a)?o+="@font-face { font-family:"+a+"; src:":o+='@font-face { font-family:"'+a+'"; src:',o+='url("'+t+'");',s.textContent=o+"}",document.body.appendChild(s);var h,u,l,f,d,v,_=document.createElement("div"),p=_.style;if(p.fontFamily=a,_.innerHTML=".",p.position="absolute",p.left="-100px",p.top="-100px",document.body.appendChild(_),function(){if(void 0===ka)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ka=t?parseInt(t[1],10)>42:!e}else ka=!1;return ka}())h=Date.now(),u=a,l=r,f=new Promise((function(t,e){!function r(){Date.now()-h>=Wa?e():document.fonts.load("40px "+u).then((function(e){e.length>=1?t():setTimeout(r,100)}),(function(){e()}))}()})),d=null,v=new Promise((function(t,e){d=setTimeout(e,Wa)})),Promise.race([v,f]).then((function(){d&&(clearTimeout(d),d=null),l(null,u)}),(function(){c(4933,u),l(null,u)}));else{var x={fontFamilyName:a,refWidth:n,onComplete:r,startTime:Date.now()};za.push(x),-1===Na&&(Na=setInterval(Za,100))}Ua[a]=s}}function qa(t,e,r,a){var i=new ft;i._nativeUrl=t,i._nativeAsset=e,a(null,i)}L.register({".font":Qa,".eot":Qa,".ttf":Qa,".woff":Qa,".svg":Qa,".ttc":Qa}),R.register({".font":qa,".eot":qa,".ttf":qa,".woff":qa,".svg":qa,".ttc":qa}),a.UI={MeshBuffer:gt,spriteAssembler:Ba,graphicsAssembler:_e,labelAssembler:Ur,RenderData:St,MeshRenderData:yt}}}}));
