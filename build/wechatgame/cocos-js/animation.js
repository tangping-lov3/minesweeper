System.register(["./bits-b8bc8b22.js","./buffer-barrier-17698e09.js","./scene-asset-10397f71.js","./math-base-02e87bf8.js","./pipeline-state-manager-f4a950fe.js","./deprecated-dacf9914.js","./touch-37ec7c16.js","./skeletal-animation-utils-f6075954.js","./animation-component-531e6afc.js"],(function(t){"use strict";var e,n,i,r,a,o,s,u,l,c,h,f,p,d,_,g,v,m,y,b,T,S,E,w,A,N,k,C,M,R,O,I,x,P,L,z,U,F,B,D,W,V,G,H,j,q,Q,X,Y,Z,J,$,K,tt,et,nt,it,rt,at,ot,st,ut,lt,ct,ht,ft,pt,dt,_t,gt,vt,mt,yt;return{setters:[function(t){e=t.F,n=t.G,i=t.A,r=t.H,a=t.I,o=t.f,s=t.w,u=t.ai,l=t.i,c=t.Q,h=t.$,f=t.aq,p=t.ar,d=t.ae,_=t.as,g=t.P,v=t.m,m=t.d,y=t.ac,b=t.l,T=t.ak},function(t){S=t.T},function(e){E=e.a$,w=e.b$,A=e.b1,N=e.aN,k=e.M,C=e.J,M=e.I,R=e.aM,O=e.c0,I=e.c1,x=e.Z,P=e.a2,L=e.b0,z=e.b7,U=e.bR,F=e.bU,B=e.aI,D=e.aF,W=e.c2;var n={};n.bezier=e.c3,n.bezierByTime=e.c4,n.easing=e.c2,t(n)},function(t){V=t.i,G=t.V,H=t.a,j=t.Q},function(t){q=t.d},function(t){Q=t.k,X=t.j},function(){},function(e){Y=e.b,Z=e.d,J=e.a;var n={};n.getPathFromRoot=e.c,n.getWorldTransformUntilRoot=e.g,t(n)},function(e){$=e.C,K=e.A,tt=e.c,et=e.a,nt=e.T,it=e.b,rt=e.d,at=e.R,ot=e.V,st=e.Q,ut=e.e,lt=e.S,ct=e.O,ht=e.i,ft=e.f,pt=e.H,dt=e.g,_t=e.h,gt=e.j,vt=e.k,mt=e.l,yt=e.m;var n={};n.AnimCurve=e.p,n.Animation=e.n,n.AnimationClip=e.b,n.AnimationComponent=e.n,n.AnimationState=e.A,n.EventInfo=e.E,n.RatioSampler=e.o,n.computeRatioByType=e.q,n.sampleAnimationCurve=e.s,t(n)}],execute:function(){E($+"EmbeddedPlayer")((At=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"begin",Tt,a(e)),r(e,"end",St,a(e)),r(e,"reconciledSpeed",Et,a(e)),r(e,"playable",wt,a(e)),e}return e(n,t),n}(w),Tt=n((bt=At).prototype,"begin",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),St=n(bt.prototype,"end",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Et=n(bt.prototype,"reconciledSpeed",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wt=n(bt.prototype,"playable",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bt));var bt,Tt,St,Et,wt,At,Nt,kt,Ct,Mt,Rt,Ot,It,xt,Pt,Lt,zt,Ut,Ft,Bt,Dt,Wt,Vt,Gt,Ht,jt,qt,Qt,Xt,Yt,Zt,Jt,$t,Kt,te=function(){},ee=function(){function t(t){this._randomAccess=t}return t.prototype.setTime=function(){},i(t,[{key:"randomAccess",get:function(){return this._randomAccess}}]),t}(),ne=(E($+"EmbeddedAnimationClipPlayable")((Mt=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"path",kt,a(e)),r(e,"clip",Ct,a(e)),e}return e(n,t),n.prototype.instantiate=function(t){var e=this.clip,n=this.path;if(!e)return null;var i=t.getChildByPath(n);if(!i)return o(3938,n,t.getPathInHierarchy(),e.name),null;var r=new K(e);return r.initialize(i),new ne(r)},n}(te),kt=n((Nt=Mt).prototype,"path",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ct=n(Nt.prototype,"clip",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nt)),function(t){function n(e){var n;return(n=t.call(this,!0)||this)._animationState=void 0,n._animationState=e,n}e(n,t);var i=n.prototype;return i.destroy=function(){this._animationState.destroy()},i.play=function(){this._animationState.play()},i.pause=function(){this._animationState.pause()},i.stop=function(){this._animationState.stop()},i.setSpeed=function(t){this._animationState.speed=t},i.setTime=function(t){this._animationState.time=t},n}(ee)),ie=(E($+"EmbeddedParticleSystemPlayable")((It=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"path",Ot,a(e)),e}return e(n,t),n.prototype.instantiate=function(t){var e=t.getChildByPath(this.path);if(!e)return s("Hierarchy path "+this.path+" does not exists."),null;var n=u("cc.ParticleSystem");if(!n)return s("Particle system is required for embedded particle system player."),null;var i=e.getComponent(n);return i?new ie(i):(s(this.path+" does not includes a particle system component."),null)},n}(te),Ot=n((Rt=It).prototype,"path",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Rt)),function(t){function n(e){var n;return(n=t.call(this,!1)||this)._particleSystem=void 0,n._particleSystem=e,n}e(n,t);var i=n.prototype;return i.destroy=function(){},i.play=function(){this._particleSystem.play()},i.pause=function(){this._particleSystem.stopEmitting()},i.stop=function(){this._particleSystem.stopEmitting()},i.setSpeed=function(t){this._particleSystem.simulationSpeed=t},n}(ee)),re=(E($+"RealArrayTrack")((Lt=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_channels",Pt,a(e)),e}e(n,t);var o=n.prototype;return o.channels=function(){return this._channels},o[tt]=function(){return new re(this._channels.map((function(t){return t.curve})))},i(n,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var e=this._channels.length;if(t<e)this._channels.splice(t);else if(t>e){var n;(n=this._channels).push.apply(n,Array.from({length:t-e},(function(){return new et(new N)})))}}}]),n}(nt),Pt=n((xt=Lt).prototype,"_channels",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xt)),function(){function t(t){this._curves=t,this._result=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var e=this._result,n=e.length,i=0;i<n;++i)e[i]=this._curves[i].evaluate(t);return this._result},t}()),ae=E("cc.animation.UniformProxyFactory")((Wt=function(){function t(t,e){r(this,"passIndex",Ft,this),r(this,"uniformName",Bt,this),r(this,"channelIndex",Dt,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],n=e.getHandle(this.uniformName);if(!n)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');if(k.getTypeFromHandle(n)<S.SAMPLER1D){var i=void 0===this.channelIndex?n:e.getHandle(this.uniformName,this.channelIndex,S.FLOAT);if(!i)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var n,i=l(t.shaderInfo.blocks);!(n=i()).done;)for(var r,a=n.value,o=l(a.members);!(r=o()).done;){var s=r.value;if(s.name===e)return s.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(i,t)}}:{set:function(t){e.setUniform(i,t)}}}var r=k.getBindingFromHandle(n),a=e.properties[this.uniformName],o=a&&a.value?""+a.value+C(a.type):M(a.type),u=R.get(o);return u||(s("Illegal texture default value: "+o+"."),u=R.get("default-texture")),{set:function(t){t||(t=u);var n=t.getGFXTexture();n&&n.width&&n.height&&(e.bindTexture(r,n),t instanceof O&&e.bindSampler(r,q.gfxDevice.getSampler(t.getSamplerInfo())))}}},t}(),Ft=n((Ut=Wt).prototype,"passIndex",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bt=n(Ut.prototype,"uniformName",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dt=n(Ut.prototype,"channelIndex",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),zt=Ut))||zt,oe=E("cc.animation.MorphWeightValueProxy")((qt=function(){function t(){r(this,"subMeshIndex",Ht,this),r(this,"shapeIndex",jt,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),Ht=n((Gt=qt).prototype,"subMeshIndex",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jt=n(Gt.prototype,"shapeIndex",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vt=Gt))||Vt,se=E("cc.animation.MorphWeightsValueProxy")((Zt=function(){function t(){r(this,"subMeshIndex",Yt,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),Yt=n((Xt=Zt).prototype,"subMeshIndex",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qt=Xt))||Qt,ue=E("cc.animation.MorphWeightsAllValueProxy")(Jt=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||Jt,le=Symbol("[[Owner]]");function ce(t,e){c(t[le]===e)}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER"}($t||($t={})),function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(Kt||(Kt={}));var he,fe,pe,de,_e,ge,ve,me,ye,be,Te,Se,Ee,we,Ae,Ne=function(){function t(t,e){this.type=void 0,this.resetMode=Kt.AFTER_CONSUMED,this._value=void 0,this._refs=[],this.type=t,this._value=e}return t.prototype.bind=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._refs.push({fn:t,thisArg:e,args:i}),this._value},i(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t;for(var e,n=l(this._refs);!(e=n()).done;){var i=e.value,r=i.fn,a=i.thisArg,o=i.args;r.call.apply(r,[a,t].concat(o))}}}]),t}(),ke=function(t){function n(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return e(n,t),n}(h(Error)),Ce=function(t){function n(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return e(n,t),n}(h(Error)),Me=function(t){function n(e,n,i){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=i?i:typeof i)+"'")||this}return e(n,t),n}(h(Error)),Re=Symbol("[[createEval]]"),Oe=Symbol("[[Outgoing transitions]]"),Ie=Symbol("[[Incoming transitions]]"),xe=E("cc.animation.State")((de=function(t){function n(){var e;return e=t.call(this)||this,r(e,"name",pe,a(e)),e[Oe]=[],e[Ie]=[],e}return e(n,t),n}(w),pe=n((fe=de).prototype,"name",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),he=fe))||he,Pe=E($+"InteractiveState")((me=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_components",ve,a(e)),e}e(n,t);var o=n.prototype;return o.addComponent=function(t){var e=new t;return this._components.push(e),e},o.removeComponent=function(t){f(this._components,t)},o.instantiateComponents=function(){return this._components.map((function(t){return x(t)}))},i(n,[{key:"components",get:function(){return this._components}}]),n}(xe),ve=n((ge=me).prototype,"_components",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_e=ge))||_e,Le=E("cc.animation.Motion")((Ae=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"motion",Te,a(e)),r(e,"speed",Se,a(e)),r(e,"speedMultiplier",Ee,a(e)),r(e,"speedMultiplierEnabled",we,a(e)),e}return e(n,t),n.prototype.clone=function(){var t,e,i=new n;return i.motion=null!==(t=null===(e=this.motion)||void 0===e?void 0:e.clone())&&void 0!==t?t:null,i.speed=this.speed,i.speedMultiplier=this.speedMultiplier,i.speedMultiplierEnabled=this.speedMultiplierEnabled,i},n}(Pe),Te=n((be=Ae).prototype,"motion",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=n(be.prototype,"speed",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ee=n(be.prototype,"speedMultiplier",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),we=n(be.prototype,"speedMultiplierEnabled",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ye=be))||ye;function ze(t,e,n){if(p(t,e),p(t,n),e===n)return t;var i=t[e];if(e<n)for(var r=e+1;r<=n;++r)t[r-1]=t[r];else for(var a=e;a!==n;--a)t[a]=t[a-1];return t[n]=i,t}var Ue,Fe,Be,De,We,Ve,Ge,He,je,qe,Qe,Xe,Ye,Ze,Je,$e,Ke,tn,en,nn,rn,an,on,sn,un,ln,cn,hn,fn,pn,dn,_n,gn,vn,mn,yn,bn,Tn,Sn,En,wn,An,Nn,kn,Cn,Mn,Rn,On,In,xn,Pn,Ln,zn,Un,Fn,Bn,Dn,Wn=Symbol("[[OnAfterDeserialized]]"),Vn=E($+"Transition")((Ve=function(t){function n(e,n,i){var o;return o=t.call(this)||this,r(o,"from",Be,a(o)),r(o,"to",De,a(o)),r(o,"conditions",We,a(o)),o[le]=void 0,o.from=e,o.to=n,i&&(o.conditions=i),o}return e(n,t),n}(w),Be=n((Fe=Ve).prototype,"from",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=n(Fe.prototype,"to",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=n(Fe.prototype,"conditions",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ue=Fe))||Ue;!function(t){t[t.NONE=0]="NONE",t[t.CURRENT_STATE=1]="CURRENT_STATE",t[t.NEXT_STATE=2]="NEXT_STATE",t[t.CURRENT_STATE_THEN_NEXT_STATE=3]="CURRENT_STATE_THEN_NEXT_STATE",t[t.NEXT_STATE_THEN_CURRENT_STATE=4]="NEXT_STATE_THEN_CURRENT_STATE"}(Dn||(Dn={}));var Gn,Hn=E($+"AnimationTransition")(($e=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"duration",je,a(e)),r(e,"relativeDuration",qe,a(e)),r(e,"exitConditionEnabled",Qe,a(e)),r(e,"destinationStart",Xe,a(e)),r(e,"relativeDestinationStart",Ye,a(e)),r(e,"interruptionSource",Ze,a(e)),r(e,"_exitCondition",Je,a(e)),e}return e(n,t),i(n,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}},{key:"interruptible",get:function(){return this.interruptionSource!==Dn.NONE},set:function(t){this.interruptionSource=t?Dn.CURRENT_STATE_THEN_NEXT_STATE:Dn.NONE}}]),n}(Vn),je=n((He=$e).prototype,"duration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),qe=n(He.prototype,"relativeDuration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qe=n(He.prototype,"exitConditionEnabled",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xe=n(He.prototype,"destinationStart",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ye=n(He.prototype,"relativeDestinationStart",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ze=n(He.prototype,"interruptionSource",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.NONE}}),Je=n(He.prototype,"_exitCondition",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ge=He))||Ge,jn=E($+"EmptyState")(Ke=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(xe))||Ke,qn=E($+"EmptyStateTransition")((on=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"duration",nn,a(e)),r(e,"destinationStart",rn,a(e)),r(e,"relativeDestinationStart",an,a(e)),e}return e(n,t),n}(Vn),nn=n((en=on).prototype,"duration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),rn=n(en.prototype,"destinationStart",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),an=n(en.prototype,"relativeDestinationStart",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tn=en))||tn,Qn=E("cc.animation.StateMachine")((dn=function(t){e(o,t);var n=o.prototype;function o(){var e;return e=t.call(this)||this,r(e,"_states",ln,a(e)),r(e,"_transitions",cn,a(e)),r(e,"_entryState",hn,a(e)),r(e,"_exitState",fn,a(e)),r(e,"_anyState",pn,a(e)),e._entryState=e._addState(new xe),e._entryState.name="Entry",e._exitState=e._addState(new xe),e._exitState.name="Exit",e._anyState=e._addState(new xe),e._anyState.name="Any",e}return n.__callOnAfterDeserializeRecursive=function(){this[Wn]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof Xn&&n.stateMachine.__callOnAfterDeserializeRecursive()}},n[Wn]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[Oe].push(t),t.to[Ie].push(t)}))},n[Re]=function(){throw new Error("Method not implemented.")},n.states=function(){return this._states},n.transitions=function(){return this._transitions},n.getTransitionsBetween=function(t,e){return ce(t,this),ce(e,this),t[Oe].filter((function(t){return t.to===e}))},n.getOutgoings=function(t){return ce(t,this),t[Oe]},n.getIncomings=function(t){return ce(t,this),t[Ie]},n.addMotion=function(){return this._addState(new Le)},n.addSubStateMachine=function(){return this._addState(new Xn)},n.addEmpty=function(){return this._addState(new jn)},n.remove=function(t){ce(t,this),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),f(this._states,t))},n.connect=function(t,e,n){if(ce(t,this),ce(e,this),e===this.entryState)throw new ke("to-entry");if(e===this.anyState)throw new ke("to-any");if(t===this.exitState)throw new ke("from-exit");var i=t instanceof Le||t===this._anyState?new Hn(t,e,n):t instanceof jn?new qn(t,e,n):new Vn(t,e,n);return this._transitions.push(i),t[Oe].push(i),e[Ie].push(i),i},n.disconnect=function(t,e){ce(t,this),ce(e,this);for(var n=t[Oe],i=e[Ie],r=this._transitions,a=n.filter((function(t){return t.to===e})),o=a.length,s=function(t){var e=a[t];f(n,e),c(f(r,e)),d(_(i,(function(t){return t===e})))},u=0;u<o;++u)s(u)},n.removeTransition=function(t){c(f(this._transitions,t)),d(_(t.from[Oe],(function(e){return e===t}))),d(_(t.to[Ie],(function(e){return e===t})))},n.eraseOutgoings=function(t){var e=this;ce(t,this);for(var n=t[Oe],i=function(t){var i=n[t],r=i.to;c(f(e._transitions,i)),d(_(r[Ie],(function(t){return t===i})))},r=0;r<n.length;++r)i(r);n.length=0},n.eraseIncomings=function(t){var e=this;ce(t,this);for(var n=t[Ie],i=function(t){var i=n[t],r=i.from;c(f(e._transitions,i)),d(_(r[Oe],(function(t){return t===i})))},r=0;r<n.length;++r)i(r);n.length=0},n.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},n.adjustTransitionPriority=function(t,e){var n=t.from;if(0!==e){var i=n[Oe],r=i.indexOf(t),a=V(r+e,0,i.length-1),o=this._transitions,s=o.indexOf(t);if(a>r)for(var u=r+1;u<=a;++u){var l=i[u],c=o.indexOf(l);o[s]=l,s=c}else if(r>a)for(var h=r-1;h>=a;--h){var f=i[h],p=o.indexOf(f);o[s]=f,s=p}o[s]=t,ze(i,r,a)}},n.clone=function(){for(var t,e=new o,n=new Map,i=l(this._states);!(t=i()).done;){var r=t.value;switch(r){case this._entryState:n.set(r,e._entryState);break;case this._exitState:n.set(r,e._exitState);break;case this._anyState:n.set(r,e._anyState);break;default:if(r instanceof Le||r instanceof Xn){var a=r.clone();e._addState(a),n.set(r,a)}}}for(var s,u=l(this._transitions);!(s=u()).done;){var c=s.value,h=n.get(c.from),f=n.get(c.to),p=e.connect(h,f);p.conditions=c.conditions.map((function(t){return t.clone()})),p instanceof Hn&&(p.duration=c.duration,p.exitConditionEnabled=c.exitConditionEnabled,p.exitCondition=c.exitCondition)}return e},n._addState=function(t){return this._states.push(t),t},i(o,[{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),o}(w),ln=n((un=dn).prototype,"_states",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cn=n(un.prototype,"_transitions",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hn=n(un.prototype,"_entryState",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn=n(un.prototype,"_exitState",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=n(un.prototype,"_anyState",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn=un))||sn,Xn=E("cc.animation.SubStateMachine")((mn=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_stateMachine",vn,a(e)),e}return e(n,t),n.prototype.clone=function(){var t=new n;return t._stateMachine=this._stateMachine.clone(),t},i(n,[{key:"stateMachine",get:function(){return this._stateMachine}}]),n}(Pe),vn=n((gn=mn).prototype,"_stateMachine",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),_n=gn))||_n,Yn=E("cc.animation.Layer")((An=function(){function t(){this[le]=void 0,r(this,"_stateMachine",Tn,this),r(this,"name",Sn,this),r(this,"weight",En,this),r(this,"mask",wn,this),this._stateMachine=new Qn}return i(t,[{key:"stateMachine",get:function(){return this._stateMachine}}]),t}(),Tn=n((bn=An).prototype,"_stateMachine",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sn=n(bn.prototype,"name",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),En=n(bn.prototype,"weight",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wn=n(bn.prototype,"mask",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yn=bn))||yn;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(Gn||(Gn={})),c(0==(0|Kt.AFTER_CONSUMED<<1));var Zn,Jn,$n,Kn,ti,ei=E("cc.animation.PlainVariable")((Rn=function(){function t(t){if(r(this,"_type",Cn,this),r(this,"_value",Mn,this),void 0!==t)switch(this._type=t,t){default:break;case $t.FLOAT:case $t.INTEGER:this._value=0;break;case $t.BOOLEAN:this._value=!1}}return i(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),Cn=n((kn=Rn).prototype,"_type",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $t.FLOAT}}),Mn=n(kn.prototype,"_value",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nn=kn))||Nn,ni=E("cc.animation.TriggerVariable")((Pn=function(){function t(){r(this,"_flags",xn,this)}return i(t,[{key:"type",get:function(){return $t.TRIGGER}},{key:"value",get:function(){return!!((1&this._flags)>>0)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),xn=n((In=Pn).prototype,"_flags",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),On=In))||On,ii=E("cc.animation.AnimationGraph")((Bn=function(t){function n(){var e;return e=t.call(this)||this,r(e,"_layers",Un,a(e)),r(e,"_variables",Fn,a(e)),e}e(n,t);var o=n.prototype;return o.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].stateMachine.__callOnAfterDeserializeRecursive()},o.addLayer=function(){var t=new Yn;return this._layers.push(t),t},o.removeLayer=function(t){g.removeAt(this._layers,t)},o.moveLayer=function(t,e){ze(this._layers,t,e)},o.addBoolean=function(t,e){void 0===e&&(e=!1);var n=new ei($t.BOOLEAN);n.value=e,this._variables[t]=n},o.addFloat=function(t,e){void 0===e&&(e=0);var n=new ei($t.FLOAT);n.value=e,this._variables[t]=n},o.addInteger=function(t,e){void 0===e&&(e=0);var n=new ei($t.INTEGER);n.value=e,this._variables[t]=n},o.addTrigger=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=Kt.AFTER_CONSUMED);var i=new ni;i.resetMode=n,i.value=e,this._variables[t]=i},o.removeVariable=function(t){delete this._variables[t]},o.getVariable=function(t){return this._variables[t]},o.renameVariable=function(t,e){var n=this._variables;t in n&&(e in n||(this._variables=Object.entries(n).reduce((function(n,i){var r=i[0],a=i[1];return n[r===t?e:r]=a,n}),{})))},i(n,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),n}(P),Un=n((zn=Bn).prototype,"_layers",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fn=n(zn.prototype,"_variables",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Ln=zn))||Ln,ri=oi,ai=oi;function oi(){}Zn=E("cc.animation.ClipMotion"),Jn=L(it),Zn((ti=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"clip",Kn,a(e)),e}e(n,t);var i=n.prototype;return i[Re]=function(t){return this.clip?new Ai(t,this.clip):null},i.clone=function(){var t=new n;return t.clip=this.clip,t},n}(w),Kn=n(($n=ti).prototype,"clip",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$n));var si,ui,li,ci,hi,fi,pi,di,_i,gi,vi,mi,yi,bi,Ti,Si,Ei,wi,Ai=function(){function t(t,e){this.duration=e.duration/e.speed,this._state=new K(e),this._state.initialize(t.node,t.blendBuffer,t.mask)}var e=t.prototype;return e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._state.clip,weight:t}})}}},e.sample=function(t,e){if(0!==e){var n=this._state.duration*t;this._state.time=n,this._state.weight=e,this._state.sample(),this._state.weight=0}},i(t,[{key:"progress",get:function(){return this._state.time/this.duration}}]),t}(),Ni=E($+"BindableNumber")((hi=function(){function t(t){void 0===t&&(t=0),r(this,"variable",li,this),r(this,"value",ci,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),li=n((ui=hi).prototype,"variable",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ci=n(ui.prototype,"value",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),si=ui))||si,ki=E($+"BindableBoolean")((gi=function(){function t(t){void 0===t&&(t=!1),r(this,"variable",di,this),r(this,"value",_i,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),di=n((pi=gi).prototype,"variable",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_i=n(pi.prototype,"value",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fi=pi))||fi;function Ci(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!Ri(s,a))return o;if(s.type!==n)throw new Me(a,"number");for(var u=arguments.length,l=new Array(u>5?u-5:0),c=5;c<u;c++)l[c-5]=arguments[c];var h=s.bind.apply(s,[i,r].concat(l));return h}function Mi(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!Ri(s,a))return o;if(n!==$t.FLOAT&&n!==$t.INTEGER)throw new Me(a,"number or integer");for(var u=arguments.length,l=new Array(u>5?u-5:0),c=5;c<u;c++)l[c-5]=arguments[c];var h=s.bind.apply(s,[i,r].concat(l));return h}function Ri(t,e){if(t)return!0;throw new Ce(e)}var Oi,Ii,xi,Pi,Li,zi,Ui,Fi,Bi,Di,Wi,Vi=E($+"AnimationBlendItem")((bi=function(){function t(){r(this,"motion",yi,this)}var e=t.prototype;return e.clone=function(){var e=new t;return this._assign(e),e},e._assign=function(t){var e,n;return t.motion=null!==(e=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==e?e:null,t},t}(),yi=n((mi=bi).prototype,"motion",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vi=mi))||vi,Gi=E($+"AnimationBlend")((wi=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"name",Ei,a(e)),e}return e(n,t),n}(w),Ei=n((Si=wi).prototype,"name",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ti=Si))||Ti,Hi=function(){function t(t,e,n,i){this._childEvaluators=n.map((function(e){var n,i;return null!==(n=null===(i=e.motion)||void 0===i?void 0:i[Re](t))&&void 0!==n?n:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(i)}var e=t.prototype;return e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,i=this._weights,r=n.length,a=0;return{next:function(){for(;;){if(e){var o=e.next();if(!o.done)return o}if(a>=r)return{done:!0,value:void 0};var s=n[a];e=null==s?void 0:s.getClipStatuses(t*i[a]),++a}}}},e.sample=function(t,e){for(var n=0;n<this._childEvaluators.length;++n){var i;null===(i=this._childEvaluators[n])||void 0===i||i.sample(t,e*this._weights[n])}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},e.eval=function(){},i(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,i;t+=(null!==(n=null===(i=this._childEvaluators[e])||void 0===i?void 0:i.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),ji=E($+"AnimationBlend1DItem")((Pi=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"threshold",xi,a(e)),e}e(n,t);var i=n.prototype;return i.clone=function(){var t=new n;return this._assign(t),t},i._assign=function(e){return t.prototype._assign.call(this,e),e.threshold=this.threshold,e},n}(Vi),xi=n((Ii=Pi).prototype,"threshold",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Oi=Ii))||Oi,qi=(E("cc.animation.AnimationBlend1D")((Bi=Fi=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_items",zi,a(e)),r(e,"param",Ui,a(e)),e}e(n,t);var o=n.prototype;return o.clone=function(){var t=new n;return t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},o[Re]=function(t){var e=new qi(t,this,this._items,this._items.map((function(t){return t.threshold})),0),n=Ci(t,this.param,$t.FLOAT,e.setInput,e,0);return e.setInput(n,0),e},i(n,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),n}(Gi),Fi.Item=ji,zi=n((Li=Bi).prototype,"_items",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ui=n(Li.prototype,"param",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni}}),Li)),function(t){function n(e,n,i,r,a){var o;return(o=t.call(this,e,n,i,[a])||this)._thresholds=r,o.doEval(),o}return e(n,t),n.prototype.eval=function(t,e){var n=e[0];!function(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var i=0,r=1;r<e.length;++r)if(e[r]>n){i=r;break}var a=e[i-1],o=e[i],s=o-a;t[i-1]=(o-n)/s,t[i]=(n-a)/s}}(t,this._thresholds,n)},n}(Hi)),Qi=(Di=new G,Wi={wA:0,wB:0},function(t,e,n){if(c(t.length===e.length),0!==e.length)if(1!==e.length)if(G.strictEquals(n,G.ZERO)){var i=e.findIndex((function(t){return G.strictEquals(t,G.ZERO)}));i>=0?t[i]=1:t.fill(1/e.length)}else{for(var r=-1,a=-1,o=-1,s=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,l=n.x,h=n.y,f=0;f<e.length;++f){var p=e[f];if(G.equals(p,G.ZERO))o=f;else{var d=G.normalize(Di,p),_=G.dot(d,n);d.x*h-d.y*l>0?_>=u&&(u=_,r=f):_>=s&&(s=_,a=f)}}var g=0;if(r<0||a<0)g=1;else{var v=(A=e[r],N=e[a],k=n,C=Wi,(M=G.cross(A,N))?(C.wA=G.cross(k,N)/M,C.wB=G.cross(k,A)/-M):(C.wA=0,C.wB=0),C),m=v.wA,y=v.wB,b=0,T=0,S=m+y;S>1?(b=m/S,T=y/S):S<0?(b=0,T=0,g=1):(b=m,T=y,g=1-S),t[r]=b,t[a]=T}if(g>0)if(o>=0)t[o]=g;else for(var E=g/t.length,w=0;w<t.length;++w)t[w]+=E}else t[0]=1;var A,N,k,C,M});function Xi(t,e,n,i){t.fill(0);for(var r=new G(0,0),a=new G(0,0),o=0,s=e.length,u=0;u<s;++u){for(var l=Number.MAX_VALUE,c=!1,h=0;h<s;++h)if(u!==h){i(e[u],e[h],n,r,a);var f=1-G.dot(r,a)/G.lengthSqr(a);if(f<0){c=!0;break}l=Math.min(l,f)}c||(t[u]=l,o+=l)}o>0&&t.forEach((function(e,n){return t[n]=e/o}))}var Yi,Zi,Ji,$i,Ki,tr,er,nr,ir,rr,ar,or,sr,ur,lr,cr,hr,fr,pr=function(t,e,n,i,r){G.subtract(i,n,t),G.subtract(r,e,t)},dr=(Yi=new H(0,0,0),Zi=new H(0,0,0),Ji=new H(0,0,0),$i=new H(0,0,0),Ki=new H(0,0,0),tr=new H(0,0,0),function(t,e,n,i,r){var a=0,o=0,s=2;H.set(Ji,n.x,n.y,0),G.equals(t,G.ZERO)?(a=G.angle(n,e),o=0,s=1):G.equals(e,G.ZERO)?(o=a=G.angle(n,t),s=1):(a=G.angle(t,e))<=0?o=0:G.equals(n,G.ZERO)?o=a:(H.set($i,t.x,t.y,0),H.set(Ki,e.x,e.y,0),H.set(tr,n.x,n.y,0),H.cross(Yi,$i,Ki),H.projectOnPlane(Ji,tr,Yi),o=H.angle($i,Ji),a<.99*Math.PI&&H.dot(H.cross(Zi,$i,Ji),Yi)<0&&(o=-o));var u=G.len(t),l=G.len(e),c=(l+u)/2;G.set(r,(l-u)/c,a*s),G.set(i,(H.len(Ji)-u)/c,o*s)});!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(fr||(fr={})),v(fr);var _r,gr,vr,mr,yr,br,Tr,Sr,Er,wr,Ar,Nr,kr,Cr,Mr,Rr,Or,Ir,xr,Pr,Lr,zr,Ur,Fr,Br,Dr,Wr,Vr,Gr,Hr,jr,qr=E($+"AnimationBlend2DItem")((rr=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"threshold",ir,a(e)),e}e(n,t);var i=n.prototype;return i.clone=function(){var t=new n;return this._assign(t),t},i._assign=function(e){return t.prototype._assign.call(this,e),G.copy(e.threshold,this.threshold),e},n}(Vi),ir=n((nr=rr).prototype,"threshold",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new G}}),er=nr))||er,Qr=(E("cc.animation.AnimationBlend2D")((hr=cr=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"algorithm",or,a(e)),r(e,"_items",sr,a(e)),r(e,"paramX",ur,a(e)),r(e,"paramY",lr,a(e)),e}e(n,t);var o=n.prototype;return o.clone=function(){var t=new n;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t},o[Re]=function(t){var e=new Qr(t,this,this._items,this._items.map((function(t){return t.threshold})),this.algorithm,[0,0]),n=Ci(t,this.paramX,$t.FLOAT,e.setInput,e,0),i=Ci(t,this.paramY,$t.FLOAT,e.setInput,e,1);return e.setInput(n,0),e.setInput(i,1),e},i(n,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),n}(Gi),cr.Algorithm=fr,cr.Item=qr,or=n((ar=hr).prototype,"algorithm",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fr.SIMPLE_DIRECTIONAL}}),sr=n(ar.prototype,"_items",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ur=n(ar.prototype,"paramX",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni}}),lr=n(ar.prototype,"paramY",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni}}),ar)),function(t){function n(e,n,i,r,a,o){var s;return(s=t.call(this,e,n,i,o)||this)._thresholds=void 0,s._algorithm=void 0,s._value=new G,s._thresholds=r,s._algorithm=a,s.doEval(),s}return e(n,t),n.prototype.eval=function(t,e){var n=e[0],i=e[1];switch(G.set(this._value,n,i),t.fill(0),this._algorithm){case fr.SIMPLE_DIRECTIONAL:Qi(t,this._thresholds,this._value);break;case fr.FREEFORM_CARTESIAN:!function(t,e,n){Xi(t,e,n,pr)}(t,this._thresholds,this._value);break;case fr.FREEFORM_DIRECTIONAL:!function(t,e,n){Xi(t,e,n,dr)}(t,this._thresholds,this._value)}},n}(Hi)),Xr=E($+"AnimationBlendDirectItem")((mr=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"weight",vr,a(e)),e}e(n,t);var i=n.prototype;return i.clone=function(){var t=new n;return this._assign(t),t},i._assign=function(e){return t.prototype._assign.call(this,e),e.weight=this.weight,e},n}(Vi),vr=n((gr=mr).prototype,"weight",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_r=gr))||_r,Yr=(E("cc.animation.AnimationBlendDirect")((Sr=Tr=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_items",br,a(e)),e}e(n,t);var o=n.prototype;return o.clone=function(){var t=new n;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},o[Re]=function(t){return new Yr(t,this,this._items,this._items.map((function(t){return t.weight})))},i(n,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),n}(Gi),Tr.Item=Xr,br=n((yr=Sr).prototype,"_items",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yr)),function(t){function n(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).doEval(),e}return e(n,t),n.prototype.eval=function(t,e){for(var n=t.length,i=0;i<n;++i)t[i]=e[i]},n}(Hi)),Zr=(E($+"AnimationMask")((Ar=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"_jointMasks",wr,a(e)),e}e(n,t);var o=n.prototype;return o.addJoint=function(t,e){this.removeJoint(t);var n=new Zr;n.path=t,n.enabled=e,this._jointMasks.push(n)},o.removeJoint=function(t){_(this._jointMasks,(function(e){return e.path===t}))},o.clear=function(){this._jointMasks.length=0},o.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,i=new Set,r=0;r<n;++r){var a=e[r],o=a.path;if(!a.enabled){var s=t.getChildByPath(o);s&&i.add(s)}}return i},i(n,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=l(t);!(e=n()).done;){var i=e.value;this.addJoint(i.path,i.enabled)}}}]),n}(P),wr=n((Er=Ar).prototype,"_jointMasks",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n(Er.prototype,"joints",[z],Object.getOwnPropertyDescriptor(Er.prototype,"joints"),Er.prototype),Er)),E("cc.JointMask")((Cr=n((kr=function(){r(this,"path",Cr,this),r(this,"enabled",Mr,this)}).prototype,"path",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Mr=n(kr.prototype,"enabled",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Nr=kr))||Nr);!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(jr||(jr={})),E($+"BinaryCondition")((Lr=Pr=function(){function t(){r(this,"operator",Or,this),r(this,"lhs",Ir,this),r(this,"rhs",xr,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs.clone(),e.rhs=this.rhs.clone(),e},e[Re]=function(t){var e=this.operator,n=this.lhs,i=this.rhs,r=new $r(e,0,0),a=Mi(t,n,$t.FLOAT,r.setLhs,r),o=Mi(t,i,$t.FLOAT,r.setRhs,r);return r.reset(a,o),r},t}(),Pr.Operator=jr,Or=n((Rr=Lr).prototype,"operator",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jr.EQUAL_TO}}),Ir=n(Rr.prototype,"lhs",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni}}),xr=n(Rr.prototype,"rhs",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ni}}),Rr));var Jr,$r=function(){function t(t,e,n){this._operator=t,this._lhs=e,this._rhs=n,this._eval()}var e=t.prototype;return e.reset=function(t,e){this._lhs=t,this._rhs=e,this._eval()},e.setLhs=function(t){this._lhs=t,this._eval()},e.setRhs=function(t){this._rhs=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._lhs,e=this._rhs;switch(this._operator){default:case jr.EQUAL_TO:this._result=t===e;break;case jr.NOT_EQUAL_TO:this._result=t!==e;break;case jr.LESS_THAN:this._result=t<e;break;case jr.LESS_THAN_OR_EQUAL_TO:this._result=t<=e;break;case jr.GREATER_THAN:this._result=t>e;break;case jr.GREATER_THAN_OR_EQUAL_TO:this._result=t>=e}},t}();!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(Jr||(Jr={})),E($+"UnaryCondition")((Dr=Br=function(){function t(){r(this,"operator",Ur,this),r(this,"operand",Fr,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[Re]=function(t){var e=this.operator,n=this.operand,i=new ta(e,!1),r=Ci(t,n,$t.BOOLEAN,i.setOperand,i);return i.reset(r),i},t}(),Br.Operator=Jr,Ur=n((zr=Dr).prototype,"operator",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jr.TRUTHY}}),Fr=n(zr.prototype,"operand",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ki}}),zr));var Kr,ta=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case Jr.TRUTHY:this._result=!!t;break;case Jr.FALSY:this._result=!t}},t}(),ea=E($+"TriggerCondition")((Hr=function(){function t(){r(this,"trigger",Gr,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[Re]=function(t){var e=new na(!1),n=t.getVar(this.trigger);return Ri(n,this.trigger)&&(function(t,e){if(t!==$t.TRIGGER)throw new Me(e,"trigger")}(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),Gr=n((Vr=Hr).prototype,"trigger",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Wr=Vr))||Wr,na=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),ia=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new ra(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),ra=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},i(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(Kr||(Kr={}));var aa,oa=Kr.POSITION|Kr.ROTATION|Kr.SCALE|Kr.EULER_ANGLES,sa=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new H}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=ga(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,H.zero(this.result)},t}(),ua=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new j}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=va(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,j.identity(this.result)},t}(),la=function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,i,r,a=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":r=null!==(n=a[e])&&void 0!==n?n:a[e]=this._createVec3BlendState(t[e]);break;case"rotation":r=null!==(i=a[e])&&void 0!==i?i:a[e]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._transformApplyFlags,a=this._properties,o=a.position,s=a.scale,u=a.rotation,l=a.eulerAngles;r&&(o&&r&Kr.POSITION&&(e=o.result),s&&r&Kr.SCALE&&(n=s.result),l&&r&Kr.EULER_ANGLES&&(i=l.result),u&&r&Kr.ROTATION&&(i=u.result),(i||e||n)&&t.setRTS(i,e,n),this._transformApplyFlags=0)},i(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),ca=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.apply=function(e){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.accumulatedWeight&&(this._transformApplyFlags|=Kr.POSITION,i.accumulatedWeight<1&&i.blend(e.position,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=Kr.SCALE,r.accumulatedWeight<1&&r.blend(e.scale,1-r.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=Kr.EULER_ANGLES,o.accumulatedWeight<1&&o.blend(e.eulerAngles,1-o.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=Kr.ROTATION,a.accumulatedWeight<1&&a.blend(e.rotation,1-a.accumulatedWeight)),t.prototype.apply.call(this,e),null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},i._createVec3BlendState=function(){return new sa},i._createQuatBlendState=function(){return new ua},n}(la),ha=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.createNodeBlendState=function(){return new ca},n}(ia),fa=function(){function t(t){this.refCount=0,this.result=new H,this._defaultValue=new H,this._clipBlendResult=new H,this._accumulatedWeight=0,H.copy(this._defaultValue,t),H.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=ga(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),H.lerp(e,e,n,t),H.zero(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){H.copy(this.result,this._defaultValue)},t}(),pa=function(){function t(t){this.refCount=0,this.result=new j,this._defaultValue=new j,this._clipBlendResult=new j,this._accumulatedWeight=0,j.copy(this._defaultValue,t),j.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=va(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),j.slerp(e,e,n,t),j.identity(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){j.copy(this.result,this._defaultValue)},t}(),da=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._layerMask=-1>>>0,e}e(n,t);var i=n.prototype;return i.setLayerMask=function(t){this._layerMask&=~(1<<t)},i.commitLayerChanges=function(t,e){if(this._layerMask&1<<t){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.commitLayerChange(e),r&&r.commitLayerChange(e),a&&a.commitLayerChange(e),o&&o.commitLayerChange(e)}},i.apply=function(e){this._transformApplyFlags=oa,t.prototype.apply.call(this,e);var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},i._createVec3BlendState=function(t){return new fa(t)},i._createQuatBlendState=function(t){return new pa(t)},n}(la),_a=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.setMask=function(t,e){this._nodeBlendStates.forEach((function(n,i){e.has(i)&&n.setLayerMask(t)}))},i.commitLayerChanges=function(t,e){this._nodeBlendStates.forEach((function(n){n.commitLayerChanges(t,e)}))},i.createNodeBlendState=function(){return new da},n}(ia);function ga(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;H.lerp(t,t,i,o)}}else H.copy(t,i);return a}function va(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;j.slerp(t,e,i,o)}}else j.copy(t,i);return a}var ma,ya=E($+"StateMachineComponent")(aa=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||aa,ba=function(){function t(t,e,n){var i=this;this._blendBuffer=new _a,this._currentTransitionCache={duration:0,time:0},this._varInstances={},this._hasAutoTrigger=!1;for(var r,a=l(t.variables);!(r=a()).done;){var o=r.value,s=o[0],u=o[1],c=this._varInstances[s]=new Ne(u.type,u.value);if(u.type===$t.TRIGGER){var h=u.resetMode;c.resetMode=h,h===Kt.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}}for(var f={controller:n,blendBuffer:this._blendBuffer,node:e,getVar:function(t){return i._varInstances[t]},triggerResetFn:function(t){i.setValue(t,!1)}},p=(this._layerEvaluations=t.layers.map((function(t){var e;return new Ta(t,y({},f,{mask:null!==(e=t.mask)&&void 0!==e?e:void 0}))}))).length,d=0;d<p;++d){var _=t.layers[d].mask;if(_){var g=_.filterDisabledNodes(f.node);this._blendBuffer.setMask(d,g)}}}var e=t.prototype;return e.update=function(t){for(var e=this._blendBuffer,n=this._layerEvaluations,i=n.length,r=0;r<i;++r){var a=n[r];a.update(t),e.commitLayerChanges(r,a.weight*a.passthroughWeight)}if(this._hasAutoTrigger){var o=this._varInstances;for(var s in o){var u=o[s];u.type===$t.TRIGGER&&u.resetMode===Kt.NEXT_FRAME_OR_AFTER_CONSUMED&&(u.value=!1)}}this._blendBuffer.apply()},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._layerEvaluations[t].getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._layerEvaluations[t].getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._layerEvaluations,n=this._currentTransitionCache;return e[t].getCurrentTransition(n)?n:null},e.getNextStateStatus=function(t){return this._layerEvaluations[t].getNextStateStatus()},e.getNextClipStatuses=function(t){return d(this.getCurrentTransition(t)),this._layerEvaluations[t].getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.getLayerWeight=function(t){return this._layerEvaluations[t].weight},e.setLayerWeight=function(t,e){this._layerEvaluations[t].weight=e},t}(),Ta=function(){function t(t,e){this.passthroughWeight=1,this._nodes=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._currentTransitionToNode=null,this._currentTransitionPath=[],this._transitionProgress=0,this._fromWeight=0,this._toWeight=0,this._fromUpdated=!1,this._toUpdated=!1,this._transitionSnapshot=new qa,this.name=t.name,this._controller=e.controller,this.weight=t.weight;var n=this._addStateMachine(t.stateMachine,null,y({},e),t.name),i=n.entry,r=n.exit;this._topLevelEntry=i,this._topLevelExit=r,this._currentNode=i,this._resetTrigger=e.triggerResetFn}var e=t.prototype;return e.update=function(t){this.exited||(this._fromWeight=1,this._toWeight=0,this._eval(t),this._sample())},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===Ea.animation?t.getFromPortStatus():t.kind===Ea.transitionSnapshot?t.first.getFromPortStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===Ea.animation?t.getClipStatuses(this._fromWeight):t.kind===Ea.transitionSnapshot?t.first.getClipStatuses(this._fromWeight):Aa},e.getCurrentTransition=function(t){var e=this._currentTransitionPath;if(0!==e.length){if(e[e.length-1].to.kind!==Ea.animation)return!1;var n=e[0],i=n.duration,r=n.normalizedDuration,a=t.duration=r?i*(this._currentNode.kind===Ea.animation?this._currentNode.duration:this._currentNode.kind===Ea.transitionSnapshot?this._currentNode.first.duration:0):i;return t.time=this._transitionProgress*a,!0}return!1},e.getNextStateStatus=function(){return c(this._currentTransitionToNode&&this._currentTransitionToNode.kind!==Ea.empty),this._currentTransitionToNode.getToPortStatus()},e.getNextClipStatuses=function(){var t,e=this._currentTransitionPath,n=e[e.length-1].to;return c(n.kind===Ea.animation),null!==(t=n.getClipStatuses(this._toWeight))&&void 0!==t?t:Aa},e._addStateMachine=function(t,e,n,i){for(var r,a,o,s=this,u=Array.from(t.states()),c=u.map((function(e){return e instanceof Le?new Ra(e,n):e===t.entryState?r=new Ga(e,Ea.entry,e.name):e===t.exitState?o=new Ga(e,Ea.exit,e.name):e===t.anyState?a=new Ga(e,Ea.any,e.name):e instanceof jn?new Ha(e):null})),h={components:null,parent:e,entry:r,exit:o,any:a},f=0;f<u.length;++f){var p=c[f];p&&(p.stateMachine=h)}for(var d=u.map((function(t){if(t instanceof Xn){var e=s._addStateMachine(t.stateMachine,h,n,i+"/"+t.name);return e.components=new Ma(t),e}return null})),_=0;_<u.length;++_){var g=u[_],v=t.getOutgoings(g),m=[],y=void 0;y=g instanceof Xn?d[_].exit:c[_];for(var b,T=function(){var t=b.value,e=t.to,i=u.findIndex((function(e){return e===t.to})),r=void 0;r=e instanceof Xn?d[i].entry:c[i];var a={conditions:t.conditions.map((function(t){return t[Re](n)})),to:r,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,interruption:Dn.NONE};t instanceof Hn?(a.duration=t.duration,a.normalizedDuration=t.relativeDuration,a.exitConditionEnabled=t.exitConditionEnabled,a.exitCondition=t.exitCondition,a.destinationStart=t.destinationStart,a.relativeDestinationStart=t.relativeDestinationStart,a.interruption=t.interruptionSource):t instanceof qn&&(a.duration=t.duration,a.destinationStart=t.destinationStart,a.relativeDestinationStart=t.relativeDestinationStart),a.conditions.forEach((function(e,n){var i,r=t.conditions[n];r instanceof ea&&r.trigger&&(null!==(i=a.triggers)&&void 0!==i?i:a.triggers=[]).push(r.trigger)})),m.push(a)},S=l(v);!(b=S()).done;)T();y.outgoingTransitions=m}return h},e._eval=function(t){if(c(!this.exited),ai("[Layer "+this.name+"]: UpdateStart "+t+"s"),this._continueDanglingTransition())return 0;for(var e=t,n=!0,i=0;n||e>0;){if(n=!1,100===i){m(14e3,100);break}if(++i,this._currentTransitionPath.length>0){var r=this._detectInterruption(e,ka);if(r){if(e-=r.requires,this._interrupt(r))break;n=!0;continue}if(e-=this._updateCurrentTransition(e),this._currentNode.kind===Ea.exit)break;0===this._currentTransitionPath.length&&(n=!0)}else{var a=this._currentNode,o=this._matchCurrentNodeTransition(e);if(o){var s=o.transition,u=o.requires;if(ri("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+a.name),e-=u,a.kind===Ea.animation&&(a.updateFromPort(u),this._fromUpdated=!0),this._switchTo(s))break;n=!0}else ri("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+a.name),a.kind===Ea.animation?(a.updateFromPort(e),this._fromUpdated=!0,e=0):e=0}}return ri("[SubStateMachine "+this.name+"]: UpdateEnd"),this._fromUpdated&&this._currentNode.kind===Ea.animation&&(this._fromUpdated=!1,this._currentNode.triggerFromPortUpdate(this._controller)),this._currentTransitionToNode&&this._toUpdated&&this._currentTransitionToNode.kind===Ea.animation&&(this._toUpdated=!1,this._currentTransitionToNode.triggerToPortUpdate(this._controller)),e},e._sample=function(){var t=this._currentNode,e=this._currentTransitionToNode,n=this._fromWeight,i=this._toWeight;t.kind===Ea.empty?(this.passthroughWeight=i,e&&e.kind===Ea.animation&&e.sampleToPort(1)):e&&e.kind===Ea.empty?(this.passthroughWeight=n,this._sampleSource(1)):(this.passthroughWeight=1,this._sampleSource(n),e&&e.kind===Ea.animation&&e.sampleToPort(i))},e._sampleSource=function(t){var e=this._currentNode;e.kind===Ea.animation?e.sampleFromPort(t):e.kind===Ea.transitionSnapshot&&e.sample(t)},e._matchCurrentNodeTransition=function(t){var e=this._currentNode,n=Na.reset();return this._matchTransition(e,e,t,null,n),n.hasZeroCost()||e.kind===Ea.animation&&(this._matchAnyScoped(e,t,n),n.hasZeroCost())||n.isValid()?n:null},e._matchAnyScoped=function(t,e,n){for(var i=!1,r=t.stateMachine;null!==r&&(this._matchTransition(r.any,t,e,null,n)&&(i=!0),!n.hasZeroCost());r=r.parent);return i},e._matchTransition=function(t,e,n,i,r){c(t===e||t.kind===Ea.any);for(var a=t.outgoingTransitions,o=a.length,s=!1,u=0;u<o;++u){var l=a[u];if(l!==i){var h=l.conditions,f=h.length;if(0===f){if(t.kind===Ea.entry||t.kind===Ea.exit){r.set(l,0),s=!0;break}if(!l.exitConditionEnabled)continue}var p=0;if(e.kind===Ea.animation&&l.exitConditionEnabled){var d=e.duration*l.exitCondition;if((p=Math.max(d-e.fromPortTime,0))>n||p>=r.requires)continue}for(var _=!0,g=0;g<f;++g)if(!h[g].eval()){_=!1;break}if(_){if(0===p){r.set(l,0),s=!0;break}c(p<=r.requires),r.set(l,p),s=!0}}}return s},e._switchTo=function(t){var e=this._currentTransitionPath;this._consumeTransition(t),e.push(t);var n=this._matchTransitionPathUntilMotion();return!n||(this._doTransitionToMotion(n),!1)},e._continueDanglingTransition=function(){var t=this._currentTransitionPath,e=t.length;if(0===e)return!1;var n=t[e-1].to;if(n.kind!==Ea.animation&&n.kind!==Ea.empty){var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)}return!1},e._matchTransitionPathUntilMotion=function(){for(var t=this._currentTransitionPath,e=t[t.length-1].to;e.kind!==Ea.animation&&e.kind!==Ea.empty;){var n=Na.reset();if(this._matchTransition(e,e,0,null,n),!n.transition)break;var i=n.transition;this._consumeTransition(i),t.push(i),e=i.to}return e.kind===Ea.animation||e.kind===Ea.empty?e:null},e._consumeTransition=function(t){var e=t.to;e.kind===Ea.entry&&this._callEnterMethods(e)},e._resetTriggersAlongThePath=function(){for(var t=this._currentTransitionPath,e=t.length,n=0;n<e;++n){var i=t[n];this._resetTriggersOnTransition(i)}},e._doTransitionToMotion=function(t){var e=this._currentTransitionPath;if(c(0!==e.length),this._resetTriggersAlongThePath(),this._transitionProgress=0,this._currentTransitionToNode=t,this._toUpdated=!1,t.kind===Ea.animation){var n=e[0],i=n.destinationStart,r=n.relativeDestinationStart?i:0===t.duration?0:i/t.duration;t.resetToPort(r)}this._callEnterMethods(t)},e._updateCurrentTransition=function(t){var e,n=this._currentTransitionPath,i=this._currentTransitionToNode;d(n.length>0);var r=n[0],a=r.duration,o=r.normalizedDuration,s=this._currentNode,u=i,l=0,h=0;if(a<=0)l=0,h=1;else{c(s.kind===Ea.animation||s.kind===Ea.empty||s.kind===Ea.transitionSnapshot);var f=this._transitionProgress,p=s.kind===Ea.empty?a:o?a*(s.kind===Ea.animation?s.duration:s.first.duration):a,_=f*p,g=p-_;l=Math.min(g,t),h=this._transitionProgress=(_+l)/p}var v=null!==(e=null==u?void 0:u.name)&&void 0!==e?e:"<Empty>";this._fromWeight=1-h,this._toWeight=h;var m=0!==l,y=1===h;return s.kind===Ea.animation&&m&&(ai("Update "+s.name),s.updateFromPort(l),this._fromUpdated=!0),u.kind===Ea.animation&&m&&(ai("Update "+u.name),u.updateToPort(l),this._toUpdated=!0),y&&(ri("[SubStateMachine "+this.name+"]: Transition finished:  "+s.name+" -> "+v+"."),this._finishCurrentTransition()),l},e._finishCurrentTransition=function(){var t=this._currentTransitionPath,e=this._currentTransitionToNode;d(t.length>0);var n=this._currentNode,i=e;this._callExitMethods(n);for(var r=this._currentTransitionPath,a=r.length,o=0;o<a;++o){var s=r[o].to;s.kind===Ea.exit&&this._callExitMethods(s)}this._fromUpdated=this._toUpdated,this._toUpdated=!1,this._dropCurrentTransition(),this._currentNode=i,n.kind===Ea.transitionSnapshot&&n.clear()},e._dropCurrentTransition=function(){var t=this._currentTransitionToNode;t.kind===Ea.animation&&t.finishTransition(),this._currentTransitionToNode=null,this._currentTransitionPath.length=0,this._fromWeight=1,this._toWeight=0},e._detectInterruption=function(t,e){var n=this._currentTransitionPath,i=this._currentNode,r=this._currentTransitionToNode;if(i.kind!==Ea.animation&&i.kind!==Ea.transitionSnapshot)return null;if(!r||r.kind!==Ea.animation)return null;c(0!==n.length);var a=n[0],o=a.interruption;if(o===Dn.NONE)return null;var s=Na.reset(),u=null,l=i.kind===Ea.animation?i:i.first,h=this._matchAnyScoped(l,t,s);h&&(u=l),s.hasZeroCost();var f=o===Dn.CURRENT_STATE||o===Dn.CURRENT_STATE_THEN_NEXT_STATE?Sa(i):r;(h=this._matchTransition(f,f,t,a,s))&&(u=f),s.hasZeroCost();var p=o===Dn.NEXT_STATE_THEN_CURRENT_STATE?Sa(i):o===Dn.CURRENT_STATE_THEN_NEXT_STATE?r:null;return p&&((h=this._matchTransition(p,p,t,a,s))&&(u=p),s.hasZeroCost()),Na.transition?e.set(u,Na.transition,Na.requires):null},e._interrupt=function(t){var e=t.from,n=t.transition,i=t.requires,r=this._currentNode;if(c(r.kind===Ea.animation||r.kind===Ea.transitionSnapshot),r.kind===Ea.animation){r.updateFromPort(i),this._fromUpdated=!0;var a=this._transitionSnapshot;c(a.empty),a.enqueue(r,1)}return this._takeCurrentTransitionSnapshot(e),this._dropCurrentTransition(),this._currentNode=this._transitionSnapshot,this._switchTo(n)},e._takeCurrentTransitionSnapshot=function(t){var e=this._currentTransitionPath,n=this._currentTransitionToNode,i=this._transitionSnapshot;c(0!==e.length),c(n&&n.kind===Ea.animation);var r=e[0],a=r.duration,o=r.normalizedDuration,s=t,u=0;if(a<=0)u=1;else{var l=this._transitionProgress,h=o?a*s.duration:a;u=l*h/h}i.enqueue(n,u)},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,i=0;i<n;++i){var r=e[i];this._resetTrigger(r)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case Ea.animation:t.components.callMotionStateEnterMethods(n,t.getToPortStatus());break;case Ea.entry:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case Ea.animation:t.components.callMotionStateExitMethods(n,t.getFromPortStatus());break;case Ea.exit:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineExitMethods(n)}},i(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}();function Sa(t){return t.kind===Ea.animation?t:t.first}var Ea,wa=Object.freeze({next:function(){return{done:!0,value:void 0}}}),Aa=Object.freeze(((ma={})[Symbol.iterator]=function(){return wa},ma)),Na=new(function(){function t(){this.transition=null,this.requires=1/0}var e=t.prototype;return e.hasZeroCost=function(){return 0===this.requires},e.isValid=function(){return null!==this.transition},e.set=function(t,e){return this.transition=t,this.requires=e,this},e.reset=function(){return this.requires=1/0,this.transition=null,this},t}()),ka=new(function(){function t(){this.transition=null,this.requires=0,this.from=null}return t.prototype.set=function(t,e,n){return this.from=t,this.transition=e,this.requires=n,this},t}());!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty",t[t.transitionSnapshot=5]="transitionSnapshot"}(Ea||(Ea={}));var Ca=function(t){this.name=void 0,this.outgoingTransitions=[],this.name=t.name},Ma=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var i=this._components,r=i.length,a=0;a<r;++a){var o=i[a];o[t]!==ya.prototype[t]&&o[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,i=n.length,r=0;r<i;++r){var a=n[r];a[t]!==ya.prototype[t]&&a[t](e)}},t}(),Ra=function(t){function n(e,n){var i,r,o;if((o=t.call(this,e)||this).kind=Ea.animation,o._source=null,o._baseSpeed=1,o._speed=1,o._fromPort={progress:0,statusCache:{progress:0}},o._toPort={progress:0,statusCache:{progress:0}},o._baseSpeed=e.speed,o._setSpeedMultiplier(1),e.speedMultiplierEnabled&&e.speedMultiplier){var s=e.speedMultiplier,u=n.getVar(s);if(Ri(u,s)){!function(t,e,n){if(t!==e)throw new Me(n,"number")}(u.type,$t.FLOAT,s),u.bind(o._setSpeedMultiplier,a(o));var l=u.value;o._setSpeedMultiplier(l)}}var c=y({},n),h=null!==(i=null===(r=e.motion)||void 0===r?void 0:r[Re](c))&&void 0!==i?i:null;return h&&Object.defineProperty(h,"__DEBUG_ID__",{value:o.name}),o._source=h,o.components=new Ma(e),o}e(n,t);var r=n.prototype;return r.updateFromPort=function(t){this._fromPort.progress=Oa(this._fromPort.progress,this.duration,t*this._speed)},r.updateToPort=function(t){this._toPort.progress=Oa(this._toPort.progress,this.duration,t*this._speed)},r.triggerFromPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getFromPortStatus())},r.triggerToPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getToPortStatus())},r.getFromPortStatus=function(){var t=this._fromPort.statusCache;return t.progress=Ia(this._fromPort.progress),t},r.getToPortStatus=function(){var t=this._toPort.statusCache;return t.progress=Ia(this._toPort.progress),t},r.resetToPort=function(t){this._toPort.progress=t},r.finishTransition=function(){this._fromPort.progress=this._toPort.progress},r.sampleFromPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._fromPort.progress,t)},r.sampleToPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._toPort.progress,t)},r.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):Aa},r._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},i(n,[{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._source)||void 0===e?void 0:e.duration)&&void 0!==t?t:0}},{key:"fromPortTime",get:function(){return this._fromPort.progress*this.duration}}]),n}(Ca);function Oa(t,e,n){return 0===e?0:t+n/e}function Ia(t){var e=t-Math.trunc(t);return e>=0?e:1+e}var xa,Pa,La,za,Ua,Fa,Ba,Da,Wa,Va,Ga=function(t){function n(e,n){var i;return(i=t.call(this,e)||this).kind=void 0,i.kind=n,i}return e(n,t),n}(Ca),Ha=function(t){function n(e){var n;return(n=t.call(this,e)||this).kind=Ea.empty,n}return e(n,t),n}(Ca),ja=function(t,e){this.motion=t,this.weight=e},qa=function(t){function n(){var e;return(e=t.call(this,{name:"[[TransitionSnapshotEval]]"})||this).kind=Ea.transitionSnapshot,e._queue=[],e}e(n,t);var r=n.prototype;return r.sample=function(t){for(var e=this._queue,n=e.length,i=0;i<n;++i){var r=e[i],a=r.motion,o=r.weight;a.sampleFromPort(o*t)}},r.clear=function(){this._queue.length=0},r.enqueue=function(t,e){for(var n=this._queue,i=n.length,r=1-e,a=0;a<i;++a)n[a].weight*=r;n.push(new ja(t,e))},i(n,[{key:"empty",get:function(){return 0===this._queue.length}},{key:"first",get:function(){var t=this._queue;return c(t.length>0),t[0].motion}}]),n}(Ca),Qa=(xa=E("cc.animation.AnimationController"),Pa=F(),La=U(ii),xa(za=Pa((Ba=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,r(e,"graph",Fa,a(e)),e._graphEval=null,e}e(n,t);var i=n.prototype;return i.__preload=function(){this.graph&&(this._graphEval=new ba(this.graph,this.node,this))},i.update=function(t){var e;null===(e=this._graphEval)||void 0===e||e.update(t)},i.getVariables=function(){return this._graphEval.getVariables()},i.setValue=function(t,e){this._graphEval.setValue(t,e)},i.getValue=function(t){return this._graphEval.getValue(t)},i.getCurrentStateStatus=function(t){return this._graphEval.getCurrentStateStatus(t)},i.getCurrentClipStatuses=function(t){return this._graphEval.getCurrentClipStatuses(t)},i.getCurrentTransition=function(t){return this._graphEval.getCurrentTransition(t)},i.getNextStateStatus=function(t){return this._graphEval.getNextStateStatus(t)},i.getNextClipStatuses=function(t){return this._graphEval.getNextClipStatuses(t)},i.getLayerWeight=function(t){return this._graphEval.getLayerWeight(t)},i.setLayerWeight=function(t,e){return this._graphEval.setLayerWeight(t,e)},n}(B),Fa=n((Ua=Ba).prototype,"graph",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),za=Ua))||za)||za);t("animation",Object.freeze({__proto__:null,UniformProxyFactory:ae,MorphWeightValueProxy:oe,MorphWeightsValueProxy:se,MorphWeightsAllValueProxy:ue,Track:nt,TrackPath:rt,RealTrack:at,VectorTrack:ot,QuatTrack:st,ColorTrack:ut,SizeTrack:lt,ObjectTrack:ct,isPropertyPath:ht,isCustomPath:ft,HierarchyPath:pt,ComponentPath:dt,CubicSplineVec2Value:_t,CubicSplineVec3Value:gt,CubicSplineVec4Value:vt,CubicSplineQuatValue:mt,CubicSplineNumberValue:yt,AnimationController:Qa,get VariableType(){return $t},StateMachineComponent:ya}));var Xa=t("AnimationManager",E((Va=Wa=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new T([]),e._crossFades=new T([]),e._delayEvents=[],e._blendStateBuffer=new ha,e._sockets=[],e}e(n,t);var r=n.prototype;return r.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},r.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):o(3907)},r.update=function(t){var e=this._delayEvents,n=this._crossFades,i=this._sockets,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var a=this._anims,o=a.array;for(a.i=0;a.i<o.length;++a.i){var s=o[a.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var u=b.director.getTotalFrames(),l=0,c=i.length;l<c;l++){var h=i[l],f=h.target,p=h.transform;f.matrix=Y(p,u)}for(var d=0,_=e.length;d<_;d++){var g=e[d];g.fn.apply(g.thisArg,g.args)}e.length=0},r.destruct=function(){},r.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},r.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):o(3907)},r.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},r.addSockets=function(t,e){for(var n=this,i=function(i){var r=e[i];if(n._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),o=r.target&&a&&J(a,t);o&&n._sockets.push({target:r.target,transform:o})},r=0;r<e.length;++r)i(r)},r.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===i.target){Z(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},i(n,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),n}(D),Wa.ID="animation",Da=Va))||Da);Q.on(X.EVENT_INIT,(function(){var t=new Xa;Q.registerSystem(Xa.ID,t,D.Priority.HIGH)})),b.AnimationManager=Xa,b.easing=W}}}));
